{"version":3,"names":["getGlobal","globalThis","Function","ensureObject","parent","names","root","name","getGlobalNamespace","namespace","getConfig","configName","exists","x","isNullish","isString","isNumber","isBoolean","isSymbol","isPrimitive","isArray","Array","isObject","Boolean","isPlainObject","Object","getPrototypeOf","ownInstanceOf","isEmptyObject","isFunction","isIterable","Symbol","iterator","_typedArrayNames","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","isTypedArray","className","ctor","prototype","toStringTagName","toStringTag","constructor","toString","call","slice","sameClass","lhs","rhs","$cdp","_verifier","notNullish","message","TypeError","typeOf","type","array","iterable","instanceOf","notOwnInstanceOf","hasProperty","prop","String","hasOwnProperty","verify","method","args","arrayEqual","len","length","i","deepEqual","bufferEqual","size","byteLength","pos","f64L","f64R","is","L","DataView","R","getUint32","getUint16","getUint8","assignValue","target","key","value","valueL","valueOf","valueR","isRegExpL","RegExp","isRegExpR","isArrayL","isArrayR","isBufferL","ArrayBuffer","isBufferR","isBufferViewL","isView","isBufferViewR","buffer","isIterableL","isIterableR","keysL","Set","keys","keysR","has","add","cloneArrayBuffer","arrayBuffer","result","set","needUpdate","oldValue","newValue","exceptUndefined","undefined","mergeObjectProperty","source","merge","cloneRegExp","regexp","flags","lastIndex","cloneTypedArray","typedArray","byteOffset","cloneDataView","dataView","mergeArray","mergeSet","item","Map","mergeMap","k","v","get","obj","deepMerge","sources","deepCopy","src","_objPrototype","_instanceOf","hasInstance","_override","_isInherited","_constructors","_classBase","_classSources","_protoExtendsOnly","reflectProperties","defineProperty","getOwnPropertyDescriptor","copyProperties","getOwnPropertyNames","filter","test","forEach","getOwnPropertySymbols","setInstanceOf","behaviour","isPrototypeOf","applied","defineProperties","writable","enumerable","mixins","base","_hasSourceConstructor","_MixinBase","super","constructors","this","srcClass","handler","apply","thisobj","arglist","Proxy","map","isMixedWith","reduce","p","c","static","instance","ctors","desc","orgInstanceOf","inst","propName","invert","accessible","callable","safe","create","stub","_root","setTimeout","clearTimeout","setInterval","clearInterval","post","executor","Promise","resolve","then","createEscaper","escaper","match","join","regexTest","regexReplace","replace","mapHtmlEscape","escapeHTML","unescapeHTML","fromTypedData","data","JSON","stringify","dropUndefined","nullishSerialize","restoreNullish","_localId","randomInt","min","max","Math","floor","random","_regexCancelLikeString","isCancelLikeError","error","capitalize","lowercaseRest","remainingChars","toLowerCase","charAt","toUpperCase","decapitalize","camelize","lower","trim","unique","difference","others","arrays","acc","ary","el","includes","async","callback","thisArg","all","a","_computeDateFuncMap","year","date","setUTCFullYear","getUTCFullYear","month","setUTCMonth","getUTCMonth","day","setUTCDate","getUTCDate","hour","setUTCHours","getUTCHours","setUTCMinutes","getUTCMinutes","sec","setUTCSeconds","getUTCSeconds","msec","setUTCMilliseconds","getUTCMilliseconds","_status","statusAddRef","status","statusRelease","retval","_mapListeners","WeakMap","listeners","validChannel","channel","validListener","listener","triggerEvent","original","list","eventArgs","handled","e","reject","EventPublisher","publish","hasListener","channels","on","ch","freeze","enable","unsubscribe","delete","once","context","managed","off","clear","EventBroker","trigger","_context","register","subscriptions","s","push","listenerMap","unregister","values","EventReceiver","listenTo","listenToOnce","stopListening","EventSource","EventSourceBase","_cancel","_close","invalidSubscription","_tokens","getContext","CancelToken","linkedTokens","cancel","close","token","onCancel","onClose","linkedTokenSet","t","broker","reason","seal","bind","cancelable","requested","closed","NativePromise","nativeThen","_create","CancelablePromise","species","cancelToken","thenArgs","dispose","Error","setPrototypeOf","onfulfilled","onrejected","catch","finally","onfinally","extendPromise","wait","promises","safePromises","promise","checkCanceled","noAutomaticNativeExtend","Deferred","publications","assign","EventBrokerProxy","_broker","_internal","_notify","_stockChange","_notifyChanges","verifyObservable","_proxyHandler","receiver","Reflect","state","ObservableObject","internal","changed","changeMap","property","props","suspend","noRecord","resume","getObservableState","getBroker","observable","notify","properties","keyValue","keyValuePairs","curValue","eventBroker","attributes","byMethod","oldLength","newLength","stock","scrap","isValidArrayIndex","Number","deleteProperty","index","n","trunc","ObservableArray","arguments","records","indexes","argLength","sort","comparator","old","from","splice","start","deleteCount","items","oldLen","shift","unshift","callbackfn","rci","findRelatedChangeIndex","checkType","rct","r","prevRecord","CDP_DECLARE","RESULT_CODE","ASSIGN_RESULT_CODE","extend","_code2message","declareResultCode","code","succeeded","RangeError","signed","resultCode","ERROR_MESSAGE_MAP","DECLARE_SUCCESS_CODE","DECLARE_ERROR_CODE","FAILED","SUCCEEDED","toNameString","tag","prefix","toHelpString","isFinite","configurable","Result","options","SUCCESS","FAIL","cause","time","isError","Date","now","isSucceeded","isFailed","isCanceled","ABORT","codeName","help","MemoryStorage","_storage","kind","cc","dataType","newVal","oldVal","silent","memoryStorage","globalSettings","tags","escape","cache","escapeTemplateExp","Scanner","_source","_tail","_pos","eos","scan","exec","string","substring","scanUntil","search","Context","_view","_parent","_cache","view","parentContext","lookup","intermediateValue","lookupHit","indexOf","split","_regexp","white","space","equals","curly","Writer","parse","template","cacheKey","buildCacheKey","tokens","parseTemplate","lineHasNonSpace","sections","spaces","hasTag","nonSpace","indentation","tagIndex","stripSpace","pop","compileTags","tagsToCompile","openingTag","closingTag","closingCurly","reTag","reWhite","reEquals","reCurly","_regxpTags","scanner","openSection","reOpeningTag","reClosingTag","reClosingCurly","valueLength","chr","nestTokens","nestedTokens","collector","section","squashTokens","squashedTokens","lastToken","render","partials","renderTokens","originalTemplate","renderSection","renderInverted","renderPartial","unescapedValue","escapedValue","rawValue","self","subRender","indentPartial","partial","filteredIndentation","partialByNl","indentedValue","writer","PromiseManager","_pool","cancelSource","always","release","race","allSettled","any","abort","canceler","Registry","_rootKey","_defaultOptions","_store","storage","rootKey","formatSpace","jsonSpace","getItem","opts","setItem","read","field","structure","lastKey","reg","targetRoot","write","noSave","remove","removeItem","TemplateEngine","typeString","jst","cacheLocation","clearCache","setiings","oldSettings","at","idx","checkStatus","pending","classify","combination","count","val","entries","n1","row","j","n2","concat","computeDate","unit","getTime","func","dasherize","debounce","immediate","handle","later","debounced","callNow","diff","drop","dropValues","every","bits","find","findIndex","groupBy","sumKeys","groupKey","_groupKey","_sumKeys","hash","res","_key","keyList","h","resKey","indices","excludes","exList","ex","intersection","isBigInt","isNumeric","isNaN","isObservable","isResult","isStatusIn","luid","zeroPad","id","padStart","makeCanceledResult","makeResult","noop","omit","omitKeys","memo","permutation","parts","pick","pickKeys","initialValue","hasInit","fallback","o","sameType","sample","last","rand","temp","setMixClassAttribute","attr","shuffle","destructive","swap","sleep","elapse","some","statusScope","throttle","previous","leading","throttled","arg","remaining","trailing","toResult","toTypedData","underscored","union","flat","without"],"sources":["cdp:///@cdp/lib-core/core-utils/config.ts","cdp:///@cdp/lib-core/core-utils/types.ts","cdp:///@cdp/lib-core/core-utils/verify.ts","cdp:///@cdp/lib-core/core-utils/deep-circuit.ts","cdp:///@cdp/lib-core/core-utils/mixins.ts","cdp:///@cdp/lib-core/core-utils/object.ts","cdp:///@cdp/lib-core/core-utils/safe.ts","cdp:///@cdp/lib-core/core-utils/timer.ts","cdp:///@cdp/lib-core/core-utils/misc.ts","cdp:///@cdp/lib-core/core-utils/array.ts","cdp:///@cdp/lib-core/core-utils/date.ts","cdp:///@cdp/lib-core/core-utils/status.ts","cdp:///@cdp/lib-core/events/publisher.ts","cdp:///@cdp/lib-core/events/broker.ts","cdp:///@cdp/lib-core/events/receiver.ts","cdp:///@cdp/lib-core/events/source.ts","cdp:///@cdp/lib-core/promise/internal.ts","cdp:///@cdp/lib-core/promise/cancel-token.ts","cdp:///@cdp/lib-core/promise/cancelable-promise.ts","cdp:///@cdp/lib-core/promise/utils.ts","cdp:///@cdp/lib-core/promise/deferred.ts","cdp:///@cdp/lib-core/observable/internal.ts","cdp:///@cdp/lib-core/observable/object.ts","cdp:///@cdp/lib-core/observable/array.ts","cdp:///@cdp/lib-core/result/result-code-defs.ts","cdp:///@cdp/lib-core/result/result-code.ts","cdp:///@cdp/lib-core/result/result.ts","cdp:///@cdp/lib-core/core-storage/memory-storage.ts","cdp:///@cdp/lib-core/core-template/internal.ts","cdp:///@cdp/lib-core/core-template/cache.ts","cdp:///@cdp/lib-core/core-template/utils.ts","cdp:///@cdp/lib-core/core-template/scanner.ts","cdp:///@cdp/lib-core/core-template/context.ts","cdp:///@cdp/lib-core/core-template/parse.ts","cdp:///@cdp/lib-core/core-template/writer.ts","cdp:///@cdp/lib-core/core-template/class.ts","cdp:///@cdp/lib-core/promise/promise-manager.ts","cdp:///@cdp/lib-core/core-storage/registry.ts","cdp:///@cdp/lib-core/observable/common.ts"],"sourcesContent":["/**\n * @en Safe `global` accessor.\n * @ja `global` ã¢ã¯ã»ããµ\n * \n * @returns\n *  - `en` `global` object of the runtime environment\n *  - `ja` ç°å¢ã«å¿ãã `global` ãªãã¸ã§ã¯ã\n */\nexport function getGlobal(): typeof globalThis {\n    // eslint-disable-next-line no-new-func, @typescript-eslint/no-implied-eval\n    return ('object' === typeof globalThis) ? globalThis : Function('return this')();\n}\n\n/**\n * @en Ensure named object as parent's property.\n * @ja è¦ªãªãã¸ã§ã¯ããæå®ãã¦, ååã«æå®ãããªãã¸ã§ã¯ãã®å­å¨ãä¿è¨¼\n *\n * @param parent\n *  - `en` parent object. If null given, `globalThis` is assigned.\n *  - `ja` è¦ªãªãã¸ã§ã¯ã. null ã®å ´åã¯ `globalThis` ãä½¿ç¨ããã\n * @param names\n *  - `en` object name chain for ensure instance.\n *  - `ja` ä¿è¨¼ãããªãã¸ã§ã¯ãã®åå\n */\nexport function ensureObject<T extends object = object>(parent: object | null, ...names: string[]): T {\n    let root = parent || getGlobal();\n    for (const name of names) {\n        root[name] = root[name] || {};\n        root = root[name];\n    }\n    return root as T;\n}\n\n/**\n * @en Global namespace accessor.\n * @ja ã°ã­ã¼ãã«ãã¼ã ã¹ãã¼ã¹ã¢ã¯ã»ããµ\n */\nexport function getGlobalNamespace<T extends object = object>(namespace: string): T {\n    return ensureObject<T>(null, namespace);\n}\n\n/**\n * @en Global config accessor.\n * @ja ã°ã­ã¼ãã«ã³ã³ãã£ã°ã¢ã¯ã»ããµ\n *\n * @returns default: `CDP.Config`\n */\nexport function getConfig<T extends object = object>(namespace = 'CDP', configName = 'Config'): T {\n    return ensureObject<T>(getGlobalNamespace(namespace), configName);\n}\n","/* eslint-disable\n    @typescript-eslint/no-explicit-any,\n    @typescript-eslint/ban-types,\n */\n\n/**\n * @en Primitive type of JavaScript.\n * @ja JavaScript ã®ããªããã£ãå\n */\nexport type Primitive = string | number | boolean | symbol | bigint | null | undefined;\n\n/**\n * @en The general null type.\n * @ja ç©ºãç¤ºãåå®ç¾©\n */\nexport type Nullish = void | null | undefined;\n\n/**\n * @en The type of object or [[Nullish]].\n * @ja [[Nullish]] ã«ãªããããªãã¸ã§ã¯ãåå®ç¾©\n */\nexport type Nullable<T extends object> = T | Nullish;\n\n/**\n * @en Avoid the `Function`types.\n * @ja æ±ç¨é¢æ°å\n */\nexport type UnknownFunction = (...args: unknown[]) => unknown;\n\n/**\n * @en Avoid the `Object` and `{}` types, as they mean \"any non-nullish value\".\n * @ja æ±ç¨ãªãã¸ã§ã¯ãå. `Object` ããã³ `{}` ã¿ã¤ãã¯ãnullã§ãªãå¤ããæå³ããããä»£ä¾¡ã¨ãã¦ä½¿ç¨\n */\nexport type UnknownObject = Record<string | number | symbol, unknown>;\n\n/**\n * @en JavaScript type set interface.\n * @ja JavaScript ã®åã®éå\n */\ninterface TypeList {\n    string: string;\n    number: number;\n    boolean: boolean;\n    symbol: symbol;\n    bigint: bigint;\n    undefined: void | undefined;\n    object: object | null;\n    function(...args: unknown[]): unknown;\n}\n\n/**\n * @en The key list of [[TypeList]].\n * @ja [[TypeList]] ã­ã¼ä¸è¦§\n */\nexport type TypeKeys = keyof TypeList;\n\n/**\n * @en Type base definition.\n * @ja åã®è¦å®å®ç¾©\n */\nexport interface Type<T extends object> extends Function {\n    readonly prototype: T;\n}\n\n/**\n * @en Type of constructor.\n * @ja ã³ã³ã¹ãã©ã¯ã¿å\n */\nexport interface Constructor<T extends object> extends Type<T> {\n    new(...args: any[]): T;\n}\n\n/**\n * @en Type of class.\n * @ja ã¯ã©ã¹å\n */\nexport type Class<T extends object = object> = Constructor<T>;\n\n/**\n * @en Ensure for function parameters to tuple.\n * @ja é¢æ°ãã©ã¡ã¼ã¿ã¨ãã¦ tuple ãä¿è¨¼\n */\nexport type Arguments<T> = T extends any[] ? T : [T];\n\n/**\n * @en Rmove `readonly` attributes from input type.\n * @ja `readonly` å±æ§ãè§£é¤\n */\nexport type Writable<T> = { -readonly [K in keyof T]: T[K] };\n\n/**\n * @en Extract functional property names.\n * @ja é¢æ°ãã­ããã£åã®æ½åº\n */\nexport type FunctionPropertyNames<T> = { [K in keyof T]: T[K] extends Function ? K : never }[keyof T] & string;\n\n/**\n * @en Extract functional properties.\n * @ja é¢æ°ãã­ããã£ã®æ½åº\n */\nexport type FunctionProperties<T> = Pick<T, FunctionPropertyNames<T>>;\n\n/**\n * @en Extract non-functional property names.\n * @ja éé¢æ°ãã­ããã£åã®æ½åº\n */\nexport type NonFunctionPropertyNames<T> = { [K in keyof T]: T[K] extends Function ? never : K }[keyof T] & string;\n\n/**\n * @en Extract non-functional properties.\n * @ja éé¢æ°ãã­ããã£ã®æ½åº\n */\nexport type NonFunctionProperties<T> = Pick<T, NonFunctionPropertyNames<T>>;\n\n/**\n * @en Extract non-functional types.\n * @ja éé¢æ°åã®æ½åº\n */\nexport type NonFunction<T> = T extends Function ? never : T;\n\n/**\n * @en Extract object key list. (ensure only 'string')\n * @ja ãªãã¸ã§ã¯ãã®ã­ã¼ä¸è¦§ãæ½åº ('string' åã®ã¿ãä¿è¨¼)\n */\nexport type Keys<T extends object> = keyof Omit<T, number | symbol>;\n\n/**\n * @en Extract object type list.\n * @ja ãªãã¸ã§ã¯ãã®åä¸è¦§ãæ½åº\n */\nexport type Types<T extends object> = T[keyof T];\n\n/**\n * @en Convert object key to type.\n * @ja ãªãã¸ã§ã¯ãã­ã¼ããåã¸å¤æ\n */\nexport type KeyToType<O extends object, K extends keyof O> = K extends keyof O ? O[K] : never;\n\n/**\n * @en Convert object type to key.\n * @ja ãªãã¸ã§ã¯ãåããã­ã¼ã¸å¤æ\n */\nexport type TypeToKey<O extends object, T extends Types<O>> = { [K in keyof O]: O[K] extends T ? K : never }[keyof O];\n\n/**\n * @en The [[PlainObject]] type is a JavaScript object containing zero or more key-value pairs. <br>\n *     'Plain' means it from other kinds of JavaScript objects. ex: null, user-defined arrays, and host objects such as `document`.\n * @ja 0 ä»¥ä¸ã® key-value ãã¢ãæã¤ [[PlainObject]] å®ç¾© <br>\n *     'Plain' ã¨ã¯ä»ã®ç¨®é¡ã® JavaScript ãªãã¸ã§ã¯ããå«ã¾ãªããªãã¸ã§ã¯ããæå³ãã. ä¾:  null, ã¦ã¼ã¶ã¼å®ç¾©éå, ã¾ãã¯ `document` ã®ãããªçµã¿è¾¼ã¿ãªãã¸ã§ã¯ã\n */\nexport type PlainObject<T = {} | null | undefined> = Record<string, T>;\n\n/**\n * @en Object can be guaranteed definition. Be careful not to abuse it because it does not force the cast.\n *   - Unlike [[PlainObject]], it can accept Class (built-in object), Array, Function.\n *   - Unlike `object`, you can access unknown properties.\n *   - Unlike `{} / Object`, it can repel [[Primitive]].\n * @ja Object ãä¿è¨¼å¯è½ãªå®ç¾©. ã­ã£ã¹ããå¼·å¶ããªãããä¹±ç¨ããªãããã«æ³¨æãå¿è¦.\n *   - [[PlainObject]] ã¨éããClass (çµã¿è¾¼ã¿ãªãã¸ã§ã¯ã), Array, Function ãåãä»ãããã¨ãã§ãã.\n *   - `object` ã¨éããæªç¥ã®ãã­ããã£ã«ã¢ã¯ã»ã¹ãããã¨ãã§ãã.\n *   - `{} / Object` ã¨éãã[[Primitive]] ãã¯ãããã¨ãã§ãã.\n */\nexport type AnyObject = Record<string, any>;\n\n/**\n * @en The data type list by which style compulsion is possible.\n * @ja åå¼·å¶å¯è½ãªãã¼ã¿åä¸è¦§\n */\nexport type TypedData = string | number | boolean | null | object;\n\n/**\n * @en The data type list of TypedArray.\n * @ja TypedArray ä¸è¦§\n */\nexport type TypedArray = Int8Array | Uint8Array | Uint8ClampedArray | Int16Array | Uint16Array | Int32Array | Uint32Array | Float32Array | Float64Array;\n\n/**\n * @en TypedArray constructor.\n * @ja TypedArray ã³ã³ã¹ãã©ã¯ã¿å®ç¾©\n */\nexport interface TypedArrayConstructor {\n    readonly prototype: TypedArray;\n    new(seed: number | ArrayLike<number> | ArrayBufferLike): TypedArray;\n    new(buffer: ArrayBufferLike, byteOffset?: number, length?: number): TypedArray;\n\n    /**\n     * @en The size in bytes of each element in the array.\n     * @ja è¦ç´ ã®ãã¤ããµã¤ãº\n     */\n    readonly BYTES_PER_ELEMENT: number;\n\n    /**\n     * @en Returns a new array from a set of elements.\n     * @ja è¦ç´ ãè¨­å®ãæ°è¦éåãè¿å´\n     *\n     * @param items\n     *  - `en` A set of elements to include in the new array object.\n     *  - `ja` æ°ãã«è¨­å®ããè¦ç´ \n     */\n    of(...items: number[]): TypedArray;\n\n    /**\n     * @en Creates an array from an array-like or iterable object.\n     * @ja array-like / iteratable ãªãã¸ã§ã¯ãããæ°è¦éåãä½æ\n     *\n     * @param arrayLike\n     *  - `en` An array-like or iterable object to convert to an array.\n     *  - `ja` array-like ãããã¯ iteratable ãªãã¸ã§ã¯ã\n     */\n    from(arrayLike: ArrayLike<number>): TypedArray;\n\n    /**\n     * @en Creates an array from an array-like or iterable object.\n     * @ja array-like / iteratable ãªãã¸ã§ã¯ãããæ°è¦éåãä½æ\n     *\n     * @param arrayLike\n     *  - `en` An array-like or iterable object to convert to an array.\n     *  - `ja` array-like ãããã¯ iteratable ãªãã¸ã§ã¯ã\n     * @param mapfn\n     *  - `en` A mapping function to call on every element of the array.\n     *  - `ja` å¨è¦ç´ ã«é©ç¨ãããã­ã­ã·é¢æ°\n     * @param thisArg\n     *  - `en` Value of 'this' used to invoke the mapfn.\n     *  - `ja` mapfn ã«ä½¿ç¨ãã 'this'\n     */\n    from<T>(arrayLike: ArrayLike<T>, mapfn: (v: T, k: number) => number, thisArg?: unknown): TypedArray;\n}\n\n//__________________________________________________________________________________________________//\n\n/**\n * @en Check the value exists.\n * @ja å¤ãå­å¨ãããå¤å®\n *\n * @param x\n *  - `en` evaluated value\n *  - `ja` è©ä¾¡ããå¤\n */\nexport function exists<T>(x: T | Nullish): x is T {\n    return null != x;\n}\n\n/**\n * @en Check the value-type is [[Nullish]].\n * @ja [[Nullish]] åã§ãããå¤å®\n *\n * @param x\n *  - `en` evaluated value\n *  - `ja` è©ä¾¡ããå¤\n */\nexport function isNullish(x: unknown): x is Nullish {\n    return null == x;\n}\n\n/**\n * @en Check the value-type is String.\n * @ja String åã§ãããå¤å®\n *\n * @param x\n *  - `en` evaluated value\n *  - `ja` è©ä¾¡ããå¤\n */\nexport function isString(x: unknown): x is string {\n    return 'string' === typeof x;\n}\n\n/**\n * @en Check the value-type is Number.\n * @ja Number åã§ãããå¤å®\n *\n * @param x\n *  - `en` evaluated value\n *  - `ja` è©ä¾¡ããå¤\n */\nexport function isNumber(x: unknown): x is number {\n    return 'number' === typeof x;\n}\n\n/**\n * @en Check the value-type is Boolean.\n * @ja Boolean åã§ãããå¤å®\n *\n * @param x\n *  - `en` evaluated value\n *  - `ja` è©ä¾¡ããå¤\n */\nexport function isBoolean(x: unknown): x is boolean {\n    return 'boolean' === typeof x;\n}\n\n/**\n * @en Check the value-type is Symble.\n * @ja Symbol åã§ãããå¤å®\n *\n * @param x\n *  - `en` evaluated value\n *  - `ja` è©ä¾¡ããå¤\n */\nexport function isSymbol(x: unknown): x is symbol {\n    return 'symbol' === typeof x;\n}\n\n/**\n * @en Check the value-type is BigInt.\n * @ja BigInt åã§ãããå¤å®\n *\n * @param x\n *  - `en` evaluated value\n *  - `ja` è©ä¾¡ããå¤\n */\nexport function isBigInt(x: unknown): x is bigint {\n    return 'bigint' === typeof x;\n}\n\n/**\n * @en Check the value-type is primitive type.\n * @ja ããªããã£ãåã§ãããå¤å®\n *\n * @param x\n *  - `en` evaluated value\n *  - `ja` è©ä¾¡ããå¤\n */\nexport function isPrimitive(x: unknown): x is Primitive {\n    return !x || ('function' !== typeof x) && ('object' !== typeof x);\n}\n\n/**\n * @en Check the value-type is Array.\n * @ja Array åã§ãããå¤å®\n *\n * @param x\n *  - `en` evaluated value\n *  - `ja` è©ä¾¡ããå¤\n */\nexport const isArray = Array.isArray;\n\n/**\n * @en Check the value-type is Object.\n * @ja Object åã§ãããå¤å®\n *\n * @param x\n *  - `en` evaluated value\n *  - `ja` è©ä¾¡ããå¤\n */\nexport function isObject(x: unknown): x is object {\n    return Boolean(x) && 'object' === typeof x;\n}\n\n/**\n * @en Check the value-type is [[PlainObject]].\n * @ja [[PlainObject]] åã§ãããå¤å®\n *\n * @param x\n *  - `en` evaluated value\n *  - `ja` è©ä¾¡ããå¤\n */\nexport function isPlainObject(x: unknown): x is PlainObject {\n    if (!isObject(x)) {\n        return false;\n    }\n\n    // create from `Object.create( null )` is plain\n    if (!Object.getPrototypeOf(x)) {\n        return true;\n    }\n\n    return ownInstanceOf(Object, x);\n}\n\n/**\n * @en Check the value-type is empty object.\n * @ja ç©ºãªãã¸ã§ã¯ãã§ãããå¤å®\n *\n * @param x\n *  - `en` evaluated value\n *  - `ja` è©ä¾¡ããå¤\n */\nexport function isEmptyObject(x: unknown): x is object {\n    if (!isPlainObject(x)) {\n        return false;\n    }\n    for (const name in x) {\n        return false;\n    }\n    return true;\n}\n\n/**\n * @en Check the value-type is Function.\n * @ja Function åã§ãããå¤å®\n *\n * @param x\n *  - `en` evaluated value\n *  - `ja` è©ä¾¡ããå¤\n */\nexport function isFunction(x: unknown): x is TypeList['function'] {\n    return 'function' === typeof x;\n}\n\n/**\n * @en Check the value can be convert to a number.\n * @ja æ°å¤ã«å¤æå¯è½ãå¤å®\n *\n * @param x\n *  - `en` evaluated value\n *  - `ja` è©ä¾¡ããå¤\n */\nexport function isNumeric(x: unknown): x is number {\n    return !isNullish(x) && !isBoolean(x) && !isArray(x) && !isSymbol(x) && ('' !== x) && !Number.isNaN(Number(x));\n}\n\n/**\n * @en Check the value-type is input.\n * @ja æå®ããåã§ãããå¤å®\n *\n * @param type\n *  - `en` evaluated type\n *  - `ja` è©ä¾¡ããå\n * @param x\n *  - `en` evaluated value\n *  - `ja` è©ä¾¡ããå¤\n */\nexport function typeOf<K extends TypeKeys>(type: K, x: unknown): x is TypeList[K] {\n    return typeof x === type;\n}\n\n/**\n * @en Check the value has iterator.\n * @ja iterator ãææãã¦ãããå¤å®\n *\n * @param x\n *  - `en` evaluated value\n *  - `ja` è©ä¾¡ããå¤\n */\nexport function isIterable<T>(x: Nullable<Iterable<T>>): x is Iterable<T>;\nexport function isIterable(x: unknown): x is Iterable<unknown>;\nexport function isIterable(x: unknown): any {\n    return Symbol.iterator in Object(x);\n}\n\n/** @internal */\nconst _typedArrayNames = {\n    'Int8Array': true,\n    'Uint8Array': true,\n    'Uint8ClampedArray': true,\n    'Int16Array': true,\n    'Uint16Array': true,\n    'Int32Array': true,\n    'Uint32Array': true,\n    'Float32Array': true,\n    'Float64Array': true,\n};\n\n/**\n * @en Check the value is one of [[TypedArray]].\n * @ja æå®ããã¤ã³ã¹ã¿ã³ã¹ã [[TypedArray]] ã®ä¸ç¨®ã§ãããå¤å®\n *\n * @param x\n *  - `en` evaluated value\n *  - `ja` è©ä¾¡ããå¤\n */\nexport function isTypedArray(x: unknown): x is TypedArray {\n    return !!_typedArrayNames[className(x)];\n}\n\n/**\n * @en Check the value instance of input.\n * @ja æå®ããã¤ã³ã¹ã¿ã³ã¹ã§ãããå¤å®\n *\n * @param ctor\n *  - `en` evaluated constructor\n *  - `ja` è©ä¾¡ããã³ã³ã¹ãã©ã¯ã¿\n * @param x\n *  - `en` evaluated value\n *  - `ja` è©ä¾¡ããå¤\n */\nexport function instanceOf<T extends object>(ctor: Nullable<Type<T>>, x: unknown): x is T {\n    return ('function' === typeof ctor) && (x instanceof ctor);\n}\n\n/**\n * @en Check the value instance of input constructor (except sub class).\n * @ja æå®ã³ã³ã¹ãã©ã¯ã¿ã®ã¤ã³ã¹ã¿ã³ã¹ã§ãããå¤å® (æ´¾çã¯ã©ã¹ã¯å«ããªã)\n *\n * @param ctor\n *  - `en` evaluated constructor\n *  - `ja` è©ä¾¡ããã³ã³ã¹ãã©ã¯ã¿\n * @param x\n *  - `en` evaluated value\n *  - `ja` è©ä¾¡ããå¤\n */\nexport function ownInstanceOf<T extends object>(ctor: Nullable<Type<T>>, x: unknown): x is T {\n    return (null != x) && ('function' === typeof ctor) && (Object.getPrototypeOf(x) === Object(ctor.prototype));\n}\n\n/**\n * @en Get the value's class name.\n * @ja ã¯ã©ã¹åãåå¾\n *\n * @param x\n *  - `en` evaluated value\n *  - `ja` è©ä¾¡ããå¤\n */\nexport function className(x: any): string {\n    if (x != null) {\n        const toStringTagName = x[Symbol.toStringTag];\n        if (isString(toStringTagName)) {\n            return toStringTagName;\n        } else if (isFunction(x) && x.prototype && null != x.name) {\n            return x.name;\n        } else {\n            const ctor = x.constructor;\n            if (isFunction(ctor) && ctor === (Object(ctor.prototype) as object).constructor) {\n                return ctor.name;\n            }\n        }\n    }\n    return (Object.prototype.toString.call(x) as string).slice(8, -1);\n}\n\n/**\n * @en Check input values are same value-type.\n * @ja å¥åãåä¸åã§ãããå¤å®\n *\n * @param lhs\n *  - `en` evaluated value\n *  - `ja` è©ä¾¡ããå¤\n * @param rhs\n *  - `en` evaluated value\n *  - `ja` è©ä¾¡ããå¤\n */\nexport function sameType(lhs: unknown, rhs: unknown): boolean {\n    return typeof lhs === typeof rhs;\n}\n\n/**\n * @en Check input values are same class.\n * @ja å¥åãåä¸ã¯ã©ã¹ã§ãããå¤å®\n *\n * @param lhs\n *  - `en` evaluated value\n *  - `ja` è©ä¾¡ããå¤\n * @param rhs\n *  - `en` evaluated value\n *  - `ja` è©ä¾¡ããå¤\n */\nexport function sameClass(lhs: unknown, rhs: unknown): boolean {\n    if (null == lhs && null == rhs) {\n        return className(lhs) === className(rhs);\n    } else {\n        return (null != lhs) && (null != rhs) && (Object.getPrototypeOf(lhs) === Object.getPrototypeOf(rhs));\n    }\n}\n\n/**\n * @en Common Symble for framework.\n * @ja ãã¬ã¼ã ã¯ã¼ã¯ãå±éã§ä½¿ç¨ãã Symble\n */\nexport const $cdp = Symbol('@cdp');\n","/* eslint-disable\n    @typescript-eslint/ban-types,\n */\n\nimport {\n    UnknownFunction,\n    TypeKeys,\n    isArray,\n    exists,\n    className,\n} from './types';\n\n/**\n * @en Type verifier interface definition. <br>\n *     If invalid value received, the method throws `TypeError`.\n * @ja åæ¤è¨¼ã®ã¤ã³ã¿ã¼ãã§ã¤ã¹å®ç¾© <br>\n *     éåããå ´åã¯ `TypeError` ãçºç\n *\n *\n */\ninterface Verifier {\n    /**\n     * @en Verification for the input value is not [[Nullish]].\n     * @ja [[Nullish]] ã§ãªããã¨ãæ¤è¨¼\n     *\n     * @param notNullish.x\n     *  - `en` evaluated value\n     *  - `ja` è©ä¾¡ããå¤\n     * @param notNullish.message\n     *  - `en` custom error message\n     *  - `ja` ã«ã¹ã¿ã ã¨ã©ã¼ã¡ãã»ã¼ã¸\n     */\n    notNullish: (x: unknown, message?: string | null) => void | never;\n\n    /**\n     * @en Verification for the input is [[TypeKeys]].\n     * @ja æå®ãã [[TypeKeys]] ã§ãããæ¤è¨¼\n     *\n     * @param typeOf.type\n     *  - `en` one of [[TypeKeys]]\n     *  - `ja` [[TypeKeys]] ãæå®\n     * @param typeOf.x\n     *  - `en` evaluated value\n     *  - `ja` è©ä¾¡ããå¤\n     * @param typeOf.message\n     *  - `en` custom error message\n     *  - `ja` ã«ã¹ã¿ã ã¨ã©ã¼ã¡ãã»ã¼ã¸\n     */\n    typeOf: (type: TypeKeys, x: unknown, message?: string | null) => void | never;\n\n    /**\n     * @en Verification for the input value is `Array`.\n     * @ja `Array` ã§ãããæ¤è¨¼\n     *\n     * @param array.x\n     *  - `en` evaluated value\n     *  - `ja` è©ä¾¡ããå¤\n     * @param array.message\n     *  - `en` custom error message\n     *  - `ja` ã«ã¹ã¿ã ã¨ã©ã¼ã¡ãã»ã¼ã¸\n     */\n    array: (x: unknown, message?: string | null) => void | never;\n\n    /**\n     * @en Verification for the input value is `Iterable`.\n     * @ja `Iterable` ã§ãããæ¤è¨¼\n     *\n     * @param iterable.x\n     *  - `en` evaluated value\n     *  - `ja` è©ä¾¡ããå¤\n     * @param iterable.message\n     *  - `en` custom error message\n     *  - `ja` ã«ã¹ã¿ã ã¨ã©ã¼ã¡ãã»ã¼ã¸\n     */\n    iterable: (x: unknown, message?: string | null) => void | never;\n\n    /**\n     * @en Verification for the input instance is equal comparative target constructor.\n     * @ja æå®ã³ã³ã¹ãã©ã¯ã¿ã®ã¤ã³ã¹ã¿ã³ã¹ã§ãããæ¤è¨¼\n     *\n     * @param instanceOf.ctor\n     *  - `en` comparative target constructor\n     *  - `ja` æ¯è¼å¯¾è±¡ã®ã³ã³ã¹ãã©ã¯ã¿\n     * @param instanceOf.x\n     *  - `en` evaluated value\n     *  - `ja` è©ä¾¡ããå¤\n     * @param instanceOf.message\n     *  - `en` custom error message\n     *  - `ja` ã«ã¹ã¿ã ã¨ã©ã¼ã¡ãã»ã¼ã¸\n     */\n    instanceOf: (ctor: Function, x: unknown, message?: string | null) => void | never;\n\n    /**\n     * @en Verification for the input instance has `strictly` comparative target constructor.\n     * @ja æå®ã³ã³ã¹ãã©ã¯ã¿ã®å³å¯ä¸è´ããã¤ã³ã¹ã¿ã³ã¹ã§ãããæ¤è¨¼\n     *\n     * @param ownInstanceOf.ctor\n     *  - `en` comparative target constructor\n     *  - `ja` æ¯è¼å¯¾è±¡ã®ã³ã³ã¹ãã©ã¯ã¿\n     * @param ownInstanceOf.x\n     *  - `en` evaluated value\n     *  - `ja` è©ä¾¡ããå¤\n     * @param ownInstanceOf.message\n     *  - `en` custom error message\n     *  - `ja` ã«ã¹ã¿ã ã¨ã©ã¼ã¡ãã»ã¼ã¸\n     */\n    ownInstanceOf: (ctor: Function, x: unknown, message?: string | null) => void | never;\n\n    /**\n     * @en Verification for the input instance has not `strictly` equal comparative target constructor.\n     * @ja æå®ã³ã³ã¹ãã©ã¯ã¿ãæã¤ã¤ã³ã¹ã¿ã³ã¹ã§ãªããã¨ãæ¤è¨¼\n     *\n     * @param notOwnInstanceOf.ctor\n     *  - `en` comparative target constructor\n     *  - `ja` æ¯è¼å¯¾è±¡ã®ã³ã³ã¹ãã©ã¯ã¿\n     * @param notOwnInstanceOf.x\n     *  - `en` evaluated value\n     *  - `ja` è©ä¾¡ããå¤\n     * @param notOwnInstanceOf.message\n     *  - `en` custom error message\n     *  - `ja` ã«ã¹ã¿ã ã¨ã©ã¼ã¡ãã»ã¼ã¸\n     */\n    notOwnInstanceOf: (ctor: Function, x: unknown, message?: string | null) => void | never;\n\n    /**\n     * @en Verification for the input value has specified property.\n     * @ja æå®ãã­ããã£ãæã£ã¦ãããæ¤è¨¼\n     *\n     * @param hasProperty.prop\n     *  - `en` specified property\n     *  - `ja` å¯¾è±¡ã®ãã­ããã£\n     * @param hasProperty.x\n     *  - `en` evaluated value\n     *  - `ja` è©ä¾¡ããå¤\n     * @param hasProperty.message\n     *  - `en` custom error message\n     *  - `ja` ã«ã¹ã¿ã ã¨ã©ã¼ã¡ãã»ã¼ã¸\n     */\n    hasProperty: (x: unknown, prop: PropertyKey, message?: string | null) => void | never;\n\n    /**\n     * @en Verification for the input value has own specified property.\n     * @ja æå®ãã­ããã£ãå¥åå¤èªèº«æã£ã¦ãããæ¤è¨¼\n     *\n     * @param hasOwnProperty.prop\n     *  - `en` specified property\n     *  - `ja` å¯¾è±¡ã®ãã­ããã£\n     * @param hasOwnProperty.x\n     *  - `en` evaluated value\n     *  - `ja` è©ä¾¡ããå¤\n     * @param hasOwnProperty.message\n     *  - `en` custom error message\n     *  - `ja` ã«ã¹ã¿ã ã¨ã©ã¼ã¡ãã»ã¼ã¸\n     */\n    hasOwnProperty: (x: unknown, prop: PropertyKey, message?: string | null) => void | never;\n}\n\n/**\n * @en List of method for type verify.\n * @ja åæ¤è¨¼ãæä¾ããã¡ã½ããä¸è¦§\n */\nexport type VerifyMethod = keyof Verifier;\n\n/**\n * @en Concrete type verifier object.\n * @ja åæ¤è¨¼å®è£ãªãã¸ã§ã¯ã\n *\n * @internal\n */\nconst _verifier: Verifier = {\n    notNullish: (x: unknown, message?: string | null): void | never => {\n        if (null == x) {\n            exists(message) || (message = `${className(x)} is not a valid value.`);\n            throw new TypeError(message);\n        }\n    },\n\n    typeOf: (type: TypeKeys, x: unknown, message?: string | null): void | never => {\n        if (typeof x !== type) {\n            exists(message) || (message = `Type of ${className(x)} is not ${type}.`);\n            throw new TypeError(message);\n        }\n    },\n\n    array: (x: unknown, message?: string | null): void | never => {\n        if (!isArray(x)) {\n            exists(message) || (message = `${className(x)} is not an Array.`);\n            throw new TypeError(message);\n        }\n    },\n\n    iterable: (x: unknown, message?: string | null): void | never => {\n        if (!(Symbol.iterator in Object(x))) {\n            exists(message) || (message = `${className(x)} is not an iterable object.`);\n            throw new TypeError(message);\n        }\n    },\n\n    instanceOf: (ctor: Function, x: unknown, message?: string | null): void | never => {\n        if (!(x instanceof ctor)) {\n            exists(message) || (message = `${className(x)} is not an instance of ${ctor.name}.`);\n            throw new TypeError(message);\n        }\n    },\n\n    ownInstanceOf: (ctor: Function, x: unknown, message?: string | null): void | never => {\n        if (null == x || Object.getPrototypeOf(x) !== Object(ctor.prototype)) {\n            exists(message) || (message = `The object is not own instance of ${ctor.name}.`);\n            throw new TypeError(message);\n        }\n    },\n\n    notOwnInstanceOf: (ctor: Function, x: unknown, message?: string | null): void | never => {\n        if (null != x && Object.getPrototypeOf(x) === Object(ctor.prototype)) {\n            exists(message) || (message = `The object is own instance of ${ctor.name}.`);\n            throw new TypeError(message);\n        }\n    },\n\n    hasProperty: (x: unknown, prop: PropertyKey, message?: string | null): void | never => {\n        if (null == x || !(prop in (x as object))) {\n            exists(message) || (message = `The object does not have property ${String(prop)}.`);\n            throw new TypeError(message);\n        }\n    },\n\n    hasOwnProperty: (x: unknown, prop: PropertyKey, message?: string | null): void | never => {\n        if (null == x || !Object.prototype.hasOwnProperty.call(x, prop)) {\n            exists(message) || (message = `The object does not have own property ${String(prop)}.`);\n            throw new TypeError(message);\n        }\n    },\n};\n\n/**\n * @en Verify method.\n * @ja æ¤è¨¼ã¡ã½ãã\n *\n * @param method\n *  - `en` method name which using\n *  - `ja` ä½¿ç¨ããã¡ã½ããå\n * @param args\n *  - `en` arguments which corresponds to the method name\n *  - `ja` ã¡ã½ããåã«å¯¾å¿ããå¼æ°\n */\nexport function verify<TMethod extends VerifyMethod>(method: TMethod, ...args: Parameters<Verifier[TMethod]>): void | never {\n    (_verifier[method] as UnknownFunction)(...args);\n}\n\nexport { verify as default };\n","import {\n    UnknownObject,\n    TypedArray,\n    TypedArrayConstructor,\n    isFunction,\n    isArray,\n    isObject,\n    isIterable,\n    isTypedArray,\n    sameClass,\n} from './types';\n\n/** @internal helper for deepEqual() */\nfunction arrayEqual(lhs: unknown[], rhs: unknown[]): boolean {\n    const len = lhs.length;\n    if (len !== rhs.length) {\n        return false;\n    }\n    for (let i = 0; i < len; i++) {\n        if (!deepEqual(lhs[i], rhs[i])) {\n            return false;\n        }\n    }\n    return true;\n}\n\n/** @internal helper for deepEqual() */\nfunction bufferEqual(lhs: SharedArrayBuffer | ArrayBuffer, rhs: SharedArrayBuffer | ArrayBuffer): boolean {\n    const size = lhs.byteLength;\n    if (size !== rhs.byteLength) {\n        return false;\n    }\n    let pos = 0;\n    if (size - pos >= 8) {\n        const len = size >>> 3;\n        const f64L = new Float64Array(lhs, 0, len);\n        const f64R = new Float64Array(rhs, 0, len);\n        for (let i = 0; i < len; i++) {\n            if (!Object.is(f64L[i], f64R[i])) {\n                return false;\n            }\n        }\n        pos = len << 3;\n    }\n    if (pos === size) {\n        return true;\n    }\n    const L = new DataView(lhs);\n    const R = new DataView(rhs);\n    if (size - pos >= 4) {\n        if (!Object.is(L.getUint32(pos), R.getUint32(pos))) {\n            return false;\n        }\n        pos += 4;\n    }\n    if (size - pos >= 2) {\n        if (!Object.is(L.getUint16(pos), R.getUint16(pos))) {\n            return false;\n        }\n        pos += 2;\n    }\n    if (size > pos) {\n        if (!Object.is(L.getUint8(pos), R.getUint8(pos))) {\n            return false;\n        }\n        pos += 1;\n    }\n    return pos === size;\n}\n\n/**\n * @en Set by specifying key and value for the object. (prototype pollution countermeasure)\n * @ja ãªãã¸ã§ã¯ãã« key, value ãæå®ãã¦è¨­å® (ãã­ãã¿ã¤ãæ±æå¯¾ç­)\n */\nexport function assignValue(target: UnknownObject, key: string | number | symbol, value: unknown): void {\n    if ('__proto__' !== key) {\n        target[key] = value;\n    }\n}\n\n/**\n * @en Performs a deep comparison between two values to determine if they are equivalent.\n * @ja 2å¤ã®è©³ç´°æ¯è¼ãã, ç­ãããã©ããå¤å®\n */\nexport function deepEqual(lhs: unknown, rhs: unknown): boolean {\n    if (lhs === rhs) {\n        return true;\n    }\n    if (isFunction(lhs) && isFunction(rhs)) {\n        return lhs.length === rhs.length && lhs.name === rhs.name;\n    }\n    if (!isObject(lhs) || !isObject(rhs)) {\n        return false;\n    }\n    { // Primitive Wrapper Objects / Date\n        const valueL = lhs.valueOf();\n        const valueR = rhs.valueOf();\n        if (lhs !== valueL || rhs !== valueR) {\n            return valueL === valueR;\n        }\n    }\n    { // RegExp\n        const isRegExpL = lhs instanceof RegExp;\n        const isRegExpR = rhs instanceof RegExp;\n        if (isRegExpL || isRegExpR) {\n            return isRegExpL === isRegExpR && String(lhs) === String(rhs);\n        }\n    }\n    { // Array\n        const isArrayL = isArray(lhs);\n        const isArrayR = isArray(rhs);\n        if (isArrayL || isArrayR) {\n            return isArrayL === isArrayR && arrayEqual(lhs as unknown[], rhs as unknown[]);\n        }\n    }\n    { // ArrayBuffer\n        const isBufferL = lhs instanceof ArrayBuffer;\n        const isBufferR = rhs instanceof ArrayBuffer;\n        if (isBufferL || isBufferR) {\n            return isBufferL === isBufferR && bufferEqual(lhs as ArrayBuffer, rhs as ArrayBuffer);\n        }\n    }\n    { // ArrayBufferView\n        const isBufferViewL = ArrayBuffer.isView(lhs);\n        const isBufferViewR = ArrayBuffer.isView(rhs);\n        if (isBufferViewL || isBufferViewR) {\n            return isBufferViewL === isBufferViewR && sameClass(lhs, rhs)\n                && bufferEqual((lhs as ArrayBufferView).buffer, (rhs as ArrayBufferView).buffer);\n        }\n    }\n    { // other Iterable\n        const isIterableL = isIterable(lhs);\n        const isIterableR = isIterable(rhs);\n        if (isIterableL || isIterableR) {\n            return isIterableL === isIterableR && arrayEqual([...(lhs as unknown[])], [...(rhs as unknown[])]);\n        }\n    }\n    if (sameClass(lhs, rhs)) {\n        const keysL = new Set(Object.keys(lhs));\n        const keysR = new Set(Object.keys(rhs));\n        if (keysL.size !== keysR.size) {\n            return false;\n        }\n        for (const key of keysL) {\n            if (!keysR.has(key)) {\n                return false;\n            }\n        }\n        for (const key of keysL) {\n            if (!deepEqual(lhs[key], rhs[key])) {\n                return false;\n            }\n        }\n    } else {\n        for (const key in lhs) {\n            if (!(key in rhs)) {\n                return false;\n            }\n        }\n        const keys = new Set<string>();\n        for (const key in rhs) {\n            if (!(key in lhs)) {\n                return false;\n            }\n            keys.add(key);\n        }\n        for (const key of keys) {\n            if (!deepEqual(lhs[key], rhs[key])) {\n                return false;\n            }\n        }\n    }\n    return true;\n}\n\n//__________________________________________________________________________________________________//\n\n/** @internal clone RegExp */\nfunction cloneRegExp(regexp: RegExp): RegExp {\n    const result = new RegExp(regexp.source, regexp.flags);\n    result.lastIndex = regexp.lastIndex;\n    return result;\n}\n\n/** @internal clone ArrayBuffer */\nfunction cloneArrayBuffer(arrayBuffer: ArrayBuffer): ArrayBuffer {\n    const result = new ArrayBuffer(arrayBuffer.byteLength);\n    new Uint8Array(result).set(new Uint8Array(arrayBuffer));\n    return result;\n}\n\n/** @internal clone DataView */\nfunction cloneDataView(dataView: DataView): DataView {\n    const buffer = cloneArrayBuffer(dataView.buffer);\n    return new DataView(buffer, dataView.byteOffset, dataView.byteLength);\n}\n\n/** @internal clone TypedArray */\nfunction cloneTypedArray<T extends TypedArray>(typedArray: T): T {\n    const buffer = cloneArrayBuffer(typedArray.buffer);\n    return new (typedArray.constructor as TypedArrayConstructor)(buffer, typedArray.byteOffset, typedArray.length) as T;\n}\n\n/** @internal check necessary to update */\nfunction needUpdate(oldValue: unknown, newValue: unknown, exceptUndefined: boolean): boolean {\n    if (oldValue !== newValue) {\n        return true;\n    } else {\n        return (exceptUndefined && undefined === oldValue);\n    }\n}\n\n/** @internal merge Array */\nfunction mergeArray(target: unknown[], source: unknown[]): unknown[] {\n    for (let i = 0, len = source.length; i < len; i++) {\n        const oldValue = target[i];\n        const newValue = merge(oldValue, source[i]);\n        !needUpdate(oldValue, newValue, false) || (target[i] = newValue);\n    }\n    return target;\n}\n\n/** @internal merge Set */\nfunction mergeSet(target: Set<unknown>, source: Set<unknown>): Set<unknown> {\n    for (const item of source) {\n        target.has(item) || target.add(merge(undefined, item));\n    }\n    return target;\n}\n\n/** @internal merge Map */\nfunction mergeMap(target: Map<unknown, unknown>, source: Map<unknown, unknown>): Map<unknown, unknown> {\n    for (const [k, v] of source) {\n        const oldValue = target.get(k);\n        const newValue = merge(oldValue, v);\n        !needUpdate(oldValue, newValue, false) || target.set(k, newValue);\n    }\n    return target;\n}\n\n/** @internal merge object property */\nfunction mergeObjectProperty(target: UnknownObject, source: UnknownObject, key: string | number | symbol): void {\n    if ('__proto__' !== key) {\n        const oldValue = target[key];\n        const newValue = merge(oldValue, source[key]);\n        !needUpdate(oldValue, newValue, true) || (target[key] = newValue);\n    }\n}\n\n/** @internal helper for deepMerge() */\nfunction merge(target: unknown, source: unknown): unknown {\n    if (undefined === source || target === source) {\n        return target;\n    }\n    if (!isObject(source)) {\n        return source;\n    }\n    // Primitive Wrapper Objects / Date\n    if (source.valueOf() !== source) {\n        return deepEqual(target, source) ? target : new (source.constructor as ObjectConstructor)(source.valueOf());\n    }\n    // RegExp\n    if (source instanceof RegExp) {\n        return deepEqual(target, source) ? target : cloneRegExp(source);\n    }\n    // ArrayBuffer\n    if (source instanceof ArrayBuffer) {\n        return deepEqual(target, source) ? target : cloneArrayBuffer(source);\n    }\n    // ArrayBufferView\n    if (ArrayBuffer.isView(source)) {\n        return deepEqual(target, source) ? target : isTypedArray(source) ? cloneTypedArray(source) : cloneDataView(source as DataView);\n    }\n    // Array\n    if (Array.isArray(source)) {\n        return mergeArray(isArray(target) ? target : [], source);\n    }\n    // Set\n    if (source instanceof Set) {\n        return mergeSet(target instanceof Set ? target : new Set(), source);\n    }\n    // Map\n    if (source instanceof Map) {\n        return mergeMap(target instanceof Map ? target : new Map(), source);\n    }\n\n    const obj = isObject(target) ? target : {};\n    if (sameClass(target, source)) {\n        for (const key of Object.keys(source)) {\n            mergeObjectProperty(obj as UnknownObject, source as UnknownObject, key);\n        }\n    } else {\n        for (const key in source) {\n            mergeObjectProperty(obj as UnknownObject, source as UnknownObject, key);\n        }\n    }\n    return obj;\n}\n\n/**\n * @en Recursively merges own and inherited enumerable string keyed properties of source objects into the destination object.\n * @ja ãªãã¸ã§ã¯ãã®åå¸°çãã¼ã¸ãå®è¡\n */\nexport function deepMerge<T, S1, S2, S3, S4, S5, S6, S7, S8, S9>(\n    target: T,\n    ...sources: [S1, S2?, S3?, S4?, S5?, S6?, S7?, S8?, S9?, ...unknown[]]\n): T & S1 & S2 & S3 & S4 & S5 & S6 & S7 & S8 & S9;\nexport function deepMerge<X>(target: unknown, ...sources: unknown[]): X;\nexport function deepMerge(target: unknown, ...sources: unknown[]): unknown {\n    let result = target;\n    for (const source of sources) {\n        result = merge(result, source);\n    }\n    return result;\n}\n\n//__________________________________________________________________________________________________//\n\n/**\n * @en Create deep copy instance of source object.\n * @ja ãã£ã¼ãã³ãã¼ãªãã¸ã§ã¯ãã®çæ\n *\n * @see https://developer.mozilla.org/en-US/docs/Web/API/structuredClone\n */\nexport function deepCopy<T>(src: T): T {\n    return deepMerge(undefined, src);\n}\n","/* eslint-disable\n    @typescript-eslint/no-explicit-any,\n */\n\nimport {\n    UnknownFunction,\n    Nullish,\n    Type,\n    Class,\n    Constructor,\n} from './types';\n\n/**\n * @en Mixin class's base interface.\n * @ja Mixin ã¯ã©ã¹ã®åºåºã¤ã³ã¿ã¼ãã§ã¤ã¹å®ç¾©\n */\nexport declare class MixinClass {\n    /**\n     * @en call mixin source class's `super()`. <br>\n     *     This method should be called from constructor.\n     * @ja Mixin ã¯ã©ã¹ã®åºåºã¤ã³ã¿ã¼ãã§ã¤ã¹å®ç¾© <br>\n     *     ã³ã³ã¹ãã©ã¯ã¿ããå¼ã¶ãã¨ãæ³å®\n     *\n     * @param srcClass\n     *  - `en` construction target class name. ex) from S1 available\n     *  - `ja` ã³ã³ã¹ãã©ã¯ãããã¯ã©ã¹åãæå® ex) S1 ããæå®å¯è½\n     * @param args\n     *  - `en` construction parameters\n     *  - `ja` ã³ã³ã¹ãã©ã¯ãã«ä½¿ç¨ããå¼æ°\n     */\n    protected super<T extends Class>(srcClass: T, ...args: ConstructorParameters<T>): this;\n\n    /**\n     * @en Check the input class is mixined (excluding own class).\n     * @ja æå®ã¯ã©ã¹ã Mixin ããã¦ãããç¢ºèª (èªèº«ã®ã¯ã©ã¹ã¯å«ã¾ããªã)\n     *\n     * @param mixedClass\n     *  - `en` set target class constructor\n     *  - `ja` å¯¾è±¡ã¯ã©ã¹ã®ã³ã³ã¹ãã©ã¯ã¿ãæå®\n     */\n    public isMixedWith<T extends object>(mixedClass: Constructor<T>): boolean;\n}\n\n/**\n * @en Mixed sub class constructor definitions.\n * @ja åæãããµãã¯ã©ã¹ã®ã³ã³ã¹ãã©ã¯ã¿å®ç¾©\n */\nexport interface MixinConstructor<B extends Class, U extends object> extends Type<U> {\n    /**\n     * @en constructor\n     * @ja ã³ã³ã¹ãã©ã¯ã¿\n     *\n     * @param args\n     *  - `en` base class arguments\n     *  - `ja` åºåºã¯ã©ã¹ã«æå®ããå¼æ°\n     * @returns\n     *  - `en` union type of classes when calling [[mixins]]()\n     *  - `ja` [[mixins]]() ã«æ¸¡ããã¯ã©ã¹ã®éå\n     */\n    new(...args: ConstructorParameters<B>): U;\n}\n\n/**\n * @en Definition of [[setMixClassAttribute]] function's arguments.\n * @ja [[setMixClassAttribute]] ã®åãããå¼æ°å®ç¾©\n */\nexport interface MixClassAttribute {\n    /**\n     * @en Suppress providing constructor-trap for the mixin source class. In this case, `isMixedWith`, `instanceof` also becomes invalid. (for improving performance)\n     * @ja Mixin Source ã¯ã©ã¹ã«å¯¾ãã¦, ã³ã³ã¹ãã©ã¯ã¿ãã©ãããææ­¢. ãããæå®ããå ´å, `isMixedWith`, `instanceof` ãç¡å¹ã«ãªã. (ããã©ã¼ãã³ã¹æ¹å)\n     */\n    protoExtendsOnly: void;\n\n    /**\n     * @en Setup [Symbol.hasInstance] property. <br>\n     *     The class designated as a source of [[mixins]]() has [Symbol.hasInstance] property implicitly. <br>\n     *     It's used to avoid becoming the behavior `instanceof` doesn't intend when the class is extended from the mixined class the other place.\n     * @ja [Symbol.hasInstance] ãã­ããã£è¨­å®<br>\n     *     [[mixins]]() ã®ã½ã¼ã¹ã«æå®ãããã¯ã©ã¹ã¯ [Symbol.hasInstance] ãæé»çã«åãããã<br>\n     *     ãã®ã¯ã©ã¹ãä»ã§ç¶æ¿ããã¦ããå ´å `instanceof` ãæå³ããªãæ¯ãèãã¨ãªãã®ãé¿ããããã«ä½¿ç¨ãã.\n     */\n    instanceOf: ((inst: object) => boolean) | Nullish;\n}\n\n//__________________________________________________________________________________________________//\n\n/** @internal */ const _objPrototype     = Object.prototype;\n/** @internal */ const _instanceOf       = Function.prototype[Symbol.hasInstance];\n/** @internal */ const _override         = Symbol('override');\n/** @internal */ const _isInherited      = Symbol('is-inherited');\n/** @internal */ const _constructors     = Symbol('constructors');\n/** @internal */ const _classBase        = Symbol('class-base');\n/** @internal */ const _classSources     = Symbol('class-sources');\n/** @internal */ const _protoExtendsOnly = Symbol('proto-extends-only');\n\n/** @internal copy properties core */\nfunction reflectProperties(target: object, source: object, key: string | symbol): void {\n    if (null == target[key]) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key) as PropertyDecorator);\n    }\n}\n\n/** @internal object properties copy method */\nfunction copyProperties(target: object, source: object): void {\n    source && Object.getOwnPropertyNames(source)\n        .filter(key => !/(prototype|name|constructor)/.test(key))\n        .forEach(key => {\n            reflectProperties(target, source, key);\n        });\n    source && Object.getOwnPropertySymbols(source)\n        .forEach(key => {\n            reflectProperties(target, source, key);\n        });\n}\n\n/** @internal helper for setMixClassAttribute(target, 'instanceOf') */\nfunction setInstanceOf<T extends object>(target: Constructor<T>, method: ((inst: object) => boolean) | Nullish): void {\n    const behaviour = method || (null === method ? undefined : ((i: object) => Object.prototype.isPrototypeOf.call(target.prototype, i)));\n    const applied = behaviour && Object.getOwnPropertyDescriptor(target, _override);\n    if (!applied) {\n        Object.defineProperties(target, {\n            [Symbol.hasInstance]: {\n                value: behaviour,\n                writable: true,\n                enumerable: false,\n            },\n            [_override]: {\n                value: behaviour ? true : undefined,\n                writable: true,\n            },\n        });\n    }\n}\n\n/**\n * @en Set the Mixin class attribute.\n * @ja Mixin ã¯ã©ã¹ã«å¯¾ãã¦å±æ§ãè¨­å®\n *\n * @example <br>\n *\n * ```ts\n * // 'protoExtendOnly'\n * class Base { constructor(a, b) {} };\n * class MixA { };\n * setMixClassAttribute(MixA, 'protoExtendsOnly');  // for improving construction performance\n * class MixB { constructor(c, d) {} };\n *\n * class MixinClass extends mixins(Base, MixA, MixB) {\n *     constructor(a, b, c, d){\n *         // calling `Base` constructor\n *         super(a, b);\n *\n *         // calling Mixin class's constructor\n *         this.super(MixA);        // no affect\n *         this.super(MixB, c, d);\n *     }\n * }\n *\n * const mixed = new MixinClass();\n * console.log(mixed instanceof MixA);    // false\n * console.log(mixed.isMixedWith(MixA));  // false\n *\n * // 'instanceOf'\n * class Base {};\n * class Source {};\n * class MixinClass extends mixins(Base, Source) {};\n *\n * class Other extends Source {};\n *\n * const other = new Other();\n * const mixed = new MixinClass();\n * console.log(other instanceof Source);        // true\n * console.log(other instanceof Other);         // true\n * console.log(mixed instanceof MixinClass);    // true\n * console.log(mixed instanceof Base);          // true\n * console.log(mixed instanceof Source);        // true\n * console.log(mixed instanceof Other);         // true ???\n *\n * setMixClassAttribute(Other, 'instanceOf'); // or setMixClassAttribute(Other, 'instanceOf', null);\n * console.log(other instanceof Source);        // true\n * console.log(other instanceof Other);         // true\n * console.log(mixed instanceof Other);         // false !\n *\n * // [Best Practice] If you declare the derived-class from mixin, you should call the function for avoiding `instanceof` limitation.\n * class DerivedClass extends MixinClass {}\n * setMixClassAttribute(DerivedClass, 'instanceOf');\n * ```\n *\n * @param target\n *  - `en` set target constructor\n *  - `ja` è¨­å®å¯¾è±¡ã®ã³ã³ã¹ãã©ã¯ã¿\n * @param attr\n *  - `en`:\n *    - `protoExtendsOnly`: Suppress providing constructor-trap for the mixin source class. (for improving performance)\n *    - `instanceOf`      : function by using [Symbol.hasInstance] <br>\n *                          Default behaviour is `{ return target.prototype.isPrototypeOf(instance) }`\n *                          If set `null`, delete [Symbol.hasInstance] property.\n *  - `ja`:\n *    - `protoExtendsOnly`: Mixin Source ã¯ã©ã¹ã«å¯¾ãã¦, ã³ã³ã¹ãã©ã¯ã¿ãã©ãããææ­¢ (ããã©ã¼ãã³ã¹æ¹å)\n *    - `instanceOf`      : [Symbol.hasInstance] ãä½¿ç¨ããé¢æ°ãæå® <br>\n *                          æ¢å®ã§ã¯ `{ return target.prototype.isPrototypeOf(instance) }` ãä½¿ç¨ããã\n *                         `null` æå®ãããã¨ [Symbol.hasInstance] ãã­ããã£ãåé¤ãã\n */\nexport function setMixClassAttribute<T extends object, U extends keyof MixClassAttribute>(\n    target: Constructor<T>,\n    attr: U,\n    method?: MixClassAttribute[U]\n): void {\n    switch (attr) {\n        case 'protoExtendsOnly':\n            target[_protoExtendsOnly] = true;\n            break;\n        case 'instanceOf':\n            setInstanceOf(target, method);\n            break;\n        default:\n            break;\n    }\n}\n\n/**\n * @en Mixin function for multiple inheritance. <br>\n *     Resolving type support for maximum 10 classes.\n * @ja å¤éç¶æ¿ã®ããã® Mixin <br>\n *     æå¤§ 10 ã¯ã©ã¹ã®åè§£æ±ºããµãã¼ã\n *\n * @example <br>\n *\n * ```ts\n * class Base { constructor(a, b) {} };\n * class MixA { constructor(a, b) {} };\n * class MixB { constructor(c, d) {} };\n *\n * class MixinClass extends mixins(Base, MixA, MixB) {\n *     constructor(a, b, c, d){\n *         // calling `Base` constructor\n *         super(a, b);\n *\n *         // calling Mixin class's constructor\n *         this.super(MixA, a, b);\n *         this.super(MixB, c, d);\n *     }\n * }\n * ```\n *\n * @param base\n *  - `en` primary base class. super(args) is this class's one.\n *  - `ja` åºåºã¯ã©ã¹ã³ã³ã¹ãã©ã¯ã¿. ååãã­ããã£, ã¡ã½ããã¯æåªåããã. super(args) ã¯ãã®ã¯ã©ã¹ã®ãã®ãæå®å¯è½.\n * @param sources\n *  - `en` multiple extends class\n *  - `ja` æ¡å¼µã¯ã©ã¹ã³ã³ã¹ãã©ã¯ã¿\n * @returns\n *  - `en` mixined class constructor\n *  - `ja` åæãããã¯ã©ã¹ã³ã³ã¹ãã©ã¯ã¿\n */\nexport function mixins<\n    B extends Class,\n    S1 extends object,\n    S2 extends object,\n    S3 extends object,\n    S4 extends object,\n    S5 extends object,\n    S6 extends object,\n    S7 extends object,\n    S8 extends object,\n    S9 extends object>(\n    base: B,\n    ...sources: [\n        Constructor<S1>,\n        Constructor<S2>?,\n        Constructor<S3>?,\n        Constructor<S4>?,\n        Constructor<S5>?,\n        Constructor<S6>?,\n        Constructor<S7>?,\n        Constructor<S8>?,\n        Constructor<S9>?,\n        ...any[]\n    ]): MixinConstructor<B, MixinClass & InstanceType<B> & S1 & S2 & S3 & S4 & S5 & S6 & S7 & S8 & S9> {\n\n    let _hasSourceConstructor = false;\n\n    class _MixinBase extends (base as unknown as Constructor<MixinClass>) {\n\n        private readonly [_constructors]: Map<Constructor<object>, UnknownFunction | null>;\n        private readonly [_classBase]: Constructor<object>;\n\n        constructor(...args: unknown[]) {\n            super(...args);\n\n            const constructors = new Map<Constructor<object>, UnknownFunction>();\n            this[_constructors] = constructors;\n            this[_classBase] = base;\n\n            if (_hasSourceConstructor) {\n                for (const srcClass of sources) {\n                    if (!srcClass[_protoExtendsOnly]) {\n                        const handler = {\n                            apply: (target: unknown, thisobj: unknown, arglist: unknown[]) => {\n                                const obj = new srcClass(...arglist);\n                                copyProperties(this, obj);\n                            }\n                        };\n                        // proxy for 'construct' and cache constructor\n                        constructors.set(srcClass, new Proxy(srcClass, handler as ProxyHandler<object>));\n                    }\n                }\n            }\n        }\n\n        protected super<T extends Class>(srcClass: T, ...args: ConstructorParameters<T>): this {\n            const map = this[_constructors];\n            const ctor = map.get(srcClass);\n            if (ctor) {\n                ctor.call(this, ...args);\n                map.set(srcClass, null);    // prevent calling twice\n            }\n            return this;\n        }\n\n        public isMixedWith<T extends object>(srcClass: Constructor<T>): boolean {\n            if (this.constructor === srcClass) {\n                return false;\n            } else if (this[_classBase] === srcClass) {\n                return true;\n            } else {\n                return this[_classSources].reduce((p, c) => p || (srcClass === c), false);\n            }\n        }\n\n        public static [Symbol.hasInstance](instance: unknown): boolean {\n            return Object.prototype.isPrototypeOf.call(_MixinBase.prototype, instance);\n        }\n\n        public [_isInherited]<T extends object>(srcClass: Constructor<T>): boolean {\n            const ctors = this[_constructors];\n            if (ctors.has(srcClass)) {\n                return true;\n            }\n            for (const ctor of ctors.keys()) {\n                if (Object.prototype.isPrototypeOf.call(srcClass, ctor)) {\n                    return true;\n                }\n            }\n            return false;\n        }\n\n        private get [_classSources](): Constructor<object>[] {\n            return [...this[_constructors].keys()];\n        }\n    }\n\n    for (const srcClass of sources) {\n        // provide custom instanceof\n        const desc = Object.getOwnPropertyDescriptor(srcClass, Symbol.hasInstance);\n        if (!desc || desc.writable) {\n            const orgInstanceOf = desc ? srcClass[Symbol.hasInstance] : _instanceOf;\n            setInstanceOf(srcClass, (inst: object) => {\n                return orgInstanceOf.call(srcClass, inst) || ((null != inst && inst[_isInherited]) ? inst[_isInherited](srcClass) : false);\n            });\n        }\n        // provide prototype\n        copyProperties(_MixinBase.prototype, srcClass.prototype);\n        let parent = Object.getPrototypeOf(srcClass.prototype);\n        while (_objPrototype !== parent) {\n            copyProperties(_MixinBase.prototype, parent);\n            parent = Object.getPrototypeOf(parent);\n        }\n        // check constructor\n        if (!_hasSourceConstructor) {\n            _hasSourceConstructor = !srcClass[_protoExtendsOnly];\n        }\n    }\n\n    return _MixinBase as any;\n}\n","import { assignValue, deepEqual } from './deep-circuit';\nimport {\n    Nullish,\n    Writable,\n    isArray,\n    isObject,\n    isFunction,\n} from './types';\nimport { verify } from './verify';\n\n/**\n * @en Check whether input source has a property.\n * @ja å¥ååããã­ããã£ãæã£ã¦ãããå¤å®\n *\n * @param src\n */\nexport function has(src: unknown, propName: string): boolean {\n    return null != src && isObject(src) && (propName in src);\n}\n\n/**\n * @en Get shallow copy of `target` which has only `pickKeys`.\n * @ja `pickKeys` ã§æå®ããããã­ããã£ã®ã¿ãæã¤ `target` ã® Shallow Copy ãåå¾\n *\n * @param target\n *  - `en` copy source object\n *  - `ja` ã³ãã¼åãªãã¸ã§ã¯ã\n * @param pickKeys\n *  - `en` copy target keys\n *  - `ja` ã³ãã¼å¯¾è±¡ã®ã­ã¼ä¸è¦§\n */\nexport function pick<T extends object, K extends keyof T>(target: T, ...pickKeys: K[]): Writable<Pick<T, K>> {\n    verify('typeOf', 'object', target);\n    return pickKeys.reduce((obj, key) => {\n        key in target && assignValue(obj, key, target[key]);\n        return obj;\n    }, {} as Writable<Pick<T, K>>);\n}\n\n/**\n * @en Get shallow copy of `target` without `omitKeys`.\n * @ja `omitKeys` ã§æå®ããããã­ããã£ä»¥å¤ã®ã­ã¼ãæã¤ `target` ã® Shallow Copy ãåå¾\n *\n * @param target\n *  - `en` copy source object\n *  - `ja` ã³ãã¼åãªãã¸ã§ã¯ã\n * @param omitKeys\n *  - `en` omit target keys\n *  - `ja` åé¤å¯¾è±¡ã®ã­ã¼ä¸è¦§\n */\nexport function omit<T extends object, K extends keyof T>(target: T, ...omitKeys: K[]): Writable<Omit<T, K>> {\n    verify('typeOf', 'object', target);\n    const obj = {} as Writable<Omit<T, K>>;\n    for (const key of Object.keys(target)) {\n        !omitKeys.includes(key as K) && assignValue(obj, key, target[key]);\n    }\n    return obj;\n}\n\n/**\n * @en Invert the keys and values of an object. The values must be serializable.\n * @ja ãªãã¸ã§ã¯ãã®ã­ã¼ã¨å¤ãéè»¢ãã. ãã¹ã¦ã®å¤ãã¦ãã¼ã¯ã§ãããã¨ãåæ\n *\n * @param target\n *  - `en` target object\n *  - `ja` å¯¾è±¡ãªãã¸ã§ã¯ã\n */\nexport function invert<T extends object = object>(target: object): T {\n    const result = {};\n    for (const key of Object.keys(target)) {\n        assignValue(result, target[key], key);\n    }\n    return result as T;\n}\n\n/**\n * @en Get shallow copy of difference between `base` and `src`.\n * @ja `base` ã¨ `src` ã®å·®åãã­ããã£ããã¤ãªãã¸ã§ã¯ãã® Shallow Copy ãåå¾\n *\n * @param base\n *  - `en` base object\n *  - `ja` åºæºã¨ãªããªãã¸ã§ã¯ã\n * @param src\n *  - `en` source object\n *  - `ja` ã³ãã¼åãªãã¸ã§ã¯ã\n */\nexport function diff<T extends object>(base: T, src: Partial<T>): Partial<T> {\n    verify('typeOf', 'object', base);\n    verify('typeOf', 'object', src);\n\n    const retval: Partial<T> = {};\n\n    for (const key of Object.keys(src)) {\n        if (!deepEqual(base[key], src[key])) {\n            assignValue(retval, key, src[key]);\n        }\n    }\n\n    return retval;\n}\n\n/**\n * @en Get shallow copy of `base` without `dropValue`.\n * @ja `dropValue` ã§æå®ããããã­ããã£å¤ä»¥å¤ã®ã­ã¼ãæã¤ `target` ã® Shallow Copy ãåå¾\n *\n * @param base\n *  - `en` base object\n *  - `ja` åºæºã¨ãªããªãã¸ã§ã¯ã\n * @param dropValues\n *  - `en` target value. default: `undefined`.\n *  - `ja` å¯¾è±¡ã®å¤. æ¢å®å¤: `undefined`\n */\nexport function drop<T extends object>(base: T, ...dropValues: unknown[]): Partial<T> {\n    verify('typeOf', 'object', base);\n\n    const values = [...dropValues];\n    if (!values.length) {\n        values.push(undefined);\n    }\n\n    const retval: Partial<T> = { ...base };\n\n    for (const key of Object.keys(base)) {\n        for (const val of values) {\n            if (deepEqual(val, retval[key])) {\n                delete retval[key];\n                break;\n            }\n        }\n    }\n\n    return retval;\n}\n\n/**\n * @en If the value of the named property is a function then invoke it; otherwise, return it.\n * @ja object ã® property ãã¡ã½ãããªããã®å®è¡çµæã, ãã­ããã£ãªããã®å¤ãè¿å´\n *\n * @param target\n * - `en` Object to maybe invoke function `property` on.\n * - `ja` è©ä¾¡ãããªãã¸ã§ã¯ã\n * @param property\n * - `en` The function by name to invoke on `object`.\n * - `ja` è©ä¾¡ãããã­ããã£å\n * @param fallback\n * - `en` The value to be returned in case `property` doesn't exist or is undefined.\n * - `ja` å­å¨ããªãã£ãå ´åã® fallback å¤\n */\nexport function result<T = any>(target: object | Nullish, property: string | string[], fallback?: T): T { // eslint-disable-line @typescript-eslint/no-explicit-any\n    const props = isArray(property) ? property : [property];\n    if (!props.length) {\n        return isFunction(fallback) ? fallback.call(target) : fallback;\n    }\n\n    const resolve = (o: unknown, p: unknown): unknown => {\n        return isFunction(p) ? p.call(o) : p;\n    };\n\n    let obj = target;\n    for (const name of props) {\n        const prop = null == obj ? undefined : obj[name];\n        if (undefined === prop) {\n            return resolve(obj, fallback) as T;\n        }\n        obj = resolve(obj, prop) as object;\n    }\n    return obj as unknown as T;\n}\n","/** @internal */\nfunction callable(): unknown {\n    // eslint-disable-next-line @typescript-eslint/no-use-before-define\n    return accessible;\n}\n\n/** @internal */\nconst accessible: unknown = new Proxy(callable, {\n    get: (target, name) => {\n        const prop = target[name];\n        if (null != prop) {\n            return prop;\n        } else {\n            return accessible;\n        }\n    },\n});\n\n/** @internal */\nfunction create(): unknown {\n    const stub = new Proxy({}, {\n        get: (target, name) => {\n            const prop = target[name];\n            if (null != prop) {\n                return prop;\n            } else {\n                return accessible;\n            }\n        },\n    });\n\n    Object.defineProperty(stub, 'stub', {\n        value: true,\n        writable: false,\n    });\n\n    return stub;\n}\n\n/**\n * @en Get safe accessible object.\n * @ja å®å¨ã«ã¢ã¯ã»ã¹å¯è½ãªãªãã¸ã§ã¯ãã®åå¾\n *\n * @example <br>\n *\n * ```ts\n * const safeWindow = safe(globalThis.window);\n * console.log(null != safeWindow.document);    // true\n * const div = safeWindow.document.createElement('div');\n * console.log(null != div);    // true\n * ```\n *\n * @param target\n *  - `en` A reference of an object with a possibility which exists.\n *  - `ja` å­å¨ããããªãã¸ã§ã¯ãã®åç§\n * @returns\n *  - `en` Reality or stub instance.\n *  - `ja` å®ä½ã¾ãã¯ã¹ã¿ãã¤ã³ã¹ã¿ã³ã¹\n */\nexport function safe<T>(target: T): T {\n    return target || create() as T;\n}\n","import { UnknownFunction } from './types';\nimport { getGlobal } from './config';\nimport { safe } from './safe';\n\n/**\n * @en Type of handle for timer functions.\n * @ja ã¿ã¤ãã¼é¢æ°ã«ä½¿ç¨ãããã³ãã«å\n */\nexport interface TimerHandle { } // eslint-disable-line @typescript-eslint/no-empty-interface\n\n/**\n * @en Type of timer start functions.\n * @ja ã¿ã¤ãã¼éå§é¢æ°ã®å\n */\nexport type TimerStartFunction = (handler: UnknownFunction, timeout?: number, ...args: unknown[]) => TimerHandle;\n\n/**\n * @en Type of timer stop functions.\n * @ja ã¿ã¤ãã¼åæ­¢é¢æ°ã®å\n */\nexport type TimerStopFunction = (handle: TimerHandle) => void;\n\n/** @internal */\ninterface TimerContext {\n    setTimeout: TimerStartFunction;\n    clearTimeout: TimerStopFunction;\n    setInterval: TimerStartFunction;\n    clearInterval: TimerStopFunction;\n}\n\n/** @internal */ const _root = getGlobal() as unknown as TimerContext;\nconst setTimeout: TimerStartFunction   = safe(_root.setTimeout);\nconst clearTimeout: TimerStopFunction  = safe(_root.clearTimeout);\nconst setInterval: TimerStartFunction  = safe(_root.setInterval);\nconst clearInterval: TimerStopFunction = safe(_root.clearInterval);\n\nexport {\n    setTimeout,\n    clearTimeout,\n    setInterval,\n    clearInterval,\n};\n","import {\n    UnknownFunction,\n    Primitive,\n    TypedData,\n    isString,\n    isObject,\n} from './types';\nimport { invert } from './object';\nimport {\n    TimerHandle,\n    setTimeout,\n    clearTimeout,\n} from './timer';\n\n/**\n * @en Ensure asynchronous execution.\n * @ja éåæå®è¡ãä¿è¨¼\n *\n * @example <br>\n *\n * ```ts\n * void post(() => exec(arg));\n * ```\n *\n * @param executor\n *  - `en` implement as function scope.\n *  - `ja` é¢æ°ã¹ã³ã¼ãã¨ãã¦å®è£\n*/\nexport function post<T>(executor: () => T): Promise<T> {\n    return Promise.resolve().then(executor);\n}\n\n/**\n * @en Generic No-Operation.\n * @ja æ±ç¨ No-Operation\n */\nexport function noop(...args: unknown[]): any { // eslint-disable-line @typescript-eslint/no-unused-vars, @typescript-eslint/no-explicit-any\n    // noop\n}\n\n/**\n * @en Wait for the designation elapse.\n * @ja æå®æéå¦çãå¾æ©\n *\n * @param elapse\n *  - `en` wait elapse [msec].\n *  - `ja` å¾æ©æé [msec]\n */\nexport function sleep(elapse: number): Promise<void> {\n    return new Promise(resolve => setTimeout(resolve, elapse));\n}\n\n/**\n * @en Returns a function, that, when invoked, will only be triggered at most once during a given time.\n * @ja é¢æ°ã®å®è¡ã wait [msec] ã«1åã«å¶é\n *\n * @example <br>\n *\n * ```ts\n * const throttled = throttle(upatePosition, 100);\n * $(window).scroll(throttled);\n * ```\n *\n * @param executor\n *  - `en` seed function.\n *  - `ja` å¯¾è±¡ã®é¢æ°\n * @param elapse\n *  - `en` wait elapse [msec].\n *  - `ja` å¾æ©æé [msec]\n * @param options\n */\nexport function throttle<T extends UnknownFunction>(executor: T, elapse: number, options?: { leading?: boolean; trailing?: boolean; }): T & { cancel(): void; } {\n    const opts = options || {};\n    let handle: TimerHandle | undefined;\n    let args: unknown[] | undefined;\n    let context: unknown, result: unknown;\n    let previous = 0;\n\n    const later = function (): void {\n        previous = false === opts.leading ? 0 : Date.now();\n        handle = undefined;\n        result = executor.apply(context, args);\n        if (!handle) {\n            context = args = undefined;\n        }\n    };\n\n    const throttled = function (this: unknown, ...arg: unknown[]): unknown {\n        const now = Date.now();\n        if (!previous && false === opts.leading) {\n            previous = now;\n        }\n        const remaining = elapse - (now - previous);\n        // eslint-disable-next-line no-invalid-this, @typescript-eslint/no-this-alias\n        context = this;\n        args = [...arg];\n        if (remaining <= 0 || remaining > elapse) {\n            if (handle) {\n                clearTimeout(handle);\n                handle = undefined;\n            }\n            previous = now;\n            result = executor.apply(context, args);\n            if (!handle) {\n                context = args = undefined;\n            }\n        } else if (!handle && false !== opts.trailing) {\n            handle = setTimeout(later, remaining);\n        }\n        return result;\n    };\n\n    throttled.cancel = function (): void {\n        clearTimeout(handle as TimerHandle);\n        previous = 0;\n        handle = context = args = undefined;\n    };\n\n    return throttled as (T & { cancel(): void; });\n}\n\n/**\n * @en Returns a function, that, as long as it continues to be invoked, will not be triggered.\n * @ja å¼ã³åºããã¦ãã wait [msec] çµéããã¾ã§å®è¡ããªãé¢æ°ãè¿å´\n *\n * @param executor\n *  - `en` seed function.\n *  - `ja` å¯¾è±¡ã®é¢æ°\n * @param wait\n *  - `en` wait elapse [msec].\n *  - `ja` å¾æ©æé [msec]\n * @param immediate\n *  - `en` If `true` is passed, trigger the function on the leading edge, instead of the trailing.\n *  - `ja` `true` ã®å ´å, ååã®ã³ã¼ã«ã¯å³æå®è¡\n */\nexport function debounce<T extends UnknownFunction>(executor: T, wait: number, immediate?: boolean): T & { cancel(): void; } {\n    /* eslint-disable no-invalid-this */\n    let handle: TimerHandle | undefined;\n    let result: undefined;\n\n    const later = function (context: undefined, args: undefined[]): void {\n        handle = undefined;\n        if (args) {\n            result = executor.apply(context, args);\n        }\n    };\n\n    const debounced = function (this: undefined, ...args: undefined[]): undefined {\n        if (handle) {\n            clearTimeout(handle);\n        }\n        if (immediate) {\n            const callNow = !handle;\n            handle = setTimeout(later, wait);\n            if (callNow) {\n                result = executor.apply(this, args);\n            }\n        } else {\n            handle = setTimeout(later, wait, this, [...args]);\n        }\n        return result;\n    };\n\n    debounced.cancel = function (): void {\n        clearTimeout(handle as TimerHandle);\n        handle = undefined;\n    };\n\n    return debounced as (T & { cancel(): void; });\n    /* eslint-enable no-invalid-this */\n}\n\n/**\n * @en Returns a function that will be executed at most one time, no matter how often you call it.\n * @ja 1åº¦ããå®è¡ãããªãé¢æ°ãè¿å´. 2åç®ä»¥éã¯æåã®ã³ã¼ã«ã®ã­ã£ãã·ã¥ãè¿å´\n *\n * @param executor\n *  - `en` seed function.\n *  - `ja` å¯¾è±¡ã®é¢æ°\n */\nexport function once<T extends UnknownFunction>(executor: T): T {\n    /* eslint-disable no-invalid-this, @typescript-eslint/no-non-null-assertion */\n    let memo: unknown;\n    return function (this: unknown, ...args: unknown[]): unknown {\n        if (executor) {\n            memo = executor.call(this, ...args);\n            executor = null!;\n        }\n        return memo;\n    } as T;\n    /* eslint-enable no-invalid-this, @typescript-eslint/no-non-null-assertion */\n}\n\n//__________________________________________________________________________________________________//\n\n/**\n * @en Create escape function from map.\n * @ja æå­ç½®æé¢æ°ãä½æ\n *\n * @param map\n *  - `en` key: target char, value: replace char\n *  - `ja` key: ç½®æå¯¾è±¡, value: ç½®ææå­\n * @returns\n *  - `en` espace function\n *  - `ja` ã¨ã¹ã±ã¼ãé¢æ°\n */\nexport function createEscaper(map: object): (src: Primitive) => string {\n    const escaper = (match: string): string => {\n        return map[match];\n    };\n\n    const source = `(?:${Object.keys(map).join('|')})`;\n    const regexTest = RegExp(source);\n    const regexReplace = RegExp(source, 'g');\n\n    return (src: Primitive): string => {\n        src = (null == src || 'symbol' === typeof src) ? '' : String(src);\n        return regexTest.test(src) ? src.replace(regexReplace, escaper) : src;\n    };\n}\n\n/** @internal */\nconst mapHtmlEscape = {\n    '<': '&lt;',\n    '>': '&gt;',\n    '&': '&amp;',\n    '\"': '&quot;',\n    \"'\": '&#39;',\n    '`': '&#x60;'\n};\n\n/**\n * @en Escape HTML string.\n * @ja HTML ã§ä½¿ç¨ããæå­ãå¶å¾¡æå­ã«ç½®æ\n *\n * @brief <br>\n *\n * ```ts\n * const mapHtmlEscape = {\n *     '<' : '&lt;',\n *     '>' : '&gt;',\n *     '&' : '&amp;',\n *     'â³': '&quot;',\n *     `'` : '&#39;',\n *     '`' : '&#x60;'\n * };\n * ```\n */\nexport const escapeHTML = createEscaper(mapHtmlEscape);\n\n/**\n * @en Unescape HTML string.\n * @ja HTML ã§ä½¿ç¨ããå¶å¾¡æå­ãå¾©å\n */\nexport const unescapeHTML = createEscaper(invert(mapHtmlEscape));\n\n//__________________________________________________________________________________________________//\n\n/**\n * @en Convert to the style compulsion value from input string.\n * @ja å¥åæå­åãåå¼·å¶ããå¤ã«å¤æ\n *\n * @param data\n *  - `en` input string\n *  - `ja` å¤æå¯¾è±¡ã®æå­å\n */\nexport function toTypedData(data: string | undefined): TypedData | undefined {\n    if ('true' === data) {\n        // boolean: true\n        return true;\n    } else if ('false' === data) {\n        // boolean: false\n        return false;\n    } else if ('null' === data) {\n        // null\n        return null;\n    } else if (data === String(Number(data))) {\n        // number: æ°å¤å¤æ â æå­åå¤æã§åã«æ»ãã¨ã\n        return Number(data);\n    } else if (data && /^(?:\\{[\\w\\W]*\\}|\\[[\\w\\W]*\\])$/.test(data)) {\n        // object\n        return JSON.parse(data);\n    } else {\n        // string / undefined\n        return data;\n    }\n}\n\n/**\n * @en Convert to string from [[TypedData]].\n * @ja [[TypedData]] ãæå­åã«å¤æ\n *\n * @param data\n *  - `en` input string\n *  - `ja` å¤æå¯¾è±¡ã®æå­å\n */\nexport function fromTypedData(data: TypedData | undefined): string | undefined {\n    if (undefined === data || isString(data)) {\n        return data;\n    } else if (isObject(data)) {\n        return JSON.stringify(data);\n    } else {\n        return String(data);\n    }\n}\n\n/**\n * @en Convert to `Web API` stocked type. <br>\n *     Ensure not to return `undefined` value.\n * @ja `Web API` æ ¼ç´å½¢å¼ã«å¤æ <br>\n *     `undefined` ãè¿å´ããªããã¨ãä¿è¨¼\n */\nexport function dropUndefined<T>(value: T | null | undefined, nullishSerialize = false): T | 'null' | 'undefined' | null {\n    return null != value ? value : (nullishSerialize ? String(value) : null) as T | 'null' | 'undefined' | null;\n}\n\n/**\n * @en Deserialize from `Web API` stocked type. <br>\n *     Convert from 'null' or 'undefined' string to original type.\n * @ja 'null' or 'undefined' ããã¨ã®åã«æ»ã\n */\nexport function restoreNullish<T>(value: T | 'null' | 'undefined'): T | null | undefined {\n    if ('null' === value) {\n        return null;\n    } else if ('undefined' === value) {\n        return undefined;\n    } else {\n        return value;\n    }\n}\n\n//__________________________________________________________________________________________________//\n\n/** @internal */ let _localId = 0;\n\n/**\n * @en Get local unique id. <br>\n *     \"local unique\" means guarantees unique during in script life cycle only.\n * @ja ã­ã¼ã«ã«ã¦ãã¼ã¯ ID ã®åå¾ <br>\n *     ã¹ã¯ãªããã©ã¤ããµã¤ã¯ã«ä¸­ã®åä¸æ§ãä¿è¨¼ãã.\n *\n * @param prefix\n *  - `en` ID prefix\n *  - `ja` ID ã«ä»ä¸ãã Prefix\n * @param zeroPad\n *  - `en` 0 padding order\n *  - `ja` 0 è©°ãããæ¡æ°ãæå®\n */\nexport function luid(prefix = '', zeroPad?: number): string {\n    const id = (++_localId).toString(16);\n    return (null != zeroPad) ? `${prefix}${id.padStart(zeroPad, '0')}` : `${prefix}${id}`;\n}\n\n/**\n * @en Returns a random integer between `0` and `max`, inclusive.\n * @ja `0` - `max` ã®ã©ã³ãã ã®æ´æ°å¤ãçæ\n *\n * @param max\n *  - `en` The maximum random number.\n *  - `ja` æ´æ°ã®æå¤§å¤\n */\nexport function randomInt(max: number): number;\n\n/**\n * @en Returns a random integer between `min` and `max`, inclusive.\n * @ja `min` - `max` ã®ã©ã³ãã ã®æ´æ°å¤ãçæ\n *\n * @param min\n *  - `en` The maximum random number.\n *  - `ja` æ´æ°ã®æå¤§å¤\n * @param max\n *  - `en` The maximum random number.\n *  - `ja` æ´æ°ã®æå¤§å¤\n */\nexport function randomInt(min: number, max: number): number; // eslint-disable-line @typescript-eslint/unified-signatures\n\nexport function randomInt(min: number, max?: number): number {\n    if (null == max) {\n        max = min;\n        min = 0;\n    }\n    return min + Math.floor(Math.random() * (max - min + 1));\n}\n\n//__________________________________________________________________________________________________//\n\n/** @internal */ const _regexCancelLikeString = /(abort|cancel)/im;\n\n/**\n * @en Presume whether it's a canceled error.\n * @ja ã­ã£ã³ã»ã«ãããã¨ã©ã¼ã§ãããæ¨å®\n *\n * @param error\n *  - `en` an error object handled in `catch` block.\n *  - `ja` `catch` ç¯ãªã©ã§è£è¶³ããã¨ã©ã¼ãæå®\n */\nexport function isCancelLikeError(error: unknown): boolean {\n    if (null == error) {\n        return false;\n    } else if (isString(error)) {\n        return _regexCancelLikeString.test(error);\n    } else if (isObject(error)) {\n        return _regexCancelLikeString.test((error as Error).message);\n    } else {\n        return false;\n    }\n}\n\n//__________________________________________________________________________________________________//\n\n/**\n * @en Converts first letter of the string to uppercase.\n * @ja æåã®æå­ãå¤§æå­ã«å¤æ\n *\n *\n * @example <br>\n *\n * ```ts\n * capitalize(\"foo Bar\");\n * // => \"Foo Bar\"\n *\n * capitalize(\"FOO Bar\", true);\n * // => \"Foo bar\"\n * ```\n *\n * @param src\n *  - `en` source string\n *  - `ja` å¤æåæå­å\n * @param lowercaseRest\n *  - `en` If `true` is passed, the rest of the string will be converted to lower case\n *  - `ja` `true` ãæå®ããå ´å, 2æå­ç®ä»¥éãå°æå­å\n */\nexport function capitalize(src: string, lowercaseRest = false): string {\n    const remainingChars = !lowercaseRest ? src.slice(1) : src.slice(1).toLowerCase();\n    return src.charAt(0).toUpperCase() + remainingChars;\n}\n\n/**\n * @en Converts first letter of the string to lowercase.\n * @ja æåã®æå­ãå°æå­å\n *\n * @example <br>\n *\n * ```ts\n * decapitalize(\"Foo Bar\");\n * // => \"foo Bar\"\n * ```\n *\n * @param src\n *  - `en` source string\n *  - `ja` å¤æåæå­å\n */\nexport function decapitalize(src: string): string {\n    return src.charAt(0).toLowerCase() + src.slice(1);\n}\n\n/**\n * @en Converts underscored or dasherized string to a camelized one. <br>\n *     Begins with a lower case letter unless it starts with an underscore, dash or an upper case letter.\n * @ja `_`, `-` åºåãæå­åãã­ã£ã¡ã«ã±ã¼ã¹å <br>\n *     `-` ã¾ãã¯å¤§æå­ã¹ã¿ã¼ãã§ããã°, å¤§æå­ã¹ã¿ã¼ããæ¢å®å¤\n *\n * @example <br>\n *\n * ```ts\n * camelize(\"moz-transform\");\n * // => \"mozTransform\"\n *\n * camelize(\"-moz-transform\");\n * // => \"MozTransform\"\n *\n * camelize(\"_moz_transform\");\n * // => \"MozTransform\"\n *\n * camelize(\"Moz-transform\");\n * // => \"MozTransform\"\n *\n * camelize(\"-moz-transform\", true);\n * // => \"mozTransform\"\n * ```\n *\n * @param src\n *  - `en` source string\n *  - `ja` å¤æåæå­å\n * @param lower\n *  - `en` If `true` is passed, force converts to lower camel case in starts with the special case.\n *  - `ja` å¼·å¶çã«å°æå­ã¹ã¿ã¼ãããå ´åã«ã¯ `true` ãæå®\n */\nexport function camelize(src: string, lower = false): string {\n    src = src.trim().replace(/[-_\\s]+(.)?/g, (match, c) => {\n        return c ? c.toUpperCase() : '';\n    });\n\n    if (true === lower) {\n        return decapitalize(src);\n    } else {\n        return src;\n    }\n}\n\n/**\n * @en Converts string to camelized class name. First letter is always upper case.\n * @ja åé ­å¤§æå­ã®ã­ã£ã¡ã«ã±ã¼ã¹ã«å¤æ\n *\n * @example <br>\n *\n * ```ts\n * classify(\"some_class_name\");\n * // => \"SomeClassName\"\n * ```\n *\n * @param src\n *  - `en` source string\n *  - `ja` å¤æåæå­å\n */\nexport function classify(src: string): string {\n    return capitalize(camelize(src.replace(/[\\W_]/g, ' ')).replace(/\\s/g, ''));\n}\n\n/**\n * @en Converts a camelized or dasherized string into an underscored one.\n * @ja ã­ã£ã¡ã«ã±ã¼ã¹ or `-` ã¤ãªãæå­åã `_` ã¤ãªãã«å¤æ\n *\n * @example <br>\n *\n * ```ts\n * underscored(\"MozTransform\");\n * // => \"moz_transform\"\n * ```\n *\n * @param src\n *  - `en` source string\n *  - `ja` å¤æåæå­å\n */\nexport function underscored(src: string): string {\n    return src.trim().replace(/([a-z\\d])([A-Z]+)/g, '$1_$2').replace(/[-\\s]+/g, '_').toLowerCase();\n}\n\n/**\n * @en Converts a underscored or camelized string into an dasherized one.\n * @ja ã­ã£ã¡ã«ã±ã¼ã¹ or `_` ã¤ãªãæå­åã `-` ã¤ãªãã«å¤æ\n *\n * @example <br>\n *\n * ```ts\n * dasherize(\"MozTransform\");\n * // => \"-moz-transform\"\n * ```\n *\n * @param src\n *  - `en` source string\n *  - `ja` å¤æåæå­å\n */\nexport function dasherize(src: string): string {\n    return src.trim().replace(/([A-Z])/g, '-$1').replace(/[_\\s]+/g, '-').toLowerCase();\n}\n","/* eslint-disable\n    no-invalid-this,\n */\n\nimport { assignValue } from './deep-circuit';\nimport { randomInt } from './misc';\n\n/**\n * @en Execute shuffle of an array elements.\n * @ja éåè¦ç´ ã®ã·ã£ããã«\n *\n * @param array\n *  - `en` source array\n *  - `ja` å¥åéå\n * @param destructive\n *  - `en` true: destructive / false: non-destructive (default)\n *  - `ja` true: ç ´å£ç / false: éç ´å£ç (æ¢å®)\n */\nexport function shuffle<T>(array: T[], destructive = false): T[] {\n    const source = destructive ? array : array.slice();\n    const len = source.length;\n    for (let i = len > 0 ? len >>> 0 : 0; i > 1;) {\n        const j = i * Math.random() >>> 0;\n        const swap = source[--i];\n        source[i] = source[j];\n        source[j] = swap;\n    }\n    return source;\n}\n\n//__________________________________________________________________________________________________//\n\n/**\n * @en Execute stable sort by merge-sort algorithm.\n * @ja `merge-sort` ã«ããå®å®ã½ã¼ã\n *\n * @param array\n *  - `en` source array\n *  - `ja` å¥åéå\n * @param comparator\n *  - `en` sort comparator function\n *  - `ja` ã½ã¼ãé¢æ°ãæå®\n * @param destructive\n *  - `en` true: destructive / false: non-destructive (default)\n *  - `ja` true: ç ´å£ç / false: éç ´å£ç (æ¢å®)\n */\nexport function sort<T>(array: T[], comparator: (lhs: T, rhs: T) => number, destructive = false): T[] {\n    const source = destructive ? array : array.slice();\n    if (source.length < 2) {\n        return source;\n    }\n    const lhs = sort(source.splice(0, source.length >>> 1), comparator, true);\n    const rhs = sort(source.splice(0), comparator, true);\n    while (lhs.length && rhs.length) {\n        source.push(comparator(lhs[0], rhs[0]) <= 0 ? lhs.shift() as T : rhs.shift() as T);\n    }\n    return source.concat(lhs, rhs);\n}\n\n//__________________________________________________________________________________________________//\n\n/**\n * @en Make unique array.\n * @ja éè¤è¦ç´ ã®ãªãéåã®ä½æ\n *\n * @param array\n *  - `en` source array\n *  - `ja` å¥åéå\n */\nexport function unique<T>(array: T[]): T[] {\n    return [...new Set(array)];\n}\n\n/**\n * @en Make union array.\n * @ja éåã®åéåãè¿å´\n *\n * @param arrays\n *  - `en` source arrays\n *  - `ja` å¥åéåç¾¤\n */\nexport function union<T>(...arrays: T[][]): T[] {\n    return unique(arrays.flat());\n}\n\n//__________________________________________________________________________________________________//\n\n/**\n * @en Get the model at the given index. If negative value is given, the target will be found from the last index.\n * @ja ã¤ã³ããã¯ã¹æå®ã«ããã¢ãã«ã¸ã®ã¢ã¯ã»ã¹. è² å¤ã®å ´åã¯æ«å°¾æ¤ç´¢ãå®è¡\n *\n * @param array\n *  - `en` source array\n *  - `ja` å¥åéå\n * @param index\n *  - `en` A zero-based integer indicating which element to retrieve. <br> If negative index is counted from the end of the matched set.\n *  - `ja` 0 base ã®ã¤ã³ããã¯ã¹ãæå® <br> è² å¤ãæå®ãããå ´å, æ«å°¾ããã®ã¤ã³ããã¯ã¹ã¨ãã¦è§£éããã\n */\nexport function at<T>(array: T[], index: number): T | never {\n    const idx = Math.trunc(index);\n    const el = idx < 0 ? array[idx + array.length] : array[idx];\n    if (null == el) {\n        throw new RangeError(`invalid array index. [length: ${array.length}, given: ${index}]`);\n    }\n    return el;\n}\n\n//__________________________________________________________________________________________________//\n\n/**\n * @en Make index array.\n * @ja ã¤ã³ããã¯ã¹éåã®ä½æ\n *\n * @param array\n *  - `en` source array\n *  - `ja` å¥åéå\n * @param excludes\n *  - `en` exclude index in return value.\n *  - `ja` æ»ãå¤éåã«å«ããªãã¤ã³ããã¯ã¹ãæå®\n */\nexport function indices<T>(array: T[], ...excludes: number[]): number[] {\n    const retval = [...array.keys()];\n\n    const len = array.length;\n    const exList = [...new Set(excludes)].sort((lhs, rhs) => lhs < rhs ? 1 : -1);\n    for (const ex of exList) {\n        if (0 <= ex && ex < len) {\n            retval.splice(ex, 1);\n        }\n    }\n\n    return retval;\n}\n\n//__________________________________________________________________________________________________//\n\n/**\n * @en [[groupBy]]() options definition.\n * @ja [[groupBy]]() ã«æå®ãããªãã·ã§ã³å®ç¾©\n */\nexport interface GroupByOptions<\n    T extends object,\n    TKEYS extends keyof T,\n    TSUMKEYS extends keyof T,\n    TGROUPKEY extends string\n> {\n    /**\n     * @en `GROUP BY` keys.\n     * @ja `GROUP BY` ã«æå®ããã­ã¼\n     */\n    keys: Extract<TKEYS, string>[];\n\n    /**\n     * @en Aggregatable keys.\n     * @ja éè¨å¯è½ãªã­ã¼ä¸è¦§\n     */\n    sumKeys?: Extract<TSUMKEYS, string>[];\n\n    /**\n     * @en Grouped item access key. default: 'items',\n     * @ja ã°ã«ã¼ãã³ã°ãããè¦ç´ ã¸ã®ã¢ã¯ã»ã¹ã­ã¼. æ¢å®: 'items'\n     */\n    groupKey?: TGROUPKEY;\n}\n\n/**\n * @en Return type of [[groupBy]]().\n * @ja [[groupBy]]() ãè¿å´ããå\n */\nexport type GroupByReturnValue<\n    T extends object,\n    TKEYS extends keyof T,\n    TSUMKEYS extends keyof T = never,\n    TGROUPKEY extends string = 'items'\n> = Readonly<Record<TKEYS, unknown> & Record<TSUMKEYS, unknown> & Record<TGROUPKEY, T[]>>;\n\n/**\n * @en Execute `GROUP BY` for array elements.\n * @ja éåã®è¦ç´ ã® `GROUP BY` éåãæ½åº\n *\n * @param array\n *  - `en` source array\n *  - `ja` å¥åéå\n * @param options\n *  - `en` `GROUP BY` options\n *  - `ja` `GROUP BY` ãªãã·ã§ã³\n */\nexport function groupBy<\n    T extends object,\n    TKEYS extends keyof T,\n    TSUMKEYS extends keyof T = never,\n    TGROUPKEY extends string = 'items'\n>(array: T[], options: GroupByOptions<T, TKEYS, TSUMKEYS, TGROUPKEY>): GroupByReturnValue<T, TKEYS, TSUMKEYS, TGROUPKEY>[] {\n    const { keys, sumKeys, groupKey } = options;\n    const _groupKey = groupKey || 'items';\n    const _sumKeys: string[] = sumKeys || [];\n    _sumKeys.push(_groupKey);\n\n    const hash = array.reduce((res: T, data: T) => {\n        // create groupBy internal key\n        const _key = keys.reduce((s, k) => s + String(data[k]), '');\n\n        // init keys\n        if (!(_key in res)) {\n            const keyList = keys.reduce((h, k: string) => {\n                assignValue(h, k, data[k]);\n                return h;\n            }, {});\n\n            res[_key] = _sumKeys.reduce((h, k: string) => {\n                h[k] = 0;\n                return h;\n            }, keyList);\n        }\n\n        const resKey = res[_key];\n\n        // sum properties\n        for (const k of _sumKeys) {\n            if (_groupKey === k) {\n                resKey[k] = resKey[k] || [];\n                resKey[k].push(data);\n            } else {\n                resKey[k] += data[k];\n            }\n        }\n\n        return res;\n    }, {});\n\n    return Object.values(hash);\n}\n\n//__________________________________________________________________________________________________//\n\n/**\n * @en Computes the list of values that are the intersection of all the arrays. Each value in the result is present in each of the arrays.\n * @ja éåã®ç©éåãè¿å´. è¿å´ãããéåã®è¦ç´ ã¯ãã¹ã¦ã®å¥åãããéåã«å«ã¾ãã\n *\n * @example <br>\n *\n * ```ts\n * console.log(intersection([1, 2, 3], [101, 2, 1, 10], [2, 1]));\n * // => [1, 2]\n * ```\n *\n * @param arrays\n *  - `en` source array\n *  - `ja` å¥åéå\n */\nexport function intersection<T>(...arrays: T[][]): T[] {\n    return arrays.reduce((acc, ary) => acc.filter(el => ary.includes(el)));\n}\n\n/**\n * @en Returns the values from array that are not present in the other arrays.\n * @ja éåããã»ãã®éåã«å«ã¾ããªããã®ãè¿å´\n *\n * @example <br>\n *\n * ```ts\n * console.log(difference([1, 2, 3, 4, 5], [5, 2, 10]));\n * // => [1, 3, 4]\n * ```\n *\n * @param array\n *  - `en` source array\n *  - `ja` å¥åéå\n * @param others\n *  - `en` exclude element in return value.\n *  - `ja` æ»ãå¤éåã«å«ããªãè¦ç´ ãæå®\n */\nexport function difference<T>(array: T[], ...others: T[][]): T[] {\n    const arrays = [array, ...others] as T[][];\n    return arrays.reduce((acc, ary) => acc.filter(el => !ary.includes(el)));\n}\n\n/**\n * @en Returns a copy of the array with all instances of the values removed.\n * @ja éåããæå®è¦ç´ ãåãé¤ãããã®ãè¿å´\n *\n * @example <br>\n *\n * ```ts\n * console.log(without([1, 2, 1, 0, 3, 1, 4], 0, 1));\n * // => [2, 3, 4]\n * ```\n *\n * @param array\n *  - `en` source array\n *  - `ja` å¥åéå\n * @param values\n *  - `en` exclude element in return value.\n *  - `ja` æ»ãå¤éåã«å«ããªãè¦ç´ ãæå®\n */\nexport function without<T>(array: T[], ...values: T[]): T[] {\n    return difference(array, values);\n}\n\n/**\n * @en Produce a random sample from the list.\n * @ja ã©ã³ãã ã«ãµã³ãã«å¤ãè¿å´\n *\n * @example <br>\n *\n * ```ts\n * console.log(sample([1, 2, 3, 4, 5, 6], 3));\n * // => [1, 6, 2]\n * ```\n *\n * @param array\n *  - `en` source array\n *  - `ja` å¥åéå\n * @param count\n *  - `en` number of sampling count.\n *  - `ja` è¿å´ãããµã³ãã«æ°ãæå®\n */\nexport function sample<T>(array: T[], count: number): T[];\n\n/**\n * @en Produce a random sample from the list.\n * @ja ã©ã³ãã ã«ãµã³ãã«å¤ãè¿å´\n *\n * @example <br>\n *\n * ```ts\n * console.log(sample([1, 2, 3, 4, 5, 6]));\n * // => 4\n * ```\n *\n * @param array\n *  - `en` source array\n *  - `ja` å¥åéå\n */\nexport function sample<T>(array: T[]): T;\n\nexport function sample<T>(array: T[], count?: number): T | T[] {\n    if (null == count) {\n        return array[randomInt(array.length - 1)];\n    }\n    const sample = array.slice();\n    const length = sample.length;\n    count = Math.max(Math.min(count, length), 0);\n    const last = length - 1;\n    for (let index = 0; index < count; index++) {\n        const rand = randomInt(index, last);\n        const temp = sample[index];\n        sample[index] = sample[rand];\n        sample[rand] = temp;\n    }\n    return sample.slice(0, count);\n}\n\n//__________________________________________________________________________________________________//\n\n/**\n * @en Returns a result of permutation from the list.\n * @ja éåããé åçµæãè¿å´\n *\n * @example <br>\n *\n * ```ts\n * const arr = permutation(['a', 'b', 'c'], 2);\n * console.log(JSON.stringify(arr));\n * // => [['a','b'],['a','c'],['b','a'],['b','c'],['c','a'],['c','b']]\n * ```\n *\n * @param array\n *  - `en` source array\n *  - `ja` å¥åéå\n * @param count\n *  - `en` number of pick up.\n *  - `ja` é¸ææ°\n */\nexport function permutation<T>(array: T[], count: number): T[][] {\n    const retval: T[][] = [];\n    if (array.length < count) {\n        return [];\n    }\n    if (1 === count) {\n        for (const [i, val] of array.entries()) {\n            retval[i] = [val];\n        }\n    } else {\n        for (let i = 0, n1 = array.length; i < n1; i++) {\n            const parts = array.slice(0);\n            parts.splice(i, 1);\n            const row = permutation(parts, count - 1);\n            for (let j = 0, n2 = row.length; j < n2; j++) {\n                retval.push([array[i]].concat(row[j]));\n            }\n        }\n    }\n    return retval;\n}\n\n/**\n * @en Returns a result of combination from the list.\n * @ja éåããçµã¿åããçµæãè¿å´\n *\n * @example <br>\n *\n * ```ts\n * const arr = combination(['a', 'b', 'c'], 2);\n * console.log(JSON.stringify(arr));\n * // => [['a','b'],['a','c'],['b','c']]\n * ```\n *\n * @param array\n *  - `en` source array\n *  - `ja` å¥åéå\n * @param count\n *  - `en` number of pick up.\n *  - `ja` é¸ææ°\n */\nexport function combination<T>(array: T[], count: number): T[][] {\n    const retval: T[][] = [];\n    if (array.length < count) {\n        return [];\n    }\n    if (1 === count) {\n        for (const [i, val] of array.entries()) {\n            retval[i] = [val];\n        }\n    } else {\n        for (let i = 0, n1 = array.length; i < n1 - count + 1; i++) {\n            const row = combination(array.slice(i + 1), count - 1);\n            for (let j = 0, n2 = row.length; j < n2; j++) {\n                retval.push([array[i]].concat(row[j]));\n            }\n        }\n    }\n    return retval;\n}\n\n//__________________________________________________________________________________________________//\n\n/**\n * @en Substitution method of `Array.prototype.map()` which also accepts asynchronous callback.\n * @ja éåæã³ã¼ã«ããã¯ãæå®å¯è½ãª `Array.prototype.map()` ã®ä»£æ¿ã¡ã½ãã\n * \n * @param array\n *  - `en` Array to iterate over.\n *  - `ja` å¥åéå\n * @param callback\n *  - `en` Function to apply each item in `array`.\n *  - `ja` ã¤ãã¬ã¼ã·ã§ã³é©ç¨é¢æ°\n * @param thisArg\n *  - `en` Value to use as *this* when executing the `callback`.\n *  - `ja` `callback` å®è¡ã³ã³ãã­ã¹ã\n * @returns\n *  - `en` Returns a Promise with the resultant *Array* as value.\n *  - `ja` ã¤ãã¬ã¼ã·ã§ã³çµæéåãæ ¼ç´ãã Promise ãªãã¸ã§ã¯ã\n */\nexport async function map<T, U>(this: unknown, array: T[], callback: (value: T, index: number, array: T[]) => U | Promise<U>, thisArg?: unknown): Promise<U[]> {\n    return Promise.all(\n        array.map(async (v, i, a) => {\n            return await callback.call(thisArg || this, v, i, a);\n        })\n    );\n}\n\n/**\n * @en Substitution method of `Array.prototype.filter()` which also accepts asynchronous callback.\n * @ja éåæã³ã¼ã«ããã¯ãæå®å¯è½ãª `Array.prototype.filter()` ã®ä»£æ¿ã¡ã½ãã\n *\n * @param array\n *  - `en` Array to iterate over.\n *  - `ja` å¥åéå\n * @param callback\n *  - `en` Function to apply each item in `array`.\n *  - `ja` ã¤ãã¬ã¼ã·ã§ã³é©ç¨é¢æ°\n * @param thisArg\n *  - `en` Value to use as *this* when executing the `callback`.\n *  - `ja` `callback` å®è¡ã³ã³ãã­ã¹ã\n * @returns\n *  - `en` Returns a Promise with the resultant *Array* as value.\n *  - `ja` ã¤ãã¬ã¼ã·ã§ã³çµæéåãæ ¼ç´ãã Promise ãªãã¸ã§ã¯ã\n */\nexport async function filter<T>(this: unknown, array: T[], callback: (value: T, index: number, array: T[]) => boolean | Promise<boolean>, thisArg?: unknown): Promise<T[]> {\n    const bits: boolean[] = await map(array, (v, i, a) => callback.call(thisArg || this, v, i, a));\n    return array.filter(() => bits.shift());\n}\n\n/**\n * @en Substitution method of `Array.prototype.find()` which also accepts asynchronous callback.\n * @ja éåæã³ã¼ã«ããã¯ãæå®å¯è½ãª `Array.prototype.find()` ã®ä»£æ¿ã¡ã½ãã\n *\n * @param array\n *  - `en` Array to iterate over.\n *  - `ja` å¥åéå\n * @param callback\n *  - `en` Function to apply each item in `array`.\n *  - `ja` ã¤ãã¬ã¼ã·ã§ã³é©ç¨é¢æ°\n * @param thisArg\n *  - `en` Value to use as *this* when executing the `callback`.\n *  - `ja` `callback` å®è¡ã³ã³ãã­ã¹ã\n * @returns\n *  - `en` Returns a Promise with the resultant value.\n *  - `ja` ã¤ãã¬ã¼ã·ã§ã³çµæãæ ¼ç´ãã Promise ãªãã¸ã§ã¯ã\n */\nexport async function find<T>(this: unknown, array: T[], callback: (value: T, index: number, array: T[]) => boolean | Promise<boolean>, thisArg?: unknown): Promise<T | undefined> {\n    for (const [i, v] of array.entries()) {\n        if (await callback.call(thisArg || this, v, i, array)) {\n            return v;\n        }\n    }\n    return undefined;\n}\n\n/**\n * @en Substitution method of `Array.prototype.findIndex()` which also accepts asynchronous callback.\n * @ja éåæã³ã¼ã«ããã¯ãæå®å¯è½ãª `Array.prototype.findIndex()` ã®ä»£æ¿ã¡ã½ãã\n *\n * @param array\n *  - `en` Array to iterate over.\n *  - `ja` å¥åéå\n * @param callback\n *  - `en` Function to apply each item in `array`.\n *  - `ja` ã¤ãã¬ã¼ã·ã§ã³é©ç¨é¢æ°\n * @param thisArg\n *  - `en` Value to use as *this* when executing the `callback`.\n *  - `ja` `callback` å®è¡ã³ã³ãã­ã¹ã\n * @returns\n *  - `en` Returns a Promise with the resultant index value.\n *  - `ja` ã¤ã³ããã¯ã¹ãæ ¼ç´ãã Promise ãªãã¸ã§ã¯ã\n */\nexport async function findIndex<T>(this: unknown, array: T[], callback: (value: T, index: number, array: T[]) => boolean | Promise<boolean>, thisArg?: unknown): Promise<number> {\n    for (const [i, v] of array.entries()) {\n        if (await callback.call(thisArg || this, v, i, array)) {\n            return i;\n        }\n    }\n    return -1;\n}\n\n/**\n * @en Substitution method of `Array.prototype.some()` which also accepts asynchronous callback.\n * @ja éåæã³ã¼ã«ããã¯ãæå®å¯è½ãª `Array.prototype.some()` ã®ä»£æ¿ã¡ã½ãã\n *\n * @param array\n *  - `en` Array to iterate over.\n *  - `ja` å¥åéå\n * @param callback\n *  - `en` Function to apply each item in `array`.\n *  - `ja` ã¤ãã¬ã¼ã·ã§ã³é©ç¨é¢æ°\n * @param thisArg\n *  - `en` Value to use as *this* when executing the `callback`.\n *  - `ja` `callback` å®è¡ã³ã³ãã­ã¹ã\n * @returns\n *  - `en` Returns a Promise with the resultant boolean value.\n *  - `ja` çå½å¤ãæ ¼ç´ãã Promise ãªãã¸ã§ã¯ã\n */\nexport async function some<T>(this: unknown, array: T[], callback: (value: T, index: number, array: T[]) => unknown | Promise<unknown>, thisArg?: unknown): Promise<boolean> {\n    for (const [i, v] of array.entries()) {\n        if (await callback.call(thisArg || this, v, i, array)) {\n            return true;\n        }\n    }\n    return false;\n}\n\n/**\n * @en Substitution method of `Array.prototype.every()` which also accepts asynchronous callback.\n * @ja éåæã³ã¼ã«ããã¯ãæå®å¯è½ãª `Array.prototype.every()` ã®ä»£æ¿ã¡ã½ãã\n *\n * @param array\n *  - `en` Array to iterate over.\n *  - `ja` å¥åéå\n * @param callback\n *  - `en` Function to apply each item in `array`.\n *  - `ja` ã¤ãã¬ã¼ã·ã§ã³é©ç¨é¢æ°\n * @param thisArg\n *  - `en` Value to use as *this* when executing the `callback`.\n *  - `ja` `callback` å®è¡ã³ã³ãã­ã¹ã\n * @returns\n *  - `en` Returns a Promise with the resultant boolean value.\n *  - `ja` çå½å¤ãæ ¼ç´ãã Promise ãªãã¸ã§ã¯ã\n */\nexport async function every<T>(this: unknown, array: T[], callback: (value: T, index: number, array: T[]) => unknown | Promise<unknown>, thisArg?: unknown): Promise<boolean> {\n    for (const [i, v] of array.entries()) {\n        if (!await callback.call(thisArg || this, v, i, array)) {\n            return false;\n        }\n    }\n    return true;\n}\n\n/**\n * @en Substitution method of `Array.prototype.reduce()` which also accepts asynchronous callback.\n * @ja éåæã³ã¼ã«ããã¯ãæå®å¯è½ãª `Array.prototype.reduce()` ã®ä»£æ¿ã¡ã½ãã\n *\n * @param array\n *  - `en` Array to iterate over.\n *  - `ja` å¥åéå\n * @param callback\n *  - `en` Function to apply each item in `array`.\n *  - `ja` ã¤ãã¬ã¼ã·ã§ã³é©ç¨é¢æ°\n * @param initialValue\n *  - `en` Used as first argument to the first call of `callback`.\n *  - `ja` `callback` ã«æ¸¡ãããåæå¤\n * @returns\n *  - `en` Returns a Promise with the resultant *Array* as value.\n *  - `ja` ã¤ãã¬ã¼ã·ã§ã³çµæéåãæ ¼ç´ãã Promise ãªãã¸ã§ã¯ã\n */\nexport async function reduce<T, U>(\n    array: T[],\n    callback: (accumulator: U, currentValue: T, currentIndex: number, array: T[]) => U | Promise<U>,\n    initialValue?: U\n): Promise<U> {\n    if (array.length <= 0 && undefined === initialValue) {\n        throw TypeError('Reduce of empty array with no initial value');\n    }\n\n    const hasInit = (undefined !== initialValue);\n    let acc = (hasInit ? initialValue : array[0]) as U;\n\n    for (const [i, v] of array.entries()) {\n        if (!(!hasInit && 0 === i)) {\n            acc = await callback(acc, v, i, array);\n        }\n    }\n\n    return acc;\n}\n","/**\n * @en Date unit definitions.\n * @ja æ¥æãªãã¸ã§ã¯ãã®åä½å®ç¾©\n */\nexport type DateUnit = 'year' | 'month' | 'day' | 'hour' | 'min' | 'sec' | 'msec';\n\n/** @internal */\nconst _computeDateFuncMap = {\n    year: (date: Date, base: Date, add: number) => {\n        date.setUTCFullYear(base.getUTCFullYear() + add);\n        return date;\n    },\n    month: (date: Date, base: Date, add: number) => {\n        date.setUTCMonth(base.getUTCMonth() + add);\n        return date;\n    },\n    day: (date: Date, base: Date, add: number) => {\n        date.setUTCDate(base.getUTCDate() + add);\n        return date;\n    },\n    hour: (date: Date, base: Date, add: number) => {\n        date.setUTCHours(base.getUTCHours() + add);\n        return date;\n    },\n    min: (date: Date, base: Date, add: number) => {\n        date.setUTCMinutes(base.getUTCMinutes() + add);\n        return date;\n    },\n    sec: (date: Date, base: Date, add: number) => {\n        date.setUTCSeconds(base.getUTCSeconds() + add);\n        return date;\n    },\n    msec: (date: Date, base: Date, add: number) => {\n        date.setUTCMilliseconds(base.getUTCMilliseconds() + add);\n        return date;\n    },\n};\n\n/**\n * @en Calculate from the date which becomes a cardinal point before a N date time or after a N date time (by [[DateUnit]]).\n * @ja åºç¹ã¨ãªãæ¥ä»ãããNæ¥å¾ãNæ¥åãç®åº\n *\n * @param base\n *  - `en` base date time.\n *  - `ja` åºæºæ¥\n * @param add\n *  - `en` relative date time.\n *  - `ja` å ç®æ¥. ãã¤ãã¹æå®ã§næ¥åãè¨­å®å¯è½\n * @param unit [[DateUnit]]\n */\nexport function computeDate(base: Date, add: number, unit: DateUnit = 'day'): Date {\n    const date = new Date(base.getTime());\n    const func = _computeDateFuncMap[unit];\n    if (func) {\n        return func(date, base, add);\n    } else {\n        throw new TypeError(`invalid unit: ${unit}`);\n    }\n}\n","const _status: Record<string | symbol, number> = {};\n\n/**\n * @en Increment reference count for status identifier.\n * @ja ç¶æå¤æ°ã®åç§ã«ã¦ã³ãã®ã¤ã³ã¯ãªã¡ã³ã\n *\n * @param status\n *  - `en` state identifier\n *  - `ja` ç¶æè­å¥å­\n * @returns\n *  - `en` reference count value\n *  - `ja` åç§ã«ã¦ã³ãã®å¤\n */\nexport function statusAddRef(status: string | symbol): number {\n    if (!_status[status]) {\n        _status[status] = 1;\n    } else {\n        _status[status]++;\n    }\n    return _status[status];\n}\n\n/**\n * @en Decrement reference count for status identifier.\n * @ja ç¶æå¤æ°ã®åç§ã«ã¦ã³ãã®ãã¯ãªã¡ã³ã\n *\n * @param status\n *  - `en` state identifier\n *  - `ja` ç¶æè­å¥å­\n * @returns\n *  - `en` reference count value\n *  - `ja` åç§ã«ã¦ã³ãã®å¤\n */\nexport function statusRelease(status: string | symbol): number {\n    if (!_status[status]) {\n        return 0;\n    } else {\n        const retval = --_status[status];\n        if (0 === retval) {\n            delete _status[status];\n        }\n        return retval;\n    }\n}\n\n/**\n * @en State variable management scope\n * @ja ç¶æå¤æ°ç®¡çã¹ã³ã¼ã\n *\n * @param status\n *  - `en` state identifier\n *  - `ja` ç¶æè­å¥å­\n * @param executor\n *  - `en` seed function.\n *  - `ja` å¯¾è±¡ã®é¢æ°\n * @returns\n *  - `en` retval of seed function.\n *  - `ja` å¯¾è±¡ã®é¢æ°ã®æ»ãå¤\n */\nexport async function statusScope<T>(status: string | symbol, executor: () => T | Promise<T>): Promise<T> {\n    try {\n        statusAddRef(status);\n        return await executor();\n    } finally {\n        statusRelease(status);\n    }\n}\n\n/**\n * @en Check if it's in the specified state.\n * @ja æå®ããç¶æä¸­ã§ãããç¢ºèª\n *\n * @param status\n *  - `en` state identifier\n *  - `ja` ç¶æè­å¥å­\n * @return {Boolean} true: ç¶æå / false: ç¶æå¤\n * @returns\n *  - `en` `true`: within the status / `false`: out of the status\n *  - `ja` `true`: ç¶æå / `false`: ç¶æå¤\n */\nexport function isStatusIn(status: string | symbol): boolean {\n    return !!_status[status];\n}\n","/* eslint-disable\n    @typescript-eslint/no-explicit-any,\n */\n\nimport {\n    Arguments,\n    isString,\n    isArray,\n    isSymbol,\n    className,\n    verify,\n} from '@cdp/core-utils';\nimport {\n    EventAll,\n    Subscription,\n    Subscribable,\n} from './interfaces';\n\n/** @internal Lisner æ ¼ç´å½¢å¼ */\ntype ListenersMap<T> = Map<keyof T, Set<(...args: T[keyof T][]) => unknown>>;\n\n/** @internal Lisner ã®å¼±åç§ */\nconst _mapListeners = new WeakMap<EventPublisher<any>, ListenersMap<any>>();\n\n/** @internal LisnerMap ã®åå¾ */\nfunction listeners<T extends object>(instance: EventPublisher<T>): ListenersMap<T> {\n    if (!_mapListeners.has(instance)) {\n        throw new TypeError('This is not a valid EventPublisher.');\n    }\n    return _mapListeners.get(instance) as ListenersMap<T>;\n}\n\n/** @internal Channel ã®åæ¤è¨¼ */\nfunction validChannel(channel: unknown): void | never {\n    if (isString(channel) || isSymbol(channel)) {\n        return;\n    }\n    throw new TypeError(`Type of ${className(channel)} is not a valid channel.`);\n}\n\n/** @internal Listener ã®åæ¤è¨¼ */\nfunction validListener(listener?: (...args: unknown[]) => unknown): any | never {\n    if (null != listener) {\n        verify('typeOf', 'function', listener);\n    }\n    return listener;\n}\n\n/** @internal event çºè¡ */\nfunction triggerEvent<Event, Channel extends keyof Event>(\n    map: ListenersMap<Event>,\n    channel: Channel,\n    original: string | undefined,\n    ...args: Arguments<Partial<Event[Channel]>>\n): void {\n    const list = map.get(channel);\n    if (!list) {\n        return;\n    }\n    for (const listener of list) {\n        try {\n            const eventArgs = original ? [original, ...args] : args;\n            const handled = listener(...eventArgs);\n            // if received 'true', stop delegation.\n            if (true === handled) {\n                break;\n            }\n        } catch (e) {\n            void Promise.reject(e);\n        }\n    }\n}\n\n//__________________________________________________________________________________________________//\n\n/**\n * @en Eventing framework class with ensuring type-safe for TypeScript. <br>\n *     The client of this class can implement original Pub-Sub (Observer) design pattern.\n * @ja åå®å¨ãä¿éããã¤ãã³ãç»é²ã»çºè¡ã¯ã©ã¹ <br>\n *     ã¯ã©ã¤ã¢ã³ãã¯æ¬ã¯ã©ã¹ãæ´¾çãã¦ç¬èªã® Pub-Sub (Observer) ãã¿ã¼ã³ãå®è£å¯è½\n *\n * @example <br>\n *\n * ```ts\n * import { EventPublisher } from '@cdp/events';\n *\n * // declare event interface\n * interface SampleEvent {\n *   hoge: [number, string];        // callback function's args type tuple\n *   foo: [void];                   // no args\n *   hoo: void;                     // no args (same the upon)\n *   bar: [Error];                  // any class is available.\n *   baz: Error | Number;           // if only one argument, `[]` is not required.\n * }\n *\n * // declare client class\n * class SamplePublisher extends EventPublisher<SampleEvent> {\n *   :\n *   someMethod(): void {\n *     this.publish('hoge', 100, 'test');       // OK. standard usage.\n *     this.publish('hoge', 100, true);         // NG. argument of type 'true' is not assignable\n *                                              //     to parameter of type 'string | undefined'.\n *     this.publish('hoge', 100);               // OK. all args to be optional automatically.\n *     this.publish('foo');                     // OK. standard usage.\n *     this.publish('foo', 100);                // NG. argument of type '100' is not assignable\n *                                              //     to parameter of type 'void | undefined'.\n *   }\n * }\n *\n * const sample = new SamplePublisher();\n *\n * sample.on('hoge', (a: number, b: string) => { ... });    // OK. standard usage.\n * sample.on('hoge', (a: number, b: boolean) => { ... });   // NG. types of parameters 'b'\n *                                                          //     and 'args_1' are incompatible.\n * sample.on('hoge', (a) => { ... });                       // OK. all args\n *                                                          //     to be optional automatically.\n * sample.on('hoge', (a, b, c) => { ... });                 // NG. expected 1-2 arguments,\n *                                                          //     but got 3.\n * ```\n */\nexport abstract class EventPublisher<Event extends object> implements Subscribable<Event> {\n\n    /** constructor */\n    constructor() {\n        verify('instanceOf', EventPublisher, this);\n        _mapListeners.set(this, new Map());\n    }\n\n    /**\n     * @en Notify event to clients.\n     * @ja event çºè¡\n     *\n     * @param channel\n     *  - `en` event channel key. (string | symbol)\n     *  - `ja` ã¤ãã³ããã£ãã«ã­ã¼ (string | symbol)\n     * @param args\n     *  - `en` arguments for callback function of the `channel` corresponding.\n     *  - `ja` `channel` ã«å¯¾å¿ããã³ã¼ã«ããã¯é¢æ°ã«æ¸¡ãå¼æ°\n     */\n    protected publish<Channel extends keyof Event>(channel: Channel, ...args: Arguments<Partial<Event[Channel]>>): void {\n        const map = listeners(this);\n        validChannel(channel);\n        triggerEvent(map, channel, undefined, ...args);\n        // trigger for all handler\n        if ('*' !== channel) {\n            triggerEvent(map as unknown as ListenersMap<EventAll>, '*', channel as string, ...args);\n        }\n    }\n\n///////////////////////////////////////////////////////////////////////\n// implements: Subscribable<Event>\n\n    /**\n     * @en Check whether this object has clients.\n     * @ja ã¯ã©ã¤ã¢ã³ããå­å¨ãããå¤å®\n     *\n     * @param channel\n     *  - `en` event channel key. (string | symbol)\n     *  - `ja` ã¤ãã³ããã£ãã«ã­ã¼ (string | symbol)\n     * @param listener\n     *  - `en` callback function of the `channel` corresponding.\n     *  - `ja` `channel` ã«å¯¾å¿ããã³ã¼ã«ããã¯é¢æ°\n     */\n    hasListener<Channel extends keyof Event>(channel?: Channel, listener?: (...args: Arguments<Event[Channel]>) => unknown): boolean {\n        const map = listeners(this);\n        if (null == channel) {\n            return map.size > 0;\n        }\n        validChannel(channel);\n        if (null == listener) {\n            return map.has(channel);\n        }\n        validListener(listener);\n        const list = map.get(channel);\n        return list ? list.has(listener) : false;\n    }\n\n    /**\n     * @en Returns registered channel keys.\n     * @ja ç»é²ããã¦ãããã£ãã«ã­ã¼ãè¿å´\n     */\n    channels(): (keyof Event)[] {\n        return [...listeners(this).keys()];\n    }\n\n    /**\n     * @en Subscrive event(s).\n     * @ja ã¤ãã³ãè³¼èª­è¨­å®\n     *\n     * @param channel\n     *  - `en` target event channel key. (string | symbol)\n     *  - `ja` å¯¾è±¡ã®ã¤ãã³ããã£ãã«ã­ã¼ (string | symbol)\n     * @param listener\n     *  - `en` callback function of the `channel` corresponding.\n     *  - `ja` `channel` ã«å¯¾å¿ããã³ã¼ã«ããã¯é¢æ°\n     */\n    on<Channel extends keyof Event>(channel: Channel | Channel[], listener: (...args: Arguments<Event[Channel]>) => unknown): Subscription {\n        const map = listeners(this);\n        validListener(listener);\n\n        const channels = isArray(channel) ? channel : [channel];\n        for (const ch of channels) {\n            validChannel(ch);\n            map.has(ch) ? map.get(ch)!.add(listener) : map.set(ch, new Set([listener])); // eslint-disable-line @typescript-eslint/no-non-null-assertion\n        }\n\n        return Object.freeze({\n            get enable() {\n                for (const ch of channels) {\n                    const list = map.get(ch);\n                    if (!list || !list.has(listener)) {\n                        this.unsubscribe();\n                        return false;\n                    }\n                }\n                return true;\n            },\n            unsubscribe() {\n                for (const ch of channels) {\n                    const list = map.get(ch);\n                    if (list) {\n                        list.delete(listener);\n                        list.size > 0 || map.delete(ch);\n                    }\n                }\n            },\n        });\n    }\n\n    /**\n     * @en Subscrive event(s) but it causes the bound callback to only fire once before being removed.\n     * @ja ä¸åº¦ã ããã³ããªã³ã°å¯è½ãªã¤ãã³ãè³¼èª­è¨­å®\n     *\n     * @param channel\n     *  - `en` target event channel key. (string | symbol)\n     *  - `ja` å¯¾è±¡ã®ã¤ãã³ããã£ãã«ã­ã¼ (string | symbol)\n     * @param listener\n     *  - `en` callback function of the `channel` corresponding.\n     *  - `ja` `channel` ã«å¯¾å¿ããã³ã¼ã«ããã¯é¢æ°\n     */\n    once<Channel extends keyof Event>(channel: Channel | Channel[], listener: (...args: Arguments<Event[Channel]>) => unknown): Subscription {\n        const context = this.on(channel, listener);\n        const managed = this.on(channel, () => {\n            context.unsubscribe();\n            managed.unsubscribe();\n        });\n        return context;\n    }\n\n    /**\n     * @en Unsubscribe event(s).\n     * @ja ã¤ãã³ãè³¼èª­è§£é¤\n     *\n     * @param channel\n     *  - `en` target event channel key. (string | symbol)\n     *         When not set this parameter, everything is released.\n     *  - `ja` å¯¾è±¡ã®ã¤ãã³ããã£ãã«ã­ã¼ (string | symbol)\n     *         æå®ããªãå ´åã¯ãã¹ã¦è§£é¤\n     * @param listener\n     *  - `en` callback function of the `channel` corresponding.\n     *         When not set this parameter, all same `channel` listeners are released.\n     *  - `ja` `channel` ã«å¯¾å¿ããã³ã¼ã«ããã¯é¢æ°\n     *         æå®ããªãå ´åã¯åä¸ `channel` ãã¹ã¦ãè§£é¤\n     */\n    off<Channel extends keyof Event>(channel?: Channel | Channel[], listener?: (...args: Arguments<Event[Channel]>) => unknown): this {\n        const map = listeners(this);\n        if (null == channel) {\n            map.clear();\n            return this;\n        }\n\n        const channels = isArray(channel) ? channel : [channel];\n        const callback = validListener(listener);\n        for (const ch of channels) {\n            validChannel(ch);\n            if (null == callback) {\n                map.delete(ch);\n                continue;\n            } else {\n                const list = map.get(ch);\n                if (list) {\n                    list.delete(callback);\n                    list.size > 0 || map.delete(ch);\n                }\n            }\n        }\n\n        return this;\n    }\n}\n","/* eslint-disable\n    @typescript-eslint/no-explicit-any,\n */\n\nimport { Arguments } from '@cdp/core-utils';\nimport { Subscribable } from './interfaces';\nimport { EventPublisher } from './publisher';\n\n/** re-export */\nexport type EventArguments<T> = Arguments<T>;\n\n/**\n * @en Eventing framework object able to call `publish()` method from outside.\n * @ja å¤é¨ããã® `publish()` ãå¯è½ã«ããã¤ãã³ãç»é²ã»çºè¡ã¯ã©ã¹\n *\n * @example <br>\n *\n * ```ts\n * import { EventBroker } from '@cdp/events';\n *\n * // declare event interface\n * interface SampleEvent {\n *   hoge: [number, string];        // callback function's args type tuple\n * }\n *\n * const broker = new EventBroker<SampleEvent>();\n * broker.trigger('hoge', 100, 'test');     // OK. standard usage.\n * broker.trigger('hoge', 100, true);       // NG. argument of type 'true' is not assignable\n *                                          //     to parameter of type 'string | undefined'.\n * ```\n */\nexport interface EventBroker<Event extends object> extends Subscribable<Event> {\n    /**\n     * @en Notify event to clients.\n     * @ja event çºè¡\n     *\n     * @param channel\n     *  - `en` event channel key. (string | symbol)\n     *  - `ja` ã¤ãã³ããã£ãã«ã­ã¼ (string | symbol)\n     * @param args\n     *  - `en` arguments for callback function of the `channel` corresponding.\n     *  - `ja` `channel` ã«å¯¾å¿ããã³ã¼ã«ããã¯é¢æ°ã«æ¸¡ãå¼æ°\n     */\n    trigger<Channel extends keyof Event>(channel: Channel, ...args: Arguments<Partial<Event[Channel]>>): void;\n}\n\n/**\n * @en Constructor of [[EventBroker]]\n * @ja [[EventBroker]] ã®ã³ã³ã¹ãã©ã¯ã¿å®ä½\n */\nexport const EventBroker: {\n    readonly prototype: EventBroker<any>;\n    new <T extends object>(): EventBroker<T>;\n} = EventPublisher as any;\n\nEventBroker.prototype.trigger = (EventPublisher.prototype as any).publish;\n","import {\n    UnknownFunction,\n    Arguments,\n    isArray,\n} from '@cdp/core-utils';\nimport {\n    Subscribable,\n    Subscription,\n    EventSchema,\n} from './interfaces';\n\n/** @internal */ const _context = Symbol('context');\n/** @internal */ type SubscriptionMap = Map<UnknownFunction, Subscription>;\n/** @internal */ type ListerMap       = Map<string, SubscriptionMap>;\n/** @internal */ type SubscriptionSet = Set<Subscription>;\n/** @internal */ type SubscribableMap = WeakMap<Subscribable, ListerMap>;\n\n/** @internal Lisner æ ¼ç´å½¢å¼ */\ninterface Context {\n    map: SubscribableMap;\n    set: SubscriptionSet;\n}\n\n/** @internal register listener context */\nfunction register(context: Context, target: Subscribable, channel: string | string[], listener: UnknownFunction): Subscription {\n    const subscriptions: Subscription[] = [];\n\n    const channels = isArray(channel) ? channel : [channel];\n    for (const ch of channels) {\n        const s = target.on(ch, listener);\n        context.set.add(s);\n        subscriptions.push(s);\n\n        const listenerMap = context.map.get(target) || new Map<string, Map<UnknownFunction, Subscription>>();\n        const map = listenerMap.get(ch) || new Map<UnknownFunction, Subscription>();\n        map.set(listener, s);\n\n        if (!listenerMap.has(ch)) {\n            listenerMap.set(ch, map);\n        }\n        if (!context.map.has(target)) {\n            context.map.set(target, listenerMap);\n        }\n    }\n\n    return Object.freeze({\n        get enable() {\n            for (const s of subscriptions) {\n                if (s.enable) {\n                    return true;\n                }\n            }\n            return false;\n        },\n        unsubscribe() {\n            for (const s of subscriptions) {\n                s.unsubscribe();\n            }\n        },\n    });\n}\n\n/** @internal unregister listener context */\nfunction unregister(context: Context, target?: Subscribable, channel?: string | string[], listener?: UnknownFunction): void {\n    if (null != target) {\n        target.off(channel, listener);\n\n        const listenerMap = context.map.get(target);\n        if (!listenerMap) {\n            return;\n        }\n        if (null != channel) {\n            const channels = isArray(channel) ? channel : [channel];\n            for (const ch of channels) {\n                const map = listenerMap.get(ch);\n                if (!map) {\n                    return;\n                } else if (listener) {\n                    const s = map.get(listener);\n                    if (s) {\n                        s.unsubscribe();\n                        context.set.delete(s);\n                    }\n                    map.delete(listener);\n                } else {\n                    for (const s of map.values()) {\n                        s.unsubscribe();\n                        context.set.delete(s);\n                    }\n                }\n            }\n        } else {\n            for (const map of listenerMap.values()) {\n                for (const s of map.values()) {\n                    s.unsubscribe();\n                    context.set.delete(s);\n                }\n            }\n        }\n    } else {\n        for (const s of context.set) {\n            s.unsubscribe();\n        }\n        context.map = new WeakMap();\n        context.set.clear();\n    }\n}\n\n//__________________________________________________________________________________________________//\n\n/**\n * @en The class to which the safe event register/unregister method is offered for the object which is a short life cycle than subscription target. <br>\n *     The advantage of using this form, instead of `on()`, is that `listenTo()` allows the object to keep track of the events,\n *     and they can be removed all at once later call `stopListening()`.\n * @ja è³¼èª­å¯¾è±¡ãããã©ã¤ããµã¤ã¯ã«ãç­ããªãã¸ã§ã¯ãã«å¯¾ãã¦, å®å¨ãªã¤ãã³ãç»é²/è§£é¤ã¡ã½ãããæä¾ããã¯ã©ã¹ <br>\n *     `on()` ã®ä»£ããã« `listenTo()` ãä½¿ç¨ãããã¨ã§, å¾ã« `stopListening()` ã1åº¦å¼ã¶ã ãã§ãã¹ã¦ã®ãªã¹ãã¼ãè§£é¤ã§ããå©ç¹ããã.\n *\n * @example <br>\n *\n * ```ts\n * import { EventReceiver, EventBroker } from '@cdp/events';\n *\n * // declare event interface\n * interface SampleEvent {\n *   hoge: [number, string];        // callback function's args type tuple\n *   foo: [void];                   // no args\n *   hoo: void;                     // no args (same the upon)\n *   bar: [Error];                  // any class is available.\n *   baz: Error | Number;           // if only one argument, `[]` is not required.\n * }\n *\n * // declare client class\n * class SampleReceiver extends EventReceiver {\n *   constructor(broker: EventBroker<SampleEvent>) {\n *     super();\n *     this.listenTo(broker, 'hoge', (num: number, str: string) => { ... });\n *     this.listenTo(broker, 'bar', (e: Error) => { ... });\n *     this.listenTo(broker, ['foo', 'hoo'], () => { ... });\n *   }\n *\n *   release(): void {\n *     this.stopListening();\n *   }\n * }\n * ```\n *\n * or\n *\n * ```ts\n * const broker   = new EventBroker<SampleEvent>();\n * const receiver = new EventReceiver();\n *\n * receiver.listenTo(broker, 'hoge', (num: number, str: string) => { ... });\n * receiver.listenTo(broker, 'bar', (e: Error) => { ... });\n * receiver.listenTo(broker, ['foo', 'hoo'], () => { ... });\n *\n * receiver.stopListening();\n * ```\n */\nexport class EventReceiver {\n    /** @internal */\n    private readonly [_context]: Context;\n\n    /** constructor */\n    constructor() {\n        this[_context] = { map: new WeakMap(), set: new Set() };\n    }\n\n    /**\n     * @en Tell an object to listen to a particular event on an other object.\n     * @ja å¯¾è±¡ãªãã¸ã§ã¯ãã®ã¤ãã³ãè³¼èª­è¨­å®\n     *\n     * @param target\n     *  - `en` event listening target object.\n     *  - `ja` ã¤ãã³ãè³¼èª­å¯¾è±¡ã®ãªãã¸ã§ã¯ã\n     * @param channel\n     *  - `en` target event channel key. (string | symbol)\n     *  - `ja` å¯¾è±¡ã®ã¤ãã³ããã£ãã«ã­ã¼ (string | symbol)\n     * @param listener\n     *  - `en` callback function of the `channel` corresponding.\n     *  - `ja` `channel` ã«å¯¾å¿ããã³ã¼ã«ããã¯é¢æ°\n     */\n    public listenTo<T extends Subscribable, Event extends EventSchema<T> = EventSchema<T>, Channel extends keyof Event = keyof Event>(\n        target: T,\n        channel: Channel | Channel[],\n        listener: (...args: Arguments<Event[Channel]>) => unknown\n    ): Subscription {\n        return register(this[_context], target, channel as string, listener);\n    }\n\n    /**\n     * @en Just like listenTo, but causes the bound callback to fire only once before being removed.\n     * @ja å¯¾è±¡ãªãã¸ã§ã¯ãã®ä¸åº¦ã ããã³ããªã³ã°å¯è½ãªã¤ãã³ãè³¼èª­è¨­å®\n     *\n     * @param target\n     *  - `en` event listening target object.\n     *  - `ja` ã¤ãã³ãè³¼èª­å¯¾è±¡ã®ãªãã¸ã§ã¯ã\n     * @param channel\n     *  - `en` target event channel key. (string | symbol)\n     *  - `ja` å¯¾è±¡ã®ã¤ãã³ããã£ãã«ã­ã¼ (string | symbol)\n     * @param listener\n     *  - `en` callback function of the `channel` corresponding.\n     *  - `ja` `channel` ã«å¯¾å¿ããã³ã¼ã«ããã¯é¢æ°\n     */\n    public listenToOnce<T extends Subscribable, Event extends EventSchema<T> = EventSchema<T>, Channel extends keyof Event = keyof Event>(\n        target: T,\n        channel: Channel | Channel[],\n        listener: (...args: Arguments<Event[Channel]>) => unknown\n    ): Subscription {\n        const context = register(this[_context], target, channel as string, listener);\n        const managed = target.on(channel, () => {\n            unregister(this[_context], target, channel as string, listener);\n            managed.unsubscribe();\n        });\n        return context;\n    }\n\n    /**\n     * @en Tell an object to stop listening to events.\n     * @ja ã¤ãã³ãè³¼èª­è§£é¤\n     *\n     * @param target\n     *  - `en` event listening target object.\n     *         When not set this parameter, everything is released.\n     *  - `ja` ã¤ãã³ãè³¼èª­å¯¾è±¡ã®ãªãã¸ã§ã¯ã\n     *         æå®ããªãå ´åã¯ãã¹ã¦ã®ãªã¹ãã¼ãè§£é¤\n     * @param channel\n     *  - `en` target event channel key. (string | symbol)\n     *         When not set this parameter, everything is released listeners from `target`.\n     *  - `ja` å¯¾è±¡ã®ã¤ãã³ããã£ãã«ã­ã¼ (string | symbol)\n     *         æå®ããªãå ´åã¯å¯¾è±¡ `target` ã®ãªã¹ãã¼ããã¹ã¦è§£é¤\n     * @param listener\n     *  - `en` callback function of the `channel` corresponding.\n     *         When not set this parameter, all same `channel` listeners are released.\n     *  - `ja` `channel` ã«å¯¾å¿ããã³ã¼ã«ããã¯é¢æ°\n     *         æå®ããªãå ´åã¯åä¸ `channel` ãã¹ã¦ãè§£é¤\n     */\n    public stopListening<T extends Subscribable, Event extends EventSchema<T> = EventSchema<T>, Channel extends keyof Event = keyof Event>(\n        target?: T,\n        channel?: Channel | Channel[],\n        listener?: (...args: Arguments<Event[Channel]>) => unknown\n    ): this {\n        unregister(this[_context], target, channel as string, listener);\n        return this;\n    }\n}\n","/* eslint-disable\n    @typescript-eslint/no-explicit-any,\n */\n\nimport { mixins } from '@cdp/core-utils';\nimport { EventBroker } from './broker';\nimport { EventReceiver } from './receiver';\n\n/**\n * @en The class which have I/F of [[EventBroker]] and [[EventReceiver]]. <br>\n *     `Events` class of `Backbone.js` equivalence.\n * @ja [[EventBroker]] ã¨ [[EventReceiver]] ã® I/F ããããæã¤ã¯ã©ã¹ <br>\n *     `Backbone.js` ã® `Events` ã¯ã©ã¹ç¸å½\n *\n * @example <br>\n *\n * ```ts\n * import { EventSource } from '@cdp/events';\n *\n * // declare event interface\n * interface TargetEvent {\n *   hoge: [number, string];        // callback function's args type tuple\n *   foo: [void];                   // no args\n *   hoo: void;                     // no args (same the upon)\n *   bar: [Error];                  // any class is available.\n *   baz: Error | Number;           // if only one argument, `[]` is not required.\n * }\n *\n * interface SampleEvent {\n *   fuga: [number, string];        // callback function's args type tuple\n * }\n *\n * // declare client class\n * class SampleSource extends EventSource<SampleEvent> {\n *   constructor(target: EventSource<TargetEvent>) {\n *     super();\n *     this.listenTo(broker, 'hoge', (num: number, str: string) => { ... });\n *     this.listenTo(broker, 'bar', (e: Error) => { ... });\n *     this.listenTo(broker, ['foo', 'hoo'], () => { ... });\n *   }\n *\n *   release(): void {\n *     this.stopListening();\n *   }\n * }\n *\n * const sample = new SampleSource();\n *\n * sample.on('fuga', (a: number, b: string) => { ... });    // OK. standard usage.\n * sample.trigger('fuga', 100, 'test');                     // OK. standard usage.\n * ```\n */\ntype EventSourceBase<T extends object> = EventBroker<T> & EventReceiver;\n\n/** @internal [[EventSource]] class */\nclass EventSource extends mixins(EventBroker, EventReceiver) {\n    constructor() {\n        super();\n        this.super(EventReceiver);\n    }\n}\n\n/**\n * @en Constructor of [[EventSource]]\n * @ja [[EventSource]] ã®ã³ã³ã¹ãã©ã¯ã¿å®ä½\n */\nconst EventSourceBase: {\n    readonly prototype: EventSourceBase<any>;\n    new <T extends object>(): EventSourceBase<T>;\n} = EventSource as any;\n\nexport { EventSourceBase as EventSource };\n","import { EventBroker, Subscription } from '@cdp/events';\n\n/** @internal */ export const _cancel = Symbol('cancel');\n/** @internal */ export const _close  = Symbol('close');\n\n/**\n * @en CancelToken state definitions.\n * @ja CancelToken ã®ç¶æå®ç¾©\n *\n * @internal\n */\nexport const enum CancelTokenState {\n    /** ã­ã£ã³ã»ã«åä»å¯è½ */\n    OPEN        = 0x0,\n    /** ã­ã£ã³ã»ã«åä»æ¸ã¿ */\n    REQUESTED   = 0x1,\n    /** ã­ã£ã³ã»ã«åä»ä¸å¯ */\n    CLOSED      = 0x2,\n}\n\n/**\n * @en Cancel event definitions.\n * @ja ã­ã£ã³ã»ã«ã¤ãã³ãå®ç¾©\n *\n * @internal\n */\nexport interface CancelEvent<T> {\n    cancel: [T];\n}\n\n/**\n * @en Internal CancelToken interface.\n * @ja CancelToken ã®åé¨ã¤ã³ã¿ã¼ãã§ã¤ã¹å®ç¾©\n *\n * @internal\n */\nexport interface CancelTokenContext<T = unknown> {\n    readonly broker: EventBroker<CancelEvent<T>>;\n    readonly subscriptions: Set<Subscription>;\n    reason: T | undefined;\n    status: CancelTokenState;\n}\n\n/**\n * @en Invalid subscription object declaration.\n * @ja ç¡å¹ãª Subscription ãªãã¸ã§ã¯ã\n *\n * @internal\n */\nexport const invalidSubscription = Object.freeze({\n    enable: false,\n    unsubscribe() { /* noop */ }\n}) as Subscription;\n","import { verify } from '@cdp/core-utils';\nimport { EventBroker, Subscription } from '@cdp/events';\nimport {\n    _cancel,\n    _close,\n    CancelTokenState,\n    CancelTokenContext,\n    invalidSubscription,\n} from './internal';\n\n/**\n * @en Cancellation source interface.\n * @ja ã­ã£ã³ã»ã«ç®¡çã¤ã³ã¿ã¼ãã§ã¤ã¹\n */\nexport interface CancelTokenSource<T = unknown> {\n    /**\n     * @en [[CancelToken]] getter.\n     * @ja [[CancelToken]] åå¾\n     */\n    readonly token: CancelToken<T>;\n\n    /**\n     * @en Execute cancel.\n     * @ja ã­ã£ã³ã»ã«å®è¡\n     *\n     * @param reason\n     *  - `en` cancellation reason. this arg is transmitted in promise chain.\n     *  - `ja` ã­ã£ã³ã»ã«ã®çç±ãæå®. `Promise` ãã§ã¤ã³ã«ä¼éããã.\n     */\n    cancel(reason: T): void;\n\n    /**\n     * @en Break up cancellation reception.\n     * @ja ã­ã£ã³ã»ã«åä»ãçµäº\n     */\n    close(): void;\n}\n\n/** @internal */ const _tokens = new WeakMap<CancelToken, CancelTokenContext>();\n\n/** @internal */\nfunction getContext<T = unknown>(instance: CancelToken<T>): CancelTokenContext<T> {\n    if (!_tokens.has(instance)) {\n        throw new TypeError('The object is not a valid CancelToken.');\n    }\n    return _tokens.get(instance) as CancelTokenContext<T>;\n}\n\n/**\n * @en The token object to which unification processing for asynchronous processing cancellation is offered. <br>\n *     Origin is `CancellationToken` of `.NET Framework`.\n * @ja éåæå¦çã­ã£ã³ã»ã«ã®ããã®çµ±ä¸å¦çãæä¾ãããã¼ã¯ã³ãªãã¸ã§ã¯ã <br>\n *     ãªãªã¸ãã«ã¯ `.NET Framework` ã® `CancellationToken`\n *\n * @see https://docs.microsoft.com/en-us/dotnet/standard/threading/cancellation-in-managed-threads\n *\n * @example <br>\n *\n * ```ts\n * import { CancelToken } from '@cdp/promise';\n * ```\n *\n * - Basic Usage\n *\n * ```ts\n * const token = new CancelToken((cancel, close) => {\n *   button1.onclick = ev => cancel(new Error('Cancel'));\n *   button2.onclick = ev => close();\n * });\n * ```\n *\n * or\n *\n * ```ts\n * const { cancel, close, token } = CancelToken.source();\n * button1.onclick = ev => cancel(new Error('Cancel'));\n * button2.onclick = ev => close();\n * ```\n *\n * - Use with Promise\n *\n * ```ts\n * const { cancel, close, token } = CancelToken.source();\n * const promise = new Promise((ok, ng) => { ... }, token);\n * promise\n *   .then(...)\n *   .then(...)\n *   .then(...)\n *   .catch(reason => {\n *     // check reason\n *   });\n * ```\n *\n * - Register & Unregister callback(s)\n *\n * ```ts\n * const { cancel, close, token } = CancelToken.source();\n * const subscription = token.register(reason => {\n *   console.log(reason.message);\n * });\n * if (someCase) {\n *   subscription.unsubscribe();\n * }\n * ```\n */\nexport class CancelToken<T = unknown> {\n\n    /**\n     * @en Create [[CancelTokenSource]] instance.\n     * @ja [[CancelTokenSource]] ã¤ã³ã¹ã¿ã³ã¹ã®åå¾\n     *\n     * @param linkedTokens\n     *  - `en` relating already made [[CancelToken]] instance.\n     *        You can attach to the token that to be a cancellation target.\n     *  - `ja` ãã§ã«ä½æããã [[CancelToken]] é¢é£ä»ããå ´åã«æå®\n     *        æ¸¡ããã token ã¯ã­ã£ã³ã»ã«å¯¾è±¡ã¨ãã¦ç´ã¥ãããã\n     */\n    public static source<T = unknown>(...linkedTokens: CancelToken[]): CancelTokenSource<T> {\n        let cancel!: (reason: T) => void;\n        let close!: () => void;\n        const token = new CancelToken<T>((onCancel, onClose) => {\n            cancel = onCancel;\n            close = onClose;\n        }, ...linkedTokens);\n        return Object.freeze({ token, cancel, close });\n    }\n\n    /**\n     * constructor\n     *\n     * @param executor\n     *  - `en` executer that has `cancel` and `close` callback.\n     *  - `ja` ã­ã£ã³ã»ã«/ã¯ã­ã¼ãº å®è¡ã³ã¼ã«ããã¯ãæå®\n     * @param linkedTokens\n     *  - `en` relating already made [[CancelToken]] instance.\n     *        You can attach to the token that to be a cancellation target.\n     *  - `ja` ãã§ã«ä½æããã [[CancelToken]] é¢é£ä»ããå ´åã«æå®\n     *        æ¸¡ããã token ã¯ã­ã£ã³ã»ã«å¯¾è±¡ã¨ãã¦ç´ã¥ãããã\n     */\n    constructor(\n        executor: (cancel: (reason: T) => void, close: () => void) => void,\n        ...linkedTokens: CancelToken[]\n    ) {\n        verify('instanceOf', CancelToken, this);\n        verify('typeOf', 'function', executor);\n\n        const linkedTokenSet = new Set(linkedTokens.filter(t => _tokens.has(t)));\n        let status = CancelTokenState.OPEN;\n        for (const t of linkedTokenSet) {\n            status |= getContext(t).status;\n        }\n\n        const context: CancelTokenContext<T> = {\n            broker: new EventBroker(),\n            subscriptions: new Set(),\n            reason: undefined,\n            status,\n        };\n        _tokens.set(this, Object.seal(context));\n\n        const cancel = this[_cancel];\n        const close = this[_close];\n        if (status === CancelTokenState.OPEN) {\n            for (const t of linkedTokenSet) {\n                context.subscriptions.add(t.register(cancel.bind(this)));\n                this.register(cancel.bind(t));\n            }\n        }\n\n        executor(cancel.bind(this), close.bind(this));\n    }\n\n    /**\n     * @en Cancellation reason accessor.\n     * @ja ã­ã£ã³ã»ã«ã®åå åå¾\n     */\n    get reason(): T | undefined {\n        return getContext(this).reason;\n    }\n\n    /**\n     * @en Enable cancellation state accessor.\n     * @ja ã­ã£ã³ã»ã«å¯è½ãå¤å®\n     */\n    get cancelable(): boolean {\n        return getContext(this).status === CancelTokenState.OPEN;\n    }\n\n    /**\n     * @en Cancellation requested state accessor.\n     * @ja ã­ã£ã³ã»ã«ãåãä»ãã¦ãããå¤å®\n     */\n    get requested(): boolean {\n        return !!(getContext(this).status & CancelTokenState.REQUESTED);\n    }\n\n    /**\n     * @en Cancellation closed state accessor.\n     * @ja ã­ã£ã³ã»ã«åä»ãçµäºãã¦ãããå¤å®\n     */\n    get closed(): boolean {\n        return !!(getContext(this).status & CancelTokenState.CLOSED);\n    }\n\n    /**\n     * @en `toString` tag override.\n     * @ja `toString` ã¿ã°ã®ãªã¼ãã¼ã©ã¤ã\n     */\n    protected get [Symbol.toStringTag](): 'CancelToken' { return 'CancelToken'; }\n\n    /**\n     * @en Register custom cancellation callback.\n     * @ja ã­ã£ã³ã»ã«æã®ã«ã¹ã¿ã å¦çã®ç»é²\n     *\n     * @param onCancel\n     *  - `en` cancel operation callback\n     *  - `ja` ã­ã£ã³ã»ã«ã³ã¼ã«ããã¯\n     * @returns\n     *  - `en` `Subscription` instance.\n     *        You can revoke cancellation to call `unsubscribe` method.\n     *  - `ja` `Subscription` ã¤ã³ã¹ã¿ã³ã¹\n     *        `unsubscribe` ã¡ã½ãããå¼ã¶ãã¨ã§ã­ã£ã³ã»ã«ãç¡å¹ã«ãããã¨ãå¯è½\n     */\n    public register(onCancel: (reason: T) => unknown): Subscription {\n        const context = getContext(this);\n        if (!this.cancelable) {\n            return invalidSubscription;\n        }\n        return context.broker.on('cancel', onCancel);\n    }\n\n    /** @internal */\n    private [_cancel](reason: T): void {\n        const context = getContext(this);\n        verify('notNullish', reason);\n        if (!this.cancelable) {\n            return;\n        }\n        context.reason = reason;\n        context.status |= CancelTokenState.REQUESTED;\n        for (const s of context.subscriptions) {\n            s.unsubscribe();\n        }\n        context.broker.trigger('cancel', reason);\n        void Promise.resolve().then(() => this[_close]());\n    }\n\n    /** @internal */\n    private [_close](): void {\n        const context = getContext(this);\n        if (this.closed) {\n            return;\n        }\n        context.status |= CancelTokenState.CLOSED;\n        for (const s of context.subscriptions) {\n            s.unsubscribe();\n        }\n        context.subscriptions.clear();\n        context.broker.off();\n    }\n}\n","/* eslint-disable\n    no-global-assign,\n    @typescript-eslint/unbound-method,\n */\n\nimport {\n    isFunction,\n    verify,\n    getConfig,\n} from '@cdp/core-utils';\nimport { Subscription } from '@cdp/events';\nimport { CancelToken } from './cancel-token';\n\ndeclare global {\n\n    interface PromiseConstructor {\n        new <T>(executor: (resolve: (value?: T | PromiseLike<T>) => void, reject: (reason?: unknown) => void) => void, cancelToken?: CancelToken | null): Promise<T>;\n        resolve<T>(value?: T | PromiseLike<T>, cancelToken?: CancelToken | null): Promise<T>;\n    }\n\n}\n\n/** @internal `Native Promise` constructor */\nconst NativePromise = Promise;\n/** @internal `Native then` method */\nconst nativeThen = NativePromise.prototype.then;\n/** @internal */ const _create = Symbol('create');\n/** @internal */ const _tokens = new WeakMap<Promise<unknown>, CancelToken>();\n\n/**\n * @en Extended `Promise` class which enabled cancellation. <br>\n *     `Native Promise` constructor is overridden by framework default behaviour.\n * @ja ã­ã£ã³ã»ã«ãå¯è½ã«ãã `Promise` æ¡å¼µã¯ã©ã¹ <br>\n *     æ¢å®ã§ `Native Promise` ããªã¼ãã¼ã©ã¤ããã.\n */\nclass CancelablePromise<T> extends Promise<T> {\n\n    /**\n     * @en Overriding of the default constructor used for generation of an object.\n     * @ja ãªãã¸ã§ã¯ãã®çæã«ä½¿ãããããã©ã«ãã³ã³ã¹ãã©ã¯ã¿ã®ãªã¼ãã¼ã©ã¤ã\n     *\n     * @internal\n     */\n    static get [Symbol.species](): PromiseConstructor { return NativePromise; }\n\n    /**\n     * @en Creates a new resolved promise for the provided value.\n     * @ja æ°è¦ã«è§£æ±ºæ¸ã¿ promise ã¤ã³ã¹ã¿ã³ã¹ãä½æ\n     *\n     * @internal\n     *\n     * @param value\n     *  - `en` the value transmitted in promise chain.\n     *  - `ja` `Promise` ã«ä¼éããå¤\n     * @param cancelToken\n     *  - `en` [[CancelToken]] instance create from [[CancelToken]].`source()`.\n     *  - `ja` [[CancelToken]].`source()` ããä½æãã [[CancelToken]] ã¤ã³ã¹ã¿ã³ã¹ãæå®\n     */\n    static resolve<T>(value?: T | PromiseLike<T>, cancelToken?: CancelToken | null): CancelablePromise<T> {\n        return this[_create](super.resolve(value), cancelToken);\n    }\n\n    /** @internal private construction */\n    private static [_create]<T, TResult1 = T, TResult2 = never>(\n        src: Promise<T>,\n        token?: CancelToken | null,\n        thenArgs?: [\n            ((value: T) => TResult1 | PromiseLike<TResult1>) | null | undefined,\n            ((reason: unknown) => TResult2 | PromiseLike<TResult2>) | null | undefined\n        ] | null\n    ): CancelablePromise<TResult1 | TResult2> {\n        verify('instanceOf', NativePromise, src);\n\n        let p: Promise<T | TResult1 | TResult2>;\n        if (!(token instanceof CancelToken)) {\n            p = src;\n        } else if (thenArgs && (!isFunction(thenArgs[0]) || isFunction(thenArgs[1]))) {\n            p = src;\n        } else if (token.cancelable) {\n            let s: Subscription;\n            p = new NativePromise((resolve, reject) => {\n                s = token.register(reject);\n                nativeThen.call(src, resolve, reject);\n            });\n            const dispose = (): void => {\n                s.unsubscribe();\n                _tokens.delete(p);\n            };\n            p.then(dispose, dispose);\n        } else if (token.requested) {\n            p = super.reject(token.reason);\n        } else if (token.closed) {\n            p = src;\n        } else {\n            throw new Error('Unexpected Exception');\n        }\n\n        if (thenArgs) {\n            p = nativeThen.apply(p, thenArgs);\n        }\n        if (token && token.cancelable) {\n            _tokens.set(p, token);\n        }\n\n        p instanceof this || Object.setPrototypeOf(p, this.prototype);\n\n        return p as CancelablePromise<TResult1 | TResult2>;\n    }\n\n    /**\n     * constructor\n     *\n     * @param executor\n     *  - `en` A callback used to initialize the promise. This callback is passed two arguments `resolve` and `reject`.\n     *  - `ja` promise ã®åæåã«ä½¿ç¨ããã³ã¼ã«ããã¯ãæå®. `resolve` ã¨ `reject` ã®2ã¤ã®å¼æ°ãæã¤\n     * @param cancelToken\n     *  - `en` [[CancelToken]] instance create from [[CancelToken]].`source()`.\n     *  - `ja` [[CancelToken]].`source()` ããä½æãã [[CancelToken]] ã¤ã³ã¹ã¿ã³ã¹ãæå®\n     */\n    constructor(\n        executor: (resolve: (value?: T | PromiseLike<T>) => void, reject: (reason?: unknown) => void) => void,\n        cancelToken?: CancelToken | null\n    ) {\n        super(executor);\n        return CancelablePromise[_create](this, cancelToken);\n    }\n\n    /**\n     * Attaches callbacks for the resolution and/or rejection of the Promise.\n     *\n     * @internal\n     *\n     * @param onfulfilled The callback to execute when the Promise is resolved.\n     * @param onrejected The callback to execute when the Promise is rejected.\n     * @returns A Promise for the completion of which ever callback is executed.\n     */\n    then<TResult1 = T, TResult2 = never>(\n        onfulfilled?: ((value: T) => TResult1 | PromiseLike<TResult1>) | null,\n        onrejected?: ((reason: unknown) => TResult2 | PromiseLike<TResult2>) | null\n    ): Promise<TResult1 | TResult2> {\n        return CancelablePromise[_create](this, _tokens.get(this), [onfulfilled, onrejected]);\n    }\n\n    /**\n     * Attaches a callback for only the rejection of the Promise.\n     *\n     * @internal\n     *\n     * @param onrejected The callback to execute when the Promise is rejected.\n     * @returns A Promise for the completion of the callback.\n     */\n    catch<TResult2 = never>(onrejected?: ((reason: unknown) => TResult2 | PromiseLike<TResult2>) | null): Promise<T | TResult2> {\n        return this.then(undefined, onrejected);\n    }\n\n    /**\n     * Attaches a callback that is invoked when the Promise is settled (fulfilled or rejected). <br>\n     * The resolved value cannot be modified from the callback.\n     *\n     * @internal\n     *\n     * @param onfinally The callback to execute when the Promise is settled (fulfilled or rejected).\n     * @returns A Promise for the completion of the callback.\n     */\n    finally(onfinally?: (() => void) | undefined | null): Promise<T> {\n        return CancelablePromise[_create](super.finally(onfinally), _tokens.get(this));\n    }\n\n}\n\n/**\n * @en Switch the global `Promise` constructor `Native Promise` or [[CancelablePromise]]. <br>\n *     `Native Promise` constructor is overridden by framework default behaviour.\n * @ja ã°ã­ã¼ãã« `Promise` ã³ã³ã¹ãã©ã¯ã¿ã `Native Promise` ã¾ãã¯ [[CancelablePromise]] ã«åãæ¿ã <br>\n *     æ¢å®ã§ `Native Promise` ããªã¼ãã¼ã©ã¤ããã.\n *\n * @param enable\n *  - `en` `true`: use [[CancelablePromise]] /  `false`: use `Native Promise`\n *  - `ja` `true`: [[CancelablePromise]] ãä½¿ç¨ / `false`: `Native Promise` ãä½¿ç¨\n */\nexport function extendPromise(enable: boolean): PromiseConstructor {\n    if (enable) {\n        Promise = CancelablePromise;\n    } else {\n        Promise = NativePromise;\n    }\n    return Promise;\n}\n\n/** @internal global config options */\ninterface GlobalConfig {\n    noAutomaticNativeExtend: boolean;\n}\n\n// default: automatic native promise override.\nextendPromise(!getConfig<GlobalConfig>().noAutomaticNativeExtend);\n\nexport {\n    CancelablePromise,\n    CancelablePromise as Promise,\n};\n","import { CancelToken } from './cancel-token';\n\n/**\n * @en Cancelable base option definition.\n * @ja ã­ã£ã³ã»ã«å¯è½ãªåºåºãªãã·ã§ã³\n */\nexport interface Cancelable {\n    cancel?: CancelToken;\n}\n\n//__________________________________________________________________________________________________//\n\n/**\n * @en Wait for promises done. <br>\n *     While control will be returned immediately when `Promise.all()` fails, but this mehtod waits for including failure.\n * @ja `Promise` ãªãã¸ã§ã¯ãã®çµäºã¾ã§å¾æ© <br>\n *     `Promise.all()` ã¯å¤±æããã¨ããã«å¶å¾¡ãè¿ãã®ã«å¯¾ããå¤±æãå«ãã¦å¾ã¤ `Promise` ãªãã¸ã§ã¯ããè¿å´\n *\n * @param promises\n *  - `en` Promise instance array\n *  - `ja` Promise ã¤ã³ã¹ã¿ã³ã¹ã®éåãæå®\n */\nexport function wait(promises: Promise<unknown>[]): Promise<unknown[]> {\n    const safePromises = promises.map((promise) => promise.catch((e) => e));\n    return Promise.all(safePromises);\n}\n\n/**\n * @en Cancellation checker method. <br>\n *     It's practicable by `async function`.\n * @ja ã­ã£ã³ã»ã«ãã§ãã«ã¼ <br>\n *     `async function` ã§ä½¿ç¨å¯è½\n *\n * @example <br>\n *\n * ```ts\n *  async function someFunc(token: CancelToken): Promise<{}> {\n *    await checkCanceled(token);\n *    return {};\n *  }\n * ```\n *\n * @param token\n *  - `en` [[CancelToken]] reference. (enable `undefined`)\n *  - `ja` [[CancelToken]] ãæå® (undefined å¯)\n */\nexport function checkCanceled(token: CancelToken | undefined): Promise<void> {\n    return Promise.resolve(undefined, token);\n}\n\n/**\n * @en Check the status of the promise instance. <br>\n *     It's practicable by `async function`.\n * @ja Promise ã¤ã³ã¹ã¿ã³ã¹ã®ç¶æãç¢ºèª <br>\n *     `async function` ã§ä½¿ç¨å¯è½\n *\n * @example <br>\n *\n * ```ts\n * import { checkStatus } from '@cdp/promise';\n *\n * let promise: Promise<unknown>; // some promise instance\n * :\n * const status = await checkStatus(promise);\n * console.log(status);\n * // 'pending' or 'fulfilled' or 'rejected'\n * ```\n *\n * @param promise\n *  - `en` Promise instance\n *  - `ja` Promise ã¤ã³ã¹ã¿ã³ã¹ãæå®\n */\nexport function checkStatus(promise: Promise<unknown>): Promise<'pending' | 'fulfilled' | 'rejected'> {\n    const pending = {};\n    return Promise.race([promise, pending])\n        .then(v => (v === pending) ? 'pending' : 'fulfilled', () => 'rejected');\n}\n","import { CancelToken } from './cancel-token';\nimport { CancelablePromise } from './cancelable-promise';\n\n/**\n * @en `Deferred` object class that can operate `reject` and` resolve` from the outside.\n * @ja `reject`, ` resolve` ãå¤é¨ããæä½å¯è½ãª `Deferred` ãªãã¸ã§ã¯ãã¯ã©ã¹\n * \n * @example <br>\n *\n * ```ts\n * const df = new Deferred();\n * df.resolve();\n * df.reject('reason');\n * \n * await df;\n * ```\n */\nexport class Deferred<T = void> extends CancelablePromise<T> {\n    readonly resolve!: (arg: T | PromiseLike<T>) => void;\n    readonly reject!: (reason?: unknown) => void;\n\n    /**\n     * constructor\n     *\n     * @param cancelToken\n     *  - `en` [[CancelToken]] instance create from [[CancelToken]].`source()`.\n     *  - `ja` [[CancelToken]].`source()` ããä½æãã [[CancelToken]] ã¤ã³ã¹ã¿ã³ã¹ãæå®\n     */\n    constructor(cancelToken?: CancelToken | null) {\n        const publications = {};\n        super((resolve, reject) => {\n            Object.assign(publications, { resolve, reject });\n        }, cancelToken);\n        Object.assign(this, publications); // eslint-disable-line @typescript-eslint/no-floating-promises\n    }\n\n    /** @internal */\n    get [Symbol.toStringTag](): 'Deferred' { return 'Deferred'; }\n}\n","import {\n    isString,\n    isSymbol,\n    className,\n} from '@cdp/core-utils';\nimport { EventBroker } from '@cdp/events';\n\n/** @internal EventBrokerProxy */\nexport class EventBrokerProxy<Event extends object> {\n    private _broker?: EventBroker<Event>;\n    public get(): EventBroker<Event> {\n        return this._broker || (this._broker = new EventBroker());\n    }\n}\n\n/** @internal */ export const _internal      = Symbol('internal');\n/** @internal */ export const _notify        = Symbol('notify');\n/** @internal */ export const _stockChange   = Symbol('stock-change');\n/** @internal */ export const _notifyChanges = Symbol('notify-changes');\n\n/** @internal */\nexport function verifyObservable(x: unknown): void | never {\n    if (!x || !(x as object)[_internal]) {\n        throw new TypeError(`The object passed is not an IObservable.`);\n    }\n}\n\n/** @internal */\nexport function verifyValidKey(key: unknown): void | never {\n    if (isString(key) || isSymbol(key)) {\n        return;\n    }\n    throw new TypeError(`Type of ${className(key)} is not a valid key.`);\n}\n","/* eslint-disable\n    @typescript-eslint/no-explicit-any,\n */\n\nimport {\n    NonFunctionProperties,\n    NonFunctionPropertyNames,\n    isString,\n    isArray,\n    verify,\n    post,\n    deepMerge,\n    deepEqual,\n} from '@cdp/core-utils';\nimport { Subscription, EventBroker } from '@cdp/events';\nimport {\n    EventBrokerProxy,\n    _internal,\n    _notify,\n    _stockChange,\n    _notifyChanges,\n    verifyObservable,\n} from './internal';\nimport { ObservableState, IObservable } from './common';\n\n/** @internal */\ninterface InternalProps {\n    state: ObservableState;\n    changed: boolean;\n    readonly changeMap: Map<PropertyKey, any>;\n    readonly broker: EventBrokerProxy<any>;\n}\n\n/** @internal */\nconst _proxyHandler: ProxyHandler<ObservableObject> = {\n    set(target, p, value, receiver) {\n        if (!isString(p)) {\n            return Reflect.set(target, p, value, receiver);\n        }\n        const oldValue = target[p];\n        if (ObservableState.DISABLED !== target[_internal].state && value !== oldValue) {\n            target[_stockChange](p, oldValue);\n        }\n        return Reflect.set(target, p, value, receiver);\n    },\n};\nObject.freeze(_proxyHandler);\n\n//__________________________________________________________________________________________________//\n\n/**\n * @en Observable key type definition.\n * @ja è³¼èª­å¯è½ãªã­ã¼ã®åå®ç¾©\n */\nexport type ObservableKeys<T extends ObservableObject> = NonFunctionPropertyNames<T>;\n\n//__________________________________________________________________________________________________//\n\n/**\n * @en The object class which change can be observed.\n * @ja ãªãã¸ã§ã¯ãã®å¤æ´ãç£è¦ã§ãããªãã¸ã§ã¯ãã¯ã©ã¹\n *\n * @example <br>\n *\n * - Basic Usage\n *\n * ```ts\n * class Example extends ObservableObject {\n *   public a: number = 0;\n *   public b: number = 0;\n *   public get sum(): number {\n *       return this.a + this.b;\n *   }\n * }\n *\n * const observable = new Example();\n *\n * function onNumChange(newValue: number, oldValue: number, key: string) {\n *   console.log(`${key} changed from ${oldValue} to ${newValue}.`);\n * }\n * observable.on(['a', 'b'], onNumChange);\n *\n * // update\n * observable.a = 100;\n * observable.b = 200;\n *\n * // console out from `async` event loop.\n * // => 'a changed from 0 to 100.'\n * // => 'b changed from 0 to 200.'\n *\n * :\n *\n * function onSumChange(newValue: number, oldValue: number) {\n *   console.log(`sum changed from ${oldValue} to ${newVaue}.`);\n * }\n * observable.on('sum', onSumChange);\n *\n * // update\n * observable.a = 100; // nothing reaction because of no change properties.\n * observable.a = 200;\n *\n * // console out from `async` event loop.\n * // => 'sum changed from 300 to 400.'\n * ```\n */\nexport abstract class ObservableObject implements IObservable {\n    /** @internal */\n    private readonly [_internal]!: InternalProps;\n\n    /**\n     * constructor\n     *\n     * @param state\n     *  - `en` initial state. default: [[ObservableState.ACTIVE]]\n     *  - `ja` åæç¶æ æ¢å®: [[ObservableState.ACTIVE]]\n     */\n    constructor(state = ObservableState.ACTIVE) {\n        verify('instanceOf', ObservableObject, this);\n        const internal: InternalProps = {\n            state,\n            changed: false,\n            changeMap: new Map(),\n            broker: new EventBrokerProxy<this>(),\n        };\n        Object.defineProperty(this, _internal, { value: Object.seal(internal) });\n        return new Proxy(this, _proxyHandler);\n    }\n\n///////////////////////////////////////////////////////////////////////\n// implements: IObservable\n\n    /**\n     * @en Subscrive property changes.\n     * @ja ãã­ããã£å¤æ´è³¼èª­è¨­å® (å¨ãã­ããã£ç£è¦)\n     *\n     * @param property\n     *  - `en` wild cord signature.\n     *  - `ja` ã¯ã¤ã«ãã«ã¼ã\n     * @param listener\n     *  - `en` callback function of the property change.\n     *  - `ja` ãã­ããã£å¤æ´éç¥ã³ã¼ã«ããã¯é¢æ°\n     */\n    on(property: '@', listener: (context: ObservableObject) => unknown): Subscription;\n\n    /**\n     * @en Subscrive property change(s).\n     * @ja ãã­ããã£å¤æ´è³¼èª­è¨­å®\n     *\n     * @param property\n     *  - `en` target property.\n     *  - `ja` å¯¾è±¡ã®ãã­ããã£\n     * @param listener\n     *  - `en` callback function of the property change.\n     *  - `ja` ãã­ããã£å¤æ´éç¥ã³ã¼ã«ããã¯é¢æ°\n     */\n    on<K extends ObservableKeys<this>>(property: K | K[], listener: (newValue: this[K], oldValue: this[K], key: K) => unknown): Subscription;\n\n    on<K extends ObservableKeys<this>>(property: K | K[], listener: (newValue: this[K], oldValue: this[K], key: K) => unknown): Subscription {\n        verifyObservable(this);\n        const { changeMap, broker } = this[_internal];\n        const result = broker.get().on(property, listener);\n        if (0 < changeMap.size) {\n            const props = isArray(property) ? property : [property];\n            for (const prop of props) {\n                changeMap.has(prop) || changeMap.set(prop, this[prop]);\n            }\n        }\n        return result;\n    }\n\n    /**\n     * @en Unsubscribe property changes)\n     * @ja ãã­ããã£å¤æ´è³¼èª­è§£é¤ (å¨ãã­ããã£ç£è¦)\n     *\n     * @param property\n     *  - `en` wild cord signature.\n     *  - `ja` ã¯ã¤ã«ãã«ã¼ã\n     * @param listener\n     *  - `en` callback function of the property change.\n     *  - `ja` ãã­ããã£å¤æ´éç¥ã³ã¼ã«ããã¯é¢æ°\n     */\n    off(property: '@', listener?: (context: ObservableObject) => any): void;\n\n    /**\n     * @en Unsubscribe property change(s).\n     * @ja ãã­ããã£å¤æ´è³¼èª­è§£é¤\n     *\n     * @param property\n     *  - `en` target property.\n     *         When not set this parameter, everything is released.\n     *  - `ja` å¯¾è±¡ã®ãã­ããã£\n     *         æå®ããªãå ´åã¯ãã¹ã¦è§£é¤\n     * @param listener\n     *  - `en` callback function of the property change.\n     *         When not set this parameter, all same `channel` listeners are released.\n     *  - `ja` ãã­ããã£å¤æ´éç¥ã³ã¼ã«ããã¯é¢æ°\n     *         æå®ããªãå ´åã¯åä¸ `channel` ãã¹ã¦ãè§£é¤\n     */\n    off<K extends ObservableKeys<this>>(property?: K | K[], listener?: (newValue: this[K], oldValue: this[K], key: K) => unknown): void;\n\n    off<K extends ObservableKeys<this>>(property?: K | K[], listener?: (newValue: this[K], oldValue: this[K], key: K) => unknown): void {\n        verifyObservable(this);\n        this[_internal].broker.get().off(property, listener);\n    }\n\n    /**\n     * @en Suspend or disable the event observation state.\n     * @ja ã¤ãã³ãè³¼èª­ç¶æã®ãµã¹ãã³ã\n     *\n     * @param noRecord\n     *  - `en` `true`: not recording property changes and clear changes. / `false`: property changes are recorded and fired when [[resume]]() callded. (default)\n     *  - `ja` `true`: ãã­ããã£å¤æ´ãè¨é²ãã, ç¾å¨ã®è¨é²ãç ´æ£ / `false`: ãã­ããã£å¤æ´ã¯è¨é²ãã, [[resume]]() æã«çºç«ãã (æ¢å®)\n     */\n    suspend(noRecord = false): this {\n        verifyObservable(this);\n        this[_internal].state = noRecord ? ObservableState.DISABLED : ObservableState.SUSEPNDED;\n        if (noRecord) {\n            this[_internal].changeMap.clear();\n        }\n        return this;\n    }\n\n    /**\n     * @en Resume the event observation state.\n     * @ja ã¤ãã³ãè³¼èª­ç¶æã®ãªã¸ã¥ã¼ã \n     */\n    resume(): this {\n        verifyObservable(this);\n        const internal = this[_internal];\n        if (ObservableState.ACTIVE !== internal.state) {\n            internal.state = ObservableState.ACTIVE;\n            void post(() => this[_notifyChanges]());\n        }\n        return this;\n    }\n\n    /**\n     * @en observation state\n     * @ja è³¼èª­å¯è½ç¶æ\n     */\n    getObservableState(): ObservableState {\n        verifyObservable(this);\n        return this[_internal].state;\n    }\n\n///////////////////////////////////////////////////////////////////////\n// implements: IObservableEventBrokerAccess\n\n    /** @internal */\n    getBroker(): EventBroker<NonFunctionProperties<this>> {\n        const { broker } = this[_internal];\n        return broker.get();\n    }\n\n///////////////////////////////////////////////////////////////////////\n// static methods:\n\n    /**\n     * @en Create [[ObservableObject]] from any object.\n     * @ja ä»»æã®ãªãã¸ã§ã¯ããã [[ObservableObject]] ãçæ\n     *\n     * @example <br>\n     *\n     * ```ts\n     * const observable = ObservableObject.from({ a: 1, b: 1 });\n     * function onNumChange(newValue: number, oldValue: number, key: string) {\n     *   console.log(`${key} changed from ${oldValue} to ${newValue}.`);\n     * }\n     * observable.on(['a', 'b'], onNumChange);\n     *\n     * // update\n     * observable.a = 100;\n     * observable.b = 200;\n     *\n     * // console out from `async` event loop.\n     * // => 'a changed from 1 to 100.'\n     * // => 'b changed from 1 to 200.'\n     * ```\n     */\n    public static from<T extends object>(src: T): ObservableObject & T {\n        const observable = deepMerge(new class extends ObservableObject { }(ObservableState.DISABLED), src);\n        observable.resume();\n        return observable as any;\n    }\n\n///////////////////////////////////////////////////////////////////////\n// protected mehtods:\n\n    /**\n     * @en Force notify property change(s) in spite of active state.\n     * @ja ã¢ã¯ãã£ãç¶æã«ãããããå¼·å¶çã«ãã­ããã£å¤æ´éç¥ãçºè¡\n     */\n    protected notify(...properties: string[]): void {\n        verifyObservable(this);\n        if (0 === properties.length) {\n            return;\n        }\n        const { changeMap } = this[_internal];\n        const keyValue = new Map<PropertyKey, [any, any]>();\n        for (const key of properties) {\n            const newValue = this[key];\n            const oldValue = changeMap.has(key) ? changeMap.get(key) : newValue;\n            keyValue.set(key, [newValue, oldValue]);\n        }\n        0 < keyValue.size && this[_notify](keyValue);\n    }\n\n///////////////////////////////////////////////////////////////////////\n// private mehtods:\n\n    /** @internal */\n    private [_stockChange](p: string, oldValue: any): void {\n        const { state, changeMap, broker } = this[_internal];\n        this[_internal].changed = true;\n        if (0 === changeMap.size) {\n            changeMap.set(p, oldValue);\n            for (const k of broker.get().channels()) {\n                changeMap.has(k) || changeMap.set(k, this[k]);\n            }\n            if (ObservableState.ACTIVE === state) {\n                void post(() => this[_notifyChanges]());\n            }\n        } else {\n            changeMap.has(p) || changeMap.set(p, oldValue);\n        }\n    }\n\n    /** @internal */\n    private [_notifyChanges](): void {\n        const { state, changeMap } = this[_internal];\n        if (ObservableState.ACTIVE !== state) {\n            return;\n        }\n        const keyValuePairs = new Map<PropertyKey, [any, any]>();\n        for (const [key, oldValue] of changeMap) {\n            const curValue = this[key];\n            if (!deepEqual(oldValue, curValue)) {\n                keyValuePairs.set(key, [curValue, oldValue]);\n            }\n        }\n        this[_notify](keyValuePairs);\n    }\n\n    /** @internal */\n    private [_notify](keyValue: Map<PropertyKey, [any, any]>): void {\n        const { changed, changeMap, broker } = this[_internal];\n        changeMap.clear();\n        this[_internal].changed = false;\n        const eventBroker = broker.get();\n        for (const [key, values] of keyValue) {\n            (eventBroker as any).trigger(key, ...values, key);\n        }\n        if (changed) {\n            eventBroker.trigger('@', this);\n        }\n    }\n}\n","/* eslint-disable\n    prefer-rest-params,\n */\n\nimport {\n    UnknownFunction,\n    Writable,\n    isNumber,\n    verify,\n    post,\n} from '@cdp/core-utils';\nimport { Subscription, EventBroker } from '@cdp/events';\nimport {\n    EventBrokerProxy,\n    _internal,\n    _notify,\n    _stockChange,\n    _notifyChanges,\n    verifyObservable,\n} from './internal';\nimport { ObservableState, IObservable } from './common';\n\n/**\n * @en Array change type information. <br>\n *     The value is suitable for the number of fluctuation of the element.\n * @ja éåå¤æ´éç¥ã®ã¿ã¤ã <br>\n *     å¤ã¯è¦ç´ ã®å¢æ¸æ°ã«ç¸å½\n *\n */\nexport const enum ArrayChangeType {\n    REMOVE = -1,\n    UPDATE = 0,\n    INSERT = 1,\n}\n\n/**\n * @en Array change record information.\n * @ja éåå¤æ´æå ±\n */\nexport interface ArrayChangeRecord<T> {\n    /**\n     * @en The change type information.\n     * @ja éåå¤æ´æå ±ã®è­å¥å­\n     */\n    readonly type: ArrayChangeType;\n\n    /**\n     * @en The change type information. <br>\n     *     â» [Attention] The index will be different from the actual location when array size changed because that determines element operation unit.\n     * @ja å¤æ´ãçºçããéååã®ä½ç½®ã® index <br>\n     *     â» [æ³¨æ] ãªãã¬ã¼ã·ã§ã³åä½ã® index ã¨ãªã, è¦ç´ ãå¢æ¸ããå ´åã¯å®éã®ä½ç½®ã¨ç°ãªããã¨ããã\n     */\n    readonly index: number;\n\n    /**\n     * @en New element's value.\n     * @ja è¦ç´ ã®æ°ããå¤\n     */\n    readonly newValue?: T;\n\n    /**\n     * @en Old element's value.\n     * @ja è¦ç´ ã®å¤ãå¤\n     */\n    readonly oldValue?: T;\n}\ntype MutableChangeRecord<T> = Writable<ArrayChangeRecord<T>>;\n\n//__________________________________________________________________________________________________//\n\n/** @internal */\ninterface IArrayChangeEvent<T> {\n    '@': [ArrayChangeRecord<T>[]];\n}\n\n/** @internal */\ninterface InternalProps<T = unknown> {\n    state: ObservableState;\n    byMethod: boolean;\n    records: MutableChangeRecord<T>[];\n    readonly indexes: Set<number>;\n    readonly broker: EventBrokerProxy<IArrayChangeEvent<T>>;\n}\n\n/** @internal */\nconst _proxyHandler: ProxyHandler<ObservableArray> = {\n    defineProperty(target, p, attributes) {\n        const internal = target[_internal];\n        if (ObservableState.DISABLED === internal.state || internal.byMethod || !Object.prototype.hasOwnProperty.call(attributes, 'value')) {\n            return Reflect.defineProperty(target, p, attributes);\n        }\n        const oldValue = target[p];\n        const newValue = attributes.value;\n        // eslint-disable-next-line eqeqeq\n        if ('length' === p && newValue != oldValue) { // Do NOT use strict inequality (!==)\n            const oldLength = oldValue >>> 0;\n            const newLength = newValue >>> 0;\n            const stock = (): void => {\n                const scrap = newLength < oldLength && target.slice(newLength);\n                if (scrap) { // newLength < oldLength\n                    for (let i = oldLength; --i >= newLength;) {\n                        target[_stockChange](ArrayChangeType.REMOVE, i, undefined, scrap[i - newLength]);\n                    }\n                } else {     // oldLength < newLength\n                    for (let i = oldLength; i < newLength; i++) {\n                        target[_stockChange](ArrayChangeType.INSERT, i /*, undefined, undefined */);\n                    }\n                }\n            };\n            const result = Reflect.defineProperty(target, p, attributes);\n            result && stock();\n            return result;\n        } else if (newValue !== oldValue && isValidArrayIndex(p)) {\n            const i = p as unknown as number >>> 0;\n            const type: ArrayChangeType = Number(i >= target.length); // INSERT or UPDATE\n            const result = Reflect.defineProperty(target, p, attributes);\n            result && target[_stockChange](type, i, newValue, oldValue);\n            return result;\n        } else {\n            return Reflect.defineProperty(target, p, attributes);\n        }\n    },\n    deleteProperty(target, p) {\n        const internal = target[_internal];\n        if (ObservableState.DISABLED === internal.state || internal.byMethod || !Object.prototype.hasOwnProperty.call(target, p)) {\n            return Reflect.deleteProperty(target, p);\n        }\n        const oldValue = target[p];\n        const result = Reflect.deleteProperty(target, p);\n        result && isValidArrayIndex(p) && target[_stockChange](ArrayChangeType.UPDATE, p as unknown as number >>> 0, undefined, oldValue);\n        return result;\n    },\n};\nObject.freeze(_proxyHandler);\n\n/** @internal valid array index helper */\nfunction isValidArrayIndex<T>(index: T): boolean {\n    const s = String(index);\n    const n = Math.trunc(s as unknown as number);\n    return String(n) === s && 0 <= n && n < 0xFFFFFFFF;\n}\n\n/** @internal helper for index management */\nfunction findRelatedChangeIndex<T>(records: MutableChangeRecord<T>[], type: ArrayChangeType, index: number): number {\n    const checkType = type === ArrayChangeType.INSERT\n        ? (t: ArrayChangeType) => t === ArrayChangeType.REMOVE\n        : (t: ArrayChangeType) => t !== ArrayChangeType.REMOVE\n        ;\n\n    for (let i = records.length; --i >= 0;) {\n        const value = records[i];\n        if (value.index === index && checkType(value.type)) {\n            return i;\n        } else if (value.index < index && Boolean(value.type)) { // REMOVE or INSERT\n            index -= value.type;\n        }\n    }\n    return -1;\n}\n\n//__________________________________________________________________________________________________//\n\n/**\n * @en The array class which change can be observed.\n * @ja å¤æ´ç£è¦å¯è½ãªéåã¯ã©ã¹\n *\n * @example <br>\n *\n * - Basic Usage\n *\n * ```ts\n * const obsArray = ObservableArray.from(['a', 'b', 'c']);\n *\n * function onChangeArray(records: ArrayChangeRecord[]) {\n *   console.log(records);\n *   //  [\n *   //    { type: 1, index: 3, newValue: 'x', oldValue: undefined },\n *   //    { type: 1, index: 4, newValue: 'y', oldValue: undefined },\n *   //    { type: 1, index: 5, newValue: 'z', oldValue: undefined }\n *   //  ]\n * }\n * obsArray.on(onChangeArray);\n *\n * function addXYZ() {\n *   obsArray.push('x', 'y', 'z');\n * }\n * ```\n */\nexport class ObservableArray<T = unknown> extends Array<T> implements IObservable {\n    /** @internal */\n    private readonly [_internal]!: InternalProps<T>;\n\n    /** @final constructor */\n    private constructor() {\n        super(...arguments);\n        verify('instanceOf', ObservableArray, this);\n        const internal: InternalProps<T> = {\n            state: ObservableState.ACTIVE,\n            byMethod: false,\n            records: [],\n            indexes: new Set(),\n            broker: new EventBrokerProxy<IArrayChangeEvent<T>>(),\n        };\n        Object.defineProperty(this, _internal, { value: Object.seal(internal) });\n        const argLength = arguments.length;\n        if (1 === argLength && isNumber(arguments[0])) {\n            const len = arguments[0] >>> 0;\n            for (let i = 0; i < len; i++) {\n                this[_stockChange](ArrayChangeType.INSERT, i /*, undefined */);\n            }\n        } else if (0 < argLength) {\n            for (let i = 0; i < argLength; i++) {\n                this[_stockChange](ArrayChangeType.INSERT, i, arguments[i]);\n            }\n        }\n        return new Proxy(this, _proxyHandler) as ObservableArray<T>;\n    }\n\n///////////////////////////////////////////////////////////////////////\n// implements: IObservable\n\n    /**\n     * @en Subscrive array change(s).\n     * @ja éåå¤æ´è³¼èª­è¨­å®\n     *\n     * @param listener\n     *  - `en` callback function of the array change.\n     *  - `ja` éåå¤æ´éç¥ã³ã¼ã«ããã¯é¢æ°\n     */\n    on(listener: (records: ArrayChangeRecord<T>[]) => unknown): Subscription {\n        verifyObservable(this);\n        return this[_internal].broker.get().on('@', listener);\n    }\n\n    /**\n     * @en Unsubscribe array change(s).\n     * @ja éåå¤æ´è³¼èª­è§£é¤\n     *\n     * @param listener\n     *  - `en` callback function of the array change.\n     *         When not set this parameter, all same `channel` listeners are released.\n     *  - `ja` éåå¤æ´éç¥ã³ã¼ã«ããã¯é¢æ°\n     *         æå®ããªãå ´åã¯åä¸ `channel` ãã¹ã¦ãè§£é¤\n     */\n    off(listener?: (records: ArrayChangeRecord<T>[]) => unknown): void {\n        verifyObservable(this);\n        this[_internal].broker.get().off('@', listener);\n    }\n\n    /**\n     * @en Suspend or disable the event observation state.\n     * @ja ã¤ãã³ãè³¼èª­ç¶æã®ãµã¹ãã³ã\n     *\n     * @param noRecord\n     *  - `en` `true`: not recording property changes and clear changes. / `false`: property changes are recorded and fired when [[resume]]() callded. (default)\n     *  - `ja` `true`: ãã­ããã£å¤æ´ãè¨é²ãã, ç¾å¨ã®è¨é²ãç ´æ£ / `false`: ãã­ããã£å¤æ´ã¯è¨é²ãã, [[resume]]() æã«çºç«ãã (æ¢å®)\n     */\n    suspend(noRecord = false): this {\n        verifyObservable(this);\n        this[_internal].state = noRecord ? ObservableState.DISABLED : ObservableState.SUSEPNDED;\n        if (noRecord) {\n            this[_internal].records = [];\n        }\n        return this;\n    }\n\n    /**\n     * @en Resume of the event subscription state.\n     * @ja ã¤ãã³ãè³¼èª­ç¶æã®ãªã¸ã¥ã¼ã \n     */\n    resume(): this {\n        verifyObservable(this);\n        const internal = this[_internal];\n        if (ObservableState.ACTIVE !== internal.state) {\n            internal.state = ObservableState.ACTIVE;\n            void post(() => this[_notifyChanges]());\n        }\n        return this;\n    }\n\n    /**\n     * @en observation state\n     * @ja è³¼èª­å¯è½ç¶æ\n     */\n    getObservableState(): ObservableState {\n        verifyObservable(this);\n        return this[_internal].state;\n    }\n\n///////////////////////////////////////////////////////////////////////\n// override: Array methods\n\n    /**\n     * Sorts an array.\n     * @param compareFn The name of the function used to determine the order of the elements. If omitted, the elements are sorted in ascending, ASCII character order.\n     */\n    sort(comparator?: (lhs: T, rhs: T) => number): this {\n        verifyObservable(this);\n        const internal = this[_internal];\n        const old = Array.from(this);\n        internal.byMethod = true;\n        const result = super.sort(comparator);\n        internal.byMethod = false;\n        if (ObservableState.DISABLED !== internal.state) {\n            const len = old.length;\n            for (let i = 0; i < len; i++) {\n                const oldValue = old[i];\n                const newValue = this[i];\n                if (newValue !== oldValue) {\n                    this[_stockChange](ArrayChangeType.UPDATE, i, newValue, oldValue);\n                }\n            }\n        }\n        return result;\n    }\n\n    /**\n     * Removes elements from an array and, if necessary, inserts new elements in their place, returning the deleted elements.\n     * @param start The zero-based location in the array from which to start removing elements.\n     * @param deleteCount The number of elements to remove.\n     */\n    splice(start: number, deleteCount?: number): ObservableArray<T>;\n    /**\n     * Removes elements from an array and, if necessary, inserts new elements in their place, returning the deleted elements.\n     * @param start The zero-based location in the array from which to start removing elements.\n     * @param deleteCount The number of elements to remove.\n     * @param items Elements to insert into the array in place of the deleted elements.\n     */\n    splice(start: number, deleteCount: number, ...items: T[]): ObservableArray<T>;\n    splice(start: number, deleteCount?: number, ...items: T[]): ObservableArray<T> {\n        verifyObservable(this);\n        const internal = this[_internal];\n        const oldLen = this.length;\n        internal.byMethod = true;\n        const result = (super.splice as UnknownFunction)(...arguments) as ObservableArray<T>;\n        internal.byMethod = false;\n        if (ObservableState.DISABLED !== internal.state) {\n            start = Math.trunc(start);\n            const from = start < 0 ? Math.max(oldLen + start, 0) : Math.min(start, oldLen);\n            for (let i = result.length; --i >= 0;) {\n                this[_stockChange](ArrayChangeType.REMOVE, from + i, undefined, result[i]);\n            }\n            const len = items.length;\n            for (let i = 0; i < len; i++) {\n                this[_stockChange](ArrayChangeType.INSERT, from + i, items[i]);\n            }\n        }\n        return result;\n    }\n\n    /**\n     * Removes the first element from an array and returns it.\n     */\n    shift(): T | undefined {\n        verifyObservable(this);\n        const internal = this[_internal];\n        const oldLen = this.length;\n        internal.byMethod = true;\n        const result = super.shift();\n        internal.byMethod = false;\n        if (ObservableState.DISABLED !== internal.state && this.length < oldLen) {\n            this[_stockChange](ArrayChangeType.REMOVE, 0, undefined, result);\n        }\n        return result;\n    }\n\n    /**\n     * Inserts new elements at the start of an array.\n     * @param items  Elements to insert at the start of the Array.\n     */\n    unshift(...items: T[]): number {\n        verifyObservable(this);\n        const internal = this[_internal];\n        internal.byMethod = true;\n        const result = super.unshift(...items);\n        internal.byMethod = false;\n        if (ObservableState.DISABLED !== internal.state) {\n            const len = items.length;\n            for (let i = 0; i < len; i++) {\n                this[_stockChange](ArrayChangeType.INSERT, i, items[i]);\n            }\n        }\n        return result;\n    }\n\n    /**\n     * Calls a defined callback function on each element of an array, and returns an array that contains the results.\n     * @param callbackfn A function that accepts up to three arguments. The map method calls the callbackfn function one time for each element in the array.\n     * @param thisArg An object to which the this keyword can refer in the callbackfn function. If thisArg is omitted, undefined is used as the this value.\n     */\n    map<U>(callbackfn: (value: T, index: number, array: T[]) => U, thisArg?: unknown): ObservableArray<U> {\n        /*\n         * [NOTE] original implement is very very high-cost.\n         *        so it's converted native Array once, and restored.\n         *\n         * return (super.map as UnknownFunction)(...arguments);\n         */\n        return ObservableArray.from([...this].map(callbackfn, thisArg));\n    }\n\n///////////////////////////////////////////////////////////////////////\n// implements: IObservableEventBrokerAccess\n\n    /** @internal */\n    getBroker(): EventBroker<IArrayChangeEvent<T>> {\n        const { broker } = this[_internal];\n        return broker.get();\n    }\n\n///////////////////////////////////////////////////////////////////////\n// private mehtods:\n\n    /** @internal */\n    private [_stockChange](type: ArrayChangeType, index: number, newValue?: T, oldValue?: T): void {\n        const { state, indexes, records } = this[_internal];\n        const rci = indexes.has(index) ? findRelatedChangeIndex(records, type, index) : -1;\n        const len = records.length;\n        if (rci >= 0) {\n            const rct = records[rci].type;\n            if (!rct /* UPDATE */) {\n                const prevRecord = records.splice(rci, 1)[0];\n                // UPDATE => UPDATE : UPDATE\n                // UPDATE => REMOVE : INSERT\n                this[_stockChange](type, index, newValue, prevRecord.oldValue);\n            } else {\n                for (let r, i = len; --i > rci;) {\n                    r = records[i];\n                    (r.index >= index) && (r.index -= rct);\n                }\n                const prevRecord = records.splice(rci, 1)[0];\n                if (type !== ArrayChangeType.REMOVE) {\n                    // INSERT => UPDATE : INSERT\n                    // REMOVE => INSERT : UPDATE\n                    this[_stockChange](Number(!type), index, newValue, prevRecord.oldValue);\n                }\n            }\n            return;\n        }\n        indexes.add(index);\n        records[len] = { type, index, newValue, oldValue };\n        if (ObservableState.ACTIVE === state && 0 === len) {\n            void post(() => this[_notifyChanges]());\n        }\n    }\n\n    /** @internal */\n    private [_notifyChanges](): void {\n        const { state, records } = this[_internal];\n        if (ObservableState.ACTIVE !== state || 0 === records.length) {\n            return;\n        }\n        for (const r of records) {\n            Object.freeze(r);\n        }\n        this[_notify](Object.freeze(records) as ArrayChangeRecord<T>[]);\n        this[_internal].records = [];\n    }\n\n    /** @internal */\n    private [_notify](records: ArrayChangeRecord<T>[]): void {\n        const internal = this[_internal];\n        internal.indexes.clear();\n        internal.broker.get().trigger('@', records);\n    }\n}\n\n//__________________________________________________________________________________________________//\n\n/**\n * Override return type of prototype methods\n */\nexport interface ObservableArray<T> {\n    /**\n     * Combines two or more arrays.\n     * @param items Additional items to add to the end of array1.\n     */\n    concat(...items: T[][]): ObservableArray<T>;\n    /**\n     * Combines two or more arrays.\n     * @param items Additional items to add to the end of array1.\n     */\n    concat(...items: (T | T[])[]): ObservableArray<T>;\n    /**\n     * Reverses the elements in an Array.\n     */\n    reverse(): this;\n    /**\n     * Returns a section of an array.\n     * @param start The beginning of the specified portion of the array.\n     * @param end The end of the specified portion of the array.\n     */\n    slice(start?: number, end?: number): ObservableArray<T>;\n    /**\n     * Returns the elements of an array that meet the condition specified in a callback function.\n     * @param callbackfn A function that accepts up to three arguments. The filter method calls the callbackfn function one time for each element in the array.\n     * @param thisArg An object to which the this keyword can refer in the callbackfn function. If thisArg is omitted, undefined is used as the this value.\n     */\n    filter<S extends T>(callbackfn: (value: T, index: number, array: T[]) => value is S, thisArg?: unknown): ObservableArray<S>;\n    /**\n     * Returns the elements of an array that meet the condition specified in a callback function.\n     * @param callbackfn A function that accepts up to three arguments. The filter method calls the callbackfn function one time for each element in the array.\n     * @param thisArg An object to which the this keyword can refer in the callbackfn function. If thisArg is omitted, undefined is used as the this value.\n     */\n    filter(callbackfn: (value: T, index: number, array: T[]) => unknown, thisArg?: unknown): ObservableArray<T>;\n}\n\n/**\n * Override return type of static methods\n */\nexport declare namespace ObservableArray { // eslint-disable-line @typescript-eslint/no-namespace\n    /**\n     * Creates an array from an array-like object.\n     * @param arrayLike An array-like or iterable object to convert to an array.\n     */\n    function from<T>(arrayLike: ArrayLike<T> | Iterable<T>): ObservableArray<T>;\n    /**\n     * Creates an array from an array-like object.\n     * @param arrayLike An array-like or iterable object to convert to an array.\n     * @param mapfn A mapping function to call on every element of the array.\n     * @param thisArg Value of 'this' used to invoke the mapfn.\n     */\n    function from<T, U>(arrayLike: ArrayLike<T> | Iterable<T>, mapfn: (this: void, v: T, k: number) => U, thisArg?: undefined): ObservableArray<U>;\n    function from<X, T, U>(arrayLike: ArrayLike<T> | Iterable<T>, mapfn: (this: X, v: T, k: number) => U, thisArg: X): ObservableArray<U>;\n    /**\n     * Returns a new array from a set of elements.\n     * @param items A set of elements to include in the new array object.\n     */\n    function of<T>(...items: T[]): ObservableArray<T>;\n}\n","/* eslint-disable\n    no-inner-declarations,\n    @typescript-eslint/no-namespace,\n    @typescript-eslint/no-unused-vars,\n */\n\n/*\n * NOTE: åé¨ã¢ã¸ã¥ã¼ã«ã« `CDP` namespace ãä½¿ç¨ãã¦ãã¾ãã¨, å¤é¨ã¢ã¸ã¥ã¼ã«ã§ã¯å®£è¨ã§ããªããªã.\n * https://github.com/Microsoft/TypeScript/issues/9611\n */\nnamespace CDP_DECLARE {\n\n    /**\n     * @en Constant definition about range of the result code.\n     * @ja ãªã¶ã«ãã³ã¼ãã®ç¯å²ã«é¢ããå®æ°å®ç¾©\n     */\n    export const enum RESULT_CODE_RANGE {\n        /**\n         * @en The assignable range for the client's local result cord by which expansion is possible.\n         * @ja ã¯ã©ã¤ã¢ã³ããæ¡å¼µå¯è½ãªã­ã¼ã«ã«ãªã¶ã«ãã³ã¼ãã®ã¢ãµã¤ã³å¯è½é å\n         */\n        MAX = 1000,\n        /**\n         * @en Reserved range of framework.\n         * @ja ãã¬ã¼ã ã¯ã¼ã¯ã®äºç´é å\n         */\n        RESERVED = 1000,\n    }\n\n    /**\n     * @en The assignment range guideline definition used in the module.\n     * @ja ã¢ã¸ã¥ã¼ã«åã§ä½¿ç¨ããã¢ãµã¤ã³é åã¬ã¤ãã©ã¤ã³å®æ°å®ç¾©\n     */\n    export const enum LOCAL_CODE_RANGE_GUIDE {\n        /**\n         * @en The assignment range guideline per 1 module.\n         * @ja 1ã¢ã¸ã¥ã¼ã«å½ããã«å²ãå½ã¦ãã¢ãµã¤ã³é åã¬ã¤ãã©ã¤ã³\n         */\n        MODULE = 100,\n        /**\n         * @en The assignment range guideline per 1 function.\n         * @ja 1æ©è½å½ããã«å²ãå½ã¦ãã¢ãµã¤ã³é åã¬ã¤ãã©ã¤ã³\n         */\n        FUNCTION = 20,\n    }\n\n    /**\n     * @en Offset value enumeration for [[RESULT_CODE]]. <br>\n     *     The client can expand a definition in other module.\n     * @ja [[RESULT_CODE]] ã®ãªãã»ããå¤ <br>\n     *     ã¨ã©ã¼ã³ã¼ãå¯¾å¿ããã¢ã¸ã¥ã¼ã«åã§ å®ç¾©ãæ¡å¼µãã.\n     *\n     * @example <br>\n     *\n     * ```ts\n     *  const enum LOCAL_CODE_BASE {\n     *      COMMON      = 0,\n     *      SOMEMODULE  = 1 * LOCAL_CODE_RANGE_GUIDE.FUNCTION,\n     *      SOMEMODULE2 = 2 * LOCAL_CODE_RANGE_GUIDE.FUNCTION,\n     *  }\n     *\n     *  export enum RESULT_CODE {\n     *      SOMEMODULE_DECLARE           = RESULT_CODE_BASE.DECLARE, // for avoid TS2432.\n     *      ERROR_SOMEMODULE_UNEXPECTED  = DECLARE_ERROR_CODE(RESULT_CODE_BASE.SOMEMODULE, LOCAL_CODE_BASE.SOMEMODULE + 1, \"error unexpected.\"),\n     *      ERROR_SOMEMODULE_INVALID_ARG = DECLARE_ERROR_CODE(RESULT_CODE_BASE.SOMEMODULE, LOCAL_CODE_BASE.SOMEMODULE + 2, \"invalid arguments.\"),\n     *  }\n     *  ASSIGN_RESULT_CODE(RESULT_CODE);\n     * ```\n     */\n    export const enum RESULT_CODE_BASE {\n        DECLARE = 9007199254740991, // Number.MAX_SAFE_INTEGER\n        COMMON  = 0,\n        CDP     = 1 * LOCAL_CODE_RANGE_GUIDE.MODULE, // cdp reserved. abs(0 ï½ 1000)\n//      MODULE_A = 1 * RESULT_CODE_RANGE.MAX,    // ex) moduleA: abs(1001 ï½ 1999)\n//      MODULE_B = 2 * RESULT_CODE_RANGE.MAX,    // ex) moduleB: abs(2001 ï½ 2999)\n//      MODULE_C = 3 * RESULT_CODE_RANGE.MAX,    // ex) moduleC: abs(3001 ï½ 3999)\n    }\n\n    /**\n     * @en Known CDP module offest definition.\n     * @ja ç®¡è½ãã¦ãã CDP ã¢ã¸ã¥ã¼ã«ã®ãªãã»ããå®ç¾©\n     *\n     * @example <br>\n     *\n     * ```ts\n     * const enum LOCAL_CODE_BASE {\n     *    AJAX = CDP_KNOWN_MODULE.AJAX * LOCAL_CODE_RANGE_GUIDE.FUNCTION,\n     * }\n     *\n     * export enum RESULT_CODE {\n     *   AJAX_DECLARE        = RESULT_CODE_BASE.DECLARE,\n     *   ERROR_AJAX_RESPONSE = DECLARE_ERROR_CODE(RESULT_CODE_BASE.CDP, LOCAL_CODE_BASE.AJAX + 1, 'network error.'),\n     *   ERROR_AJAX_TIMEOUT  = DECLARE_ERROR_CODE(RESULT_CODE_BASE.CDP, LOCAL_CODE_BASE.AJAX + 2, 'request timeout.'),\n     * }\n     * ```\n     */\n    export const enum CDP_KNOWN_MODULE {\n        /** `@cdp/ajax` */\n        AJAX = 1,\n        /** `@cdp/i18n` */\n        I18N = 2,\n        /** `@cdp/data-sync`, `@cdp/model`, `@cdp/collection`, `@cdp/view`, `@cdp/router` */\n        MVC  = 3,\n        /** `@cdp/app` */\n        APP  = 4,\n        /** offset for unknown module */\n        OFFSET,\n    }\n\n    /**\n     * @en Common result code for the application.\n     * @ja ã¢ããªã±ã¼ã·ã§ã³å¨ä½ã§ä½¿ç¨ããå±éã¨ã©ã¼ã³ã¼ãå®ç¾©\n     */\n    export enum RESULT_CODE {\n        /** `en` general success code             <br> `ja` æ±ç¨æåã³ã¼ã                       */\n        SUCCESS = 0,\n        /** `en` general cancel code              <br> `ja` æ±ç¨ã­ã£ã³ã»ã«ã³ã¼ã                 */\n        ABORT = 1,\n        /** `en` general pending code             <br> `ja` æ±ç¨ãªãã¬ã¼ã·ã§ã³æªå®è¡ã¨ã©ã¼ã³ã¼ã */\n        PENDING = 2,\n        /** `en` general success but noop code    <br> `ja` æ±ç¨å®è¡ä¸è¦ã³ã¼ã                   */\n        NOOP = 3,\n        /** `en` general error code               <br> `ja` æ±ç¨ã¨ã©ã¼ã³ã¼ã                     */\n        FAIL = -1,\n        /** `en` general fatal error code         <br> `ja` æ±ç¨è´å½çã¨ã©ã¼ã³ã¼ã               */\n        FATAL = -2,\n        /** `en` general not supported error code <br> `ja` æ±ç¨ãªãã¬ã¼ã·ã§ã³ã¨ã©ã¼ã³ã¼ã       */\n        NOT_SUPPORTED = -3,\n    }\n\n    /**\n     * @en Assign declared [[RESULT_CODE]] to root enumeration.\n     *     (It's enable to merge enum in the module system environment.)\n     * @ja æ¡å¼µãã [[RESULT_CODE]] ã ã«ã¼ã enum ã«ã¢ãµã¤ã³\n     *     ã¢ã¸ã¥ã¼ã«ã·ã¹ãã ç°å¢ã«ããã¦ããenum ããã¼ã¸ãå¯è½ã«ãã\n     */\n    export function ASSIGN_RESULT_CODE(extend: Record<string, unknown>): void {\n        Object.assign(RESULT_CODE, extend);\n    }\n\n    /** @internal */\n    const _code2message: { [code: string]: string; } = {\n        '0': 'operation succeeded.',\n        '1': 'operation aborted.',\n        '2': 'operation pending.',\n        '3': 'no operation.',\n        '-1': 'operation failed.',\n        '-2': 'unexpected error occured.',\n        '-3': 'operation not supported.',\n    };\n\n    /**\n     * @en Access to error message map.\n     * @ja ã¨ã©ã¼ã¡ãã»ã¼ã¸ãããã®åå¾\n     */\n    export function ERROR_MESSAGE_MAP(): { [code: string]: string; } {\n        return _code2message;\n    }\n\n    /**\n     * @en Generate success code.\n     * @ja æåã³ã¼ããçæ\n     *\n     * @param base\n     *  - `en` set base offset as [[RESULT_CODE_BASE]]\n     *  - `ja` ãªãã»ããå¤ã [[RESULT_CODE_BASE]] ã¨ãã¦æå®\n     * @param code\n     *  - `en` set local code for declaration. ex) '1'\n     *  - `ja` å®£è¨ç¨ã®ã­ã¼ã«ã«ã³ã¼ãå¤ãæå®  ä¾) '1'\n     * @param message\n     *  - `en` set error message for help string.\n     *  - `ja` ãã«ãã¹ããªã³ã°ç¨ã¨ã©ã¼ã¡ãã»ã¼ã¸ãæå®\n     */\n    export function DECLARE_SUCCESS_CODE(base: RESULT_CODE_BASE, code: number, message?: string): number {\n        return declareResultCode(base, code, message, true);\n    }\n\n    /**\n     * @en Generate error code.\n     * @ja ã¨ã©ã¼ã³ã¼ãçæ\n     *\n     * @param base\n     *  - `en` set base offset as [[RESULT_CODE_BASE]]\n     *  - `ja` ãªãã»ããå¤ã [[RESULT_CODE_BASE]] ã¨ãã¦æå®\n     * @param code\n     *  - `en` set local code for declaration. ex) '1'\n     *  - `ja` å®£è¨ç¨ã®ã­ã¼ã«ã«ã³ã¼ãå¤ãæå®  ä¾) '1'\n     * @param message\n     *  - `en` set error message for help string.\n     *  - `ja` ãã«ãã¹ããªã³ã°ç¨ã¨ã©ã¼ã¡ãã»ã¼ã¸ãæå®\n     */\n    export function DECLARE_ERROR_CODE(base: RESULT_CODE_BASE, code: number, message?: string): number {\n        return declareResultCode(base, code, message, false);\n    }\n\n///////////////////////////////////////////////////////////////////////\n// private section:\n\n    /** @internal register for [[RESULT_CODE]] */\n    function declareResultCode(base: RESULT_CODE_BASE, code: number, message: string | undefined, succeeded: boolean): number | never {\n        if (code < 0 || RESULT_CODE_RANGE.MAX <= code) {\n            throw new RangeError(`declareResultCode(), invalid local-code range. [code: ${code}]`);\n        }\n        const signed = succeeded ? 1 : -1;\n        const resultCode = signed * (base as number + code);\n        _code2message[resultCode] = message ? message : (`[CODE: ${resultCode}]`);\n        return resultCode;\n    }\n}\n","import RESULT_CODE              = CDP_DECLARE.RESULT_CODE;\nimport RESULT_CODE_BASE         = CDP_DECLARE.RESULT_CODE_BASE;\nimport RESULT_CODE_RANGE        = CDP_DECLARE.RESULT_CODE_RANGE;\nimport LOCAL_CODE_RANGE_GUIDE   = CDP_DECLARE.LOCAL_CODE_RANGE_GUIDE;\nimport DECLARE_SUCCESS_CODE     = CDP_DECLARE.DECLARE_SUCCESS_CODE;\nimport DECLARE_ERROR_CODE       = CDP_DECLARE.DECLARE_ERROR_CODE;\nimport ASSIGN_RESULT_CODE       = CDP_DECLARE.ASSIGN_RESULT_CODE;\nimport ERROR_MESSAGE_MAP        = CDP_DECLARE.ERROR_MESSAGE_MAP;\n\n/** @internal */\nconst enum Description {\n    UNKNOWN_ERROR_NAME ='UNKNOWN',\n}\n\nexport {\n    RESULT_CODE,\n    RESULT_CODE_BASE,\n    RESULT_CODE_RANGE,\n    LOCAL_CODE_RANGE_GUIDE,\n    DECLARE_SUCCESS_CODE,\n    DECLARE_ERROR_CODE,\n    ASSIGN_RESULT_CODE,\n};\n\n/**\n * @en Judge fail or not.\n * @ja å¤±æå¤å®\n *\n * @param code [[RESULT_CODE]]\n * @returns true: fail result / false: success result\n */\nexport function FAILED(code: number): boolean {\n    return code < 0;\n}\n\n/**\n * @en Judge success or not.\n * @ja æåå¤å®\n *\n * @param code [[RESULT_CODE]]\n * @returns true: success result / false: fail result\n */\nexport function SUCCEEDED(code: number): boolean {\n    return !FAILED(code);\n}\n\n/**\n * @en Convert to [[RESULT_CODE]] `name` string from [[RESULT_CODE]].\n * @ja [[RESULT_CODE]] ã [[RESULT_CODE]] æå­åã«å¤æ\n *\n * @param code [[RESULT_CODE]]\n * @param tag  custom tag if needed.\n * @returns name string ex) \"[tag][NOT_SUPPORTED]\"\n */\nexport function toNameString(code: number, tag?: string): string {\n    const prefix = tag ? `[${tag}]` : '';\n    if (RESULT_CODE[code]) {\n        return `${prefix}[${RESULT_CODE[code]}]`;\n    } else {\n        return `${prefix}[${Description.UNKNOWN_ERROR_NAME}]`;\n    }\n}\n\n/**\n * @en Convert to help string from [[RESULT_CODE]].\n * @ja [[RESULT_CODE]] ããã«ãã¹ããªã³ã°ã«å¤æ\n *\n * @param code [[RESULT_CODE]]\n * @returns registered help string\n */\nexport function toHelpString(code: number): string {\n    const map = ERROR_MESSAGE_MAP();\n    if (map[code]) {\n        return map[code];\n    } else {\n        return `unregistered result code. [code: ${code}]`;\n    }\n}\n","import {\n    className,\n    isNullish,\n    isString,\n    isCancelLikeError,\n} from '@cdp/core-utils';\nimport {\n    RESULT_CODE,\n    SUCCEEDED,\n    FAILED,\n    toNameString,\n    toHelpString,\n} from './result-code';\n\nconst {\n    /** @internal */ isFinite: isNumber\n} = Number;\n\n/** @internal */\nconst enum Tag {\n    ERROR  = 'Error',\n    RESULT = 'Result',\n}\n\n/** @internal */\nconst desc = (value: unknown): PropertyDescriptor => {\n    return {\n        configurable: false,\n        writable: false,\n        enumerable: true,\n        value,\n    };\n};\n\n/**\n * @en A result holder class. <br>\n *     Derived native `Error` class.\n * @ja å¦ççµæä¼éã¯ã©ã¹ <br>\n *     ãã¤ãã£ã `Error` ã®æ´¾çã¯ã©ã¹\n */\nexport class Result extends Error {\n\n    /**\n     * constructor\n     *\n     * @param code\n     *  - `en` result code\n     *  - `ja` çµæã³ã¼ã\n     * @param message\n     *  - `en` result info message\n     *  - `ja` çµææå ±ã¡ãã»ã¼ã¸\n     * @param options\n     *  - `en` error construction options\n     *  - `ja` ã¨ã©ã¼æ§ç¯ãªãã·ã§ã³\n     */\n    constructor(code?: number, message?: string, options?: ErrorOptions) {\n        code = isNullish(code) ? RESULT_CODE.SUCCESS : isNumber(code) ? Math.trunc(code) : RESULT_CODE.FAIL;\n        super(message || toHelpString(code), options);\n        const cause = options?.cause;\n        let time = isError(cause) ? (cause as Result).time : undefined;\n        isNumber(time as number) || (time = Date.now());\n        Object.defineProperties(this, { code: desc(code), time: desc(time), cause: desc(cause) });\n    }\n\n    /**\n     * @en [[RESULT_CODE]] value.\n     * @ja [[RESULT_CODE]] ã®å¤\n     */\n    readonly code!: number;\n\n    /**\n     * @en Generated time information.\n     * @ja çæãããæå»æå ±\n     */\n    readonly time!: number;\n\n    /**\n     * @en Stock low-level error information.\n     * @ja ä¸ä½ã®ã¨ã©ã¼æå ±ãæ ¼ç´\n     */\n    readonly cause?: unknown;\n\n    /**\n     * @en Judge succeeded or not.\n     * @ja æåå¤å®\n     */\n    get isSucceeded(): boolean {\n        return SUCCEEDED(this.code);\n    }\n\n    /**\n     * @en Judge failed or not.\n     * @ja å¤±æå¤å®\n     */\n    get isFailed(): boolean {\n        return FAILED(this.code);\n    }\n\n    /**\n     * @en Judge canceled or not.\n     * @ja ã­ã£ã³ã»ã«ã¨ã©ã¼å¤å®\n     */\n    get isCanceled(): boolean {\n        return this.code === RESULT_CODE.ABORT;\n    }\n\n    /**\n     * @en Get formatted [[RESULT_CODE]] name string.\n     * @ja ãã©ã¼ãããããã [[RESULT_CODE]] åæå­åãåå¾\n     */\n    get codeName(): string {\n        return toNameString(this.code, this.name);\n    }\n\n    /**\n     * @en Get [[RESULT_CODE]] help string.\n     * @ja [[RESULT_CODE]] ã®ãã«ãã¹ããªã³ã°ãåå¾\n     */\n    get help(): string {\n        return toHelpString(this.code);\n    }\n\n    /** @internal */\n    private get [Symbol.toStringTag](): Tag.RESULT {\n        return Tag.RESULT;\n    }\n}\n\nResult.prototype.name = Tag.RESULT;\n\n/** @interna lReturns `true` if `x` is `Error`, `false` otherwise. */\nfunction isError(x: unknown): x is Error {\n    return x instanceof Error || className(x) === Tag.ERROR;\n}\n\n/** Returns `true` if `x` is `Result`, `false` otherwise. */\nexport function isResult(x: unknown): x is Result {\n    return x instanceof Result || className(x) === Tag.RESULT;\n}\n\n/**\n * @en Convert to [[Result]] object.\n * @ja [[Result]] ãªãã¸ã§ã¯ãã«å¤æ\n */\nexport function toResult(o: unknown): Result {\n    if (o instanceof Result) {\n        /* eslint-disable-next-line prefer-const */\n        let { code, cause, time } = o;\n        code = isNullish(code) ? RESULT_CODE.SUCCESS : isNumber(code) ? Math.trunc(code) : RESULT_CODE.FAIL;\n        isNumber(time) || (time = Date.now());\n        // Do nothing if already defined\n        Reflect.defineProperty(o, 'code',  desc(code));\n        Reflect.defineProperty(o, 'time',  desc(time));\n        Reflect.defineProperty(o, 'cause', desc(cause));\n        return o;\n    } else {\n        const e = Object(o) as Result;\n        const message = isString(e.message) ? e.message : isString(o) ? o : undefined;\n        const code = isCancelLikeError(message) ? RESULT_CODE.ABORT : isNumber(e.code) ? e.code : o as number;\n        const cause = isError(e.cause) ? e.cause : isError(o) ? o : isString(o) ? new Error(o) : o;\n        return new Result(code, message, { cause });\n    }\n}\n\n/**\n * @en Create [[Result]] helper.\n * @ja [[Result]] ãªãã¸ã§ã¯ãæ§ç¯ãã«ãã¼\n *\n * @param code\n *  - `en` result code\n *  - `ja` çµæã³ã¼ã\n * @param message\n *  - `en` result info message\n *  - `ja` çµææå ±ã¡ãã»ã¼ã¸\n * @param cause\n *  - `en` low-level error information\n *  - `ja` ä¸ä½ã®ã¨ã©ã¼æå ±\n */\nexport function makeResult(code: number, message?: string, cause?: unknown): Result {\n    return new Result(code, message, { cause });\n}\n\n/**\n * @en Create canceled [[Result]] helper.\n * @ja ã­ã£ã³ã»ã«æå ±æ ¼ç´ [[Result]] ãªãã¸ã§ã¯ãæ§ç¯ãã«ãã¼\n *\n * @param message\n *  - `en` result info message\n *  - `ja` çµææå ±ã¡ãã»ã¼ã¸\n * @param cause\n *  - `en` low-level error information\n *  - `ja` ä¸ä½ã®ã¨ã©ã¼æå ±\n */\nexport function makeCanceledResult(message?: string, cause?: unknown): Result {\n    return new Result(RESULT_CODE.ABORT, message, { cause });\n}\n","import {\n    Keys,\n    Types,\n    KeyToType,\n    assignValue,\n    deepEqual,\n    isEmptyObject,\n    fromTypedData,\n    dropUndefined,\n    restoreNullish,\n} from '@cdp/core-utils';\nimport { Subscription, EventBroker } from '@cdp/events';\nimport {\n    Cancelable,\n    checkCanceled as cc,\n} from '@cdp/promise';\nimport {\n    StorageData,\n    StorageDataTypeList,\n    StorageInputDataTypeList,\n    IStorageOptions,\n    IStorageDataOptions,\n    IStorageDataReturnType,\n    IStorageEventCallback,\n    IStorage,\n} from './interfaces';\n\n/** MemoryStorage I/O options */\nexport type MemoryStorageOptions<K extends Keys<StorageDataTypeList> = Keys<StorageDataTypeList>> = IStorageDataOptions<StorageDataTypeList, K>;\n/** MemoryStorage return value */\nexport type MemoryStorageResult<K extends Keys<StorageDataTypeList>> = KeyToType<StorageDataTypeList, K>;\n/** MemoryStorage data type */\nexport type MemoryStorageDataTypes = Types<StorageDataTypeList>;\n/** MemoryStorage return type */\nexport type MemoryStorageReturnType<D extends MemoryStorageDataTypes> = IStorageDataReturnType<StorageDataTypeList, D>;\n/** MemoryStorage input data type */\nexport type MemoryStorageInputDataTypes = StorageInputDataTypeList<StorageDataTypeList>;\n/** MemoryStorage event callback */\nexport type MemoryStorageEventCallback = IStorageEventCallback<StorageDataTypeList>;\n\n/** @internal */\ninterface MemoryStorageEvent {\n    '@': [string | null, MemoryStorageDataTypes | null, MemoryStorageDataTypes | null];\n}\n\n//__________________________________________________________________________________________________//\n\n/**\n * @en Memory storage class. This class doesn't support permaneciation data.\n * @ja ã¡ã¢ãªã¼ã¹ãã¬ã¼ã¸ã¯ã©ã¹. æ¬ã¯ã©ã¹ã¯ãã¼ã¿ã®æ°¸ç¶åããµãã¼ãããªã\n */\nexport class MemoryStorage implements IStorage {\n\n    /** @internal */\n    private readonly _broker = new EventBroker<MemoryStorageEvent>();\n    /** @internal */\n    private _storage: StorageData = {};\n\n///////////////////////////////////////////////////////////////////////\n// implements: IStorage\n\n    /**\n     * @en [[IStorage]] kind signature.\n     * @ja [[IStorage]] ã®ç¨®å¥ãè¡¨ãè­å¥å­\n     */\n    get kind(): string {\n        return 'memory';\n    }\n\n    /**\n     * @en Returns the current value associated with the given key, or null if the given key does not exist in the list associated with the object.\n     * @ja ã­ã¼ã«å¯¾å¿ããå¤ãåå¾. å­å¨ããªãå ´åã¯ null ãè¿å´\n     *\n     * @param key\n     *  - `en` access key\n     *  - `ja` ã¢ã¯ã»ã¹ã­ã¼\n     * @param options\n     *  - `en` I/O options\n     *  - `ja` I/O ãªãã·ã§ã³\n     * @returns\n     *  - `en` Returns the value which corresponds to a key with type change designated in `dataType`.\n     *  - `ja` `dataType` ã§æå®ãããåå¤æãè¡ã£ã¦, ã­ã¼ã«å¯¾å¿ããå¤ãè¿å´\n     */\n    getItem<D extends MemoryStorageDataTypes = MemoryStorageDataTypes>(\n        key: string,\n        options?: MemoryStorageOptions<never>\n    ): Promise<MemoryStorageReturnType<D>>;\n\n    /**\n     * @en Returns the current value associated with the given key, or null if the given key does not exist in the list associated with the object.\n     * @ja ã­ã¼ã«å¯¾å¿ããå¤ãåå¾. å­å¨ããªãå ´åã¯ null ãè¿å´\n     *\n     * @param key\n     *  - `en` access key\n     *  - `ja` ã¢ã¯ã»ã¹ã­ã¼\n     * @param options\n     *  - `en` I/O options\n     *  - `ja` I/O ãªãã·ã§ã³\n     * @returns\n     *  - `en` Returns the value which corresponds to a key with type change designated in `dataType`.\n     *  - `ja` `dataType` ã§æå®ãããåå¤æãè¡ã£ã¦, ã­ã¼ã«å¯¾å¿ããå¤ãè¿å´\n     */\n    getItem<K extends Keys<StorageDataTypeList>>(\n        key: string,\n        options?: MemoryStorageOptions<K>\n    ): Promise<MemoryStorageResult<K> | null>;\n\n    async getItem(key: string, options?: MemoryStorageOptions): Promise<MemoryStorageDataTypes | null> {\n        options = options || {};\n        await cc(options.cancel);\n\n        // `undefined` â `null`\n        const value = dropUndefined(this._storage[key]);\n        switch (options.dataType) {\n            case 'string':\n                return fromTypedData(value) as string;\n            case 'number':\n                return Number(restoreNullish(value));\n            case 'boolean':\n                return Boolean(restoreNullish(value));\n            case 'object':\n                return Object(restoreNullish(value));\n            default:\n                return restoreNullish(value) as null;\n        }\n    }\n\n    /**\n     * @en Sets the value of the pair identified by key to value, creating a new key/value pair if none existed for key previously.\n     * @ja ã­ã¼ãæå®ãã¦å¤ãè¨­å®. å­å¨ããªãå ´åã¯æ°è¦ã«ä½æ\n     *\n     * @param key\n     *  - `en` access key\n     *  - `ja` ã¢ã¯ã»ã¹ã­ã¼\n     * @param options\n     *  - `en` I/O options\n     *  - `ja` I/O ãªãã·ã§ã³\n     */\n    async setItem<V extends MemoryStorageInputDataTypes>(key: string, value: V, options?: MemoryStorageOptions<never>): Promise<void> {\n        options = options || {};\n        await cc(options.cancel);\n        const newVal = dropUndefined(value, true);         // `null` or `undefined` â 'null' or 'undefined'\n        const oldVal = dropUndefined(this._storage[key]);  // `undefined` â `null`\n        if (!deepEqual(oldVal, newVal)) {\n            assignValue(this._storage, key, newVal);\n            !options.silent && this._broker.trigger('@', key, newVal, oldVal);\n        }\n    }\n\n    /**\n     * @en Removes the key/value pair with the given key from the list associated with the object, if a key/value pair with the given key exists.\n     * @ja æå®ãããã­ã¼ã«å¯¾å¿ããå¤ãå­å¨ããã°åé¤\n     *\n     * @param options\n     *  - `en` storage options\n     *  - `ja` ã¹ãã¬ã¼ã¸ãªãã·ã§ã³\n     */\n    async removeItem(key: string, options?: IStorageOptions): Promise<void> {\n        options = options || {};\n        await cc(options.cancel);\n        const oldVal = this._storage[key];\n        if (undefined !== oldVal) {\n            delete this._storage[key];\n            !options.silent && this._broker.trigger('@', key, null, oldVal);\n        }\n    }\n\n    /**\n     * @en Empties the list associated with the object of all key/value pairs, if there are any.\n     * @ja ãã¹ã¦ã®ã­ã¼ã«å¯¾å¿ããå¤ãåé¤\n     *\n     * @param options\n     *  - `en` storage options\n     *  - `ja` ã¹ãã¬ã¼ã¸ãªãã·ã§ã³\n     */\n    async clear(options?: IStorageOptions): Promise<void> {\n        options = options || {};\n        await cc(options.cancel);\n        if (!isEmptyObject(this._storage)) {\n            this._storage = {};\n            !options.silent && this._broker.trigger('@', null, null, null);\n        }\n    }\n\n    /**\n     * @en Returns all entry keys.\n     * @ja ãã¹ã¦ã®ã­ã¼ä¸è¦§ãè¿å´\n     *\n     * @param options\n     *  - `en` cancel options\n     *  - `ja` ã­ã£ã³ã»ã«ãªãã·ã§ã³\n     */\n    async keys(options?: Cancelable): Promise<string[]> {\n        await cc(options && options.cancel);\n        return Object.keys(this._storage);\n    }\n\n    /**\n     * @en Subscrive event(s).\n     * @ja ã¤ãã³ãè³¼èª­è¨­å®\n     *\n     * @param listener\n     *  - `en` callback function.\n     *  - `ja` ã³ã¼ã«ããã¯é¢æ°\n     */\n    on(listener: MemoryStorageEventCallback): Subscription {\n        return this._broker.on('@', listener);\n    }\n\n    /**\n     * @en Unsubscribe event(s).\n     * @ja ã¤ãã³ãè³¼èª­è§£é¤\n     *\n     * @param listener\n     *  - `en` callback function.\n     *         When not set this parameter, listeners are released.\n     *  - `ja` ã³ã¼ã«ããã¯é¢æ°\n     *         æå®ããªãå ´åã¯ãã¹ã¦ãè§£é¤\n     */\n    off(listener?: MemoryStorageEventCallback): void {\n        this._broker.off('@', listener);\n    }\n\n///////////////////////////////////////////////////////////////////////\n// operations:\n\n    /**\n     * @en Return a storage-store object.\n     * @ja ã¹ãã¬ã¼ã¸ã¹ãã¢ãªãã¸ã§ã¯ããè¿å´\n     */\n    get context(): StorageData {\n        return this._storage;\n    }\n}\n\n// default storage\nexport const memoryStorage = new MemoryStorage();\n","import { escapeHTML } from '@cdp/core-utils';\nimport {\n    TemplateDelimiters,\n    TemplateWriter,\n    TemplateEscaper,\n} from './interfaces';\n\n/** (string | Token[]) */\nexport type TokenList = unknown;\n\n/**\n * @en [[TemplateEngine]] token structure.\n * @ja [[TemplateEngine]] token å\n *\n * @internal\n */\nexport type Token = [string, string, number, number, TokenList?, number?, boolean?];\n\n/**\n * @en [[Token]] address id.\n * @ja [[Token]] ã¢ãã¬ã¹è­å¥å­\n */\nexport const enum TokenAddress {\n    TYPE = 0,\n    VALUE,\n    START,\n    END,\n    TOKEN_LIST,\n    TAG_INDEX,\n    HAS_NO_SPACE,\n}\n\n/**\n * @en Internal delimiters definition for [[TemplateEngine]]. ex) ['{{','}}'] or '{{ }}'\n * @ja [[TemplateEngine]] ã®åé¨ã§ä½¿ç¨ããåºåãæå­ ex) ['{{','}}'] or '{{ }}'\n */\nexport type Delimiters = string | TemplateDelimiters;\n\n/** @internal */\nexport const globalSettings = {\n    tags: ['{{', '}}'],\n    escape: escapeHTML,\n} as {\n    tags: TemplateDelimiters;\n    escape: TemplateEscaper;\n    writer: TemplateWriter;\n};\n","import {\n    PlainObject,\n    ensureObject,\n    getGlobalNamespace,\n} from '@cdp/core-utils';\nimport { TemplateDelimiters } from './interfaces';\n\n/**\n * @en Cache location information.\n * @ja ã­ã£ãã·ã¥ã­ã±ã¼ã·ã§ã³æå ±\n *\n * @internal\n */\nexport const enum CacheLocation {\n    NAMESPACE = 'CDP_DECLARE',\n    ROOT      = 'TEMPLATE_CACHE',\n}\n\n/**\n * @en Build cache key.\n * @ja ã­ã£ãã·ã¥ã­ã¼ã®çæ\n *\n * @internal\n */\nexport function buildCacheKey(template: string, tags: TemplateDelimiters): string {\n    return `${template}:${tags.join(':')}`;\n}\n\n/**\n * @en Clears all cached templates in cache pool.\n * @ja ãã¹ã¦ã®ãã³ãã¬ã¼ãã­ã£ãã·ã¥ãç ´æ£\n *\n * @internal\n */\nexport function clearCache(): void {\n    const namespace = getGlobalNamespace(CacheLocation.NAMESPACE);\n    namespace[CacheLocation.ROOT] = {};\n}\n\n/** @internal global cache pool */\nexport const cache = ensureObject<PlainObject>(null, CacheLocation.NAMESPACE, CacheLocation.ROOT);\n","import { isArray, isPrimitive } from '@cdp/core-utils';\nexport {\n    PlainObject,\n    isString,\n    isArray,\n    isFunction,\n    has,\n    escapeHTML,\n} from '@cdp/core-utils';\n\n/**\n * More correct typeof string handling array\n * which normally returns typeof 'object'\n */\nexport function typeString(src: unknown): string {\n    return isArray(src) ? 'array' : typeof src;\n}\n\n/**\n * Escape for template's expression charactors.\n */\nexport function escapeTemplateExp(src: string): string {\n    // eslint-disable-next-line\n    return src.replace(/[-\\[\\]{}()*+?.,\\\\\\^$|#\\s]/g, '\\\\$&');\n}\n\n/**\n * Safe way of detecting whether or not the given thing is a primitive and\n * whether it has the given property\n */\nexport function primitiveHasOwnProperty(src: unknown, propName: string): boolean {\n    return isPrimitive(src) && Object.prototype.hasOwnProperty.call(src, propName);\n}\n\n/**\n * Check whitespace charactor exists.\n */\nexport function isWhitespace(src: string): boolean {\n    return !/\\S/.test(src);\n}\n","import { TemplateScanner } from './interfaces';\n\n/**\n * A simple string scanner that is used by the template parser to find\n * tokens in template strings.\n */\nexport class Scanner implements TemplateScanner {\n    private _source: string;\n    private _tail: string;\n    private _pos: number;\n\n    /**\n     * constructor\n     */\n    constructor(src: string) {\n        this._source = this._tail = src;\n        this._pos = 0;\n    }\n\n///////////////////////////////////////////////////////////////////////\n// public methods:\n\n    /**\n     * Returns current scanning position.\n     */\n    get pos(): number {\n        return this._pos;\n    }\n\n    /**\n     * Returns string  source.\n     */\n    get source(): string {\n        return this._source;\n    }\n\n    /**\n     * Returns `true` if the tail is empty (end of string).\n     */\n    get eos(): boolean {\n        return '' === this._tail;\n    }\n\n    /**\n     * Tries to match the given regular expression at the current position.\n     * Returns the matched text if it can match, the empty string otherwise.\n     */\n    scan(regexp: RegExp): string {\n        const match = regexp.exec(this._tail);\n\n        if (!match || 0 !== match.index) {\n            return '';\n        }\n\n        const string = match[0];\n\n        this._tail = this._tail.substring(string.length);\n        this._pos += string.length;\n\n        return string;\n    }\n\n    /**\n     * Skips all text until the given regular expression can be matched. Returns\n     * the skipped string, which is the entire tail if no match can be made.\n     */\n    scanUntil(regexp: RegExp): string {\n        const index = this._tail.search(regexp);\n        let match: string;\n\n        switch (index) {\n            case -1:\n                match = this._tail;\n                this._tail = '';\n                break;\n            case 0:\n                match = '';\n                break;\n            default:\n                match = this._tail.substring(0, index);\n                this._tail = this._tail.substring(index);\n        }\n\n        this._pos += match.length;\n\n        return match;\n    }\n}\n","import { TemplateContext } from './interfaces';\nimport {\n    PlainObject,\n    isFunction,\n    has,\n    primitiveHasOwnProperty,\n} from './utils';\n\n/**\n * Represents a rendering context by wrapping a view object and\n * maintaining a reference to the parent context.\n */\nexport class Context implements TemplateContext {\n    private readonly _view: PlainObject;\n    private readonly _parent?: Context;\n    private readonly _cache: PlainObject;\n\n    /** constructor */\n    constructor(view: PlainObject, parentContext?: Context) {\n        this._view   = view;\n        this._cache  = { '.': this._view };\n        this._parent = parentContext;\n    }\n\n///////////////////////////////////////////////////////////////////////\n// public methods:\n\n    /**\n     * View parameter getter.\n     */\n    get view(): PlainObject {\n        return this._view;\n    }\n\n    /**\n     * Creates a new context using the given view with this context\n     * as the parent.\n     */\n    push(view: PlainObject): Context {\n        return new Context(view, this);\n    }\n\n    /**\n     * Returns the value of the given name in this context, traversing\n     * up the context hierarchy if the value is absent in this context's view.\n     */\n    lookup(name: string): unknown {\n        const cache = this._cache;\n\n        let value: unknown;\n        if (Object.prototype.hasOwnProperty.call(cache, name)) {\n            value = cache[name];\n        } else {\n            let context: Context | undefined = this; // eslint-disable-line @typescript-eslint/no-this-alias\n            let intermediateValue: object | undefined | null;\n            let names: string[];\n            let index: number;\n            let lookupHit = false;\n\n            while (context) {\n                if (0 < name.indexOf('.')) {\n                    intermediateValue = context._view;\n                    names = name.split('.');\n                    index = 0;\n\n                    /**\n                     * Using the dot notion path in `name`, we descend through the\n                     * nested objects.\n                     *\n                     * To be certain that the lookup has been successful, we have to\n                     * check if the last object in the path actually has the property\n                     * we are looking for. We store the result in `lookupHit`.\n                     *\n                     * This is specially necessary for when the value has been set to\n                     * `undefined` and we want to avoid looking up parent contexts.\n                     *\n                     * In the case where dot notation is used, we consider the lookup\n                     * to be successful even if the last \"object\" in the path is\n                     * not actually an object but a primitive (e.g., a string, or an\n                     * integer), because it is sometimes useful to access a property\n                     * of an autoboxed primitive, such as the length of a string.\n                     **/\n                    while (null != intermediateValue && index < names.length) {\n                        if (index === names.length - 1) {\n                            lookupHit = (\n                                has(intermediateValue, names[index]) ||\n                                primitiveHasOwnProperty(intermediateValue, names[index])\n                            );\n                        }\n                        intermediateValue = intermediateValue[names[index++]];\n                    }\n                } else {\n                    intermediateValue = context._view[name];\n\n                    /**\n                     * Only checking against `hasProperty`, which always returns `false` if\n                     * `context.view` is not an object. Deliberately omitting the check\n                     * against `primitiveHasOwnProperty` if dot notation is not used.\n                     *\n                     * Consider this example:\n                     * ```\n                     * Mustache.render(\"The length of a football field is {{#length}}{{length}}{{/length}}.\", {length: \"100 yards\"})\n                     * ```\n                     *\n                     * If we were to check also against `primitiveHasOwnProperty`, as we do\n                     * in the dot notation case, then render call would return:\n                     *\n                     * \"The length of a football field is 9.\"\n                     *\n                     * rather than the expected:\n                     *\n                     * \"The length of a football field is 100 yards.\"\n                     **/\n                    lookupHit = has(context._view, name);\n                }\n\n                if (lookupHit) {\n                    value = intermediateValue;\n                    break;\n                }\n\n                context = context._parent;\n            }\n\n            cache[name] = value as object;\n        }\n\n        if (isFunction(value)) {\n            value = value.call(this._view);\n        }\n\n        return value;\n    }\n}\n","import {\n    Token,\n    TokenAddress as $,\n    Delimiters,\n    globalSettings,\n} from './internal';\nimport {\n    isString,\n    isArray,\n    isWhitespace,\n    escapeTemplateExp,\n} from './utils';\nimport { Scanner } from './scanner';\n\n/** @internal */\nconst _regexp = {\n    white: /\\s*/,\n    space: /\\s+/,\n    equals: /\\s*=/,\n    curly: /\\s*\\}/,\n    tag: /#|\\^|\\/|>|\\{|&|=|!/,\n};\n\n/**\n * @internal\n * Combines the values of consecutive text tokens in the given `tokens` array to a single token.\n */\nfunction squashTokens(tokens: Token[]): Token[] {\n    const squashedTokens: Token[] = [];\n\n    let lastToken!: Token;\n    for (const token of tokens) {\n        if (token) {\n            if ('text' === token[$.TYPE] && lastToken && 'text' === lastToken[$.TYPE]) {\n                lastToken[$.VALUE] += token[$.VALUE];\n                lastToken[$.END] = token[$.END];\n            } else {\n                squashedTokens.push(token);\n                lastToken = token;\n            }\n        }\n    }\n\n    return squashedTokens;\n}\n\n/**\n * @internal\n * Forms the given array of `tokens` into a nested tree structure where\n * tokens that represent a section have two additional items: 1) an array of\n * all tokens that appear in that section and 2) the index in the original\n * template that represents the end of that section.\n */\nfunction nestTokens(tokens: Token[]): Token[] {\n    const nestedTokens: Token[] = [];\n    let collector = nestedTokens;\n    const sections: Token[] = [];\n\n    let section!: Token;\n    for (const token of tokens) {\n        switch (token[$.TYPE]) {\n            case '#':\n            case '^':\n                collector.push(token);\n                sections.push(token);\n                collector = token[$.TOKEN_LIST] = [];\n                break;\n            case '/':\n                section = sections.pop() as Token;\n                section[$.TAG_INDEX] = token[$.START];\n                collector = sections.length > 0 ? sections[sections.length - 1][$.TOKEN_LIST] as Token[] : nestedTokens;\n                break;\n            default:\n                collector.push(token);\n                break;\n        }\n    }\n    return nestedTokens;\n}\n\n/**\n * Breaks up the given `template` string into a tree of tokens. If the `tags`\n * argument is given here it must be an array with two string values: the\n * opening and closing tags used in the template (e.g. [ \"<%\", \"%>\" ]). Of\n * course, the default is to use mustaches (i.e. mustache.tags).\n *\n * A token is an array with at least 4 elements. The first element is the\n * mustache symbol that was used inside the tag, e.g. \"#\" or \"&\". If the tag\n * did not contain a symbol (i.e. {{myValue}}) this element is \"name\". For\n * all text that appears outside a symbol this element is \"text\".\n *\n * The second element of a token is its \"value\". For mustache tags this is\n * whatever else was inside the tag besides the opening symbol. For text tokens\n * this is the text itself.\n *\n * The third and fourth elements of the token are the start and end indices,\n * respectively, of the token in the original template.\n *\n * Tokens that are the root node of a subtree contain two more elements: 1) an\n * array of tokens in the subtree and 2) the index in the original template at\n * which the closing tag for that section begins.\n *\n * Tokens for partials also contain two more elements: 1) a string value of\n * indendation prior to that tag and 2) the index of that tag on that line -\n * eg a value of 2 indicates the partial is the third tag on this line.\n *\n * @param template template string\n * @param tags delimiters ex) ['{{','}}'] or '{{ }}'\n */\nexport function parseTemplate(template: string, tags?: Delimiters): Token[] {\n    if (!template) {\n        return [];\n    }\n\n    let lineHasNonSpace     = false;\n    const sections: Token[] = [];       // Stack to hold section tokens\n    const tokens: Token[]   = [];       // Buffer to hold the tokens\n    const spaces: number[]  = [];       // Indices of whitespace tokens on the current line\n    let hasTag              = false;    // Is there a {{tag}} on the current line?\n    let nonSpace            = false;    // Is there a non-space char on the current line?\n    let indentation         = '';       // Tracks indentation for tags that use it\n    let tagIndex            = 0;        // Stores a count of number of tags encountered on a line\n\n    // Strips all whitespace tokens array for the current line\n    // if there was a {{#tag}} on it and otherwise only space.\n    const stripSpace = (): void => {\n        if (hasTag && !nonSpace) {\n            while (spaces.length) {\n                delete tokens[spaces.pop() as number];\n            }\n        } else {\n            spaces.length = 0;\n        }\n        hasTag = false;\n        nonSpace = false;\n    };\n\n    const compileTags = (tagsToCompile: string | string[]): { openingTag: RegExp; closingTag: RegExp; closingCurly: RegExp; } => {\n        const enum Tag {\n            OPEN = 0,\n            CLOSE,\n        }\n        if (isString(tagsToCompile)) {\n            tagsToCompile = tagsToCompile.split(_regexp.space, 2);\n        }\n\n        if (!isArray(tagsToCompile) || 2 !== tagsToCompile.length) {\n            throw new Error(`Invalid tags: ${JSON.stringify(tagsToCompile)}`);\n        }\n        return {\n            openingTag:   new RegExp(`${escapeTemplateExp(tagsToCompile[Tag.OPEN])}\\\\s*`),\n            closingTag:   new RegExp(`\\\\s*${escapeTemplateExp(tagsToCompile[Tag.CLOSE])}`),\n            closingCurly: new RegExp(`\\\\s*${escapeTemplateExp(`}${tagsToCompile[Tag.CLOSE]}`)}`),\n        };\n    };\n\n    const { tag: reTag, white: reWhite, equals: reEquals, curly: reCurly } = _regexp;\n    let _regxpTags = compileTags(tags || globalSettings.tags);\n\n    const scanner = new Scanner(template);\n\n    let openSection: Token | undefined;\n    while (!scanner.eos) {\n        const { openingTag: reOpeningTag, closingTag: reClosingTag, closingCurly: reClosingCurly } = _regxpTags;\n        let token: Token;\n        let start = scanner.pos;\n        // Match any text between tags.\n        let value = scanner.scanUntil(reOpeningTag);\n        if (value) {\n            for (let i = 0, valueLength = value.length; i < valueLength; ++i) {\n                const chr = value.charAt(i);\n\n                if (isWhitespace(chr)) {\n                    spaces.push(tokens.length);\n                    indentation += chr;\n                } else {\n                    nonSpace = true;\n                    lineHasNonSpace = true;\n                    indentation += ' ';\n                }\n\n                tokens.push(['text', chr, start, start + 1]);\n                start += 1;\n\n                // Check for whitespace on the current line.\n                if ('\\n' === chr) {\n                    stripSpace();\n                    indentation = '';\n                    tagIndex = 0;\n                    lineHasNonSpace = false;\n                }\n            }\n        }\n\n        // Match the opening tag.\n        if (!scanner.scan(reOpeningTag)) {\n            break;\n        }\n\n        hasTag = true;\n\n        // Get the tag type.\n        let type = scanner.scan(reTag) || 'name';\n        scanner.scan(reWhite);\n\n        // Get the tag value.\n        if ('=' === type) {\n            value = scanner.scanUntil(reEquals);\n            scanner.scan(reEquals);\n            scanner.scanUntil(reClosingTag);\n        } else if ('{' === type) {\n            value = scanner.scanUntil(reClosingCurly);\n            scanner.scan(reCurly);\n            scanner.scanUntil(reClosingTag);\n            type = '&';\n        } else {\n            value = scanner.scanUntil(reClosingTag);\n        }\n\n        // Match the closing tag.\n        if (!scanner.scan(reClosingTag)) {\n            throw new Error(`Unclosed tag at ${scanner.pos}`);\n        }\n\n        if ('>' === type) {\n            token = [type, value, start, scanner.pos, indentation, tagIndex, lineHasNonSpace];\n        } else {\n            token = [type, value, start, scanner.pos];\n        }\n        tagIndex++;\n        tokens.push(token);\n\n        if ('#' === type || '^' === type) {\n            sections.push(token);\n        } else if ('/' === type) {\n            // Check section nesting.\n            openSection = sections.pop();\n            if (!openSection) {\n                throw new Error(`Unopened section \"${value}\" at ${start}`);\n            }\n            if (openSection[1] !== value) {\n                throw new Error(`Unclosed section \"${openSection[$.VALUE]}\" at ${start}`);\n            }\n        } else if ('name' === type || '{' === type || '&' === type) {\n            nonSpace = true;\n        } else if ('=' === type) {\n            // Set the tags for the next time around.\n            _regxpTags = compileTags(value);\n        }\n    }\n\n    stripSpace();\n\n    // Make sure there are no open sections when we're done.\n    openSection = sections.pop();\n\n    if (openSection) {\n        throw new Error(`Unclosed section \"${openSection[$.VALUE]}\" at ${scanner.pos}`);\n    }\n\n    return nestTokens(squashTokens(tokens));\n}\n","import {\n    TemplateDelimiters,\n    TemplateWriter,\n    TemplateViewParam,\n    TemplatePartialParam,\n} from './interfaces';\nimport {\n    Token,\n    TokenAddress as $,\n    globalSettings,\n} from './internal';\nimport { cache, buildCacheKey } from './cache';\nimport {\n    PlainObject,\n    isArray,\n    isFunction,\n} from './utils';\nimport { parseTemplate } from './parse';\nimport { Context } from './context';\n\n/**\n * A Writer knows how to take a stream of tokens and render them to a\n * string, given a context. It also maintains a cache of templates to\n * avoid the need to parse the same template twice.\n */\nexport class Writer implements TemplateWriter {\n\n///////////////////////////////////////////////////////////////////////\n// public methods:\n\n    /**\n     * Parses and caches the given `template` according to the given `tags` or\n     * `mustache.tags` if `tags` is omitted,  and returns the array of tokens\n     * that is generated from the parse.\n     */\n    parse(template: string, tags?: TemplateDelimiters): { tokens: Token[]; cacheKey: string; } {\n        const cacheKey = buildCacheKey(template, tags || globalSettings.tags);\n        let tokens = cache[cacheKey] as Token[];\n        if (null == tokens) {\n            tokens = cache[cacheKey] = parseTemplate(template, tags);\n        }\n        return { tokens, cacheKey };\n    }\n\n    /**\n     * High-level method that is used to render the given `template` with\n     * the given `view`.\n     *\n     * The optional `partials` argument may be an object that contains the\n     * names and templates of partials that are used in the template. It may\n     * also be a function that is used to load partial templates on the fly\n     * that takes a single argument: the name of the partial.\n     *\n     * If the optional `tags` argument is given here it must be an array with two\n     * string values: the opening and closing tags used in the template (e.g.\n     * [ \"<%\", \"%>\" ]). The default is to mustache.tags.\n     */\n    render(template: string, view: TemplateViewParam, partials?: TemplatePartialParam, tags?: TemplateDelimiters): string {\n        const { tokens } = this.parse(template, tags);\n        return this.renderTokens(tokens, view, partials, template, tags);\n    }\n\n    /**\n     * Low-level method that renders the given array of `tokens` using\n     * the given `context` and `partials`.\n     *\n     * Note: The `originalTemplate` is only ever used to extract the portion\n     * of the original template that was contained in a higher-order section.\n     * If the template doesn't use higher-order sections, this argument may\n     * be omitted.\n     */\n    renderTokens(tokens: Token[], view: TemplateViewParam, partials?: TemplatePartialParam, originalTemplate?: string, tags?: TemplateDelimiters): string {\n        const context = (view instanceof Context) ? view : new Context(view as PlainObject);\n        let buffer = '';\n\n        for (const token of tokens) {\n            let value: string | void;\n            switch (token[$.TYPE]) {\n                case '#':\n                    value = this.renderSection(token, context, partials, originalTemplate);\n                    break;\n                case '^':\n                    value = this.renderInverted(token, context, partials, originalTemplate);\n                    break;\n                case '>':\n                    value = this.renderPartial(token, context, partials, tags);\n                    break;\n                case '&':\n                    value = this.unescapedValue(token, context);\n                    break;\n                case 'name':\n                    value = this.escapedValue(token, context);\n                    break;\n                case 'text':\n                    value = this.rawValue(token);\n                    break;\n                default:\n                    break;\n            }\n\n            if (null != value) {\n                buffer += value;\n            }\n        }\n\n        return buffer;\n    }\n\n///////////////////////////////////////////////////////////////////////\n// private methods:\n\n    /** @internal */\n    private renderSection(token: Token, context: Context, partials?: TemplatePartialParam, originalTemplate?: string): string | void {\n        const self = this;\n        let buffer = '';\n        let value = context.lookup(token[$.VALUE]);\n\n        // This function is used to render an arbitrary template\n        // in the current context by higher-order sections.\n        const subRender = (template: string): string => {\n            return self.render(template, context, partials);\n        };\n\n        if (!value) {\n            return;\n        }\n\n        if (isArray(value)) {\n            for (const v of value) {\n                buffer += this.renderTokens(token[$.TOKEN_LIST] as Token[], context.push(v), partials, originalTemplate);\n            }\n        } else if ('object' === typeof value || 'string' === typeof value || 'number' === typeof value) {\n            buffer += this.renderTokens(token[$.TOKEN_LIST] as Token[], context.push(value as PlainObject), partials, originalTemplate);\n        } else if (isFunction(value)) {\n            if ('string' !== typeof originalTemplate) {\n                throw new Error('Cannot use higher-order sections without the original template');\n            }\n            // Extract the portion of the original template that the section contains.\n            value = value.call(context.view, originalTemplate.slice(token[$.END], token[$.TAG_INDEX]), subRender);\n            if (null != value) {\n                buffer += value;\n            }\n        } else {\n            buffer += this.renderTokens(token[$.TOKEN_LIST] as Token[], context, partials, originalTemplate);\n        }\n        return buffer;\n    }\n\n    /** @internal */\n    private renderInverted(token: Token, context: Context, partials?: TemplatePartialParam, originalTemplate?: string): string | void {\n        const value = context.lookup(token[$.VALUE]);\n        if (!value || (isArray(value) && 0 === value.length)) {\n            return this.renderTokens(token[$.TOKEN_LIST] as Token[], context, partials, originalTemplate);\n        }\n    }\n\n    /** @internal */\n    private indentPartial(partial: string, indentation: string, lineHasNonSpace: boolean): string {\n        const filteredIndentation = indentation.replace(/[^ \\t]/g, '');\n        const partialByNl = partial.split('\\n');\n        for (let i = 0; i < partialByNl.length; i++) {\n            if (partialByNl[i].length && (i > 0 || !lineHasNonSpace)) {\n                partialByNl[i] = filteredIndentation + partialByNl[i];\n            }\n        }\n        return partialByNl.join('\\n');\n    }\n\n    /** @internal */\n    private renderPartial(token: Token, context: Context, partials: TemplatePartialParam | undefined, tags: TemplateDelimiters | undefined): string | void {\n        if (!partials) {\n            return;\n        }\n\n        const value = (isFunction(partials) ? partials(token[$.VALUE]) : partials[token[$.VALUE]]) as string | undefined;\n        if (null != value) {\n            const lineHasNonSpace = token[$.HAS_NO_SPACE];\n            const tagIndex        = token[$.TAG_INDEX];\n            const indentation     = token[$.TOKEN_LIST];\n            let indentedValue = value;\n            if (0 === tagIndex && indentation) {\n                indentedValue = this.indentPartial(value, indentation as string, lineHasNonSpace as boolean);\n            }\n            const { tokens } = this.parse(indentedValue, tags);\n            return this.renderTokens(tokens, context, partials, indentedValue);\n        }\n    }\n\n    /** @internal */\n    private unescapedValue(token: Token, context: Context): string | void {\n        const value = context.lookup(token[$.VALUE]);\n        if (null != value) {\n            return value as string;\n        }\n    }\n\n    /** @internal */\n    private escapedValue(token: Token, context: Context): string | void {\n        const value = context.lookup(token[$.VALUE]);\n        if (null != value) {\n            return globalSettings.escape(value as string);\n        }\n    }\n\n    /** @internal */\n    private rawValue(token: Token): string {\n        return token[$.VALUE];\n    }\n}\n","import {\n    JST,\n    TemplateDelimiters,\n    ITemplateEngine,\n    TemplateScanner,\n    TemplateContext,\n    TemplateWriter,\n    TemplateEscaper,\n} from './interfaces';\nimport { globalSettings } from './internal';\nimport { CacheLocation, clearCache } from './cache';\nimport {\n    PlainObject,\n    isString,\n    typeString,\n} from './utils';\nimport { Scanner } from './scanner';\nimport { Context } from './context';\nimport { Writer } from './writer';\n\n/** [[TemplateEngine]] common settings */\nglobalSettings.writer = new Writer();\n\n/**\n * @en [[TemplateEngine]] global settng options\n * @ja [[TemplateEngine]] ã°ã­ã¼ãã«è¨­å®ãªãã·ã§ã³\n */\nexport interface TemplateGlobalSettings {\n    writer?: TemplateWriter;\n    tags?: TemplateDelimiters;\n    escape?: TemplateEscaper;\n}\n\n/**\n * @en [[TemplateEngine]] compile options\n * @ja [[TemplateEngine]] ã³ã³ãã¤ã«ãªãã·ã§ã³\n */\nexport interface TemplateCompileOptions {\n    tags?: TemplateDelimiters;\n}\n\n/**\n * @en TemplateEngine utility class.\n * @ja TemplateEngine ã¦ã¼ãã£ãªãã£ã¯ã©ã¹\n */\nexport class TemplateEngine implements ITemplateEngine {\n\n///////////////////////////////////////////////////////////////////////\n// public static methods:\n\n    /**\n     * @en Get [[JST]] from template source.\n     * @ja ãã³ãã¬ã¼ãæå­åãã [[JST]] ãåå¾\n     *\n     * @param template\n     *  - `en` template source string\n     *  - `ja` ãã³ãã¬ã¼ãæå­å\n     * @param options\n     *  - `en` compile options\n     *  - `ja` ã³ã³ãã¤ã«ãªãã·ã§ã³\n     */\n    public static compile(template: string, options?: TemplateCompileOptions): JST {\n        if (!isString(template)) {\n            throw new TypeError(`Invalid template! the first argument should be a \"string\" but \"${typeString(template)}\" was given for TemplateEngine.compile(template, options)`);\n        }\n\n        const { tags } = options || globalSettings;\n        const { writer } = globalSettings;\n\n        const jst = (view?: PlainObject, partials?: PlainObject): string => {\n            return writer.render(template, view || {}, partials, tags);\n        };\n\n        const { tokens, cacheKey } = writer.parse(template, tags);\n        jst.tokens        = tokens;\n        jst.cacheKey      = cacheKey;\n        jst.cacheLocation = [CacheLocation.NAMESPACE, CacheLocation.ROOT];\n\n        return jst;\n    }\n\n    /**\n     * @en Clears all cached templates in the default [[TemplateWriter]].\n     * @ja æ¢å®ã® [[TemplateWriter]] ã®ãã¹ã¦ã®ã­ã£ãã·ã¥ãåé¤\n     */\n    public static clearCache(): void {\n        clearCache();\n    }\n\n    /**\n     * @en Change [[TemplateEngine]] global settings.\n     * @ja [[TemplateEngine]] ã°ã­ã¼ãã«è¨­å®ã®æ´æ°\n     *\n     * @param settings\n     *  - `en` new settings\n     *  - `ja` æ°ããè¨­å®å¤\n     * @returns\n     *  - `en` old settings\n     *  - `ja` å¤ãè¨­å®å¤\n     */\n    public static setGlobalSettings(setiings: TemplateGlobalSettings): TemplateGlobalSettings {\n        const oldSettings = { ...globalSettings };\n        const { writer, tags, escape } = setiings;\n        writer && (globalSettings.writer = writer);\n        tags   && (globalSettings.tags   = tags);\n        escape && (globalSettings.escape = escape);\n        return oldSettings;\n    }\n\n///////////////////////////////////////////////////////////////////////\n// public static methods: for debug\n\n    /** @internal Create [[TemplateScanner]] instance */\n    public static createScanner(src: string): TemplateScanner {\n        return new Scanner(src);\n    }\n\n    /** @internal Create [[TemplateContext]] instance */\n    public static createContext(view: PlainObject, parentContext?: Context): TemplateContext {\n        return new Context(view, parentContext);\n    }\n\n    /** @internal Create [[TemplateWriter]] instance */\n    public static createWriter(): TemplateWriter {\n        return new Writer();\n    }\n}\n","import { CancelTokenSource } from './cancel-token';\nimport { wait } from './utils';\n\n/**\n * @en The class manages lumping multiple `Promise` objects. <br>\n *     It's possible to make them cancel more than one `Promise` which handles different [[CancelToken]] by lumping.\n * @ja è¤æ° `Promise` ãªãã¸ã§ã¯ããä¸æ¬ç®¡çããã¯ã©ã¹ <br>\n *     ç°ãªã [[CancelToken]] ãæ±ãè¤æ°ã® `Promise` ãä¸æ¬ã§ã­ã£ã³ã»ã«ããããã¨ãå¯è½\n */\nexport class PromiseManager {\n    // eslint-disable-next-line func-call-spacing\n    private readonly _pool = new Map<Promise<unknown>, ((reason: unknown) => unknown) | undefined>();\n\n    /**\n     * @en Add a `Promise` object under the management.\n     * @ja `Promise` ãªãã¸ã§ã¯ããç®¡çä¸ã«è¿½å \n     *\n     * @param promise\n     *  - `en` any `Promise` instance is available.\n     *  - `ja` ä»»æã® `Promise` ã¤ã³ã¹ã¿ã³ã¹\n     * @param cancelSource\n     *  - `en` [[CancelTokenSource]] instance made by `CancelToken.source()`.\n     *  - `ja` `CancelToken.source()` ã§çæããã [[CancelTokenSource]] ã¤ã³ã¹ã¿ã³ã¹\n     * @returns\n     *  - `en` return the same instance of input `promise` instance.\n     *  - `ja` å¥åãã `promise` ã¨åä¸ã¤ã³ã¹ã¿ã³ã¹ãè¿å´\n     */\n    public add<T>(promise: Promise<T>, cancelSource?: CancelTokenSource): Promise<T> {\n        this._pool.set(promise, cancelSource && cancelSource.cancel); // eslint-disable-line @typescript-eslint/unbound-method\n\n        const always = (): void => {\n            this._pool.delete(promise);\n            if (cancelSource) {\n                cancelSource.close();\n            }\n        };\n\n        promise\n            .then(always, always);\n\n        return promise;\n    }\n\n    /**\n     * @en Released all instances under the management.\n     * @ja ç®¡çå¯¾è±¡ãç ´æ£\n     */\n    public release(): void {\n        this._pool.clear();\n    }\n\n    /**\n     * @en Return `promise` array from under the management.\n     * @ja ç®¡çå¯¾è±¡ã® Promise ãéåã§åå¾\n     */\n    public promises(): Promise<unknown>[] {\n        return [...this._pool.keys()];\n    }\n\n    /**\n     * @en Call `Promise.all()` for under the management. <br>\n     *     Wait for all `fullfilled`.\n     * @ja ç®¡çå¯¾è±¡ã«å¯¾ãã¦ `Promise.all()` <br>\n     *     ãã¹ã¦ã `fullfilled` ã«ãªãã¾ã§å¾æ©\n     */\n    public all(): Promise<unknown[]> {\n        return Promise.all(this.promises());\n    }\n\n    /**\n     * @en Call `Promise.race()` for under the management. <br>\n     *     Wait for any `settled`.\n     * @ja ç®¡çå¯¾è±¡ã«å¯¾ãã¦ `Promise.race()` <br>\n     *     ããããã `settled` ã«ãªãã¾ã§å¾æ©\n     */\n    public race(): Promise<unknown> {\n        return Promise.race(this.promises());\n    }\n\n    /**\n     * @en Call [[wait]]() for under the management. <br>\n     *     Wait for all `settled`. (simplified version)\n     * @ja ç®¡çå¯¾è±¡ã«å¯¾ãã¦ [[wait]]() <br>\n     *     ãã¹ã¦ã `settled` ã«ãªãã¾ã§å¾æ© (ç°¡æãã¼ã¸ã§ã³)\n     */\n    public wait(): Promise<unknown[]> {\n        return wait(this.promises());\n    }\n\n    /**\n     * @en Call `Promise.allSettled()` for under the management. <br>\n     *     Wait for all `settled`.\n     * @ja ç®¡çå¯¾è±¡ã«å¯¾ãã¦ `Promise.allSettled()` <br>\n     *     ãã¹ã¦ã `settled` ã«ãªãã¾ã§å¾æ©\n     */\n    public allSettled(): Promise<PromiseSettledResult<unknown>[]> {\n        return Promise.allSettled(this.promises());\n    }\n\n    /**\n     * @en Call `Promise.any()` for under the management. <br>\n     *     Wait for any `fullfilled`.\n     * @ja ç®¡çå¯¾è±¡ã«å¯¾ãã¦ `Promise.any()` <br>\n     *     ããããã `fullfilled` ã«ãªãã¾ã§å¾æ©\n     */\n    public any(): Promise<unknown> {\n        return Promise.any(this.promises());\n    }\n\n    /**\n     * @en Invoke `cancel` message for under the management promises.\n     * @ja ç®¡çå¯¾è±¡ã® `Promise` ã«å¯¾ãã¦ã­ã£ã³ã»ã«ãçºè¡\n     *\n     * @param reason\n     *  - `en` arguments for `cancelSource`\n     *  - `ja` `cancelSource` ã«æ¸¡ãããå¼æ°\n     * @returns\n     *  - `en` `Promise` instance which wait by until cancellation completion.\n     *  - `ja` ã­ã£ã³ã»ã«å®äºã¾ã§å¾æ©ãã [[Promise]] ã¤ã³ã¹ã¿ã³ã¹\n     */\n    public abort<T>(reason?: T): Promise<unknown[]> {\n        for (const canceler of this._pool.values()) {\n            if (canceler) {\n                canceler(\n                    (null != reason) ? reason : new Error('abort')\n                );\n            }\n        }\n        return wait(this.promises());\n    }\n}\n","/* eslint-disable\n    @typescript-eslint/no-explicit-any,\n */\n\nimport {\n    post,\n    deepEqual,\n    deepCopy,\n    dropUndefined,\n} from '@cdp/core-utils';\nimport { EventPublisher } from '@cdp/events';\nimport {\n    StorageData,\n    IStorage,\n    IStorageOptions,\n    IStorageFormatOptions,\n    RegistrySchemaBase,\n    RegistryEvent,\n    RegistryReadOptions,\n    RegistryWriteOptions,\n    RegistrySaveOptions,\n} from './interfaces';\n\n/**\n * @en Registry management class for synchronous Read/Write accessible from any [[IStorage]] object.\n * @ja ä»»æã® [[IStorage]] ãªãã¸ã§ã¯ãããåæ Read/Write ã¢ã¯ã»ã¹å¯è½ãªã¬ã¸ã¹ããªç®¡çã¯ã©ã¹\n *\n * @example <br>\n *\n * ```ts\n * // 1. define registry schema\n * interface Schema extends RegistrySchemaBase {\n *    'common/mode': 'normal' | 'specified';\n *    'common/value': number;\n *    'trade/local': { unit: 'å' | '$'; rate: number; };\n *    'trade/check': boolean;\n *    'extra/user': string;\n * }\n *\n * // 2. prepare IStorage instance\n * // ex\n * import { webStorage } from '@cdp/web-storage';\n *\n * // 3. instantiate this class\n * const reg = new Registry<Schema>(webStorage, '@test');\n *\n * // 4. read example\n * const val = reg.read('common/mode'); // 'normal' | 'specified' | null\n *\n * // 5. write example\n * reg.write('common/mode', 'specified');\n * // reg.write('common/mode', 'hoge'); // compile error\n * ```\n */\nexport class Registry<T extends RegistrySchemaBase = any> extends EventPublisher<RegistryEvent<T>> {\n\n    /** @internal */\n    private readonly _storage: IStorage;\n    /** @internal */\n    private readonly _rootKey: string;\n    /** @internal */\n    private readonly _defaultOptions: IStorageFormatOptions;\n    /** @internal */\n    private _store: StorageData = {};\n\n    /**\n     * constructor\n     *\n     * @param storage\n     *  - `en` Root key for [[IStorage]].\n     *  - `ja` [[IStorage]] ã«ä½¿ç¨ããã«ã¼ãã­ã¼\n     * @param rootKey\n     *  - `en` Root key for [[IStorage]].\n     *  - `ja` [[IStorage]] ã«ä½¿ç¨ããã«ã¼ãã­ã¼\n     * @param formatSpace\n     *  - `en` for JSON format space.\n     *  - `ja` JSON ãã©ã¼ãããã¹ãã¼ã¹ãæå®\n     */\n    constructor(storage: IStorage<any>, rootKey: string, formatSpace?: number) {\n        super();\n        this._storage = storage;\n        this._rootKey = rootKey;\n        this._defaultOptions = { jsonSpace: formatSpace };\n    }\n\n    /**\n     * @en Access to root key.\n     * @ja ã«ã¼ãã­ã¼ãåå¾\n     */\n    get rootKey(): string {\n        return this._rootKey;\n    }\n\n    /**\n     * @en Access to [[IStorage]] object.\n     * @ja [[IStorage]] ãªãã¸ã§ã¯ããåå¾\n     */\n    get storage(): IStorage<any> {\n        return this._storage;\n    }\n\n///////////////////////////////////////////////////////////////////////\n// public methods:\n\n    /**\n     * @en Read persistence data from [[IStorage]]. The data loaded already will be cleared.\n     * @ja [[IStorage]] ããæ°¸ç¶åãããã¼ã¿ãèª­ã¿è¾¼ã¿. ãã§ã«ã­ã£ãã·ã¥ããã¦ãããã¼ã¿ã¯ç ´æ£ããã\n     */\n    public async load(options?: IStorageOptions): Promise<void> {\n        options = options || {};\n        this._store = (await this._storage.getItem(this._rootKey, options)) || {};\n        if (!options.silent) {\n            void post(() => this.publish('change', '*'));\n        }\n    }\n\n    /**\n     * @en Persist data to [[IStorage]].\n     * @ja [[IStorage]] ã«ãã¼ã¿ãæ°¸ç¶å\n     */\n    public async save(options?: RegistrySaveOptions): Promise<void> {\n        const opts: RegistrySaveOptions = { ...this._defaultOptions, ...options };\n        if (!opts.silent) {\n            this.publish('will-save');\n        }\n        await this._storage.setItem(this._rootKey, this._store, opts);\n    }\n\n    /**\n     * @en Read registry value.\n     * @ja ã¬ã¸ã¹ããªå¤ã®èª­ã¿åã\n     *\n     * @param key\n     *  - `en` target registry key.\n     *  - `ja` å¯¾è±¡ã®ã¬ã¸ã¹ããªã­ã¼ãæå®\n     * @param options\n     *  - `en` read options.\n     *  - `ja` èª­ã¿åããªãã·ã§ã³ãæå®\n     */\n    public read<K extends keyof T>(key: K, options?: RegistryReadOptions): T[K] | null {\n        const { field } = options || {};\n        const structure = String(key).split('/');\n        const lastKey = structure.pop() as string;\n\n        let name: string | undefined;\n        let reg = this.targetRoot(field);\n\n        while (name = structure.shift()) { // eslint-disable-line no-cond-assign\n            if (!(name in reg)) {\n                return null;\n            }\n            reg = reg[name] as StorageData;\n        }\n\n        // return deep copy\n        return (null != reg[lastKey]) ? deepCopy(reg[lastKey]) as any : null;\n    }\n\n    /**\n     * @en Write registry value.\n     * @ja ã¬ã¸ã¹ããªå¤ã®æ¸ãè¾¼ã¿\n     *\n     * @param key\n     *  - `en` target registry key.\n     *  - `ja` å¯¾è±¡ã®ã¬ã¸ã¹ããªã­ã¼ãæå®\n     * @param value\n     *  - `en` update value. if `null` set to delete.\n     *  - `ja` æ´æ°ããå¤. `null` ã¯åé¤\n     * @param options\n     *  - `en` write options.\n     *  - `ja` æ¸ãè¾¼ã¿ãªãã·ã§ã³ãæå®\n     */\n    public write<K extends keyof T>(key: K, value: T[K] | null, options?: RegistryWriteOptions): void {\n        const { field, noSave, silent } = options || {};\n        const remove = (null == value);\n        const structure = String(key).split('/');\n        const lastKey = structure.pop() as string;\n\n        let name: string | undefined;\n        let reg = this.targetRoot(field);\n\n        while (name = structure.shift()) { // eslint-disable-line no-cond-assign\n            if (name in reg) {\n                reg = reg[name] as StorageData;\n            } else if (remove) {\n                return; // ãã§ã«è¦ªã­ã¼ããªãããä½ãããªã\n            } else {\n                reg = reg[name] = {};\n            }\n        }\n\n        const newVal = remove ? null : value;\n        const oldVal = dropUndefined(reg[lastKey]);\n        if (deepEqual(oldVal, newVal)) {\n            return; // æ´æ°ãªã\n        } else if (remove) {\n            delete reg[lastKey];\n        } else {\n            reg[lastKey] = deepCopy(newVal) as any;\n        }\n\n        if (!noSave) {\n            // no fire notification\n            void this._storage.setItem(this._rootKey, this._store, { ...this._defaultOptions, ...options });\n        }\n\n        if (!silent) {\n            void post(() => this.publish('change', key, newVal, oldVal as any));\n        }\n    }\n\n    /**\n     * @en Delete registry key.\n     * @ja ã¬ã¸ã¹ããªã­ã¼ã®åé¤\n     *\n     * @param key\n     *  - `en` target registry key.\n     *  - `ja` å¯¾è±¡ã®ã¬ã¸ã¹ããªã­ã¼ãæå®\n     * @param options\n     *  - `en` read options.\n     *  - `ja` æ¸ãè¾¼ã¿ãªãã·ã§ã³ãæå®\n     */\n    public delete<K extends keyof T>(key: K, options?: RegistryWriteOptions): void {\n        this.write(key, null, options);\n    }\n\n    /**\n     * @en Clear all registry.\n     * @ja ã¬ã¸ã¹ããªã®å¨åé¤\n     *\n     * @param options\n     *  - `en` read options.\n     *  - `ja` æ¸ãè¾¼ã¿ãªãã·ã§ã³ãæå®\n     */\n    public clear(options?: RegistryWriteOptions): void {\n        options = options || {};\n        this._store = {};\n        void this._storage.removeItem(this._rootKey, options);\n        if (!options.silent) {\n            this.publish('change', null, null, null);\n        }\n    }\n\n///////////////////////////////////////////////////////////////////////\n// private methods:\n\n    /** @internal get root object */\n    private targetRoot(field?: string): StorageData {\n        if (field) {\n            // ensure [field] object.\n            this._store[field] = this._store[field] || {};\n            return this._store[field] as StorageData;\n        } else {\n            return this._store;\n        }\n    }\n}\n","import { Subscription, EventBroker } from '@cdp/events';\nimport { _internal } from './internal';\n\n/**\n * @en Event observation state definition.\n * @ja ã¤ãã³ãè³¼èª­ç¶æå®ç¾©\n */\nexport const enum ObservableState {\n    /** observable ready */\n    ACTIVE   = 'active',\n    /** NOT observed, but property changes are recorded. */\n    SUSEPNDED = 'suspended',\n    /** NOT observed, and not recording property changes. */\n    DISABLED = 'disabled',\n}\n\n/**\n * @en Observable common interface.\n * @ja Observable å±éã¤ã³ã¿ã¼ãã§ã¤ã¹\n */\nexport interface IObservable {\n    /**\n     * @en Subscrive event(s).\n     * @ja ã¤ãã³ãè³¼èª­è¨­å®\n     */\n    on(...args: unknown[]): Subscription;\n\n    /**\n     * @en Unsubscribe event(s).\n     * @ja ã¤ãã³ãè³¼èª­è§£é¤\n     */\n    off(...args: unknown[]): void;\n\n    /**\n     * @en Suspend or disable the event observation state.\n     * @ja ã¤ãã³ãè³¼èª­ç¶æã®ãµã¹ãã³ã\n     *\n     * @param noRecord\n     *  - `en` `true`: not recording property changes and clear changes. / `false`: property changes are recorded and fired when [[resume]]() callded. (default)\n     *  - `ja` `true`: ãã­ããã£å¤æ´ãè¨é²ãã, ç¾å¨ã®è¨é²ãç ´æ£ / `false`: ãã­ããã£å¤æ´ã¯è¨é²ãã, [[resume]]() æã«çºç«ãã (æ¢å®)\n     */\n    suspend(noRecord?: boolean): this;\n\n    /**\n     * @en Resume the event observation state.\n     * @ja ã¤ãã³ãè³¼èª­ç¶æã®ãªã¸ã¥ã¼ã \n     */\n    resume(): this;\n\n    /**\n     * @en observation state\n     * @ja è³¼èª­å¯è½ç¶æ\n     */\n    getObservableState(): ObservableState;\n}\n\n/**\n * @en Interface able to access to [[EventBroker]] with [[IObservable]].\n * @ja [[IObservable]] ã®æã¤åé¨ [[EventBroker]] ã«ã¢ã¯ã»ã¹å¯è½ãªã¤ã³ã¿ã¼ãã§ã¤ã¹\n */\nexport interface IObservableEventBrokerAccess<T extends object = any> extends IObservable { // eslint-disable-line @typescript-eslint/no-explicit-any\n    /**\n     * @en Get [[EventBroker]] instance.\n     * @ja [[EventBroker]] ã¤ã³ã¹ã¿ã³ã¹ã®åå¾\n     */\n    getBroker(): EventBroker<T>;\n}\n\n/**\n * @en Check the value-type is [[IObservable]].\n * @ja [[IObservable]] åã§ãããå¤å®\n *\n * @param x\n *  - `en` evaluated value\n *  - `ja` è©ä¾¡ããå¤\n */\nexport function isObservable(x: unknown): x is IObservable {\n    return Boolean(x && (x as object)[_internal]);\n}\n"],"mappings":"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"}