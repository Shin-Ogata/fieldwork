/*!
 * @cdp/lib-worker 0.9.20
 *   worker library collection
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@cdp/lib-core")):"function"==typeof define&&define.amd?define(["exports","@cdp/lib-core"],t):(e="undefined"!=typeof globalThis?globalThis:e||self,t(e.CDP=e.CDP||{},e.CDP))}(this,function(e,t){"use strict";const n=t.safe(globalThis.btoa),o=t.safe(globalThis.atob),r=t.safe(globalThis.Blob),a=t.safe(globalThis.FileReader),s=t.safe(globalThis.URL),c=t.safe(globalThis.TextEncoder);class i{static encode(e){const t=(new c).encode(e),o=Array.from(t).map(e=>String.fromCharCode(e)).join("");return n(o)}static decode(e){const t=o(e),n=Uint8Array.from(t,e=>e.charCodeAt(0));return(new TextDecoder).decode(n)}}function u(e,n,o){const{cancel:r,onprogress:s}=o;return r&&t.verify("instanceOf",t.CancelToken,r),s&&t.verify("typeOf","function",s),new Promise((t,o)=>{const c=new a,i=r?.register(()=>{c.abort()});c.onabort=c.onerror=()=>{o(c.error)},c.onprogress=s,c.onload=()=>{t(c.result)},c.onloadend=()=>{i?.unsubscribe()},c[e](...n)},r)}function f(e,t){return u("readAsArrayBuffer",[e],{...t})}function l(e,t){return u("readAsDataURL",[e],{...t})}function d(e,t,n){return u("readAsText",[e,t??void 0],{...n})}function p(e){const t={base64:!1},n=/^data:(.+?\/.+?)?(;.+?)?,(.*)$/.exec(e);if(null==n)throw new Error(`Invalid data-URL: ${e}`);return t.mimeType=n[1],t.base64=/;base64/.test(n[2]),t.data=n[3],t}function b(e){const t=e.split("").map(e=>e.charCodeAt(0));return new Uint8Array(t)}function T(e){return unescape(encodeURIComponent(e))}function m(e){return decodeURIComponent(escape(e))}function R(e,t){return l(e,t)}function y(e,t="application/octet-stream"){return h(new Uint8Array(e),t)}function g(e,t="application/octet-stream"){return new r([e],{type:t})}function h(e,t="application/octet-stream"){return`data:${t};base64,${A(e)}`}function A(e){return i.encode(E(e))}function E(e){return m(function t(e){return Array.prototype.map.call(e,e=>String.fromCharCode(e)).join("")}(e))}function U(e,t="application/octet-stream"){return g(C(e),t)}function C(e){return b(T(i.decode(e)))}function w(e,t="text/plain"){return new r([e],{type:t})}function x(e){return b(T(e))}function O(e){return i.encode(e)}function L(e){const t=p(e);return t.base64?U(t.data,t.mimeType||"application/octet-stream"):w(decodeURIComponent(t.data),t.mimeType||"text/plain")}function D(e){return S(e).buffer}function S(e){return C(B(e))}function B(e){const t=p(e);return t.base64?t.data:i.encode(decodeURIComponent(t.data))}const j=new WeakMap,_=new Set;!function(){let e=CDP_DECLARE.RESULT_CODE;e[e.AJAX_DECLARE=9007199254740991]="AJAX_DECLARE",e[e.ERROR_AJAX_RESPONSE=CDP_DECLARE.DECLARE_ERROR_CODE(100,21,"network error.")]="ERROR_AJAX_RESPONSE",void(e[e.ERROR_AJAX_TIMEOUT=CDP_DECLARE.DECLARE_ERROR_CODE(100,22,"request timeout.")]="ERROR_AJAX_TIMEOUT")}();const v=t.safe(globalThis.FormData),P=t.safe(globalThis.Headers),k=t.safe(globalThis.AbortController),$=t.safe(globalThis.URLSearchParams),N=t.safe(globalThis.XMLHttpRequest),q=t.safe(globalThis.fetch),I=e=>{const n=t.isFunction(e)?e():e;return void 0!==n?String(n):""},X=e=>{const t=[];for(const n of Object.keys(e)){const o=I(e[n]);o&&t.push(`${encodeURIComponent(n)}=${encodeURIComponent(o)}`)}return t.join("&")},J=e=>{const n={};for(const o of Object.keys(e)){const r=I(e[o]);r&&t.assignValue(n,o,r)}return n},M=e=>t.isNumeric(e)?Number(e):"true"===e||"false"!==e&&("null"===e?null:decodeURIComponent(e)),H=(e,n)=>{if(n in e)return t.isFunction(e[n])?e[n].bind(e):e[n]},F=["hasListener","channels","on","off","once"],z=(e,n)=>{let o=0;const[r,a]=e instanceof Blob?[e.stream(),e.size]:[e,null!=n?Math.trunc(n):NaN],s=new t.EventSource,c={get:(e,t)=>{if("read"===t){const t=e.read();return void(async()=>{const{done:e,value:n}=await t;n&&(o+=n.length),s.trigger("progress",Object.freeze({computable:!Number.isNaN(a),loaded:o,total:a,done:e,chunk:n}))})(),()=>t}return H(e,t)}};return new Proxy(r,{get:(e,t)=>"getReader"===t?()=>new Proxy(e.getReader(),c):"length"===t?a:F.includes(t)?(...e)=>s[t](...e):H(e,t)})};let G;const W={get timeout(){return G},set timeout(e){G=t.isNumber(e)&&0<=e?e:void 0}},Q={text:"text/plain, text/html, application/xml; q=0.8, text/xml; q=0.8, */*; q=0.01",json:"application/json, text/javascript, */*; q=0.01"};function V(e){const t=new P(e.headers),{method:n,contentType:o,dataType:r,mode:a,body:s,username:c,password:u}=e;return"POST"!==n&&"PUT"!==n&&"PATCH"!==n||(t.get("Content-Type")&&s instanceof v?t.delete("Content-Type"):t.get("Content-Type")||(null==o&&"json"===r?t.set("Content-Type","application/json; charset=UTF-8"):null!=o&&t.set("Content-Type",o))),t.get("Accept")||t.set("Accept",Q[r]||"*/*"),a&&"cors"!==a&&!t.get("X-Requested-With")&&t.set("X-Requested-With","XMLHttpRequest"),null==c||t.get("Authorization")||t.set("Authorization",`Basic ${i.encode(`${c}:${u??""}`)}`),t}async function K(e,n){const o=new k,r=()=>o.abort(),a=Object.assign({method:"GET",dataType:"response",timeout:W.timeout},n,{signal:o.signal}),{cancel:s,timeout:c}=a;if(s){if(s.requested)throw s.reason;s.register(r)}const i=t.CancelToken.source(s),{token:u}=i;u.register(r),c&&setTimeout(()=>i.cancel(t.makeResult(t.RESULT_CODE.ERROR_AJAX_TIMEOUT,"request timeout")),c),a.method=a.method.toUpperCase(),a.headers=V(a);const{method:f,data:l,dataType:d}=a;null!=l&&("GET"!==f&&"HEAD"!==f||e.includes("?")?a.body??=new $(J(l)):e+=`?${X(l)}`);const p=await Promise.resolve(q(e,a),u);if("response"===d)return p;if(p.ok)return"stream"===d?z(p.body,Number(p.headers.get("content-length"))):Promise.resolve(p[d](),u);throw t.makeResult(t.RESULT_CODE.ERROR_AJAX_RESPONSE,p.statusText,p)}K.settings=W;const Y=e=>e??"json",Z=(e,t,n,o)=>K(e,{...o,method:"GET",data:t,dataType:Y(n)}),ee={get:Z,text:(e,t)=>Z(e,void 0,"text",t),json:(e,t)=>Z(e,void 0,"json",t),blob:(e,t)=>Z(e,void 0,"blob",t),post:(e,t,n,o)=>K(e,{...o,method:"POST",data:t,dataType:Y(n)}),resource:(e,n,o)=>{const r=new N;null==o||e.includes("?")||(e+=`?${X(o)}`),r.open("GET",e,!1);const a=Y(n),s=V({method:"GET",dataType:a});if(s.forEach((e,t)=>{r.setRequestHeader(t,e)}),r.send(null),!(200<=r.status&&r.status<300))throw t.makeResult(t.RESULT_CODE.ERROR_AJAX_RESPONSE,r.statusText,r);return"json"===a?JSON.parse(r.response):r.response}},te=t.safe(globalThis.URL),ne=t.safe(globalThis.Worker),oe=t.safe(globalThis.Blob);class re extends ne{_context;constructor(e,n){const o=function r(e){if(!t.isFunction(e)&&!t.isString(e))throw new TypeError(`${t.className(e)} is not a function or string.`);return te.createObjectURL(new oe([t.isFunction(e)?`(${e.toString()})(self);`:e],{type:"application/javascript"}))}(e);super(o,n),this._context=o}terminate(){super.terminate(),te.revokeObjectURL(this._context)}}e.Base64=i,e.BlobURL=class ae{static create(...e){for(const t of e){const e=j.get(t);if(e)continue;const n=s.createObjectURL(t);j.set(t,n),_.add(n)}}static clear(){for(const e of _)s.revokeObjectURL(e);_.clear()}static get(e){const t=j.get(e);if(t)return t;const n=s.createObjectURL(e);return j.set(e,n),_.add(n),n}static has(e){return j.has(e)}static revoke(...e){for(const t of e){const e=j.get(t);e&&(s.revokeObjectURL(e),j.delete(t),_.delete(e))}}},e.InlineWorker=re,e.ajax=K,e.base64ToBinary=C,e.base64ToBlob=U,e.base64ToBuffer=function se(e){return C(e).buffer},e.base64ToDataURL=function ce(e,t="application/octet-stream"){return`data:${t};base64,${e}`},e.base64ToText=function ie(e){return i.decode(e)},e.binaryToBase64=A,e.binaryToBlob=g,e.binaryToBuffer=function ue(e){return e.buffer},e.binaryToDataURL=h,e.binaryToText=E,e.blobToBase64=async function fe(e,t){return p(await l(e,t)).data},e.blobToBinary=async function le(e,t){return new Uint8Array(await f(e,t))},e.blobToBuffer=function de(e,t){return f(e,t)},e.blobToDataURL=R,e.blobToText=function pe(e,t){const n=t??{},{encoding:o}=n;return d(e,o,n)},e.bufferToBase64=function be(e){return A(new Uint8Array(e))},e.bufferToBinary=function Te(e){return new Uint8Array(e)},e.bufferToBlob=function me(e,t="application/octet-stream"){return new r([e],{type:t})},e.bufferToDataURL=y,e.bufferToText=function Re(e){return E(new Uint8Array(e))},e.convertUrlParamType=M,e.dataURLToBase64=B,e.dataURLToBinary=S,e.dataURLToBlob=L,e.dataURLToBuffer=D,e.dataURLToText=function ye(e){return i.decode(B(e))},e.deserialize=async function ge(e,n){const{dataType:o,cancel:r}=n??{};await t.checkCanceled(r);const a=t.restoreNullish(t.toTypedData(e));switch(o){case"string":return t.fromTypedData(a);case"number":return Number(a);case"boolean":return Boolean(a);case"object":return Object(a);case"buffer":return D(t.fromTypedData(a));case"binary":return S(t.fromTypedData(a));case"blob":return L(t.fromTypedData(a));default:return a}},e.fromBinaryString=m,e.fromHexString=function he(e){const t=e.match(/.{1,2}/g);return new Uint8Array(null!=t?t.map(e=>parseInt(e,16)):[])},e.parseUrlQuery=e=>{const t={},n=new $(e.includes("?")?e.split("?")[1]:e);for(const[e,o]of n)t[decodeURIComponent(e)]=M(o);return t},e.readAsArrayBuffer=f,e.readAsDataURL=l,e.readAsText=d,e.request=ee,e.serialize=async function Ae(e,n){const{cancel:o}=n??{};return await t.checkCanceled(o),null==e?String(e):e instanceof ArrayBuffer?y(e):e instanceof Uint8Array?h(e):e instanceof r?R(e,n):t.fromTypedData(e)},e.setupHeaders=V,e.textToBase64=O,e.textToBinary=x,e.textToBlob=w,e.textToBuffer=function Ee(e){return x(e).buffer},e.textToDataURL=function Ue(e,t="text/plain"){const n=O(e);return`data:${t};base64,${n}`},e.thread=function Ce(e,n){const{cancel:o,args:r}=Object.assign({args:[]},n);if(o?.requested)throw o.reason;const a=`(self => {\n        self.addEventListener('message', async ({ data }) => {\n            try {\n                const result = await (${e.toString()})(...data);\n                self.postMessage(result);\n            } catch (e) {\n                setTimeout(function() { throw e; });\n            }\n        });\n    })(self);`,s=new re(a,n);o?.register(()=>s.terminate());const{token:c}=t.CancelToken.source(o),i=new Promise((e,t)=>{s.onerror=e=>{e.preventDefault(),t(e),s.terminate()},s.onmessage=t=>{e(t.data),s.terminate()}},c);return s.postMessage(r),i},e.toAjaxDataStream=z,e.toAjaxParams=J,e.toBinaryString=T,e.toHexString=function we(e){return e.reduce((e,t)=>e+t.toString(16).toUpperCase().padStart(2,"0"),"")},e.toQueryStrings=X,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=lib-worker.min.map