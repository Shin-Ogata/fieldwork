/*!
 * @cdp/lib-worker 0.9.10
 *   worker library collection
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@cdp/lib-core")):"function"==typeof define&&define.amd?define(["exports","@cdp/lib-core"],t):(e="undefined"!=typeof globalThis?globalThis:e||self,t(e.CDP=e.CDP||{},e.CDP))}(this,(function(e,t){"use strict";const n=t.safe(globalThis.btoa),o=t.safe(globalThis.atob),r=t.safe(globalThis.Blob),a=t.safe(globalThis.FileReader),s=t.safe(globalThis.URL);class c{static encode(e){return n(unescape(encodeURIComponent(e)))}static decode(e){return decodeURIComponent(escape(o(e)))}}function i(e,n,o){const{cancel:r,onprogress:s}=o;return r&&t.verify("instanceOf",t.CancelToken,r),s&&t.verify("typeOf","function",s),new Promise(((t,o)=>{const c=new a,i=r&&r.register((()=>{c.abort()}));c.onabort=c.onerror=()=>{o(c.error)},c.onprogress=s,c.onload=()=>{t(c.result)},c.onloadend=()=>{i&&i.unsubscribe()},c[e](...n)}),r)}function u(e,t){return i("readAsArrayBuffer",[e],{...t})}function f(e,t){return i("readAsDataURL",[e],{...t})}function l(e,t,n){return i("readAsText",[e,t||void 0],{...n})}function d(e){const t={base64:!1},n=/^data:(.+?\/.+?)?(;.+?)?,(.*)$/.exec(e);if(null==n)throw new Error(`Invalid data-URL: ${e}`);return t.mimeType=n[1],t.base64=/;base64/.test(n[2]),t.data=n[3],t}function p(e){const t=e.split("").map((e=>e.charCodeAt(0)));return new Uint8Array(t)}function T(e){return unescape(encodeURIComponent(e))}function b(e){return decodeURIComponent(escape(e))}function R(e,t){return f(e,t)}function m(e,t="application/octet-stream"){return g(new Uint8Array(e),t)}function y(e,t="application/octet-stream"){return new r([e],{type:t})}function g(e,t="application/octet-stream"){return`data:${t};base64,${h(e)}`}function h(e){return c.encode(E(e))}function E(e){return b(function t(e){return Array.prototype.map.call(e,(e=>String.fromCharCode(e))).join("")}(e))}function A(e,t="application/octet-stream"){return y(U(e),t)}function U(e){return p(T(c.decode(e)))}function C(e,t="text/plain"){return new r([e],{type:t})}function O(e){return p(T(e))}function w(e){return c.encode(e)}function x(e){const t=d(e);return t.base64?A(t.data,t.mimeType||"application/octet-stream"):C(decodeURIComponent(t.data),t.mimeType||"text/plain")}function L(e){return D(e).buffer}function D(e){return U(_(e))}function _(e){const t=d(e);return t.base64?t.data:c.encode(decodeURIComponent(t.data))}const B=new WeakMap,S=new Set;!function(){let e=CDP_DECLARE.RESULT_CODE;e[e.AJAX_DECLARE=9007199254740991]="AJAX_DECLARE",e[e.ERROR_AJAX_RESPONSE=CDP_DECLARE.DECLARE_ERROR_CODE(100,21,"network error.")]="ERROR_AJAX_RESPONSE",void(e[e.ERROR_AJAX_TIMEOUT=CDP_DECLARE.DECLARE_ERROR_CODE(100,22,"request timeout.")]="ERROR_AJAX_TIMEOUT")}();const j=t.safe(globalThis.FormData),k=t.safe(globalThis.Headers),P=t.safe(globalThis.AbortController),v=t.safe(globalThis.URLSearchParams),$=t.safe(globalThis.XMLHttpRequest),q=t.safe(globalThis.fetch);let I;const X={get timeout(){return I},set timeout(e){I=t.isNumber(e)&&0<=e?e:void 0}},J={text:"text/plain, text/html, application/xml; q=0.8, text/xml; q=0.8, */*; q=0.01",json:"application/json, text/javascript, */*; q=0.01"};function H(e){const t=new k(e.headers),{method:n,contentType:o,dataType:r,mode:a,body:s,username:i,password:u}=e;return"POST"!==n&&"PUT"!==n&&"PATCH"!==n||(t.get("Content-Type")&&s instanceof j?t.delete("Content-Type"):t.get("Content-Type")||(null==o&&"json"===r?t.set("Content-Type","application/json; charset=UTF-8"):null!=o&&t.set("Content-Type",o))),t.get("Accept")||t.set("Accept",J[r]||"*/*"),"cors"===a||t.get("X-Requested-With")||t.set("X-Requested-With","XMLHttpRequest"),null==i||t.get("Authorization")||t.set("Authorization",`Basic ${c.encode(`${i}:${u||""}`)}`),t}function M(e){const n=t.isFunction(e)?e():e;return void 0!==n?String(n):""}function N(e){const t=[];for(const n of Object.keys(e)){const o=M(e[n]);o&&t.push(`${encodeURIComponent(n)}=${encodeURIComponent(o)}`)}return t.join("&")}function F(e){const t={};for(const n of Object.keys(e)){const o=M(e[n]);o&&(t[n]=o)}return t}async function z(e,n){const o=new P,r=()=>o.abort(),a=Object.assign({method:"GET",dataType:"response",timeout:X.timeout},n,{signal:o.signal}),{cancel:s,timeout:c}=a;if(s){if(s.requested)throw s.reason;s.register(r)}const i=t.CancelToken.source(s),{token:u}=i;u.register(r),c&&setTimeout((()=>i.cancel(t.makeResult(t.RESULT_CODE.ERROR_AJAX_TIMEOUT,"request timeout"))),c),a.method=a.method.toUpperCase(),a.headers=H(a);const{method:f,data:l,dataType:d}=a;null!=l&&("GET"!==f&&"HEAD"!==f||e.includes("?")?null==a.body&&(a.body=new v(F(l))):e+=`?${N(l)}`);const p=await Promise.resolve(q(e,a),u);if("response"===d)return p;if(p.ok)return Promise.resolve(p[d](),u);throw t.makeResult(t.RESULT_CODE.ERROR_AJAX_RESPONSE,p.statusText,p)}function G(e){return e||"json"}function W(e,t,n,o){return z(e,{...o,method:"GET",data:t,dataType:G(n)})}z.settings=X;const Q=Object.freeze({__proto__:null,get:W,text:function K(e,t,n){return W(e,t,"text",n)},json:function V(e,t,n){return W(e,t,"json",n)},blob:function Y(e,t,n){return W(e,t,"blob",n)},post:function Z(e,t,n,o){return z(e,{...o,method:"POST",data:t,dataType:G(n)})},resource:function ee(e,n,o){const r=new $;null==o||e.includes("?")||(e+=`?${N(o)}`),r.open("GET",e,!1);const a=G(n),s=H({method:"GET",dataType:a});if(s.forEach(((e,t)=>{r.setRequestHeader(t,e)})),r.send(null),!(200<=r.status&&r.status<300))throw t.makeResult(t.RESULT_CODE.ERROR_AJAX_RESPONSE,r.statusText,r);return"json"===a?JSON.parse(r.response):r.response}}),te=t.safe(globalThis.URL),ne=t.safe(globalThis.Worker),oe=t.safe(globalThis.Blob);class re extends ne{constructor(e,n){const o=function r(e){if(!t.isFunction(e)&&!t.isString(e))throw new TypeError(`${t.className(e)} is not a function or string.`);return te.createObjectURL(new oe([t.isFunction(e)?`(${e.toString()})(self);`:e],{type:"application/javascript"}))}(e);super(o,n),this._context=o}terminate(){super.terminate(),te.revokeObjectURL(this._context)}}e.Base64=c,e.BlobURL=class ae{static create(...e){for(const t of e){const e=B.get(t);if(e)continue;const n=s.createObjectURL(t);B.set(t,n),S.add(n)}}static clear(){for(const e of S)s.revokeObjectURL(e);S.clear()}static get(e){const t=B.get(e);if(t)return t;const n=s.createObjectURL(e);return B.set(e,n),S.add(n),n}static has(e){return B.has(e)}static revoke(...e){for(const t of e){const e=B.get(t);e&&(s.revokeObjectURL(e),B.delete(t),S.delete(e))}}},e.InlineWorker=re,e.ajax=z,e.base64ToBinary=U,e.base64ToBlob=A,e.base64ToBuffer=function se(e){return U(e).buffer},e.base64ToDataURL=function ce(e,t="application/octet-stream"){return`data:${t};base64,${e}`},e.base64ToText=function ie(e){return c.decode(e)},e.binaryToBase64=h,e.binaryToBlob=y,e.binaryToBuffer=function ue(e){return e.buffer},e.binaryToDataURL=g,e.binaryToText=E,e.blobToBase64=async function fe(e,t){return d(await f(e,t)).data},e.blobToBinary=async function le(e,t){return new Uint8Array(await u(e,t))},e.blobToBuffer=function de(e,t){return u(e,t)},e.blobToDataURL=R,e.blobToText=function pe(e,t){const n=t||{},{encoding:o}=n;return l(e,o,n)},e.bufferToBase64=function Te(e){return h(new Uint8Array(e))},e.bufferToBinary=function be(e){return new Uint8Array(e)},e.bufferToBlob=function Re(e,t="application/octet-stream"){return new r([e],{type:t})},e.bufferToDataURL=m,e.bufferToText=function me(e){return E(new Uint8Array(e))},e.dataURLToBase64=_,e.dataURLToBinary=D,e.dataURLToBlob=x,e.dataURLToBuffer=L,e.dataURLToText=function ye(e){return c.decode(_(e))},e.deserialize=async function ge(e,n){const{dataType:o,cancel:r}=n||{};await t.checkCanceled(r);const a=t.restoreNil(t.toTypedData(e));switch(o){case"string":return t.fromTypedData(a);case"number":return Number(a);case"boolean":return Boolean(a);case"object":return Object(a);case"buffer":return L(t.fromTypedData(a));case"binary":return D(t.fromTypedData(a));case"blob":return x(t.fromTypedData(a));default:return a}},e.fromBinaryString=b,e.fromHexString=function he(e){const t=e.match(/.{1,2}/g);return new Uint8Array(null!=t?t.map((e=>parseInt(e,16))):[])},e.readAsArrayBuffer=u,e.readAsDataURL=f,e.readAsText=l,e.request=Q,e.serialize=async function Ee(e,n){const{cancel:o}=n||{};return await t.checkCanceled(o),null==e?String(e):e instanceof ArrayBuffer?m(e):e instanceof Uint8Array?g(e):e instanceof r?R(e,n):t.fromTypedData(e)},e.setupHeaders=H,e.textToBase64=w,e.textToBinary=O,e.textToBlob=C,e.textToBuffer=function Ae(e){return O(e).buffer},e.textToDataURL=function Ue(e,t="text/plain"){const n=w(e);return`data:${t};base64,${n}`},e.thread=function Ce(e,n){const{cancel:o,args:r}=Object.assign({args:[]},n);if(o?.requested)throw o.reason;const a=`(self => {\n        self.addEventListener('message', async ({ data }) => {\n            try {\n                const result = await (${e.toString()})(...data);\n                self.postMessage(result);\n            } catch (e) {\n                setTimeout(function() { throw e; });\n            }\n        });\n    })(self);`,s=new re(a,n);o?.register((()=>s.terminate()));const{token:c}=t.CancelToken.source(o),i=new Promise(((e,t)=>{s.onerror=e=>{e.preventDefault(),t(e),s.terminate()},s.onmessage=t=>{e(t.data),s.terminate()}}),c);return s.postMessage(r),i},e.toAjaxParams=F,e.toBinaryString=T,e.toHexString=function Oe(e){return e.reduce(((e,t)=>e+t.toString(16).toUpperCase().padStart(2,"0")),"")},e.toQueryStrings=N,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=lib-worker.min.map