/*!
 * @cdp/lib-worker 0.9.17
 *   worker library collection
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@cdp/lib-core")):"function"==typeof define&&define.amd?define(["exports","@cdp/lib-core"],t):(e="undefined"!=typeof globalThis?globalThis:e||self,t(e.CDP=e.CDP||{},e.CDP))}(this,(function(e,t){"use strict";const n=t.safe(globalThis.btoa),o=t.safe(globalThis.atob),r=t.safe(globalThis.Blob),a=t.safe(globalThis.FileReader),s=t.safe(globalThis.URL);class c{static encode(e){return n(unescape(encodeURIComponent(e)))}static decode(e){return decodeURIComponent(escape(o(e)))}}function i(e,n,o){const{cancel:r,onprogress:s}=o;return r&&t.verify("instanceOf",t.CancelToken,r),s&&t.verify("typeOf","function",s),new Promise(((t,o)=>{const c=new a,i=r?.register((()=>{c.abort()}));c.onabort=c.onerror=()=>{o(c.error)},c.onprogress=s,c.onload=()=>{t(c.result)},c.onloadend=()=>{i&&i.unsubscribe()},c[e](...n)}),r)}function u(e,t){return i("readAsArrayBuffer",[e],{...t})}function l(e,t){return i("readAsDataURL",[e],{...t})}function f(e,t,n){return i("readAsText",[e,t??void 0],{...n})}function d(e){const t={base64:!1},n=/^data:(.+?\/.+?)?(;.+?)?,(.*)$/.exec(e);if(null==n)throw new Error(`Invalid data-URL: ${e}`);return t.mimeType=n[1],t.base64=/;base64/.test(n[2]),t.data=n[3],t}function p(e){const t=e.split("").map((e=>e.charCodeAt(0)));return new Uint8Array(t)}function b(e){return unescape(encodeURIComponent(e))}function T(e){return decodeURIComponent(escape(e))}function m(e,t){return l(e,t)}function R(e,t="application/octet-stream"){return g(new Uint8Array(e),t)}function y(e,t="application/octet-stream"){return new r([e],{type:t})}function g(e,t="application/octet-stream"){return`data:${t};base64,${h(e)}`}function h(e){return c.encode(E(e))}function E(e){return T(function t(e){return Array.prototype.map.call(e,(e=>String.fromCharCode(e))).join("")}(e))}function U(e,t="application/octet-stream"){return y(A(e),t)}function A(e){return p(b(c.decode(e)))}function C(e,t="text/plain"){return new r([e],{type:t})}function w(e){return p(b(e))}function x(e){return c.encode(e)}function O(e){const t=d(e);return t.base64?U(t.data,t.mimeType||"application/octet-stream"):C(decodeURIComponent(t.data),t.mimeType||"text/plain")}function L(e){return D(e).buffer}function D(e){return A(S(e))}function S(e){const t=d(e);return t.base64?t.data:c.encode(decodeURIComponent(t.data))}const B=new WeakMap,j=new Set;!function(){let e=CDP_DECLARE.RESULT_CODE;e[e.AJAX_DECLARE=9007199254740991]="AJAX_DECLARE",e[e.ERROR_AJAX_RESPONSE=CDP_DECLARE.DECLARE_ERROR_CODE(100,21,"network error.")]="ERROR_AJAX_RESPONSE",void(e[e.ERROR_AJAX_TIMEOUT=CDP_DECLARE.DECLARE_ERROR_CODE(100,22,"request timeout.")]="ERROR_AJAX_TIMEOUT")}();const _=t.safe(globalThis.FormData),v=t.safe(globalThis.Headers),P=t.safe(globalThis.AbortController),k=t.safe(globalThis.URLSearchParams),$=t.safe(globalThis.XMLHttpRequest),N=t.safe(globalThis.fetch),I=e=>{const n=t.isFunction(e)?e():e;return void 0!==n?String(n):""},q=e=>{const t=[];for(const n of Object.keys(e)){const o=I(e[n]);o&&t.push(`${encodeURIComponent(n)}=${encodeURIComponent(o)}`)}return t.join("&")},X=e=>{const n={};for(const o of Object.keys(e)){const r=I(e[o]);r&&t.assignValue(n,o,r)}return n},J=e=>t.isNumeric(e)?Number(e):"true"===e||"false"!==e&&("null"===e?null:decodeURIComponent(e)),M=(e,n)=>{if(n in e)return t.isFunction(e[n])?e[n].bind(e):e[n]},H=["hasListener","channels","on","off","once"],F=(e,n)=>{let o=0;const[r,a]=e instanceof Blob?[e.stream(),e.size]:[e,null!=n?Math.trunc(n):NaN],s=new t.EventSource,c={get:(e,t)=>{if("read"===t){const t=e.read();return void(async()=>{const{done:e,value:n}=await t;n&&(o+=n.length),s.trigger("progress",Object.freeze({computable:!Number.isNaN(a),loaded:o,total:a,done:e,chunk:n}))})(),()=>t}return M(e,t)}};return new Proxy(r,{get:(e,t)=>"getReader"===t?()=>new Proxy(e.getReader(),c):"length"===t?a:H.includes(t)?(...e)=>s[t](...e):M(e,t)})};let z;const G={get timeout(){return z},set timeout(e){z=t.isNumber(e)&&0<=e?e:void 0}},W={text:"text/plain, text/html, application/xml; q=0.8, text/xml; q=0.8, */*; q=0.01",json:"application/json, text/javascript, */*; q=0.01"};function Q(e){const t=new v(e.headers),{method:n,contentType:o,dataType:r,mode:a,body:s,username:i,password:u}=e;return"POST"!==n&&"PUT"!==n&&"PATCH"!==n||(t.get("Content-Type")&&s instanceof _?t.delete("Content-Type"):t.get("Content-Type")||(null==o&&"json"===r?t.set("Content-Type","application/json; charset=UTF-8"):null!=o&&t.set("Content-Type",o))),t.get("Accept")||t.set("Accept",W[r]||"*/*"),a&&"cors"!==a&&!t.get("X-Requested-With")&&t.set("X-Requested-With","XMLHttpRequest"),null==i||t.get("Authorization")||t.set("Authorization",`Basic ${c.encode(`${i}:${u??""}`)}`),t}async function V(e,n){const o=new P,r=()=>o.abort(),a=Object.assign({method:"GET",dataType:"response",timeout:G.timeout},n,{signal:o.signal}),{cancel:s,timeout:c}=a;if(s){if(s.requested)throw s.reason;s.register(r)}const i=t.CancelToken.source(s),{token:u}=i;u.register(r),c&&setTimeout((()=>i.cancel(t.makeResult(t.RESULT_CODE.ERROR_AJAX_TIMEOUT,"request timeout"))),c),a.method=a.method.toUpperCase(),a.headers=Q(a);const{method:l,data:f,dataType:d}=a;null!=f&&("GET"!==l&&"HEAD"!==l||e.includes("?")?null==a.body&&(a.body=new k(X(f))):e+=`?${q(f)}`);const p=await Promise.resolve(N(e,a),u);if("response"===d)return p;if(p.ok)return"stream"===d?F(p.body,Number(p.headers.get("content-length"))):Promise.resolve(p[d](),u);throw t.makeResult(t.RESULT_CODE.ERROR_AJAX_RESPONSE,p.statusText,p)}V.settings=G;const K=e=>e??"json",Y=(e,t,n,o)=>V(e,{...o,method:"GET",data:t,dataType:K(n)}),Z={get:Y,text:(e,t)=>Y(e,void 0,"text",t),json:(e,t)=>Y(e,void 0,"json",t),blob:(e,t)=>Y(e,void 0,"blob",t),post:(e,t,n,o)=>V(e,{...o,method:"POST",data:t,dataType:K(n)}),resource:(e,n,o)=>{const r=new $;null==o||e.includes("?")||(e+=`?${q(o)}`),r.open("GET",e,!1);const a=K(n),s=Q({method:"GET",dataType:a});if(s.forEach(((e,t)=>{r.setRequestHeader(t,e)})),r.send(null),!(200<=r.status&&r.status<300))throw t.makeResult(t.RESULT_CODE.ERROR_AJAX_RESPONSE,r.statusText,r);return"json"===a?JSON.parse(r.response):r.response}},ee=t.safe(globalThis.URL),te=t.safe(globalThis.Worker),ne=t.safe(globalThis.Blob);class oe extends te{_context;constructor(e,n){const o=function r(e){if(!t.isFunction(e)&&!t.isString(e))throw new TypeError(`${t.className(e)} is not a function or string.`);return ee.createObjectURL(new ne([t.isFunction(e)?`(${e.toString()})(self);`:e],{type:"application/javascript"}))}(e);super(o,n),this._context=o}terminate(){super.terminate(),ee.revokeObjectURL(this._context)}}e.Base64=c,e.BlobURL=class re{static create(...e){for(const t of e){const e=B.get(t);if(e)continue;const n=s.createObjectURL(t);B.set(t,n),j.add(n)}}static clear(){for(const e of j)s.revokeObjectURL(e);j.clear()}static get(e){const t=B.get(e);if(t)return t;const n=s.createObjectURL(e);return B.set(e,n),j.add(n),n}static has(e){return B.has(e)}static revoke(...e){for(const t of e){const e=B.get(t);e&&(s.revokeObjectURL(e),B.delete(t),j.delete(e))}}},e.InlineWorker=oe,e.ajax=V,e.base64ToBinary=A,e.base64ToBlob=U,e.base64ToBuffer=function ae(e){return A(e).buffer},e.base64ToDataURL=function se(e,t="application/octet-stream"){return`data:${t};base64,${e}`},e.base64ToText=function ce(e){return c.decode(e)},e.binaryToBase64=h,e.binaryToBlob=y,e.binaryToBuffer=function ie(e){return e.buffer},e.binaryToDataURL=g,e.binaryToText=E,e.blobToBase64=async function ue(e,t){return d(await l(e,t)).data},e.blobToBinary=async function le(e,t){return new Uint8Array(await u(e,t))},e.blobToBuffer=function fe(e,t){return u(e,t)},e.blobToDataURL=m,e.blobToText=function de(e,t){const n=t??{},{encoding:o}=n;return f(e,o,n)},e.bufferToBase64=function pe(e){return h(new Uint8Array(e))},e.bufferToBinary=function be(e){return new Uint8Array(e)},e.bufferToBlob=function Te(e,t="application/octet-stream"){return new r([e],{type:t})},e.bufferToDataURL=R,e.bufferToText=function me(e){return E(new Uint8Array(e))},e.convertUrlParamType=J,e.dataURLToBase64=S,e.dataURLToBinary=D,e.dataURLToBlob=O,e.dataURLToBuffer=L,e.dataURLToText=function Re(e){return c.decode(S(e))},e.deserialize=async function ye(e,n){const{dataType:o,cancel:r}=n??{};await t.checkCanceled(r);const a=t.restoreNullish(t.toTypedData(e));switch(o){case"string":return t.fromTypedData(a);case"number":return Number(a);case"boolean":return Boolean(a);case"object":return Object(a);case"buffer":return L(t.fromTypedData(a));case"binary":return D(t.fromTypedData(a));case"blob":return O(t.fromTypedData(a));default:return a}},e.fromBinaryString=T,e.fromHexString=function ge(e){const t=e.match(/.{1,2}/g);return new Uint8Array(null!=t?t.map((e=>parseInt(e,16))):[])},e.parseUrlQuery=e=>{const t={},n=new k(e.includes("?")?e.split("?")[1]:e);for(const[e,o]of n)t[decodeURIComponent(e)]=J(o);return t},e.readAsArrayBuffer=u,e.readAsDataURL=l,e.readAsText=f,e.request=Z,e.serialize=async function he(e,n){const{cancel:o}=n??{};return await t.checkCanceled(o),null==e?String(e):e instanceof ArrayBuffer?R(e):e instanceof Uint8Array?g(e):e instanceof r?m(e,n):t.fromTypedData(e)},e.setupHeaders=Q,e.textToBase64=x,e.textToBinary=w,e.textToBlob=C,e.textToBuffer=function Ee(e){return w(e).buffer},e.textToDataURL=function Ue(e,t="text/plain"){const n=x(e);return`data:${t};base64,${n}`},e.thread=function Ae(e,n){const{cancel:o,args:r}=Object.assign({args:[]},n);if(o?.requested)throw o.reason;const a=`(self => {\n        self.addEventListener('message', async ({ data }) => {\n            try {\n                const result = await (${e.toString()})(...data);\n                self.postMessage(result);\n            } catch (e) {\n                setTimeout(function() { throw e; });\n            }\n        });\n    })(self);`,s=new oe(a,n);o?.register((()=>s.terminate()));const{token:c}=t.CancelToken.source(o),i=new Promise(((e,t)=>{s.onerror=e=>{e.preventDefault(),t(e),s.terminate()},s.onmessage=t=>{e(t.data),s.terminate()}}),c);return s.postMessage(r),i},e.toAjaxDataStream=F,e.toAjaxParams=X,e.toBinaryString=b,e.toHexString=function Ce(e){return e.reduce(((e,t)=>e+t.toString(16).toUpperCase().padStart(2,"0")),"")},e.toQueryStrings=q,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
//# sourceMappingURL=lib-worker.min.map