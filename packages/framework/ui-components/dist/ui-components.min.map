{"version":3,"names":["RESULT_CODE","CDP_DECLARE","DECLARE_ERROR_CODE","getComputedStyle","safe","globalThis","getTransformMatrixValues","el","style","m11","m22","m33","m41","m42","m43","DOMMatrixReadOnly","transform","translateX","translateY","translateZ","scaleX","scaleY","scaleZ","setTransformTransition","prop","msec","timingFunction","animation","setProperty","clearTransition","removeProperty","post","noop","styleCore","styleButton","_config","NAMESPACE","SCROLL_MAP_CLASS","SCROLL_MAP_SELECTOR","INACTIVE_CLASS","INACTIVE_CLASS_SELECTOR","RECYCLE_CLASS","RECYCLE_CLASS_SELECTOR","LISTITEM_BASE_CLASS","LISTITEM_BASE_CLASS_SELECTOR","DATA_PAGE_INDEX","DATA_ITEM_INDEX","ListViewGlobalConfig","newConfig","key","Object","keys","undefined","assign","ItemProfile","_owner","_height","_initializer","_info","_index","_pageIndex","_offset","_$base","_instance","constructor","owner","height","initializer","this","index","updateIndex","pageIndex","updatePageIndex","offset","updateOffset","info","activate","prepareBaseElement","options","item","css","hide","deactivate","remove","addClass","refresh","render","isActive","updateHeight","newHeight","delta","updateScrollMapHeight","reflectAll","updateProfiles","resetDepth","baseDepth","$base","$recycle","findRecycleElements","first","itemTagName","console","length","removeAttr","removeClass","$","$scrollMap","append","attr","String","enableTransformOffset","top","parseInt","PageProfile","_items","_status","status","push","normalize","enableAll","every","getItem","at","getItemFirst","getItemLast","GroupProfile","_id","_parent","_children","_expanded","_mapItems","id","isExpanded","parent","children","getNextItemIndex","withActiveChildren","items","queryOperationTarget","addItem","layoutKey","groupProfile","context","Math","trunc","_addItem","update","addChildren","target","Array","isArray","child","setParent","hasChildren","some","hasLayoutKeyOf","expand","statusScope","collapse","delay","animationDuration","removeItem","ensureVisible","callback","toggle","register","insertTo","makeResult","ERROR_UI_LISTVIEW_INVALID_PARAM","toHelpString","preprocess","restore","concat","slice","newStatus","operation","findTargets","group","_properties","Symbol","ListItemView","View","_properties$3","super","$el","setElement","off","stopListening","hasChildNode","ElementScroller","_$target","_$scrollMap","_options","_scrollStopTrigger","_scrollDuration","element","timer","clearTimeout","setTimeout","trigger","CustomEvent","bubbles","cancelable","on","TYPE","getFactory","factory","defineProperties","type","configurable","writable","enumerable","value","pos","scrollTop","posMax","max","scrollTo","animate","time","Promise","resolve","enableAnimation","destroy","_defaultOpts","scrollerFactory","enableHiddenPage","scrollMapRefreshInterval","scrollRefreshDistance","pagePrepareCount","pagePreloadCount","removeItemWithTransition","useDummyInactiveScrollMap","_$invalid","verify","x","ERROR_UI_LISTVIEW_INVALID_INITIALIZATION","ListCore","_$root","_$map","_mapHeight","_scroller","_active","_settings","_scrollEventHandler","_scrollStopEventHandler","_baseHeight","_pages","_lastActivePageContext","from","to","_backup","onScroll","onScrollStop","initialize","$root","hasClass","find","createScroller","setBaseHeight","setScrollerCondition","resetScrollerCondition","release","setActiveState","active","treatScrollPosition","scrollerType","useDummyMap","display","prepareInactiveMap","$map","$target","scrollMapHeight","i","n","last","isInitialized","deltaHeight","addTail","it","splice","clearPage","arg2","arg3","_removeItemRandomly","_removeItemContinuously","_queryRemoveItemsContext","indexes","removed","transition","idx","current","scrollPos","scrollPosMax","_updateWithRemoveItemsContext","profileUpdate","setupScrollMapTransition","size","_","sort","lhs","rhs","transitionEnd","getItemInfo","parser","Number","NaN","Event","isNaN","targets","currentPageIndex","getPageIndex","highPriorityIndex","storeNextPageState","abs","searchCount","beginIndex","endIndex","overflowPrev","overflowNext","page","filter","action","pageCurrent","assignPage","rebuild","setScrollHandler","handler","method","setScrollStopHandler","partialOK","setTop","currentScope","targetScope","backup","hasBackup","clearBackup","backupData","scrollMapSize","lastPage","getLastPage","validRange","candidate","floor","basePage","nextItemIndex","asigneeItems","workPage","newPage","$parent","$inactiveMap","$listItemViews","clone","ListView","_properties$2","opt","initialHeight","ExpandCore","_mapGroups","_aryTopGroups","_layoutKey","newGroup","luid","getGroup","registerTopGroup","topGroup","lastGroup","getTopGroups","expandAll","promisies","all","collapseAll","isExpanding","isStatusIn","isCollapsing","isSwitching","statusAddRef","statusRelease","executor","map","tops","ExpandableListItemView","_properties$1","ExpandableListView"],"sources":["cdp:///@cdp/ui-components/ui-utils/result-code-defs.ts","cdp:///@cdp/ui-components/ui-utils/ssr.ts","cdp:///@cdp/ui-components/ui-utils/css/misc.ts","cdp:///@cdp/ui-components/ui-forms/index.ts","cdp:///@cdp/ui-components/ui-listview/result-code-defs.ts","cdp:///@cdp/ui-components/ui-listview/global-config.ts","cdp:///@cdp/ui-components/ui-listview/profile/item.ts","cdp:///@cdp/ui-components/ui-listview/profile/page.ts","cdp:///@cdp/ui-components/ui-listview/profile/group.ts","cdp:///@cdp/ui-components/ui-listview/list-item-view.ts","cdp:///@cdp/ui-components/ui-listview/core/element-scroller.ts","cdp:///@cdp/ui-components/ui-listview/core/list.ts","cdp:///@cdp/ui-components/ui-listview/list-view.ts","cdp:///@cdp/ui-components/ui-listview/expandable-list-item-view.ts","cdp:///@cdp/ui-components/ui-listview/core/expand.ts","cdp:///@cdp/ui-components/ui-listview/expandable-list-view.ts","cdp:///@cdp/ui-components/ui-listview/index.ts"],"sourcesContent":["/* eslint-disable\n    @typescript-eslint/no-namespace,\n    @typescript-eslint/no-unused-vars,\n */\n\nnamespace CDP_DECLARE {\n\n    export const enum CDP_KNOWN_UI_MODULE {\n        /** `@cdp/ui-utils` */\n        UTILS     = 1,\n        /** `@cdp/ui-listview` */\n        LISTVIEW  = 2,\n        /** offset for unknown ui-module */\n        OFFSET,\n    }\n\n    const enum LOCAL_CODE_BASE {\n        UI_UTILS = (CDP_KNOWN_MODULE.OFFSET + CDP_KNOWN_UI_MODULE.UTILS) * LOCAL_CODE_RANGE_GUIDE.FUNCTION,\n    }\n\n    /**\n     * @en Extends error code definitions.\n     * @ja 拡張エラーコード定義\n     */\n    export enum RESULT_CODE {\n        UI_UTILS_DECLARE = RESULT_CODE_BASE.DECLARE,\n        ERROR_UI_UTILS_FATAL = DECLARE_ERROR_CODE(RESULT_CODE_BASE.CDP, LOCAL_CODE_BASE.UI_UTILS + 1, 'UI utils something wrong.'),\n    }\n}\n","import { safe } from '@cdp/runtime';\n\n/** @internal */ export const getComputedStyle = safe(globalThis.getComputedStyle);\n","import { getComputedStyle } from '../ssr';\n\n/**\n * @en CSS vendor prefix string definition.\n * @ja CSS ベンダープリフィックス文字列定義\n */\nexport const cssPrefixes = ['-webkit-', '-moz-', '-ms-', '-o-', ''];\n\n/**\n * @en Stores the value specified in css `transform(3d)`.\n * @ja css `transform(3d)` に指定される値を格納\n */\nexport interface TransformMatrixValues {\n    translateX: number;\n    translateY: number;\n    translateZ: number;\n    scaleX: number;\n    scaleY: number;\n    scaleZ: number;\n}\n\n/**\n * @en Get the value of the transform matrix specified in `Element`.\n * @ja `Element` に指定された transform 行列の値を取得\n *\n * @param el\n *  - `en` target `Element` instance\n *  - `ja` 対象 `Element` インスタンス\n */\nexport const getTransformMatrixValues = (el: Element): TransformMatrixValues => {\n    const style = getComputedStyle(el);\n    const { m11, m22, m33, m41, m42, m43 } = new DOMMatrixReadOnly(style.transform);\n    return {\n        translateX: m41,\n        translateY: m42,\n        translateZ: m43,\n        scaleX: m11,\n        scaleY: m22,\n        scaleZ: m33,\n    };\n};\n\n/**\n * @en Setting property conversion animation using css transition for specified element.\n * @ja 指定要素に対して css transition を用いたプロパティ変換アニメーションの設定\n *\n * @param el\n *  - `en` target `HTMLElement` instance\n *  - `ja` 対象 `HTMLElement` インスタンス\n * @param prop\n *  - `en` target property name [ex: height]\n *  - `ja` 対象プロパティ名 [ex: height]\n * @param msec\n *  - `en` animation duration [msec]\n *  - `ja` アニメーション時間 [msec]\n * @param el\n *  - `en` timing function name [default: ease]\n *  - `ja` タイミング関数名 [default: ease]\n */\nexport const setTransformTransition = (el: HTMLElement, prop: string, msec: number, timingFunction = 'ease'): void => {\n    const animation = `${(msec / 1000)}s ${timingFunction}`;\n    el.style.setProperty('transition', `${prop} ${animation}, transform ${animation}`);\n};\n\n\n/**\n * @en Clear css transition settings for specified element.\n * @ja 指定要素の css transition 設定を解除\n *\n * @param el\n *  - `en` target `HTMLElement` instance\n *  - `ja` 対象 `HTMLElement` インスタンス\n */\nexport const clearTransition = (el: HTMLElement): void => {\n    el.style.removeProperty('transition');\n};\n","export const UI_FORMS_STATUS = 'UNDER CONSTRUCTION';\n\nimport { noop, post } from '@cdp/runtime';\n\nimport styleCore from '@css/structure.css' with { type: 'css' };\nimport styleButton from '@css/structure-button.css' with { type: 'css' };\n\nvoid post(noop(styleCore, styleButton));\n","/* eslint-disable\n    @typescript-eslint/no-namespace,\n    @typescript-eslint/no-unused-vars,\n */\n\nnamespace CDP_DECLARE {\n\n    const enum LOCAL_CODE_BASE {\n        UI_LISTVIEW = (CDP_KNOWN_MODULE.OFFSET + CDP_KNOWN_UI_MODULE.LISTVIEW) * LOCAL_CODE_RANGE_GUIDE.FUNCTION,\n    }\n\n    /**\n     * @en Extends error code definitions.\n     * @ja 拡張エラーコード定義\n     */\n    export enum RESULT_CODE {\n        UI_LISTVIEW_DECLARE = RESULT_CODE_BASE.DECLARE,\n        ERROR_UI_LISTVIEW_INVALID_INITIALIZATION = DECLARE_ERROR_CODE(RESULT_CODE_BASE.CDP, LOCAL_CODE_BASE.UI_LISTVIEW + 1, 'listview has invalid initialization.'),\n        ERROR_UI_LISTVIEW_INVALID_PARAM          = DECLARE_ERROR_CODE(RESULT_CODE_BASE.CDP, LOCAL_CODE_BASE.UI_LISTVIEW + 2, 'listview given a invalid param.'),\n        ERROR_UI_LISTVIEW_INVALID_OPERATION      = DECLARE_ERROR_CODE(RESULT_CODE_BASE.CDP, LOCAL_CODE_BASE.UI_LISTVIEW + 3, 'listview invalid operation.'),\n    }\n}\n","/**\n * @en Global configuration definition for list views.\n * @ja リストビューのグローバルコンフィグレーション定義\n */\nexport interface ListViewGlobalConfig {\n    NAMESPACE: string;\n    SCROLL_MAP_CLASS: string;\n    SCROLL_MAP_SELECTOR: string;\n    INACTIVE_CLASS: string;\n    INACTIVE_CLASS_SELECTOR: string;\n    RECYCLE_CLASS: string;\n    RECYCLE_CLASS_SELECTOR: string;\n    LISTITEM_BASE_CLASS: string;\n    LISTITEM_BASE_CLASS_SELECTOR: string;\n    DATA_PAGE_INDEX: string;\n    DATA_ITEM_INDEX: string;\n}\n\n/** @internal */\nconst enum DefaultV {\n    NAMESPACE                    = 'cdp-ui',\n    SCROLL_MAP_CLASS             = `${NAMESPACE}-listview-scroll-map`,\n    SCROLL_MAP_SELECTOR          = `.${SCROLL_MAP_CLASS}`,\n    INACTIVE_CLASS               = 'inactive',\n    INACTIVE_CLASS_SELECTOR      = `.${INACTIVE_CLASS}`,\n    RECYCLE_CLASS                = `${NAMESPACE}-listview-recycle`,\n    RECYCLE_CLASS_SELECTOR       = `.${RECYCLE_CLASS}`,\n    LISTITEM_BASE_CLASS          = `${NAMESPACE}-listview-item-base`,\n    LISTITEM_BASE_CLASS_SELECTOR = `.${LISTITEM_BASE_CLASS}`,\n    DATA_PAGE_INDEX              = `data-page-index`,\n    DATA_ITEM_INDEX              = `data-item-index`,\n}\n\nconst _config = {\n    NAMESPACE: DefaultV.NAMESPACE,\n    SCROLL_MAP_CLASS: DefaultV.SCROLL_MAP_CLASS,\n    SCROLL_MAP_SELECTOR: DefaultV.SCROLL_MAP_SELECTOR,\n    INACTIVE_CLASS: DefaultV.INACTIVE_CLASS,\n    INACTIVE_CLASS_SELECTOR: DefaultV.INACTIVE_CLASS_SELECTOR,\n    RECYCLE_CLASS: DefaultV.RECYCLE_CLASS,\n    RECYCLE_CLASS_SELECTOR: DefaultV.RECYCLE_CLASS_SELECTOR,\n    LISTITEM_BASE_CLASS: DefaultV.LISTITEM_BASE_CLASS,\n    LISTITEM_BASE_CLASS_SELECTOR: DefaultV.LISTITEM_BASE_CLASS_SELECTOR,\n    DATA_PAGE_INDEX: DefaultV.DATA_PAGE_INDEX,\n    DATA_ITEM_INDEX: DefaultV.DATA_ITEM_INDEX,\n};\n\n/**\n * @en Get/Update global configuration of list view.\n * @ja リストビューのグローバルコンフィグレーションの取得/更新\n */\nexport const ListViewGlobalConfig = (newConfig?: Partial<ListViewGlobalConfig>): ListViewGlobalConfig => {\n    if (newConfig) {\n        for (const key of Object.keys(newConfig)) {\n            if (undefined === newConfig[key as keyof ListViewGlobalConfig]) {\n                delete newConfig[key as keyof ListViewGlobalConfig];\n            }\n        }\n    }\n    return Object.assign({}, _config, newConfig);\n};\n","import {\n    UnknownObject,\n    DOM,\n    dom as $,\n} from '@cdp/runtime';\nimport { getTransformMatrixValues } from '@cdp/ui-utils';\nimport type { IListContext } from '../interfaces/base';\nimport type {\n    IListItemView,\n    IListItemViewConstructor,\n    ListItemUpdateHeightOptions,\n} from '../interfaces/list-item-view';\nimport { ListViewGlobalConfig } from '../global-config';\n\n/**\n * @en A class that stores UI structure information for list items.\n * @ja リストアイテムの UI 構造情報を格納するクラス\n */\nexport class ItemProfile {\n    /** @internal */\n    private readonly _owner: IListContext;\n    /** @internal */\n    private _height: number;\n    /** @internal */\n    private readonly _initializer: IListItemViewConstructor;\n    /** @internal */\n    private readonly _info: UnknownObject;\n    /** @internal global index */\n    private _index = 0;\n    /** @internal belonging page index */\n    private _pageIndex = 0;\n    /** @internal global offset */\n    private _offset = 0;\n    /** @internal base dom instance */\n    private _$base?: DOM;\n    /** @internal IListItemView instance */\n    private _instance?: IListItemView;\n\n    /**\n     * constructor\n     *\n     * @param owner\n     *  - `en` {@link IListViewContext} instance\n     *  - `ja` {@link IListViewContext} インスタンス\n     * @param height\n     *  - `en` initial item's height\n     *  - `ja` item の初期の高さ\n     * @param initializer\n     *  - `en` constructor for {@link IListItemView}'s subclass\n     *  - `ja` {@link IListItemView} のサブクラスのコンストラクタ\n     * @param info\n     *  - `en` init parameters for {@link IListItemView}'s subclass\n     *  - `ja` {@link IListItemView} のサブクラスの初期化パラメータ\n     */\n    constructor(owner: IListContext, height: number, initializer: IListItemViewConstructor, _info: UnknownObject) {\n        this._owner       = owner;\n        this._height      = height;\n        this._initializer = initializer;\n        this._info        = _info;\n    }\n\n///////////////////////////////////////////////////////////////////////\n// accessors:\n\n    /** Get the item's height. */\n    get height(): number {\n        return this._height;\n    }\n\n    /** Get the item's global index. */\n    get index(): number {\n        return this._index;\n    }\n\n    /** Set the item's global index. */\n    set index(index: number) {\n        this._index = index;\n        this.updateIndex();\n    }\n\n    /** Get belonging the page index. */\n    get pageIndex(): number {\n        return this._pageIndex;\n    }\n\n    /** Set belonging the page index. */\n    set pageIndex(index: number) {\n        this._pageIndex = index;\n        this.updatePageIndex();\n    }\n\n    /** Get global offset. */\n    get offset(): number {\n        return this._offset;\n    }\n\n    /** Set global offset. */\n    set offset(offset: number) {\n        this._offset = offset;\n        this.updateOffset();\n    }\n\n    /** Get init parameters. */\n    get info(): UnknownObject {\n        return this._info;\n    }\n\n///////////////////////////////////////////////////////////////////////\n// public methods:\n\n    /**\n     * @en Activate of the item.\n     * @ja item の活性化\n     */\n    public activate(): void {\n        if (null == this._instance) {\n            this._$base = this.prepareBaseElement();\n            this.updateIndex();\n            this.updateOffset();\n            const options = Object.assign({\n                el: this._$base,\n                owner: this._owner,\n                item: this,\n            }, this._info);\n            this._instance = new this._initializer(options);\n            if ('none' === this._$base.css('display')) {\n                this._$base.css('display', 'block');\n            }\n        }\n        this.updatePageIndex();\n        if (this._$base && 'visible' !== this._$base.css('visibility')) {\n            this._$base.css('visibility', 'visible');\n        }\n    }\n\n    /**\n     * @en Make the item invisible.\n     * @ja item の不可視化\n     */\n    public hide(): void {\n        if (null == this._instance) {\n            this.activate();\n        }\n        if (this._$base && 'hidden' !== this._$base.css('visibility')) {\n            this._$base.css('visibility', 'hidden');\n        }\n    }\n\n    /**\n     * @en Deactivate of the item.\n     * @ja item の非活性化\n     */\n    public deactivate(): void {\n        if (null != this._instance) {\n            this._instance.remove();\n            this._instance = undefined;\n            this._$base?.addClass(this._config.RECYCLE_CLASS);\n            this._$base?.css('display', 'none');\n            this._$base = undefined;\n        }\n    }\n\n    /**\n     * @en Refresh the item.\n     * @ja item の更新\n     */\n    public refresh(): void {\n        if (null != this._instance) {\n            this._instance.render();\n        }\n    }\n\n    /**\n     * @en Check the activation status of the item.\n     * @ja item の活性状態判定\n     */\n    public isActive(): boolean {\n        return null != this._instance;\n    }\n\n    /**\n     * @en Update height information of the item. Called from {@link ListItemView}.\n     * @ja item の高さ情報の更新. {@link ListItemView} からコールされる。\n     */\n    public updateHeight(newHeight: number, options?: ListItemUpdateHeightOptions): void {\n        const delta = newHeight - this._height;\n        this._height = newHeight;\n        this._owner.updateScrollMapHeight(delta);\n        if (options?.reflectAll) {\n            this._owner.updateProfiles(this._index);\n        }\n    }\n\n    /**\n     * @en Reset z-index. Called from {@link ScrollManager}`.removeItem()`.\n     * @ja z-index のリセット. {@link ScrollManager}`.removeItem()` からコールされる。\n     */\n    public resetDepth(): void {\n        if (null != this._instance) {\n            this._$base?.css('z-index', this._owner.options.baseDepth);\n        }\n    }\n\n///////////////////////////////////////////////////////////////////////\n// internal:\n\n    /** @internal */\n    private get _config(): ListViewGlobalConfig {\n        return ListViewGlobalConfig();\n    }\n\n    /** @internal */\n    private prepareBaseElement(): DOM {\n        let $base: DOM;\n        const $recycle = this._owner.findRecycleElements().first();\n        const itemTagName = this._owner.options.itemTagName;\n\n        if (null != this._$base) {\n            console.warn('this._$base is not null.');\n            return this._$base;\n        }\n\n        if (0 < $recycle.length) {\n            $base = $recycle;\n            $base.removeAttr('z-index');\n            $base.removeClass(this._config.RECYCLE_CLASS);\n        } else {\n            // TODO:  要検討. <li> 全般は <slot> とどのように協調するか?\n            $base = $(`<${itemTagName} class=\"${this._config.LISTITEM_BASE_CLASS}\"></\"${itemTagName}\">`);\n            $base.css('display', 'none');\n            this._owner.$scrollMap.append($base);\n        }\n\n        // 高さの更新\n        if ($base.height() !== this._height) {\n            $base.height(this._height);\n        }\n\n        return $base;\n    }\n\n    /** @internal */\n    private updateIndex(): void {\n        if (this._$base && this._$base.attr(this._config.DATA_ITEM_INDEX) !== String(this._index)) {\n            this._$base.attr(this._config.DATA_ITEM_INDEX, this._index);\n        }\n    }\n\n    /** @internal */\n    private updatePageIndex(): void {\n        if (this._$base && this._$base.attr(this._config.DATA_PAGE_INDEX) !== String(this._pageIndex)) {\n            this._$base.attr(this._config.DATA_PAGE_INDEX, this._pageIndex);\n        }\n    }\n\n    /** @internal */\n    private updateOffset(): void {\n        if (!this._$base) {\n            return;\n        }\n\n        if (this._owner.options.enableTransformOffset) {\n            const { translateY } = getTransformMatrixValues(this._$base[0]);\n            if (translateY !== this._offset) {\n                this._$base.css('transform', `translate3d(0,${this._offset}px,0`);\n            }\n        } else {\n            const top = parseInt(this._$base.css('top'), 10);\n            if (top !== this._offset) {\n                this._$base.css('top', `${this._offset}px`);\n            }\n        }\n    }\n}\n","import { at } from '@cdp/runtime';\nimport type { ItemProfile } from './item';\n\n/**\n * @en A class that stores UI structure information for one page of the list.\n * @ja リスト1ページ分の UI 構造情報を格納するクラス\n */\nexport class PageProfile {\n    /** @internal page index */\n    private _index = 0;\n    /** @internal page offset from top */\n    private _offset = 0;\n    /** @internal page's height */\n    private _height = 0;\n    /** @internal item's profile managed with in page */\n    private _items: ItemProfile[] = [];\n    /** @internal page status */\n    private _status: 'active' | 'inactive' | 'hidden' = 'inactive';\n\n///////////////////////////////////////////////////////////////////////\n// accessors:\n\n    /** Get the page index */\n    get index(): number {\n        return this._index;\n    }\n\n    /** Set the page index */\n    set index(index: number) {\n        this._index = index;\n    }\n\n    /** Get the page offset */\n    get offset(): number {\n        return this._offset;\n    }\n\n    /** Set the page offset */\n    set offset(offset: number) {\n        this._offset = offset;\n    }\n\n    /** Get the page height */\n    get height(): number {\n        return this._height;\n    }\n\n    /** Get the page status */\n    get status(): 'active' | 'inactive' | 'hidden' {\n        return this._status;\n    }\n\n///////////////////////////////////////////////////////////////////////\n// public methods:\n\n    /**\n     * @en Activate of the page.\n     * @ja page の活性化\n     */\n    public activate(): void {\n        if ('active' !== this._status) {\n            for (const item of this._items) {\n                item.activate();\n            }\n        }\n        this._status = 'active';\n    }\n\n    /**\n     * @en Make the page invisible.\n     * @ja page の不可視化\n     */\n    public hide(): void {\n        if ('hidden' !== this._status) {\n            for (const item of this._items) {\n                item.hide();\n            }\n        }\n        this._status = 'hidden';\n    }\n\n    /**\n     * @en Deactivate of the page.\n     * @ja page の非活性化\n     */\n    public deactivate(): void {\n        if ('inactive' !== this._status) {\n            for (const item of this._items) {\n                item.deactivate();\n            }\n        }\n        this._status = 'inactive';\n    }\n\n    /**\n     * @en Add {@link ItemProfile} to the page.\n     * @ja {@link ItemProfile} の追加\n     */\n    public push(item: ItemProfile): void {\n        this._items.push(item);\n        this._height += item.height;\n    }\n\n    /**\n     * @en If all {@link ItemProfile} under the page are not valid, disable the page's status.\n     * @ja 配下の {@link ItemProfile} すべてが有効でない場合, page ステータスを無効にする\n     */\n    public normalize(): void {\n        const enableAll = this._items.every(item => item.isActive());\n        if (!enableAll) {\n            this._status = 'inactive';\n        }\n    }\n\n    /**\n     * @en Get {@link ItemProfile} by index.\n     * @ja インデックスを指定して {@link ItemProfile} を取得\n     */\n    public getItem(index: number): ItemProfile {\n        return at(this._items, index);\n    }\n\n    /**\n     * @en Get first {@link ItemProfile}.\n     * @ja 最初の {@link ItemProfile} を取得\n     */\n    public getItemFirst(): ItemProfile | undefined {\n        return this._items[0];\n    }\n\n    /**\n     * @en Get last {@link ItemProfile}.\n     * @ja 最後の {@link ItemProfile} を取得\n     */\n    public getItemLast(): ItemProfile | undefined {\n        return this._items[this._items.length - 1];\n    }\n}\n","import {\n    type UnknownObject,\n    RESULT_CODE,\n    makeResult,\n    toHelpString,\n} from '@cdp/runtime';\nimport type { ListEnsureVisibleOptions } from '../interfaces/base';\nimport type { IListItemViewConstructor } from '../interfaces/list-item-view';\nimport type { IExpandableListContext } from '../interfaces/expandable-context';\nimport { ItemProfile } from './item';\n\nconst enum LayoutKey {\n    DEFAULT = 'layout-default',\n}\n\n/**\n * @en UI structure information storage class for group management of list items. <br>\n *     This class does not directly manipulate the DOM.\n * @ja リストアイテムをグループ管理する UI 構造情報格納クラス <br>\n *     本クラスは直接は DOM を操作しない\n */\nexport class GroupProfile {\n    /** @internal profile id */\n    private readonly _id: string;\n    /** @internal {@link ExpandableListView} instance*/\n    private readonly _owner: IExpandableListContext;\n    /** @internal parent {@link GroupProfile} instance */\n    private _parent?: GroupProfile;\n    /** @internal child {@link GroupProfile} array */\n    private readonly _children: GroupProfile[] = [];\n    /** @internal expanded / collapsed status */\n    private _expanded = false;\n    /** @internal registration status for _owner */\n    private _status: 'registered' | 'unregistered' = 'unregistered';\n    /** @internal stored {@link ItemProfile} information */\n    private readonly _mapItems: Record<string, ItemProfile[]> = {};\n\n    /**\n     * constructor\n     *\n     * @param owner\n     *  - `en` {@link IExpandableListContext} instance\n     *  - `ja` {@link IExpandableListContext} インスタンス\n     * @param id\n     *  - `en` id of the instance. specified by the framework.\n     *  - `ja` インスタンスの ID. フレームワークが指定\n     */\n    constructor(owner: IExpandableListContext, id: string) {\n        this._id    = id;\n        this._owner = owner;\n        this._mapItems[LayoutKey.DEFAULT] = [];\n    }\n\n///////////////////////////////////////////////////////////////////////\n// accessors:\n\n    /**\n     * @en Get ID.\n     * @ja ID を取得\n     */\n    get id(): string {\n        return this._id;\n    }\n\n    /**\n     * \n     * @en Get status. 'registered' | 'unregistered'\n     * @ja ステータスを取得 'registered' | 'unregistered'\n     */\n    get status(): 'registered' | 'unregistered' {\n        return this._status;\n    }\n\n    /**\n     * @en Check expanded / collapsed status.\n     * @ja 展開状態を判定\n     *\n     * @returns\n     *  - `en` true: expanded, collapsed: close\n     *  - `ja` true: 展開, false: 収束\n     */\n    get isExpanded(): boolean {\n        return this._expanded;\n    }\n\n    /**\n     * @en Get parent {@link GroupProfile}.\n     * @ja 親 {@link GroupProfile} を取得\n     */\n    get parent(): GroupProfile | undefined {\n        return this._parent;\n    }\n\n    /**\n     * @en Get children {@link GroupProfile}.\n     * @ja 子 {@link GroupProfile} を取得\n     */\n    get children(): GroupProfile[] {\n        return this._children;\n    }\n\n///////////////////////////////////////////////////////////////////////\n// public methods:\n\n    /**\n     * @en Get the next available index of the last item element.\n     * @ja 最後の item 要素の次に使用できる index を取得\n     *\n     * @param withActiveChildren \n     *  - `en` specify true to search including registered child elements\n     *  - `ja` 登録済みの子要素を含めて検索する場合は true を指定\n     */\n    public getNextItemIndex(withActiveChildren = false): number {\n        let items: ItemProfile[] = [];\n        if (withActiveChildren) {\n            items = this.queryOperationTarget('active');\n        }\n        if (null == items || items.length <= 0) {\n            items = this._items;\n        }\n        return (items[items.length - 1]?.index ?? 0) + 1;\n    }\n\n    /**\n     * @en Item registration.\n     * @ja 本 GroupProfile が管理する item を作成して登録\n     *\n     * @param height\n     *  - `en` initial item's height\n     *  - `ja` item の高さ\n     * @param initializer\n     *  - `en` constructor for {@link IListItemView}'s subclass\n     *  - `ja` {@link IListItemView} のサブクラスのコンストラクタ\n     * @param info\n     *  - `en` init parameters for {@link IListItemView}'s subclass\n     *  - `ja` {@link IListItemView} のサブクラスの初期化パラメータ\n     * @param layoutKey\n     *  - `en` identifier for each layout\n     *  - `ja` レイアウト毎の識別子\n     */\n    public addItem(\n        height: number,\n        initializer: IListItemViewConstructor,\n        info: UnknownObject,\n        layoutKey?: string,\n    ): GroupProfile {\n        layoutKey = layoutKey ?? LayoutKey.DEFAULT;\n        const options = Object.assign({ groupProfile: this }, info);\n\n        if (null == this._mapItems[layoutKey]) {\n            this._mapItems[layoutKey] = [];\n        }\n\n        const item = new ItemProfile(this._owner.context, Math.trunc(height), initializer, options);\n\n        // _owner の管理下にあるときは速やかに追加\n        if (('registered' === this._status) && (null == this._owner.layoutKey || layoutKey === this._owner.layoutKey)) {\n            this._owner._addItem(item, this.getNextItemIndex());\n            this._owner.update();\n        }\n        this._mapItems[layoutKey].push(item);\n\n        return this;\n    }\n\n    /**\n     * @en Add {@link GroupProfile} as child element.\n     * @ja 子要素として {@link GroupProfile} を追加\n     *\n     * @param target {@link GroupProfile} instance / instance array\n     */\n    public addChildren(target: GroupProfile | GroupProfile[]): this {\n        const children: GroupProfile[] = Array.isArray(target) ? target : [target];\n        for (const child of children) {\n            child.setParent(this);\n        }\n        this._children.push(...children);\n        return this;\n    }\n\n    /**\n     * @en Determine if it has a child {@link GroupProfile}. <br>\n     *     If `layoutKey` is specified, whether the layout information matches is also added to the judgment condition.\n     * @ja 子 {@link GroupProfile} を持っているか判定 <br>\n     *     `layoutKey` が指定されれば、layout 情報が一致しているかも判定条件に加える\n     *\n     * @param layoutKey\n     *  - `en` identifier for each layout\n     *  - `ja` レイアウト毎の識別子\n     * @returns\n     *  - `en` true: exists, false: unexists\n     *  - `ja` true: 有, false: 無\n     */\n    public hasChildren(layoutKey?: string): boolean {\n        if (this._children.length <= 0) {\n            return false;\n        } else if (null != layoutKey) {\n            return this._children.some(child => child.hasLayoutKeyOf(layoutKey));\n        } else {\n            return true;\n        }\n    }\n\n    /**\n     * @en Determine if the specified `layoutKey` exists.\n     * @ja 指定された `layoutKey` が存在するか判定\n     *\n     * @param layoutKey\n     *  - `en` identifier for each layout\n     *  - `ja` レイアウト毎の識別子\n     * @returns\n     *  - `en` true: exists, false: unexists\n     *  - `ja` true: 有, false: 無\n     */\n    public hasLayoutKeyOf(layoutKey: string): boolean {\n        return (null != this._mapItems[layoutKey]);\n    }\n\n    /**\n     * @en Group expansion.\n     * @ja グループ展開\n     */\n    public async expand(): Promise<void> {\n        if (!this.isExpanded) {\n            const items = this.queryOperationTarget('registered');\n            if (0 < items.length) {\n                await this._owner.statusScope('expanding', () => {\n                    // 自身を更新\n                    for (const item of this._items) {\n                        item.refresh();\n                    }\n                    // 配下を更新\n                    this._owner._addItem(items, this.getNextItemIndex());\n                    this._owner.update();\n                });\n            }\n        }\n        // 子要素がなくても展開状態にする\n        this._expanded = true;\n    }\n\n    /**\n     * @en Group collapse.\n     * @ja グループ収束\n     *\n     * @param delay\n     *  - `en` delay time spent removing elements. [default: `animationDuration` value]\n     *  - `ja` 要素削除に費やす遅延時間. [default: `animationDuration` value]\n     */\n    public async collapse(delay?: number): Promise<void> {\n        if (this.isExpanded) {\n            const items = this.queryOperationTarget('unregistered');\n            if (0 < items.length) {\n                delay = delay ?? this._owner.context.options.animationDuration;\n                await this._owner.statusScope('collapsing', () => {\n                    // 自身を更新\n                    for (const item of this._items) {\n                        item.refresh();\n                    }\n                    // 配下を更新\n                    this._owner.removeItem(items[0].index, items.length, delay);\n                    this._owner.update();\n                });\n            }\n        }\n        // 子要素がなくても収束状態にする\n        this._expanded = false;\n    }\n\n    /**\n     * @en Show self in visible area of list.\n     * @ja 自身をリストの可視領域に表示\n     *\n     * @param options\n     *  - `en` {@link ListEnsureVisibleOptions} option's object\n     *  - `ja` {@link ListEnsureVisibleOptions} オプション\n     */\n    async ensureVisible(options?: ListEnsureVisibleOptions): Promise<void> {\n        if (0 < this._items.length) {\n            await this._owner.ensureVisible(this._items[0].index, options);\n        } else {\n            options?.callback?.();\n        }\n    }\n\n    /**\n     * @en Toggle expand / collapse.\n     * @ja 開閉のトグル\n     *\n     * @param delay\n     *  - `en` delay time spent removing elements. [default: `animationDuration` value]\n     *  - `ja` 要素削除に費やす遅延時間. [default: `animationDuration` value]\n     */\n    public async toggle(delay?: number): Promise<void> {\n        if (this._expanded) {\n            await this.collapse(delay);\n        } else {\n            await this.expand();\n        }\n    }\n\n    /**\n     * @en Register to list view. Only 1st layer group can be registered.\n     * @ja リストビューへ登録. 第1階層グループのみ登録可能.\n     *\n     * @param insertTo\n     *  - `en` specify insertion position with index\n     *  - `ja` 挿入位置を index で指定\n     */\n    public register(insertTo: number): this {\n        if (this._parent) {\n            throw makeResult(\n                RESULT_CODE.ERROR_UI_LISTVIEW_INVALID_PARAM,\n                `${toHelpString(RESULT_CODE.ERROR_UI_LISTVIEW_INVALID_PARAM)} 'GroupProfile#register' method is acceptable only 1st layer group.`\n            );\n        }\n        this._owner._addItem(this.preprocess('registered'), insertTo);\n        return this;\n    }\n\n    /**\n     * @en Restore to list view. Only 1st layer group can be specified.\n     * @ja リストビューへ復元. 第1階層グループのみ指示可能.\n     */\n    public restore(): this {\n        if (this._parent) {\n            throw makeResult(\n                RESULT_CODE.ERROR_UI_LISTVIEW_INVALID_PARAM,\n                `${toHelpString(RESULT_CODE.ERROR_UI_LISTVIEW_INVALID_PARAM)} 'GroupProfile#restore' method is acceptable only 1st layer group.`\n            );\n        }\n\n        if (this._items) {\n            const items = this._expanded ? this._items.concat(this.queryOperationTarget('active')) : this._items.slice();\n            this._owner._addItem(items);\n        }\n        return this;\n    }\n\n///////////////////////////////////////////////////////////////////////\n// internal:\n\n    /** @internal 自身の管理するアクティブな LineProfie を取得 */\n    private get _items(): ItemProfile[] {\n        const key = this._owner.layoutKey;\n        if (null != key) {\n            return this._mapItems[key];\n        } else {\n            return this._mapItems[LayoutKey.DEFAULT];\n        }\n    }\n\n    /** @internal 親 Group 指定 */\n    private setParent(parent: GroupProfile): void {\n        this._parent = parent;\n    }\n\n    /** @internal  register / unregister の前処理 */\n    private preprocess(newStatus: 'registered' | 'unregistered'): ItemProfile[] {\n        const items: ItemProfile[] = [];\n        if (newStatus !== this._status) {\n            items.push(...this._items);\n        }\n        this._status = newStatus;\n        return items;\n    }\n\n    /** @internal 操作対象の ItemProfile 配列を取得 */\n    private queryOperationTarget(operation: 'registered' | 'unregistered' | 'active'): ItemProfile[] {\n        const findTargets = (group: GroupProfile): ItemProfile[] => {\n            const items: ItemProfile[] = [];\n            for (const child of group._children) {\n                switch (operation) {\n                    case 'registered':\n                    case 'unregistered':\n                        items.push(...child.preprocess(operation));\n                        break;\n                    case 'active':\n                        if (null != child._items) {\n                            items.push(...child._items);\n                        }\n                        break;\n                    default:\n                        // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n                        console.warn(`unknown operation: ${operation}`);\n                        break;\n                }\n                if (child.isExpanded) {\n                    items.push(...findTargets(child));\n                }\n            }\n            return items;\n        };\n        return findTargets(this);\n    }\n}\n","import {\n    type Writable,\n    type DOM,\n    type DOMSelector,\n    type ViewConstructionOptions,\n    View,\n} from '@cdp/runtime';\nimport type {\n    IListView,\n    ListItemUpdateHeightOptions,\n    IListItemView,\n} from './interfaces';\nimport type { ItemProfile } from './profile';\n\n/** @internal */ const _properties = Symbol('properties');\n\n/** @internal */\ninterface Property {\n    readonly owner: IListView;\n    readonly item: ItemProfile;\n}\n\n//__________________________________________________________________________________________________//\n\n/**\n * @en Options to pass to {@link ListItemView} construction.\n * @ja {@link ListItemView} 構築に渡すオプション\n */\nexport interface ListItemViewConstructionOptions<TElement extends Node = HTMLElement, TFuncName = string>\n    extends ViewConstructionOptions<TElement, TFuncName> {\n    owner: IListView;\n    $el?: DOM<TElement>;\n    item: ItemProfile;\n}\n\n/**\n * @en List item container class handled by {@link ListView}.\n * @ja {@link ListView} が扱うリストアイテムコンテナクラス\n */\nexport abstract class ListItemView<TElement extends Node = HTMLElement, TEvent extends object = object>\n    extends View<TElement, TEvent> implements IListItemView {\n\n    /** @internal */\n    private readonly [_properties]!: Property;\n\n    /** constructor */\n    constructor(options: ListItemViewConstructionOptions<TElement>) {\n        super(options);\n\n        const { owner, $el, item } = options;\n        (this[_properties] as Writable<Property>) = {\n            owner,\n            item,\n        } as Property;\n\n        if ($el) {\n            this.setElement($el as DOMSelector<TElement>);\n        }\n    }\n\n///////////////////////////////////////////////////////////////////////\n// public methods:\n\n    /** Owner 取得 */\n    get owner(): IListView {\n        return this[_properties].owner;\n    }\n\n///////////////////////////////////////////////////////////////////////\n// View component methods:\n\n    /**\n     * @override\n     * @en Remove this view by taking the element out of the DOM with release all listeners.\n     * @ja View から DOM を切り離し, リスナーを解除\n     */\n    override remove(): this {\n        this.$el.children().remove();\n        this.$el.off();\n        // this.$el は再利用するため完全な破棄はしない\n        this.setElement('null');\n        this.stopListening();\n        return this;\n    }\n\n///////////////////////////////////////////////////////////////////////\n// implements: IListItemView\n\n    /**\n     * @en Get own item index.\n     * @ja 自身の item インデックスを取得\n     */\n    get index(): number {\n        return this[_properties].item.index;\n    }\n\n    /**\n     * @en Get specified height.\n     * @ja 指定された高さを取得\n     */\n    get height(): number {\n        return this[_properties].item.height;\n    }\n\n    /**\n     * @en Check if child node exists.\n     * @ja child node が存在するか判定\n     */\n    get hasChildNode(): boolean {\n        return !!this.$el?.children().length;\n    }\n\n    /**\n     * @en Update item's height.\n     * @ja item の高さを更新\n     *\n     * @param newHeight\n     *  - `en` new item's height\n     *  - `ja` item の新しい高さ\n     * @param options\n     *  - `en` update options object\n     *  - `ja` 更新オプション\n     */\n    updateHeight(newHeight: number, options?: ListItemUpdateHeightOptions): this {\n        if (this.$el && this.height !== newHeight) {\n            this[_properties].item.updateHeight(newHeight, options);\n            this.$el.height(newHeight);\n        }\n        return this;\n    }\n}\n","import {\n    type Nullable,\n    type UnknownFunction,\n    type DOM,\n    type DOMSelector,\n    type DOMEventListener,\n    type ConnectEventMap,\n    type TimerHandle,\n    setTimeout,\n    clearTimeout,\n    dom as $,\n} from '@cdp/runtime';\nimport type {\n    ListScrollerFactory,\n    ListContextOptions,\n    IListScroller,\n} from '../interfaces';\n\n/** @internal */\ntype ScrollerEventMap = HTMLElementEventMap & ConnectEventMap & { 'scrollstop': Event; };\n\n/** @internal */\nconst enum Const {\n    MIN_SCROLLSTOP_DURATION = 50,\n}\n\n/**\n * @internal\n * @en {@link IListScroller} implementation class for HTMLElement.\n * @ja HTMLElement を対象とした {@link IListScroller} 実装クラス\n */\nexport class ElementScroller implements IListScroller {\n    private readonly _$target: DOM;\n    private readonly _$scrollMap: DOM;\n    private readonly _options: ListContextOptions;\n    private readonly _scrollStopTrigger: DOMEventListener;\n    private _scrollDuration?: number;\n\n    /** constructor */\n    constructor(element: DOMSelector, options: ListContextOptions) {\n        this._$target = $(element);\n        this._$scrollMap = this._$target.children().first();\n        this._options = options;\n\n        /*\n         * fire custom event: `scrollstop`\n         * `scrollend` の Safari 対応待ち\n         * https://developer.mozilla.org/ja/docs/Web/API/Element/scrollend_event\n         */\n        let timer: TimerHandle;\n        this._scrollStopTrigger = (): void => {\n            if (null != timer) {\n                clearTimeout(timer);\n            }\n            timer = setTimeout(() => {\n                this._$target.trigger(new CustomEvent('scrollstop', { bubbles: true, cancelable: true }));\n            }, this._scrollDuration ?? Const.MIN_SCROLLSTOP_DURATION);\n        };\n        this._$target.on('scroll', this._scrollStopTrigger);\n    }\n\n///////////////////////////////////////////////////////////////////////\n// static methods:\n\n    /** タイプ定義識別子 */\n    static get TYPE(): string {\n        return 'cdp:element-overflow-scroller';\n    }\n\n    /** factory 取得 */\n    static getFactory(): ListScrollerFactory {\n        const factory = (element: DOMSelector, options: ListContextOptions): IListScroller => {\n            return new ElementScroller(element, options);\n        };\n        // set type signature.\n        Object.defineProperties(factory, {\n            type: {\n                configurable: false,\n                writable: false,\n                enumerable: true,\n                value: ElementScroller.TYPE,\n            },\n        });\n        return factory as ListScrollerFactory;\n    }\n\n///////////////////////////////////////////////////////////////////////\n// implements: IListScroller\n\n    /** Scroller の型情報を取得 */\n    get type(): string {\n        return ElementScroller.TYPE;\n    }\n\n    /** スクロール位置取得 */\n    get pos(): number {\n        return this._$target.scrollTop();\n    }\n\n    /** スクロール最大値位置を取得 */\n    get posMax(): number {\n        return Math.max(this._$scrollMap.height() - this._$target.height(), 0);\n    }\n\n    /** スクロールイベント登録 */\n    on(type: 'scroll' | 'scrollstop', callback: DOMEventListener): void {\n        this._$target.on<ScrollerEventMap>(type, callback as UnknownFunction);\n    }\n\n    /** スクロールイベント登録解除 */\n    off(type: 'scroll' | 'scrollstop', callback: DOMEventListener): void {\n        this._$target.off<ScrollerEventMap>(type, callback as UnknownFunction);\n    }\n\n    /** スクロール位置を指定 */\n    scrollTo(pos: number, animate?: boolean, time?: number): Promise<void> {\n        return new Promise(resolve => {\n            this._scrollDuration = (this._options.enableAnimation ?? animate) ? time ?? this._options.animationDuration : undefined;\n            this._$target.scrollTop(pos, this._scrollDuration, undefined, () => {\n                this._scrollDuration = undefined;\n                resolve();\n            });\n        });\n    }\n\n    /** Scroller の状態更新 */\n    update(): void {\n        // noop\n    }\n\n    /** Scroller の破棄 */\n    destroy(): void {\n        this._$target?.off();\n        (this._$target as Nullable<DOM>) = (this._$scrollMap as Nullable<DOM>) = null;\n    }\n}\n","import {\n    type UnknownObject,\n    type DOM,\n    type DOMEventListener,\n    post,\n    noop,\n    RESULT_CODE,\n    makeResult,\n    toHelpString,\n    dom as $,\n} from '@cdp/runtime';\nimport {\n    getTransformMatrixValues,\n    setTransformTransition,\n    clearTransition,\n} from '@cdp/ui-utils';\nimport type {\n    ListContextOptions,\n    IListContext,\n    ListEnsureVisibleOptions,\n    IListScroller,\n    IListOperation,\n    IListScrollable,\n    IListBackupRestore,\n    IListItemViewConstructor,\n} from '../interfaces';\nimport { ListViewGlobalConfig } from '../global-config';\nimport { ItemProfile, PageProfile } from '../profile';\nimport { ElementScroller } from './element-scroller';\n\n/** ListContextOptions 既定値 */\nconst _defaultOpts: Required<ListContextOptions> = {\n    scrollerFactory: ElementScroller.getFactory(),\n    enableHiddenPage: false,\n    enableTransformOffset: false,\n    scrollMapRefreshInterval: 200,\n    scrollRefreshDistance: 200,\n    pagePrepareCount: 3,\n    pagePreloadCount: 1,\n    enableAnimation: true,\n    animationDuration: 0,\n    baseDepth: 'auto',\n    itemTagName: 'li',  // TODO: 見極め\n    removeItemWithTransition: true,\n    useDummyInactiveScrollMap: false,\n};\n\n/** invalid instance */\nconst _$invalid = $() as DOM;\n\n/** 初期化済みか検証 */\nfunction verify<T>(x: T | undefined): asserts x is T {\n    if (null == x) {\n        throw makeResult(RESULT_CODE.ERROR_UI_LISTVIEW_INVALID_INITIALIZATION);\n    }\n}\n\n/** @internal アイテム削除情報 */\ninterface RemoveItemsContext {\n    removed: ItemProfile[];\n    delta: number;\n    transition: boolean;\n}\n\n//__________________________________________________________________________________________________//\n\n/**\n * @internal\n * @en Core logic implementation class for scroll processing that manages memory. Accesses the DOM.\n * @ja メモリ管理を行うスクロール処理のコアロジック実装クラス. DOM にアクセスする.\n */\nexport class ListCore implements IListContext, IListOperation, IListScrollable, IListBackupRestore {\n    private _$root: DOM;\n    private _$map: DOM;\n    private _mapHeight = 0;\n    private _scroller: IListScroller | undefined;\n\n    /** UI 表示中に true */\n    private _active = true;\n\n    /** 初期オプションを格納 */\n    private readonly _settings: Required<ListContextOptions>;\n    /** Scroll Event Handler */\n    private readonly _scrollEventHandler: (ev?: Event) => void;\n    /** Scroll Stop Event Handler */\n    private readonly _scrollStopEventHandler: (ev?: Event) => void;\n    /** 1ページ分の高さの基準値 */\n    private _baseHeight = 0;\n    /** 管理下にある ItemProfile 配列 */\n    private readonly _items: ItemProfile[] = [];\n    /** 管理下にある PageProfile 配列 */\n    private readonly _pages: PageProfile[] = [];\n\n    /** 最新の表示領域情報を格納 (Scroll 中の更新処理に使用) */\n    private readonly _lastActivePageContext = {\n        index: 0,\n        from: 0,\n        to: 0,\n        pos: 0,    // scroll position\n    };\n\n    /** データの backup 領域. key と _lines を格納 */\n    private readonly _backup: Record<string, { items: ItemProfile[]; }> = {};\n\n    /** constructor */\n    constructor(options?: ListContextOptions) {\n        this._$root = this._$map = _$invalid;\n        this._settings = Object.assign({}, _defaultOpts, options);\n\n        this._scrollEventHandler = () => {\n            this.onScroll(this._scroller!.pos);\n        };\n        this._scrollStopEventHandler = (): void => {\n            this.onScrollStop(this._scroller!.pos);\n        };\n    }\n\n///////////////////////////////////////////////////////////////////////\n// public methods:\n\n    /** 内部オブジェクトの初期化 */\n    public initialize($root: DOM, height: number): void {\n        // 既に構築されていた場合は破棄\n        if (this._$root.length) {\n            this.destroy();\n        }\n\n        this._$root = $root;\n        this._$map = $root.hasClass(this._config.SCROLL_MAP_CLASS) ? $root : $root.find(this._config.SCROLL_MAP_SELECTOR);\n        // _$map が無い場合は初期化しない\n        if (this._$map.length <= 0) {\n            this.destroy();\n            throw makeResult(\n                RESULT_CODE.ERROR_UI_LISTVIEW_INVALID_PARAM,\n                `${toHelpString(RESULT_CODE.ERROR_UI_LISTVIEW_INVALID_PARAM)} [${this._config.SCROLL_MAP_CLASS} not found]`\n            );\n        }\n\n        this._scroller = this.createScroller();\n        this.setBaseHeight(height);\n        this.setScrollerCondition();\n    }\n\n    /** 内部オブジェクトの破棄 */\n    public destroy(): void {\n        this.resetScrollerCondition();\n        this._scroller?.destroy();\n        this._scroller = undefined;\n        this.release();\n        this._$root = this._$map = _$invalid;\n    }\n\n    /** ページの基準値を取得 */\n    public setBaseHeight(height: number): void {\n        if (height <= 0) {\n            throw makeResult(\n                RESULT_CODE.ERROR_UI_LISTVIEW_INVALID_PARAM,\n                `${toHelpString(RESULT_CODE.ERROR_UI_LISTVIEW_INVALID_PARAM)} [base hight: ${height}]`\n            );\n        }\n        this._baseHeight = height;\n        this._scroller?.update();\n    }\n\n    /** active 状態設定 */\n    public async setActiveState(active: boolean): Promise<void> {\n        this._active = active;\n        await this.treatScrollPosition();\n    }\n\n    /** active 状態判定 */\n    get active(): boolean {\n        return this._active;\n    }\n\n    /** scroller の種類を取得 */\n    get scrollerType(): string {\n        return this._settings.scrollerFactory.type;\n    }\n\n    /** スクロール位置の保存/復元 */\n    public async treatScrollPosition(): Promise<void> {\n        verify(this._scroller);\n\n        const offset = (this._scroller.pos - this._lastActivePageContext.pos);\n        const { useDummyInactiveScrollMap: useDummyMap } = this._settings;\n\n        const updateOffset = ($target: DOM): void => {\n            const { translateY } = getTransformMatrixValues($target[0]);\n            if (offset !== translateY) {\n                $target.css('transform', `translate3d(0,${offset}px,0`);\n            }\n        };\n\n        if (this._active) {\n            await this._scroller.scrollTo(this._lastActivePageContext.pos, false, 0);\n            this._$map.css({ 'transform': '', 'display': 'block' });\n            if (useDummyMap) {\n                this.prepareInactiveMap().remove();\n            }\n        } else {\n            const $map = useDummyMap ? this.prepareInactiveMap() : this._$map;\n            updateOffset($map);\n        }\n    }\n\n///////////////////////////////////////////////////////////////////////\n// implements: IListContext\n\n    /** get scroll-map element */\n    get $scrollMap(): DOM {\n        return this._$map;\n    }\n\n    /** get scroll-map height [px] */\n    get scrollMapHeight(): number {\n        return this._$map.length ? this._mapHeight : 0;\n    }\n\n    /** get {@link ListContextOptions} */\n    get options(): Required<ListContextOptions> {\n        return this._settings;\n    }\n\n    /** update scroll-map height (delta [px]) */\n    updateScrollMapHeight(delta: number): void {\n        if (this._$map.length) {\n            this._mapHeight += Math.trunc(delta);\n            // for fail safe.\n            if (this._mapHeight < 0) {\n                this._mapHeight = 0;\n            }\n            this._$map.height(this._mapHeight);\n        }\n    }\n\n    /** update internal profile */\n    updateProfiles(from: number): void {\n        const { _items } = this;\n        for (let i = from, n = _items.length; i < n; i++) {\n            if (0 < i) {\n                const last = _items[i - 1];\n                _items[i].index = last.index + 1;\n                _items[i].offset = last.offset + last.height;\n            } else {\n                _items[i].index = 0;\n                _items[i].offset = 0;\n            }\n        }\n    }\n\n    /** get recyclable element */\n    findRecycleElements(): DOM {\n        return this._$map.find(this._config.RECYCLE_CLASS_SELECTOR);\n    }\n\n///////////////////////////////////////////////////////////////////////\n// implements: IListView\n\n    /** 初期化済みか判定 */\n    isInitialized(): boolean {\n        return !!this._scroller;\n    }\n\n    /** item 登録 */\n    addItem(height: number, initializer: IListItemViewConstructor, info: UnknownObject, insertTo?: number): void {\n        this._addItem(new ItemProfile(this, Math.trunc(height), initializer, info), insertTo);\n    }\n\n    /** item 登録 (内部用) */\n    _addItem(item: ItemProfile | ItemProfile[], insertTo?: number): void {\n        const items: ItemProfile[] = Array.isArray(item) ? item : [item];\n        let deltaHeight = 0;\n        let addTail = false;\n\n        if (null == insertTo || this._items.length < insertTo) {\n            insertTo = this._items.length;\n        }\n\n        if (insertTo === this._items.length) {\n            addTail = true;\n        }\n\n        // scroll map の更新\n        for (const it of items) {\n            deltaHeight += it.height;\n        }\n        this.updateScrollMapHeight(deltaHeight);\n\n        // 挿入\n        this._items.splice(insertTo, 0, ...items);\n\n        // page 設定の解除\n        if (!addTail) {\n            if (0 === insertTo) {\n                this.clearPage();\n            } else if (null != this._items[insertTo - 1].pageIndex) {\n                this.clearPage(this._items[insertTo - 1].pageIndex);\n            }\n        }\n\n        // offset の再計算\n        this.updateProfiles(insertTo);\n    }\n\n    /** 指定した Item を削除 */\n    removeItem(index: number, size?: number, delay?: number): void;\n    removeItem(index: number[], delay?: number): void;\n    removeItem(index: number | number[], arg2?: number, arg3?: number): void {\n        if (Array.isArray(index)) {\n            this._removeItemRandomly(index, arg2);\n        } else {\n            this._removeItemContinuously(index, arg2, arg3);\n        }\n    }\n\n    /** helper: 削除候補と変化量の算出 */\n    private _queryRemoveItemsContext(indexes: number[], delay: number): RemoveItemsContext {\n        const removed: ItemProfile[] = [];\n        let delta = 0;\n        let transition = false;\n\n        for (const idx of indexes) {\n            const item = this._items[idx];\n            delta += item.height;\n            // 削除要素の z-index の初期化\n            item.resetDepth();\n            removed.push(item);\n        }\n        // 自動設定・削除遅延時間が設定されかつ、スクロールポジションに変更がある場合は transition 設定\n        if (this._settings.removeItemWithTransition && (0 < delay)) {\n            const current = this.scrollPos;\n            const posMax = this.scrollPosMax - delta;\n            transition = (posMax < current);\n        }\n\n        return { removed, delta, transition };\n    }\n\n    /** helper: 削除時の更新 */\n    private _updateWithRemoveItemsContext(context: RemoveItemsContext, delay: number, profileUpdate: () => void): void {\n        const { removed, delta, transition } = context;\n\n        // transition 設定\n        if (transition) {\n            this.setupScrollMapTransition(delay);\n        }\n\n        // customize point: プロファイルの更新\n        profileUpdate();\n\n        // スクロール領域の更新\n        this.updateScrollMapHeight(-delta);\n        // 遅延削除\n        setTimeout(() => {\n            for (const item of removed) {\n                item.deactivate();\n            }\n        }, delay);\n    }\n\n    /** 指定した ItemProfile を削除: 連続 index 版 */\n    private _removeItemContinuously(index: number, size: number | undefined, delay: number | undefined): void {\n        size = size ?? 1;\n        delay = delay ?? 0;\n\n        if (index < 0 || this._items.length < index + size) {\n            throw makeResult(\n                RESULT_CODE.ERROR_UI_LISTVIEW_INVALID_PARAM,\n                `${toHelpString(RESULT_CODE.ERROR_UI_LISTVIEW_INVALID_PARAM)} [removeItem(), invalid index: ${index}]`\n            );\n        }\n\n        // 削除候補と変化量の算出\n        const indexes = Array.from({ length: size }, (_, i) => index + i);\n        const context = this._queryRemoveItemsContext(indexes, delay);\n\n        // 更新\n        this._updateWithRemoveItemsContext(context, delay, () => {\n            // page 設定の解除\n            if (null != this._items[index].pageIndex) {\n                this.clearPage(this._items[index].pageIndex);\n            }\n            // 配列から削除\n            this._items.splice(index, size);\n            // offset の再計算\n            this.updateProfiles(index);\n        });\n    }\n\n    /** 指定した ItemProfile を削除: random access 版 */\n    private _removeItemRandomly(indexes: number[], delay?: number): void {\n        delay = delay ?? 0;\n        indexes.sort((lhs, rhs) => rhs - lhs); // 降順ソート\n\n        for (let i = 0, n = indexes.length; i < n; i++) {\n            if (i < 0 || this._items.length < i) {\n                throw makeResult(\n                    RESULT_CODE.ERROR_UI_LISTVIEW_INVALID_PARAM,\n                    `${toHelpString(RESULT_CODE.ERROR_UI_LISTVIEW_INVALID_PARAM)} [removeItem(), invalid index: ${i}]`\n                );\n            }\n        }\n\n        // 削除候補と変化量の算出\n        const context = this._queryRemoveItemsContext(indexes, delay);\n\n        // 更新\n        this._updateWithRemoveItemsContext(context, delay, () => {\n            for (const idx of indexes) {\n                // page 設定の解除\n                if (null != this._items[idx].pageIndex) {\n                    this.clearPage(this._items[idx].pageIndex);\n                }\n                // 配列から削除\n                this._items.splice(idx, 1);\n            }\n            // offset の再計算\n            const first = indexes[indexes.length - 1];\n            this.updateProfiles(first);\n        });\n    }\n\n    /** scroll map のトランジション設定 */\n    private setupScrollMapTransition(delay: number): void {\n        verify(this._scroller);\n        const el = this._$map[0];\n        this._$map.transitionEnd(() => {\n            clearTransition(el);\n        });\n        setTransformTransition(el, 'height', delay, 'ease');\n    }\n\n    /** 指定した item に設定した情報を取得 */\n    getItemInfo(target: number | Event): UnknownObject {\n        const { _items, _config } = this;\n\n        const parser = ($target: DOM): number => {\n            if ($target.hasClass(_config.LISTITEM_BASE_CLASS)) {\n                return Number($target.attr(_config.DATA_ITEM_INDEX));\n            } else if ($target.hasClass(_config.SCROLL_MAP_CLASS) || $target.length <= 0) {\n                console.warn('cannot ditect item from event object.');\n                return NaN;\n            } else {\n                return parser($target.parent());\n            }\n        };\n\n        const index = target instanceof Event ? parser($(target.target as HTMLElement)) : Number(target);\n\n        if (Number.isNaN(index)) {\n            throw makeResult(\n                RESULT_CODE.ERROR_UI_LISTVIEW_INVALID_PARAM,\n                `${toHelpString(RESULT_CODE.ERROR_UI_LISTVIEW_INVALID_PARAM)} [unsupported type: ${typeof target}]`\n            );\n        } else if (index < 0 || _items.length <= index) {\n            throw makeResult(\n                RESULT_CODE.ERROR_UI_LISTVIEW_INVALID_PARAM,\n                `${toHelpString(RESULT_CODE.ERROR_UI_LISTVIEW_INVALID_PARAM)} getItemInfo() [invalid index: ${typeof index}]`\n            );\n        }\n\n        return _items[index].info;\n    }\n\n    /** アクティブページを更新 */\n    refresh(): this {\n        const { _pages, _items, _settings, _lastActivePageContext } = this;\n\n        const targets: Record<number, 'activate' | 'hide' | 'deactivate'> = {};\n        const currentPageIndex = this.getPageIndex();\n        const highPriorityIndex: number[] = [];\n\n        const storeNextPageState = (index: number): void => {\n            if (index === currentPageIndex) {\n                targets[index] = 'activate';\n                highPriorityIndex.push(index);\n            } else if (Math.abs(currentPageIndex - index) <= _settings.pagePrepareCount) {\n                targets[index] = 'activate';\n            } else if (_settings.enableHiddenPage) {\n                targets[index] = 'hide';\n            } else {\n                targets[index] = 'deactivate';\n            }\n            // current page の 前後は high priority にする\n            if (currentPageIndex + 1 === index || currentPageIndex - 1 === index) {\n                highPriorityIndex.push(index);\n            }\n        };\n\n        // 対象無し\n        if (_items.length <= 0) {\n            return this;\n        }\n\n        {\n            const searchCount = _settings.pagePrepareCount + _settings.pagePreloadCount;\n            const beginIndex = currentPageIndex - searchCount;\n            const endIndex = currentPageIndex + searchCount;\n\n            let overflowPrev = 0, overflowNext = 0;\n            for (let pageIndex = beginIndex; pageIndex <= endIndex; pageIndex++) {\n                if (pageIndex < 0) {\n                    overflowPrev++;\n                    continue;\n                }\n                if (_pages.length <= pageIndex) {\n                    overflowNext++;\n                    continue;\n                }\n                storeNextPageState(pageIndex);\n            }\n\n            if (0 < overflowPrev) {\n                for (let i = 0, pageIndex = currentPageIndex + searchCount + 1; i < overflowPrev; i++, pageIndex++) {\n                    if (_pages.length <= pageIndex) {\n                        break;\n                    }\n                    storeNextPageState(pageIndex);\n                }\n            }\n\n            if (0 < overflowNext) {\n                for (let i = 0, pageIndex = currentPageIndex - searchCount - 1; i < overflowNext; i++, pageIndex--) {\n                    if (pageIndex < 0) {\n                        break;\n                    }\n                    storeNextPageState(pageIndex);\n                }\n            }\n        }\n\n        // 不要になった page の 非活性化\n        for (const page of _pages.filter(page => 'inactive' !== page.status)) {\n            if (null == targets[page.index]) {\n                page.deactivate();\n            }\n        }\n\n        // 優先 page の activate\n        for (const idx of highPriorityIndex.sort((lhs, rhs) => lhs - rhs)) { // 昇順ソート\n            void post(() => {\n                this.isInitialized() && _pages[idx]?.activate();\n            });\n        }\n\n        // そのほかの page の 状態変更\n        for (const key of Object.keys(targets)) {\n            const index = Number(key);\n            const action = targets[index];\n            void post(() => {\n                this.isInitialized() && _pages[index]?.[action]?.();\n            });\n        }\n\n        // 更新後に使用しなかった DOM を削除\n        this.findRecycleElements().remove();\n\n        const pageCurrent = _pages[currentPageIndex];\n        _lastActivePageContext.from  = pageCurrent.getItemFirst()?.index ?? 0;\n        _lastActivePageContext.to    = pageCurrent.getItemLast()?.index ?? 0;\n        _lastActivePageContext.index = currentPageIndex;\n\n        return this;\n    }\n\n    /** 未アサインページを構築 */\n    update(): this {\n        this.assignPage(this._pages.length);\n        this.refresh();\n        return this;\n    }\n\n    /** ページアサインを再構成 */\n    rebuild(): this {\n        this.clearPage();\n        this.assignPage();\n        this.refresh();\n        return this;\n    }\n\n    /** 管轄データを破棄 */\n    release(): this {\n        for (const item of this._items) {\n            item.deactivate();\n        }\n        this._pages.length = 0;\n        this._items.length = 0;\n        this._mapHeight = 0;\n        this._$map.height(0);\n        return this;\n    }\n\n///////////////////////////////////////////////////////////////////////\n// implements: IListScrollable\n\n    /** スクロール位置を取得 */\n    get scrollPos(): number {\n        return this._scroller?.pos ?? 0;\n    }\n\n    /** スクロール位置の最大値を取得 */\n    get scrollPosMax(): number {\n        return this._scroller?.posMax ?? 0;\n    }\n\n    /** スクロールイベントハンドラ設定/解除 */\n    setScrollHandler(handler: DOMEventListener, method: 'on' | 'off'): void {\n        this._scroller?.[method]('scroll', handler);\n    }\n\n    /** スクロール終了イベントハンドラ設定/解除 */\n    setScrollStopHandler(handler: DOMEventListener, method: 'on' | 'off'): void {\n        this._scroller?.[method]('scrollstop', handler);\n    }\n\n    /** スクロール位置を指定 */\n    async scrollTo(pos: number, animate?: boolean, time?: number): Promise<void> {\n        verify(this._scroller);\n        if (pos < 0) {\n            console.warn(`invalid position, too small. [pos: ${pos}]`);\n            pos = 0;\n        } else if (this._scroller.posMax < pos) {\n            console.warn(`invalid position, too big. [pos: ${pos}]`);\n            pos = this._scroller.pos;\n        }\n        // pos のみ先駆けて更新\n        this._lastActivePageContext.pos = pos;\n        if (pos !== this._scroller.pos) {\n            await this._scroller.scrollTo(pos, animate, time);\n        }\n    }\n\n    /** インデックス指定された item の表示を保証 */\n    async ensureVisible(index: number, options?: ListEnsureVisibleOptions): Promise<void> {\n        const { _scroller, _items, _settings, _baseHeight } = this;\n\n        verify(_scroller);\n        if (index < 0 || _items.length <= index) {\n            throw makeResult(\n                RESULT_CODE.ERROR_UI_LISTVIEW_INVALID_PARAM,\n                `${toHelpString(RESULT_CODE.ERROR_UI_LISTVIEW_INVALID_PARAM)} ensureVisible() [invalid index: ${typeof index}]`\n            );\n        }\n\n        const operation = Object.assign({\n            partialOK: true,\n            setTop: false,\n            animate: _settings.enableAnimation,\n            time: _settings.animationDuration,\n            callback: noop,\n        }, options) as Required<ListEnsureVisibleOptions>;\n\n        const currentScope = {\n            from: _scroller.pos,\n            to: _scroller.pos + _baseHeight,\n        };\n\n        const target = _items[index];\n\n        const targetScope = {\n            from: target.offset,\n            to: target.offset + target.height,\n        };\n\n        const isInScope = (): boolean => {\n            if (operation.partialOK) {\n                if (targetScope.from <= currentScope.from) {\n                    return currentScope.from <= targetScope.to;\n                } else {\n                    return targetScope.from <= currentScope.to;\n                }\n            } else {\n                return currentScope.from <= targetScope.from && targetScope.to <= currentScope.to;\n            }\n        };\n\n        const detectPosition = (): number => {\n            return targetScope.from < currentScope.from\n                ? targetScope.from\n                : target.offset - target.height // bottom 合わせは情報不足により不可\n            ;\n        };\n\n        let pos: number;\n        if (operation.setTop) {\n            pos = targetScope.from;\n        } else if (isInScope()) {\n            operation.callback();\n            return; // noop\n        } else {\n            pos = detectPosition();\n        }\n\n        // 補正\n        if (pos < 0) {\n            pos = 0;\n        } else if (_scroller.posMax < pos) {\n            pos = _scroller.posMax;\n        }\n\n        await this.scrollTo(pos, operation.animate, operation.time);\n        operation.callback();\n    }\n\n///////////////////////////////////////////////////////////////////////\n// implements: IListBackupRestore\n\n    /** 内部データのバックアップを実行 */\n    backup(key: string): boolean {\n        if (null == this._backup[key]) {\n            this._backup[key] = { items: this._items };\n        }\n        return true;\n    }\n\n    /** 内部データのバックアップを実行 */\n    restore(key: string, rebuild: boolean): boolean {\n        if (null == this._backup[key]) {\n            return false;\n        }\n        if (0 < this._items.length) {\n            this.release();\n        }\n\n        this._addItem(this._backup[key].items);\n\n        if (rebuild) {\n            this.rebuild();\n        }\n\n        return true;\n    }\n\n    /** バックアップデータの有無を確認 */\n    hasBackup(key: string): boolean {\n        return null != this._backup[key];\n    }\n\n    /** バックアップデータの破棄 */\n    clearBackup(key?: string): boolean {\n        if (null == key) {\n            for (const key of Object.keys(this._backup)) {\n                delete this._backup[key];\n            }\n            return true;\n        } else if (null != this._backup[key]) {\n            delete this._backup[key];\n            return true;\n        } else {\n            return false;\n        }\n    }\n\n    /** バックアップデータにアクセス */\n    get backupData(): UnknownObject {\n        return this._backup;\n    }\n\n///////////////////////////////////////////////////////////////////////\n// internal:\n\n    /** @internal */\n    private get _config(): ListViewGlobalConfig {\n        return ListViewGlobalConfig();\n    }\n\n    /** Scroller 用環境設定 */\n    private setScrollerCondition(): void {\n        this._scroller?.on('scroll', this._scrollEventHandler);\n        this._scroller?.on('scrollstop', this._scrollStopEventHandler);\n    }\n\n    /** Scroller 用環境破棄 */\n    private resetScrollerCondition(): void {\n        this._scroller?.off('scrollstop', this._scrollStopEventHandler);\n        this._scroller?.off('scroll', this._scrollEventHandler);\n    }\n\n    /** 既定の Scroller オブジェクトの作成 */\n    private createScroller(): IListScroller {\n        return this._settings.scrollerFactory(this._$root[0], this._settings);\n    }\n\n    /** 現在の Page Index を取得 */\n    private getPageIndex(): number {\n        const { _scroller, _baseHeight, _pages } = this;\n        verify(_scroller);\n\n        const { pos: scrollPos, posMax: scrollPosMax } = _scroller;\n\n        const scrollMapSize = (() => {\n            const lastPage = this.getLastPage();\n            return lastPage ? lastPage.offset + lastPage.height : _baseHeight;\n        })();\n\n        const pos = (() => {\n            if (0 === scrollPosMax || scrollPosMax <= _baseHeight) {\n                return 0;\n            } else {\n                return scrollPos * scrollMapSize / scrollPosMax;\n            }\n        })();\n\n        const validRange = (page: PageProfile): boolean => {\n            if (null == page) {\n                return false;\n            } else if (page.offset <= pos && pos <= page.offset + page.height) {\n                return true;\n            } else {\n                return false;\n            }\n        };\n\n        let candidate = Math.floor(pos / _baseHeight);\n        if (_pages.length <= candidate) {\n            candidate = _pages.length - 1;\n        }\n\n        let page = _pages[candidate];\n        if (validRange(page)) {\n            return page.index;\n        } else if (pos < page.offset) {\n            for (let i = candidate - 1; i >= 0; i--) {\n                page = _pages[i];\n                if (validRange(page)) {\n                    return page.index;\n                }\n            }\n        } else {\n            for (let i = candidate + 1, n = _pages.length; i < n; i++) {\n                page = _pages[i];\n                if (validRange(page)) {\n                    return page.index;\n                }\n            }\n        }\n\n        console.warn(`cannot detect page index. fallback: ${_pages.length - 1}`);\n        return _pages.length - 1;\n    }\n\n    /** 最後のページを取得 */\n    private getLastPage(): PageProfile | undefined {\n        if (0 < this._pages.length) {\n            return this._pages[this._pages.length - 1];\n        } else {\n            return undefined;\n        }\n    }\n\n    /** スクロールイベント*/\n    private onScroll(pos: number): void {\n        if (this._active && 0 < this._pages.length) {\n            const currentPageIndex = this.getPageIndex();\n            // TODO: intersectionRect を使用する場合, Scroll ハンドラー全般はどうあるべきか要検討\n            if (Math.abs(pos - this._lastActivePageContext.pos) < this._settings.scrollRefreshDistance) {\n                if (this._lastActivePageContext.index !== currentPageIndex) {\n                    this.refresh();\n                }\n            }\n            this._lastActivePageContext.pos = pos;\n        }\n    }\n\n    /** スクロール停止イベント */\n    private onScrollStop(pos: number): void {\n        if (this._active && 0 < this._pages.length) {\n            const currentPageIndex = this.getPageIndex();\n            if (this._lastActivePageContext.index !== currentPageIndex) {\n                this.refresh();\n            }\n            this._lastActivePageContext.pos = pos;\n        }\n    }\n\n    /** ページ区分のアサイン */\n    private assignPage(from?: number): void {\n        this.clearPage(from);\n\n        const { _items, _pages, _baseHeight, _scroller } = this;\n        const basePage = this.getLastPage();\n        const nextItemIndex = basePage?.getItemLast()?.index ?? 0;\n        const asigneeItems  = _items.slice(nextItemIndex);\n\n        let workPage = basePage;\n        if (null == workPage) {\n            workPage = new PageProfile();\n            _pages.push(workPage);\n        }\n\n        for (const item of asigneeItems) {\n            if (_baseHeight <= workPage.height) {\n                workPage.normalize();\n                const newPage = new PageProfile();\n                newPage.index = workPage.index + 1;\n                newPage.offset = workPage.offset + workPage.height;\n                workPage = newPage;\n                _pages.push(workPage);\n            }\n            item.pageIndex = workPage.index;\n            workPage.push(item);\n        }\n\n        workPage.normalize();\n\n        _scroller?.update();\n    }\n\n    /** ページ区分の解除 */\n    private clearPage(from?: number): void {\n        this._pages.splice(from ?? 0);\n    }\n\n    /** inactive 用 Map の生成 */\n    private prepareInactiveMap(): DOM {\n        const { _config, _$map, _mapHeight } = this;\n        const $parent = _$map.parent();\n        let $inactiveMap = $parent.find(_config.INACTIVE_CLASS_SELECTOR);\n\n        if ($inactiveMap.length <= 0) {\n            const currentPageIndex = this.getPageIndex();\n            const $listItemViews = _$map.clone().children().filter((_, element: HTMLElement) => {\n                const pageIndex = Number($(element).attr(_config.DATA_PAGE_INDEX));\n                if (currentPageIndex - 1 <= pageIndex || pageIndex <= currentPageIndex + 1) {\n                    return true;\n                } else {\n                    return false;\n                }\n            });\n            $inactiveMap = $(`<section class=\"${_config.SCROLL_MAP_CLASS}\" \"${_config.INACTIVE_CLASS}\"></section>`)\n                .append($listItemViews)\n                .height(_mapHeight);\n            $parent.append($inactiveMap);\n            _$map.css('display', 'none');\n        }\n\n        return $inactiveMap;\n    }\n}\n","import {\n    type Writable,\n    type UnknownObject,\n    type DOM,\n    type DOMSelector,\n    type DOMEventListener,\n    dom as $,\n    type ViewConstructionOptions,\n    View,\n} from '@cdp/runtime';\nimport type {\n    ListContextOptions,\n    IListContext,\n    IListView,\n    ListEnsureVisibleOptions,\n    IListItemViewConstructor,\n} from './interfaces';\nimport { ListCore } from './core/list';\nimport { ItemProfile } from './profile';\n\n/** @internal */ const _properties = Symbol('properties');\n\n/** @internal */\ninterface Property {\n    readonly context: ListCore;\n}\n\n//__________________________________________________________________________________________________//\n\n/**\n * @en Interface class that stores {@link ListView} initialization information.\n * @ja {@link ListView} の初期化情報を格納するインターフェイスクラス\n */\nexport interface ListViewConstructOptions<TElement extends Node = HTMLElement, TFuncName = string>\n    extends ListContextOptions, ViewConstructionOptions<TElement, TFuncName> {\n    $el?: DOM<TElement>;\n    initialHeight?: number;\n}\n\n/**\n * @en Virtual list view class that provides memory management functionality.\n * @ja メモリ管理機能を提供する仮想リストビュークラス\n */\nexport abstract class ListView<TElement extends Node = HTMLElement, TEvent extends object = object>\n    extends View<TElement, TEvent> implements IListView {\n\n    /** @internal */\n    private readonly [_properties]!: Property;\n\n    /** constructor */\n    constructor(options?: ListViewConstructOptions<TElement>) {\n        super(options);\n\n        const opt = options ?? {};\n        (this[_properties] as Writable<Property>) = {\n            context: new ListCore(opt),\n        } as Property;\n\n        this.setElement((opt.$el ?? this.$el) as DOMSelector<TElement>);\n        if (opt.initialHeight) {\n            this[_properties].context.setBaseHeight(opt.initialHeight);\n        }\n    }\n\n    /** context accessor */\n    get context(): IListContext {\n        return this[_properties].context;\n    }\n\n///////////////////////////////////////////////////////////////////////\n// View component methods:\n\n    /** `this.el` 更新時の新しい HTML をレンダリングロジックの実装関数. モデル更新と View テンプレートを連動させる. */\n    abstract render(...args: unknown[]): any; // eslint-disable-line @typescript-eslint/no-explicit-any\n\n    /**\n     * @override\n     * @en Change the view's element (`this.el` property) and re-delegate the view's events on the new element.\n     * @ja View が管轄する要素 (`this.el` property) の変更. イベント再設定も実行\n     *\n     * @param el\n     *  - `en` Object or the selector string which becomes origin of element.\n     *  - `ja` 要素のもとになるオブジェクトまたはセレクタ文字列\n     */\n    override setElement(el: DOMSelector<TElement | string>): this {\n        if (this[_properties]) {\n            const { context } = this[_properties];\n            const $el = $(el);\n            context.destroy();\n            context.initialize($el as DOM<Node> as DOM, $el.height());\n        }\n        return super.setElement(el);\n    }\n\n    /**\n     * @override\n     * @en Remove this view by taking the element out of the DOM with release all listeners.\n     * @ja View から DOM を切り離し, リスナーを解除\n     */\n    override remove(): this {\n        this[_properties].context.destroy();\n        return super.remove();\n    }\n\n///////////////////////////////////////////////////////////////////////\n// implements: IListOperation\n\n    /**\n     * @en Determine whether it has been initialized.\n     * @ja 初期化済みか判定\n     *\n     * @returns\n     *  - `en` true: initialized / false: uninitialized\n     *  - `ja` true: 初期化済み / false: 未初期化\n     */\n    isInitialized(): boolean {\n        return this[_properties].context.isInitialized();\n    }\n\n    /**\n     * @en Item registration.\n     * @ja item 登録\n     *\n     * @param height\n     *  - `en` initial item's height\n     *  - `ja` item の高さ\n     * @param initializer\n     *  - `en` constructor for {@link IListItemView}'s subclass\n     *  - `ja` {@link IListItemView} のサブクラスのコンストラクタ\n     * @param info\n     *  - `en` init parameters for {@link IListItemView}'s subclass\n     *  - `ja` {@link IListItemView} のサブクラスの初期化パラメータ\n     * @param insertTo\n     *  - `en` specify the insertion position of item by index\n     *  - `ja` item の挿入位置をインデックスで指定\n     */\n    addItem(height: number, initializer: IListItemViewConstructor, info: UnknownObject, insertTo?: number): void {\n        this._addItem(new ItemProfile(this.context, Math.trunc(height), initializer, info), insertTo);\n    }\n\n    /**\n     * @internal\n     * @en Item registration (internal use).\n     * @ja item 登録 (内部用)\n     *\n     * @param item\n     *  - `en` {@link ItemProfile} instance\n     *  - `ja` {@link ItemProfile} インスタンス\n     * @param insertTo\n     *  - `en` specify the insertion position of item by index\n     *  - `ja` item の挿入位置をインデックスで指定\n     */\n    _addItem(item: ItemProfile | ItemProfile[], insertTo?: number): void {\n        this[_properties].context._addItem(item, insertTo);\n    }\n\n    /**\n     * @en Delete the specified Item.\n     * @ja 指定した Item を削除\n     *\n     * @param index\n     *  - `en` specify the index to start releasing\n     *  - `ja` 解除開始のインデックスを指定\n     * @param size\n     *  - `en` total number of items to release\n     *  - `ja` 解除する item の総数 [default: 1]\n     * @param delay\n     *  - `en` delay time to actually delete the element [default: 0 (immediate deletion)\n     *  - `ja` 実際に要素を削除する delay time [default: 0 (即時削除)]\n     */\n    removeItem(index: number, size?: number, delay?: number): void;\n\n    /**\n     * @en Delete the specified Item.\n     * @ja 指定した Item を削除\n     *\n     * @param index\n     *  - `en` specify target index array. it is more efficient to specify reverse index.\n     *  - `ja` 対象インデックス配列を指定. reverse index を指定するほうが効率的\n     * @param delay\n     *  - `en` delay time to actually delete the element [default: 0 (immediate deletion)\n     *  - `ja` 実際に要素を削除する delay time [default: 0 (即時削除)]\n     */\n    removeItem(index: number[], delay?: number): void;\n\n    removeItem(index: number | number[], arg2?: number, arg3?: number): void {\n        this[_properties].context.removeItem(index as number, arg2, arg3); // avoid ts(2345)\n    }\n\n    /**\n     * @en Get the information set for the specified item.\n     * @ja 指定した item に設定した情報を取得\n     *\n     * @param target\n     *  - `en` identifier [index | event object]\n     *  - `ja` 識別子. [index | event object]\n     */\n    getItemInfo(target: number | Event): UnknownObject {\n        return this[_properties].context.getItemInfo(target);\n    }\n\n    /**\n     * @en Refresh active pages.\n     * @ja アクティブページを更新\n     */\n    refresh(): this {\n        this[_properties].context.refresh();\n        return this;\n    }\n\n    /**\n     * @en Build unassigned pages.\n     * @ja 未アサインページを構築\n     */\n    update(): this {\n        this[_properties].context.update();\n        return this;\n    }\n\n    /**\n     * @en Rebuild page assignments.\n     * @ja ページアサインを再構成\n     */\n    rebuild(): this {\n        this[_properties].context.rebuild();\n        return this;\n    }\n\n    /**\n     * @override\n     * @en Destroy internal data.\n     * @ja 管轄データを破棄\n     */\n    override release(): this {\n        this[_properties].context.release();\n        return super.release();\n    }\n\n///////////////////////////////////////////////////////////////////////\n// implements: IListScrollable\n\n     /**\n     * @en Get scroll position.\n     * @ja スクロール位置を取得\n     */\n    get scrollPos(): number {\n        return this[_properties].context.scrollPos;\n    }\n\n     /**\n      * @en Get maximum scroll position.\n      * @ja スクロール位置の最大値を取得\n      */\n    get scrollPosMax(): number {\n        return this[_properties].context.scrollPosMax;\n    }\n\n     /**\n     * @en Scroll event handler setting/cancellation.\n     * @ja スクロールイベントハンドラ設定/解除\n     *\n     * @param handler\n     *  - `en` event handler function\n     *  - `ja` イベントハンドラー関数\n     * @param method\n     *  - `en` on: setting / off: canceling\n     *  - `ja` on: 設定 / off: 解除\n     */\n    setScrollHandler(handler: DOMEventListener, method: 'on' | 'off'): void {\n        this[_properties].context.setScrollHandler(handler, method);\n    }\n\n    /**\n     * @en Setting/cancelling scroll stop event handler.\n     * @ja スクロール終了イベントハンドラ設定/解除\n     *\n     * @param handler\n     *  - `en` event handler function\n     *  - `ja` イベントハンドラー関数\n     * @param method\n     *  - `en` on: setting / off: canceling\n     *  - `ja` on: 設定 / off: 解除\n     */\n    setScrollStopHandler(handler: DOMEventListener, method: 'on' | 'off'): void {\n        this[_properties].context.setScrollStopHandler(handler, method);\n    }\n\n    /**\n     * @en Set scroll position.\n     * @ja スクロール位置を指定\n     *\n     * @param pos\n     *  - `en` new scroll position value [0 - posMax]\n     *  - `ja` 新しいスクロール位置を指定 [0 - posMax]\n     * @param animate\n     *  - `en` enable/disable animation\n     *  - `ja` アニメーションの有無\n     * @param time\n     *  - `en` time spent on animation [msec]\n     *  - `ja` アニメーションに費やす時間 [msec]\n     */\n    scrollTo(pos: number, animate?: boolean, time?: number): Promise<void> {\n        return this[_properties].context.scrollTo(pos, animate, time);\n    }\n\n    /**\n     * @en Ensure visibility of item by index.\n     * @ja インデックス指定された item の表示を保証\n     *\n     * @param index\n     *  - `en` specify index of item\n     *  - `ja` item のインデックスを指定\n     * @param options\n     *  - `en` specify {@link ListEnsureVisibleOptions} object\n     *  - `ja` {@link ListEnsureVisibleOptions} オブジェクトを指定\n     */\n    ensureVisible(index: number, options?: ListEnsureVisibleOptions): Promise<void> {\n        return this[_properties].context.ensureVisible(index, options);\n    }\n\n///////////////////////////////////////////////////////////////////////\n// implements: IListBackupRestore\n\n    /**\n     * @en Execute a backup of internal data.\n     * @ja 内部データのバックアップを実行\n     *\n     * @param key\n     *  - `en` specify backup key (any identifier)\n     *  - `ja` バックアップキー(任意の識別子)を指定\n     * @returns\n     *  - `en` true: success / false: failure\n     *  - `ja` true: 成功 / false: 失敗\n     */\n    backup(key: string): boolean {\n        return this[_properties].context.backup(key);\n    }\n\n    /**\n     * @en Execute a backup of internal data.\n     * @ja 内部データのバックアップを実行\n     *\n     * @param key\n     *  - `en` specify backup key (the one used for `backup()`)\n     *  - `ja` バックアップキーを指定 (`backup()` に使用したもの)\n     * @param rebuild\n     *  - `en` specify true to rebuild the list structure\n     *  - `ja` リスト構造を再構築する場合は true を指定\n     * @returns\n     *  - `en` true: success / false: failure\n     *  - `ja` true: 成功 / false: 失敗\n     */\n    restore(key: string, rebuild: boolean): boolean {\n        return this[_properties].context.restore(key, rebuild);\n    }\n\n    /**\n     * @en Check whether backup data exists.\n     * @ja バックアップデータの有無を確認\n     *\n     * @param key\n     *  - `en` specify backup key (the one used for `backup()`)\n     *  - `ja` バックアップキーを指定 (`backup()` に使用したもの)\n     * @returns\n     *  - `en` true: exists / false: not exists\n     *  - `ja` true: 有 / false: 無\n     */\n    hasBackup(key: string): boolean {\n        return this[_properties].context.hasBackup(key);\n    }\n\n    /**\n     * @en Discard backup data.\n     * @ja バックアップデータの破棄\n     *\n     * @param key\n     *  - `en` specify backup key (the one used for `backup()`)\n     *  - `ja` バックアップキーを指定 (`backup()` に使用したもの)\n     * @returns\n     *  - `en` true: discard existing data / false: specified data does not exist\n     *  - `ja` true: 存在したデータを破棄 / false: 指定されたデータは存在しない\n     */\n    clearBackup(key?: string): boolean {\n        return this[_properties].context.clearBackup(key);\n    }\n\n    /**\n     * @en Access backup data.\n     * @ja バックアップデータにアクセス\n     */\n    get backupData(): UnknownObject {\n        return this[_properties].context.backupData;\n    }\n}\n","import type { Writable } from '@cdp/runtime';\nimport type { IExpandableListView } from './interfaces';\nimport type { GroupProfile } from './profile';\nimport { type ListItemViewConstructionOptions, ListItemView } from './list-item-view';\n\n/** @internal */ const _properties = Symbol('properties');\n\n/** @internal */\ninterface Property {\n    readonly group: GroupProfile;\n}\n\n//__________________________________________________________________________________________________//\n\n/**\n * @en Options to pass to {@link ExpandableListItemView} construction.\n * @ja {@link ExpandableListItemView} 構築に渡すオプション\n */\nexport interface ExpandableListItemViewConstructionOptions<TElement extends Node = HTMLElement, TFuncName = string>\n    extends ListItemViewConstructionOptions<TElement, TFuncName> {\n    owner: IExpandableListView;\n    /** {@link GroupProfile} instance */\n    group: GroupProfile;\n}\n\n/**\n * @en List item container class handled by {@link ExpandableListView}.\n * @ja {@link ExpandableListView} が扱うリストアイテムコンテナクラス\n */\nexport abstract class ExpandableListItemView<TElement extends Node = HTMLElement, TEvent extends object = object>\n    extends ListItemView<TElement, TEvent> {\n\n    /** @internal */\n    private readonly [_properties]!: Property;\n\n    /** constructor */\n    constructor(options: ExpandableListItemViewConstructionOptions<TElement>) {\n        super(options);\n        const { group } = options;\n        (this[_properties] as Writable<Property>) = { group } as Property;\n    }\n\n///////////////////////////////////////////////////////////////////////\n// protected methods:\n\n    /**\n     * @en Check expanded / collapsed status.\n     * @ja 展開状態を判定\n     *\n     * @returns\n     *  - `en` true: expanded, collapsed: close\n     *  - `ja` true: 展開, false: 収束\n     */\n    protected get isExpanded(): boolean {\n        return this[_properties].group.isExpanded;\n    }\n\n    /**\n     * @en Determine whether the list is during expanding.\n     * @ja 展開中か判定\n     */\n    protected get isExpanding(): boolean {\n        return (this.owner as IExpandableListView).isExpanding;\n    }\n\n    /**\n     * @en Determine whether the list is during collapsing.\n     * @ja 収束中か判定\n     */\n    protected get isCollapsing(): boolean {\n        return (this.owner as IExpandableListView).isCollapsing;\n    }\n\n    /**\n     * @en Determine whether the list is during expanding or collapsing.\n     * @ja 開閉中か判定\n     */\n    protected get isSwitching(): boolean {\n        return (this.owner as IExpandableListView).isSwitching;\n    }\n\n    /**\n     * @en Determine if it has a child {@link GroupProfile}. <br>\n     *     If `layoutKey` is specified, whether the layout information matches is also added to the judgment condition.\n     * @ja 子 {@link GroupProfile} を持っているか判定 <br>\n     *     `layoutKey` が指定されれば、layout 情報が一致しているかも判定条件に加える\n     *\n     * @param layoutKey\n     *  - `en` identifier for each layout\n     *  - `ja` レイアウト毎の識別子\n     * @returns\n     *  - `en` true: exists, false: unexists\n     *  - `ja` true: 有, false: 無\n     */\n    protected hasChildren(layoutKey?: string): boolean {\n        return this[_properties].group.hasChildren(layoutKey);\n    }\n}\n","import { type UnknownObject, luid } from '@cdp/runtime';\nimport type {\n    IExpandOperation,\n    IListLayoutKeyHolder,\n    IListStatusManager,\n    IListBackupRestore,\n    IExpandableListContext,\n} from '../interfaces';\nimport { GroupProfile } from '../profile';\n\n/**\n * @internal\n * @en Core logic implementation class that manages expanding / collapsing state.\n * @ja 開閉状態管理を行うコアロジック実装クラス\n */\nexport class ExpandCore implements\n    IExpandOperation,\n    IListLayoutKeyHolder,\n    IListStatusManager,\n    IListBackupRestore {\n\n    private readonly _owner: IExpandableListContext;\n\n    // TODO: owner との各データの所有権の見直し (backupData?)\n    /** { id: GroupProfile } */\n    private _mapGroups: Record<string, GroupProfile> = {};\n    /** 第1階層 GroupProfile を格納 */\n    private _aryTopGroups: GroupProfile[] = [];\n    /** layoutKey を格納 */\n    private _layoutKey?: string;\n\n    /**\n     * constructor\n     * @param owner 親 View のインスタンス\n     */\n    constructor(owner: IExpandableListContext) {\n        this._owner = owner;\n    }\n\n    /** データを破棄 */\n    public release(): void {\n        this._mapGroups = {};\n        this._aryTopGroups = [];\n    }\n\n///////////////////////////////////////////////////////////////////////\n// implements: IExpandOperation\n\n    /** 新規 GroupProfile を作成 */\n    newGroup(id?: string): GroupProfile {\n        id = id ?? luid('list-group', 4);\n        if (null != this._mapGroups[id]) {\n            return this._mapGroups[id];\n        }\n        const group = new GroupProfile(this._owner, id);\n        this._mapGroups[id] = group;\n        return group;\n    }\n\n    /** 登録済み Group を取得 */\n    getGroup(id: string): GroupProfile | undefined {\n        return this._mapGroups[id];\n    }\n\n    /** 第1階層の Group 登録 */\n    registerTopGroup(topGroup: GroupProfile): void {\n        // すでに登録済みの場合は restore して layout キーごとに復元する。\n        if ('registered' === topGroup.status) {\n            // TODO: orientation changed 時の layout キー変更対応だが、キーに変更が無いときは不具合となる。\n            // この API に実装が必要かも含めて見直しが必要\n            topGroup.restore();\n            return;\n        }\n\n        const lastGroup = this._aryTopGroups[this._aryTopGroups.length - 1];\n        const insertTo = lastGroup?.getNextItemIndex(true) ?? 0;\n\n        this._aryTopGroups.push(topGroup);\n        topGroup.register(insertTo);\n    }\n\n    /** 第1階層の Group を取得 */\n    getTopGroups(): GroupProfile[] {\n        return this._aryTopGroups.slice(0);\n    }\n\n    /** すべてのグループを展開 (1階層) */\n    async expandAll(): Promise<void> {\n        const promisies: Promise<void>[] = [];\n        for (const group of this._aryTopGroups) {\n            promisies.push(group.expand());\n        }\n        await Promise.all(promisies);\n    }\n\n    /** すべてのグループを収束 (1階層) */\n    async collapseAll(delay?: number): Promise<void> {\n        const promisies: Promise<void>[] = [];\n        for (const group of this._aryTopGroups) {\n            promisies.push(group.collapse(delay));\n        }\n        await Promise.all(promisies);\n    }\n\n    /** 展開中か判定 */\n    get isExpanding(): boolean {\n        return this._owner.isStatusIn('expanding');\n    }\n\n    /** 収束中か判定 */\n    get isCollapsing(): boolean {\n        return this._owner.isStatusIn('collapsing');\n    }\n\n    /** 開閉中か判定 */\n    get isSwitching(): boolean {\n        return this.isExpanding || this.isCollapsing;\n    }\n\n///////////////////////////////////////////////////////////////////////\n// implements: IListLayoutKeyHolder\n\n    /** layout key を取得 */\n    get layoutKey(): string | undefined {\n        return this._layoutKey;\n    }\n\n    /** layout key を設定 */\n    set layoutKey(key: string) {\n        this._layoutKey = key;\n    }\n\n///////////////////////////////////////////////////////////////////////\n// implements: IListStatusManager\n\n    /** 状態変数の参照カウントのインクリメント */\n    statusAddRef(status: string): number {\n        return this._owner.statusAddRef(status);\n    }\n\n    /** 状態変数の参照カウントのデクリメント */\n    statusRelease(status: string): number {\n        return this._owner.statusRelease(status);\n    }\n\n    /** 処理スコープ毎に状態変数を設定 */\n    statusScope<T>(status: string, executor: () => T | Promise<T>): Promise<T> {\n        return this._owner.statusScope(status, executor);\n    }\n\n    /** 指定した状態中であるか確認 */\n    isStatusIn(status: string): boolean {\n        return this._owner.isStatusIn(status);\n    }\n\n///////////////////////////////////////////////////////////////////////\n// implements: IListBackupRestore\n\n    /** 内部データをバックアップ */\n    backup(key: string): boolean {\n        const _backup = this.backupData;\n        if (null == _backup[key]) {\n            _backup[key] = {\n                map: this._mapGroups,\n                tops: this._aryTopGroups,\n            };\n        }\n        return true;\n    }\n\n    /** 内部データをリストア */\n    restore(key: string, rebuild = true): boolean {\n        const backup = this.backupData[key] as UnknownObject;\n        if (null == backup) {\n            return false;\n        }\n\n        if (0 < this._aryTopGroups.length) {\n            this.release();\n        }\n\n        this._mapGroups = backup.map as Record<string, GroupProfile>;\n        this._aryTopGroups = backup.tops as GroupProfile[];\n\n        // layout 情報の確認\n        if (!this._aryTopGroups[0]?.hasLayoutKeyOf(this.layoutKey!)) {\n            return false;\n        }\n\n        // 展開しているものを登録\n        for (const group of this._aryTopGroups) {\n            group.restore();\n        }\n\n        // 再構築の予約\n        rebuild && this._owner.rebuild();\n        return true;\n    }\n\n    /** バックアップデータの有無 */\n    hasBackup(key: string): boolean {\n        return this._owner.hasBackup(key);\n    }\n\n    /** バックアップデータの破棄 */\n    clearBackup(key?: string): boolean {\n        return this._owner.clearBackup(key);\n    }\n\n    /** バックアップデータにアクセス */\n    get backupData(): UnknownObject {\n        return this._owner.backupData;\n    }\n}\n","import {\n    type Writable,\n    statusAddRef,\n    statusRelease,\n    statusScope,\n    isStatusIn,\n} from '@cdp/runtime';\nimport type { IExpandableListView } from './interfaces';\nimport { ExpandCore } from './core';\nimport type { GroupProfile } from './profile';\nimport { type ListViewConstructOptions, ListView } from './list-view';\n\n/** @internal */ const _properties = Symbol('properties');\n\n/** @internal */\ninterface Property {\n    readonly context: ExpandCore;\n}\n\n//__________________________________________________________________________________________________//\n\n/**\n * @en Virtual list view class with expanding / collapsing functionality.\n * @ja 開閉機能を備えた仮想リストビュークラス\n */\nexport abstract class ExpandableListView<TElement extends Node = HTMLElement, TEvent extends object = object>\n    extends ListView<TElement, TEvent> implements IExpandableListView {\n\n    /** @internal */\n    private readonly [_properties]!: Property;\n\n    /** constructor */\n    constructor(options?: ListViewConstructOptions<TElement>) {\n        super(options);\n        (this[_properties] as Writable<Property>) = {\n            context: new ExpandCore(this),\n        } as Property;\n    }\n\n///////////////////////////////////////////////////////////////////////\n// implements: IExpandableListView\n\n    /**\n     * @en Create a new {@link GroupProfile}. Return the object if it is already registered.\n     * @ja 新規 {@link GroupProfile} を作成. 登録済みの場合はそのオブジェクトを返却\n     *\n     * @param id\n     *  - `en` specify the newly created group id. if not specified, automatic allocation will be performed.\n     *  - `ja` 新規に作成する Group ID を指定. 指定しない場合は自動割り振り\n     */\n    newGroup(id?: string): GroupProfile {\n        return this[_properties].context.newGroup(id);\n    }\n\n    /**\n     * @en Get registered {@link GroupProfile}.\n     * @ja 登録済み {@link GroupProfile} を取得\n     *\n     * @param id\n     *  - `en` specify the Group ID to retrieve\n     *  - `ja` 取得する Group ID を指定\n     */\n    getGroup(id: string): GroupProfile | undefined {\n        return this[_properties].context.getGroup(id);\n    }\n\n    /**\n     * @en 1st layer {@link GroupProfile} registration.\n     * @ja 第1階層の {@link GroupProfile} 登録\n     *\n     * @param topGroup\n     *  - `en` constructed {@link GroupProfile} instance\n     *  - `ja` 構築済み {@link GroupProfile} インスタンス\n     */\n    registerTopGroup(topGroup: GroupProfile): void {\n        this[_properties].context.registerTopGroup(topGroup);\n    }\n\n    /**\n     * @en Get 1st layer {@link GroupProfile}. <br>\n     *     A copy array is returned, so the client cannot cache it.\n     * @ja 第1階層の {@link GroupProfile} を取得 <br>\n     *     コピー配列が返されるため、クライアントはキャッシュ不可\n     */\n    getTopGroups(): GroupProfile[] {\n        return this[_properties].context.getTopGroups();\n    }\n\n    /**\n     * @en Expand all groups (1st layer)\n     * @ja すべてのグループを展開 (1階層)\n     */\n    expandAll(): Promise<void> {\n        return this[_properties].context.expandAll();\n    }\n\n    /**\n     * @en Collapse all groups (1st layer)\n     * @ja すべてのグループを収束 (1階層)\n     */\n    collapseAll(delay?: number): Promise<void> {\n        return this[_properties].context.collapseAll(delay);\n    }\n\n    /**\n     * @en Determine whether the list is during expanding.\n     * @ja 展開中か判定\n     */\n    get isExpanding(): boolean {\n        return this[_properties].context.isExpanding;\n    }\n\n    /**\n     * @en Determine whether the list is during collapsing.\n     * @ja 収束中か判定\n     */\n    get isCollapsing(): boolean {\n        return this[_properties].context.isCollapsing;\n    }\n\n    /**\n     * @en Determine whether the list is during expanding or collapsing.\n     * @ja 開閉中か判定\n     */\n    get isSwitching(): boolean {\n        return this[_properties].context.isSwitching;\n    }\n\n    /**\n     * @en Increment reference count for status identifier.\n     * @ja 状態変数の参照カウントのインクリメント\n     *\n     * @param status\n     *  - `en` state identifier\n     *  - `ja` 状態識別子\n     * @returns\n     *  - `en` reference count value\n     *  - `ja` 参照カウントの値\n     */\n    statusAddRef(status: string): number {\n        return statusAddRef(status);\n    }\n\n    /**\n     * @en Decrement reference count for status identifier.\n     * @ja 状態変数の参照カウントのデクリメント\n     *\n     * @param status\n     *  - `en` state identifier\n     *  - `ja` 状態識別子\n     * @returns\n     *  - `en` reference count value\n     *  - `ja` 参照カウントの値\n     */\n    statusRelease(status: string): number {\n        return statusRelease(status);\n    }\n\n    /**\n     * @en State variable management scope\n     * @ja 状態変数管理スコープ\n     *\n     * @param status\n     *  - `en` state identifier\n     *  - `ja` 状態識別子\n     * @param executor\n     *  - `en` seed function.\n     *  - `ja` 対象の関数\n     * @returns\n     *  - `en` retval of seed function.\n     *  - `ja` 対象の関数の戻り値\n     */\n    statusScope<T>(status: string, executor: () => T | Promise<T>): Promise<T> {\n        return statusScope(status, executor);\n    }\n\n    /**\n     * @en Check if it's in the specified state.\n     * @ja 指定した状態中であるか確認\n     *\n     * @param status\n     *  - `en` state identifier\n     *  - `ja` 状態識別子\n     * @return {Boolean} true: 状態内 / false: 状態外\n     * @returns\n     *  - `en` `true`: within the status / `false`: out of the status\n     *  - `ja` `true`: 状態内 / `false`: 状態外\n     */\n    isStatusIn(status: string): boolean {\n        return isStatusIn(status);\n    }\n\n    /** @internal layout key を取得 */\n    get layoutKey(): string | undefined {\n        return this[_properties].context.layoutKey;\n    }\n\n    /** @internal layout key を設定 */\n    set layoutKey(key: string) {\n        this[_properties].context.layoutKey = key;\n    }\n\n///////////////////////////////////////////////////////////////////////\n// override: ListView\n\n    /**\n     * @override\n     * @en Destroy internal data.\n     * @ja 管轄データを破棄\n     */\n    override release(): this {\n        super.release();\n        this[_properties].context.release();\n        return this;\n    }\n\n    /**\n     * @override\n     * @en Execute a backup of internal data.\n     * @ja 内部データのバックアップを実行\n     *\n     * @param key\n     *  - `en` specify backup key (any identifier)\n     *  - `ja` バックアップキー(任意の識別子)を指定\n     * @returns\n     *  - `en` true: success / false: failure\n     *  - `ja` true: 成功 / false: 失敗\n     */\n    override backup(key: string): boolean {\n        return this[_properties].context.backup(key);\n    }\n\n    /**\n     * @override\n     * @en Execute a backup of internal data.\n     * @ja 内部データのバックアップを実行\n     *\n     * @param key\n     *  - `en` specify backup key (the one used for `backup()`)\n     *  - `ja` バックアップキーを指定 (`backup()` に使用したもの)\n     * @param rebuild\n     *  - `en` specify true to rebuild the list structure\n     *  - `ja` リスト構造を再構築する場合は true を指定\n     * @returns\n     *  - `en` true: success / false: failure\n     *  - `ja` true: 成功 / false: 失敗\n     */\n    override restore(key: string, rebuild = true): boolean {\n        return this[_properties].context.restore(key, rebuild);\n    }\n}\n","import './result-code-defs';\nexport * from './interfaces';\nexport * from './global-config';\nexport * from './profile';\nexport * from './list-item-view';\nexport * from './list-view';\nexport * from './expandable-list-item-view';\nexport * from './expandable-list-view';\n\n// TODO: test\nexport const UI_LISTVIEW_STATUS = 'UNDER CONSTRUCTION';\n"],"mappings":"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","ignoreList":[]}