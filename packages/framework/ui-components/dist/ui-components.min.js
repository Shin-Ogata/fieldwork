/*!
 * @cdp/ui-components 0.9.18
 *   ui-componets collection
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@cdp/runtime")):"function"==typeof define&&define.amd?define(["exports","@cdp/runtime"],e):(t="undefined"!=typeof globalThis?globalThis:t||self,e(t.CDP=t.CDP||{},t.CDP))}(this,(function(t,e){"use strict";!function(){let t=CDP_DECLARE.RESULT_CODE;t[t.UI_UTILS_DECLARE=9007199254740991]="UI_UTILS_DECLARE",void(t[t.ERROR_UI_UTILS_FATAL=CDP_DECLARE.DECLARE_ERROR_CODE(100,121,"UI utils something wrong.")]="ERROR_UI_UTILS_FATAL")}();const s=e.safe(globalThis.getComputedStyle),i=t=>{const e=s(t),{m11:i,m22:r,m33:n,m41:o,m42:a,m43:h}=new DOMMatrixReadOnly(e.transform);return{translateX:o,translateY:a,translateZ:h,scaleX:i,scaleY:r,scaleZ:n}},r=(t,e,s,i="ease")=>{const r=`${s/1e3}s ${i}`;t.style.setProperty("transition",`${e} ${r}, transform ${r}`)},n=t=>{t.style.removeProperty("transition")},o=new CSSStyleSheet;o.replaceSync("div{display:block;-webkit-text-decoration-skip:ink;text-decoration-skip-ink:auto;}");const a=new CSSStyleSheet;a.replaceSync("div{display:block;-webkit-text-decoration-skip:ink;text-decoration-skip-ink:auto;}");void e.post(e.noop(o,a)),function(){let t=CDP_DECLARE.RESULT_CODE;t[t.UI_LISTVIEW_DECLARE=9007199254740991]="UI_LISTVIEW_DECLARE",t[t.ERROR_UI_LISTVIEW_INVALID_INITIALIZATION=CDP_DECLARE.DECLARE_ERROR_CODE(100,141,"listview has invalid initialization.")]="ERROR_UI_LISTVIEW_INVALID_INITIALIZATION",t[t.ERROR_UI_LISTVIEW_INVALID_PARAM=CDP_DECLARE.DECLARE_ERROR_CODE(100,142,"listview given a invalid param.")]="ERROR_UI_LISTVIEW_INVALID_PARAM",void(t[t.ERROR_UI_LISTVIEW_INVALID_OPERATION=CDP_DECLARE.DECLARE_ERROR_CODE(100,143,"listview invalid operation.")]="ERROR_UI_LISTVIEW_INVALID_OPERATION")}();const h={NAMESPACE:"cdp-ui",SCROLL_MAP_CLASS:"cdp-ui-listview-scroll-map",INACTIVE_CLASS:"cdp-ui-inactive",RECYCLE_CLASS:"cdp-ui-listview-recycle",LISTITEM_BASE_CLASS:"cdp-ui-listview-item-base",DATA_PAGE_INDEX:"data-page-index",DATA_ITEM_INDEX:"data-item-index"},l=t=>{if(t){(t=>{const{NAMESPACE:e,SCROLL_MAP_CLASS:s,INACTIVE_CLASS:i,RECYCLE_CLASS:r,LISTITEM_BASE_CLASS:n,DATA_PAGE_INDEX:o,DATA_ITEM_INDEX:a}=t,h=e,l=s??(e?`${e}-listview-scroll-map`:void 0),_=i??(e?`${e}-inactive`:void 0),c=r??(e?`${e}-listview-recycle`:void 0),p=n??(e?`${e}-listview-item-base`:void 0);return Object.assign(t,{NAMESPACE:h,SCROLL_MAP_CLASS:l,INACTIVE_CLASS:_,RECYCLE_CLASS:c,LISTITEM_BASE_CLASS:p,DATA_PAGE_INDEX:o,DATA_ITEM_INDEX:a})})(t);for(const e of Object.keys(t))void 0===t[e]&&delete t[e]}return Object.assign({},Object.assign(h,t))};class _{_owner;_height;_initializer;_info;_index;_pageIndex;_offset=0;_$base;_instance;constructor(t,e,s,i){this._owner=t,this._height=e,this._initializer=s,this._info=i}get height(){return this._height}get index(){return this._index}set index(t){this._index=t,this.updateIndex()}get pageIndex(){return this._pageIndex}set pageIndex(t){this._pageIndex=t,this.updatePageIndex()}get offset(){return this._offset}set offset(t){this._offset=t,this.updateOffset()}get info(){return this._info}activate(){if(null==this._instance){this._$base=this.prepareBaseElement(),this.updateIndex(),this.updateOffset();const t=Object.assign({el:this._$base,owner:this._owner,item:this},this._info);this._instance=new this._initializer(t),"none"===this._$base.css("display")&&this._$base.css("display","block")}this.updatePageIndex(),this._$base&&"visible"!==this._$base.css("visibility")&&this._$base.css("visibility","visible")}hide(){null==this._instance&&this.activate(),this._$base&&"hidden"!==this._$base.css("visibility")&&this._$base.css("visibility","hidden")}deactivate(){null!=this._instance&&(this._instance.remove(),this._instance=void 0,this._$base?.addClass(this._config.RECYCLE_CLASS),this._$base?.css("display","none"),this._$base=void 0)}refresh(){null!=this._instance&&this._instance.render()}isActive(){return null!=this._instance}updateHeight(t,e){const s=t-this._height;this._height=t,this._owner.updateScrollMapHeight(s),e?.reflectAll&&this._owner.updateProfiles(this._index??0)}resetDepth(){null!=this._instance&&this._$base?.css("z-index",this._owner.options.baseDepth)}get _config(){return l()}prepareBaseElement(){let t;const s=this._owner.findRecycleElements().first(),i=this._owner.options.itemTagName;return null!=this._$base?(void 0,this._$base):(0<s.length?(t=s,t.removeAttr("z-index"),t.removeClass(this._config.RECYCLE_CLASS)):(t=e.dom(`<${i} class="${this._config.LISTITEM_BASE_CLASS}"></"${i}">`),t.css("display","none"),this._owner.$scrollMap.append(t)),t.height()!==this._height&&t.height(this._height),t)}updateIndex(){this._$base&&this._$base.attr(this._config.DATA_ITEM_INDEX)!==String(this._index)&&this._$base.attr(this._config.DATA_ITEM_INDEX,this._index)}updatePageIndex(){this._$base&&this._$base.attr(this._config.DATA_PAGE_INDEX)!==String(this._pageIndex)&&this._$base.attr(this._config.DATA_PAGE_INDEX,this._pageIndex)}updateOffset(){if(this._$base)if(this._owner.options.enableTransformOffset){const{translateY:t}=i(this._$base[0]);t!==this._offset&&this._$base.css("transform",`translate3d(0,${this._offset}px,0`)}else{const t=parseInt(this._$base.css("top"),10);t!==this._offset&&this._$base.css("top",`${this._offset}px`)}}}class c{_index=0;_offset=0;_height=0;_items=[];_status="inactive";get index(){return this._index}set index(t){this._index=t}get offset(){return this._offset}set offset(t){this._offset=t}get height(){return this._height}get status(){return this._status}activate(){if("active"!==this._status)for(const t of this._items)t.activate();this._status="active"}hide(){if("hidden"!==this._status)for(const t of this._items)t.hide();this._status="hidden"}deactivate(){if("inactive"!==this._status)for(const t of this._items)t.deactivate();this._status="inactive"}push(t){this._items.push(t),this._height+=t.height}normalize(){const t=this._items.every((t=>t.isActive()));t||(this._status="inactive")}getItem(t){return e.at(this._items,t)}getItemFirst(){return this._items[0]}getItemLast(){return this._items[this._items.length-1]}}class p{_id;_owner;_parent;_children=[];_expanded=!1;_status="unregistered";_items=[];constructor(t,e){this._id=e,this._owner=t}get id(){return this._id}get status(){return this._status}get isExpanded(){return this._expanded}get parent(){return this._parent}get children(){return this._children}getNextItemIndex(t=!1){let e=[];return t&&(e=this.queryOperationTarget("active")),(null==e||e.length<=0)&&(e=this._items),(e[e.length-1]?.index??0)+1}addItem(t,e,s){const i=Object.assign({group:this},s),r=new _(this._owner.context,Math.trunc(t),e,i);return"registered"===this._status&&(this._owner._addItem(r,this.getNextItemIndex()),this._owner.update()),this._items.push(r),this}addChildren(t){const e=Array.isArray(t)?t:[t];for(const t of e)t.setParent(this);return this._children.push(...e),this}get hasChildren(){return!!this._children.length}async expand(){if(!this.isExpanded){const t=this.queryOperationTarget("registered");0<t.length&&await this._owner.statusScope("expanding",(()=>{for(const t of this._items)t.refresh();this._owner._addItem(t,this.getNextItemIndex()),this._owner.update()}))}this._expanded=!0}async collapse(t){if(this.isExpanded){const e=this.queryOperationTarget("unregistered");0<e.length&&(t=t??this._owner.context.options.animationDuration,await this._owner.statusScope("collapsing",(()=>{for(const t of this._items)t.refresh();e[0].index&&this._owner.removeItem(e[0].index,e.length,t),this._owner.update()})))}this._expanded=!1}async ensureVisible(t){0<this._items.length?this._items[0].index&&await this._owner.ensureVisible(this._items[0].index,t):t?.callback?.(this._owner.scrollPos)}async toggle(t){this._expanded?await this.collapse(t):await this.expand()}register(t){if(this._parent)throw e.makeResult(e.RESULT_CODE.ERROR_UI_LISTVIEW_INVALID_PARAM,`${e.toHelpString(e.RESULT_CODE.ERROR_UI_LISTVIEW_INVALID_PARAM)} 'GroupProfile#register' method is acceptable only 1st layer group.`);return this._owner._addItem(this.preprocess("registered"),t),this}restore(){if(this._parent)throw e.makeResult(e.RESULT_CODE.ERROR_UI_LISTVIEW_INVALID_PARAM,`${e.toHelpString(e.RESULT_CODE.ERROR_UI_LISTVIEW_INVALID_PARAM)} 'GroupProfile#restore' method is acceptable only 1st layer group.`);if(this._items){const t=this._expanded?this._items.concat(this.queryOperationTarget("active")):this._items.slice();this._owner._addItem(t)}return this}setParent(t){this._parent=t}preprocess(t){const e=[];return t!==this._status&&e.push(...this._items),this._status=t,e}queryOperationTarget(t){const e=s=>{const i=[];for(const r of s._children){switch(t){case"registered":case"unregistered":i.push(...r.preprocess(t));break;case"active":null!=r._items&&i.push(...r._items)}r.isExpanded&&i.push(...e(r))}return i};return e(this)}}const u=Symbol("properties");class d extends e.View{[u];constructor(t){super(t);const{owner:e,item:s}=t;this[u]={owner:e,item:s}}get owner(){return this[u].owner}remove(){return this.$el.children().remove(),this.$el.off(),this.setElement("null"),this.stopListening(),this}get index(){return this[u].item.index}get height(){return this[u].item.height}get hasChildNode(){return!!this.$el?.children().length}updateHeight(t,e){return this.$el&&this.height!==t&&(this[u].item.updateHeight(t,e),this.$el.height(t)),this}}class g{_$target;_$scrollMap;_options;_scrollStopTrigger;_scrollDuration;constructor(t,s,i){let r;this._$target=e.dom(t),this._$scrollMap=this._$target.children().first(),this._options=i,this._scrollStopTrigger=()=>{null!=r&&e.clearTimeout(r),r=e.setTimeout((()=>{this._$target.trigger(new CustomEvent("scrollstop",{bubbles:!0,cancelable:!0}))}),this._scrollDuration??50)},this._$target.on("scroll",this._scrollStopTrigger)}static get TYPE(){return"cdp:element-overflow-scroller"}static getFactory(){const t=(t,e,s)=>new g(t,e,s);return Object.defineProperties(t,{type:{configurable:!1,writable:!1,enumerable:!0,value:g.TYPE}}),t}get type(){return g.TYPE}get pos(){return this._$target.scrollTop()}get posMax(){return Math.max(this._$scrollMap.height()-this._$target.height(),0)}on(t,e){this._$target.on(t,e)}off(t,e){this._$target.off(t,e)}scrollTo(t,e,s){return t===this._$target.scrollTop()?Promise.resolve():new Promise((i=>{this._scrollDuration=e??this._options.enableAnimation?s??this._options.animationDuration:void 0,this._$target.scrollTop(t,this._scrollDuration,void 0,(()=>{this._scrollDuration=void 0,i()}))}))}update(){}destroy(){this._$target?.off(),this._$target=this._$scrollMap=null}}const I={scrollerFactory:g.getFactory(),enableHiddenPage:!1,enableTransformOffset:!1,scrollMapRefreshInterval:200,scrollRefreshDistance:200,pagePrepareCount:3,pagePreloadCount:1,enableAnimation:!0,animationDuration:0,baseDepth:"auto",itemTagName:"div",removeItemWithTransition:!0,useDummyInactiveScrollMap:!1},m=e.dom();function f(t){if(null==t)throw e.makeResult(e.RESULT_CODE.ERROR_UI_LISTVIEW_INVALID_INITIALIZATION)}class E{_$root;_$map;_mapHeight=0;_scroller;_active=!0;_settings;_scrollEventHandler;_scrollStopEventHandler;_baseHeight=0;_items=[];_pages=[];_lastActivePageContext={index:0,from:0,to:0,pos:0};_backup={};constructor(t){this._$root=this._$map=m,this._settings=Object.assign({},I,t),this._scrollEventHandler=()=>{this.onScroll(this._scroller.pos)},this._scrollStopEventHandler=()=>{this.onScrollStop(this._scroller.pos)}}initialize(t,s){this._$root.length&&this.destroy(),this._$root=function i(t){const e=t.css("overflow-y");return"hidden"!==e&&"visible"!==e||t.css("overflow-y","auto"),t}(t),this._$map=function r(t,s){let i=t.find(`.${s}`);return i.length<=0&&(i=e.dom(`<div class="${s}"></div>`),t.append(i)),i}(this._$root,this._config.SCROLL_MAP_CLASS),this._scroller=this.createScroller(),this.setBaseHeight(s),this.setScrollerCondition()}destroy(){this.resetScrollerCondition(),this._scroller?.destroy(),this._scroller=void 0,this.release(),this._$root=this._$map=m}setBaseHeight(t){if(t<=0)throw e.makeResult(e.RESULT_CODE.ERROR_UI_LISTVIEW_INVALID_PARAM,`${e.toHelpString(e.RESULT_CODE.ERROR_UI_LISTVIEW_INVALID_PARAM)} [base hight: ${t}]`);this._baseHeight=t,this._scroller?.update()}async setActiveState(t){this._active=t,await this.treatScrollPosition()}get active(){return this._active}async treatScrollPosition(){f(this._scroller);const t=this._scroller.pos-this._lastActivePageContext.pos,{useDummyInactiveScrollMap:e}=this._settings;if(this._active)await this._scroller.scrollTo(this._lastActivePageContext.pos,!1,0),this._$map.css({transform:"",display:"block"}),e&&this.prepareInactiveMap().remove();else{const s=e?this.prepareInactiveMap():this._$map;(e=>{const{translateY:s}=i(e[0]);t!==s&&e.css("transform",`translate3d(0,${t}px,0`)})(s)}}get $scrollMap(){return this._$map}get scrollMapHeight(){return this._$map.length?this._mapHeight:0}get options(){return this._settings}updateScrollMapHeight(t){this._$map.length&&(this._mapHeight+=Math.trunc(t),this._mapHeight<0&&(this._mapHeight=0),this._$map.height(this._mapHeight))}updateProfiles(t){const{_items:e}=this;for(let s=t,i=e.length;s<i;s++)if(0<s){const t=e[s-1];e[s].index=t.index+1,e[s].offset=t.offset+t.height}else e[s].index=0,e[s].offset=0}findRecycleElements(){return this._$map.find(`.${this._config.RECYCLE_CLASS}`)}get isInitialized(){return!!this._scroller}addItem(t,e,s,i){this._addItem(new _(this,Math.trunc(t),e,s),i)}_addItem(t,e){const s=Array.isArray(t)?t:[t];let i=0,r=!1;(null==e||this._items.length<e)&&(e=this._items.length),e===this._items.length&&(r=!0);for(const t of s)i+=t.height;this.updateScrollMapHeight(i),this._items.splice(e,0,...s),r||(0===e?this.clearPage():null!=this._items[e-1].pageIndex&&this.clearPage(this._items[e-1].pageIndex)),this.updateProfiles(e)}removeItem(t,e,s){Array.isArray(t)?this._removeItemRandomly(t,e):this._removeItemContinuously(t,e,s)}_queryRemoveItemsContext(t,e){const s=[];let i=0,r=!1;for(const e of t){const t=this._items[e];i+=t.height,t.resetDepth(),s.push(t)}if(this._settings.removeItemWithTransition&&0<e){const t=this.scrollPos,e=this.scrollPosMax-i;r=e<t}return{removed:s,delta:i,transition:r}}_updateWithRemoveItemsContext(t,e,s){const{removed:i,delta:r,transition:n}=t;n&&this.setupScrollMapTransition(e),s(),this.updateScrollMapHeight(-r),setTimeout((()=>{for(const t of i)t.deactivate()}),e)}_removeItemContinuously(t,s,i){if(s=s??1,i=i??0,t<0||this._items.length<t+s)throw e.makeResult(e.RESULT_CODE.ERROR_UI_LISTVIEW_INVALID_PARAM,`${e.toHelpString(e.RESULT_CODE.ERROR_UI_LISTVIEW_INVALID_PARAM)} [removeItem(), invalid index: ${t}]`);const r=Array.from({length:s},((e,s)=>t+s)),n=this._queryRemoveItemsContext(r,i);this._updateWithRemoveItemsContext(n,i,(()=>{null!=this._items[t].pageIndex&&this.clearPage(this._items[t].pageIndex),this._items.splice(t,s),this.updateProfiles(t)}))}_removeItemRandomly(t,s){s=s??0,t.sort(((t,e)=>e-t));for(const s of t)if(s<0||this._items.length<s)throw e.makeResult(e.RESULT_CODE.ERROR_UI_LISTVIEW_INVALID_PARAM,`${e.toHelpString(e.RESULT_CODE.ERROR_UI_LISTVIEW_INVALID_PARAM)} [removeItem(), invalid index: ${s}]`);const i=this._queryRemoveItemsContext(t,s);this._updateWithRemoveItemsContext(i,s,(()=>{for(const e of t)null!=this._items[e].pageIndex&&this.clearPage(this._items[e].pageIndex),this._items.splice(e,1);const e=t[t.length-1];this.updateProfiles(e)}))}setupScrollMapTransition(t){f(this._scroller);const e=this._$map[0];this._$map.transitionEnd((()=>{n(e)})),r(e,"height",t,"ease")}getItemInfo(t){const{_items:s,_config:i}=this,r=t=>t.hasClass(i.LISTITEM_BASE_CLASS)?Number(t.attr(i.DATA_ITEM_INDEX)):t.hasClass(i.SCROLL_MAP_CLASS)||t.length<=0?(void 0,NaN):r(t.parent()),n=t instanceof Event?r(e.dom(t.target)):Number(t);if(Number.isNaN(n))throw e.makeResult(e.RESULT_CODE.ERROR_UI_LISTVIEW_INVALID_PARAM,`${e.toHelpString(e.RESULT_CODE.ERROR_UI_LISTVIEW_INVALID_PARAM)} [unsupported type: ${typeof t}]`);if(n<0||s.length<=n)throw e.makeResult(e.RESULT_CODE.ERROR_UI_LISTVIEW_INVALID_PARAM,`${e.toHelpString(e.RESULT_CODE.ERROR_UI_LISTVIEW_INVALID_PARAM)} getItemInfo() [invalid index: ${n}]`);return s[n].info}refresh(){const{_pages:t,_items:s,_settings:i,_lastActivePageContext:r}=this,n={},o=this.getPageIndex(),a=[],h=t=>{t===o?(n[t]="activate",a.push(t)):Math.abs(o-t)<=i.pagePrepareCount?n[t]="activate":i.enableHiddenPage?n[t]="hide":n[t]="deactivate",o+1!==t&&o-1!==t||a.push(t)};if(s.length<=0)return this;{const e=i.pagePrepareCount+i.pagePreloadCount,s=o-e,r=o+e;let n=0,a=0;for(let e=s;e<=r;e++)e<0?n++:t.length<=e?a++:h(e);if(0<n)for(let s=0,i=o+e+1;s<n&&!(t.length<=i);s++,i++)h(i);if(0<a)for(let t=0,s=o-e-1;t<a&&!(s<0);t++,s--)h(s)}for(const e of t.filter((t=>"inactive"!==t.status)))null==n[e.index]&&e.deactivate();for(const s of a.sort(((t,e)=>t-e)))void e.post((()=>{this.isInitialized&&t[s]?.activate()}));for(const s of Object.keys(n)){const i=Number(s),r=n[i];void e.post((()=>{this.isInitialized&&t[i]?.[r]?.()}))}this.findRecycleElements().remove();const l=t[o];return r.from=l?.getItemFirst()?.index??0,r.to=l?.getItemLast()?.index??0,r.index=o,this}update(){return this.assignPage(this._pages.length),this.refresh(),this}rebuild(){return this.clearPage(),this.assignPage(),this.refresh(),this}release(){for(const t of this._items)t.deactivate();return this._pages.length=0,this._items.length=0,this._mapHeight=0,this._$map.height(0),this}get scrollerType(){return this._scroller?.type}get scrollPos(){return this._scroller?.pos??0}get scrollPosMax(){return this._scroller?.posMax??0}setScrollHandler(t,e){this._scroller?.[e]("scroll",t)}setScrollStopHandler(t,e){this._scroller?.[e]("scrollstop",t)}async scrollTo(t,e,s){f(this._scroller),t<0?(void 0,t=0):this._scroller.posMax<t&&(void 0,t=this._scroller.posMax),this._lastActivePageContext.pos=t,t!==this._scroller.pos&&await this._scroller.scrollTo(t,e,s)}async ensureVisible(t,s){const{_scroller:i,_items:r,_settings:n,_baseHeight:o}=this;if(f(i),t<0||r.length<=t)throw e.makeResult(e.RESULT_CODE.ERROR_UI_LISTVIEW_INVALID_PARAM,`${e.toHelpString(e.RESULT_CODE.ERROR_UI_LISTVIEW_INVALID_PARAM)} ensureVisible() [invalid index: ${t}]`);const{partialOK:a,setTop:h,animate:l,time:_,callback:c}=Object.assign({partialOK:!0,setTop:!1,animate:n.enableAnimation,time:n.animationDuration,callback:e.noop},s),p=i.pos,u=i.pos+o,d=r[t],g={from:d.offset,to:d.offset+d.height};let I;if(h)I=g.from;else{if(a?g.from<=p?p<=g.to:g.from<=u:p<=g.from&&g.to<=u)return c(i.pos),void 0;I=g.from<p?g.from:d.offset-d.height}await this.scrollTo(I,l,_),c(I)}backup(t){return this._backup[t]={items:this._items},!0}restore(t,e){return null!=this._backup[t]&&(0<this._items.length&&this.release(),this._addItem(this._backup[t].items),e&&this.rebuild(),!0)}hasBackup(t){return null!=this._backup[t]}clearBackup(t){if(null==t){for(const t of Object.keys(this._backup))delete this._backup[t];return!0}return null!=this._backup[t]&&(delete this._backup[t],!0)}getBackupData(t){return this._backup[t]}setBackupData(t,e){return!!Array.isArray(e.items)&&(this._backup[t]=e,!0)}get _config(){return l()}setScrollerCondition(){this._scroller?.on("scroll",this._scrollEventHandler),this._scroller?.on("scrollstop",this._scrollStopEventHandler)}resetScrollerCondition(){this._scroller?.off("scrollstop",this._scrollStopEventHandler),this._scroller?.off("scroll",this._scrollEventHandler)}createScroller(){return this._settings.scrollerFactory(this._$root,this._$map,this._settings)}getPageIndex(){const{_scroller:t,_baseHeight:e,_pages:s}=this;f(t);const{pos:i,posMax:r}=t,n=(()=>{const t=this.getLastPage();return t?t.offset+t.height:e})(),o=0===r||r<=e?0:i*n/r,a=t=>null!=t&&(t.offset<=o&&o<=t.offset+t.height);let h=Math.floor(o/e);0!==h&&s.length<=h&&(h=s.length-1);let l=s[h];if(a(l))return l.index;if(o<l?.offset){for(let t=h-1;t>=0;t--)if(l=s[t],a(l))return l.index}else for(let t=h+1,e=s.length;t<e;t++)if(l=s[t],a(l))return l.index;return void 0,Math.max(0,s.length-1)}getLastPage(){return 0<this._pages.length?this._pages[this._pages.length-1]:void 0}onScroll(t){if(this._active&&0<this._pages.length){const e=this.getPageIndex();Math.abs(t-this._lastActivePageContext.pos)<this._settings.scrollRefreshDistance&&this._lastActivePageContext.index!==e&&this.refresh(),this._lastActivePageContext.pos=t}}onScrollStop(t){if(this._active&&0<this._pages.length){const e=this.getPageIndex();this._lastActivePageContext.index!==e&&this.refresh(),this._lastActivePageContext.pos=t}}assignPage(t){this.clearPage(t);const{_items:e,_pages:s,_baseHeight:i,_scroller:r}=this,n=this.getLastPage(),o=n?.getItemLast()?.index??0,a=e.slice(o);let h=n;null==h&&(h=new c,s.push(h));for(const t of a){if(i<=h.height){h.normalize();const t=new c;t.index=h.index+1,t.offset=h.offset+h.height,h=t,s.push(h)}t.pageIndex=h.index,h.push(t)}h.normalize(),r?.update()}clearPage(t){this._pages.splice(t??0)}prepareInactiveMap(){const{_config:t,_$map:s,_mapHeight:i}=this,r=s.parent();let n=r.find(`.${t.INACTIVE_CLASS}`);if(n.length<=0){const o=this.getPageIndex(),a=s.clone().children().filter(((s,i)=>{const r=Number(e.dom(i).attr(t.DATA_PAGE_INDEX));return o-1<=r&&r<=o+1}));n=e.dom(`<section class="${t.SCROLL_MAP_CLASS} ${t.INACTIVE_CLASS}"></section>`).append(a).height(i),r.append(n),s.css("display","none")}return n}}const x=Symbol("properties");class A extends e.View{[x];constructor(t){super(t),this[x]={context:new E(t)},this.setElement(this.$el)}get context(){return this[x].context}get options(){return this.context.options}setElement(t){if(this[x]){const{context:s}=this[x],i=e.dom(t);s.destroy(),s.initialize(i,this.options.initialHeight??i.height())}return super.setElement(t)}remove(){return this[x].context.destroy(),super.remove()}get isInitialized(){return this[x].context.isInitialized}addItem(t,e,s,i){this._addItem(new _(this.context,Math.trunc(t),e,s),i)}_addItem(t,e){this[x].context._addItem(t,e)}removeItem(t,e,s){this[x].context.removeItem(t,e,s)}getItemInfo(t){return this[x].context.getItemInfo(t)}refresh(){return this[x].context.refresh(),this}update(){return this[x].context.update(),this}rebuild(){return this[x].context.rebuild(),this}release(){return this[x].context.release(),super.release()}get scrollPos(){return this[x].context.scrollPos}get scrollPosMax(){return this[x].context.scrollPosMax}setScrollHandler(t,e){this[x].context.setScrollHandler(t,e)}setScrollStopHandler(t,e){this[x].context.setScrollStopHandler(t,e)}scrollTo(t,e,s){return this[x].context.scrollTo(t,e,s)}ensureVisible(t,e){return this[x].context.ensureVisible(t,e)}backup(t){return this[x].context.backup(t)}restore(t,e=!0){return this[x].context.restore(t,e)}hasBackup(t){return this[x].context.hasBackup(t)}clearBackup(t){return this[x].context.clearBackup(t)}getBackupData(t){return this[x].context.getBackupData(t)}setBackupData(t,e){return this[x].context.setBackupData(t,e)}}const S=Symbol("properties");class R{_owner;_mapGroups={};_aryTopGroups=[];_backup={};constructor(t){this._owner=t}release(){this._mapGroups={},this._aryTopGroups=[]}newGroup(t){if(t=t??e.luid("list-group",4),null!=this._mapGroups[t])return this._mapGroups[t];const s=new p(this._owner,t);return this._mapGroups[t]=s,s}getGroup(t){return this._mapGroups[t]}registerTopGroup(t){if("registered"===t.status)return t.restore(),void 0;const e=this._aryTopGroups[this._aryTopGroups.length-1],s=e?.getNextItemIndex(!0)??0;this._aryTopGroups.push(t),t.register(s)}getTopGroups(){return this._aryTopGroups.slice(0)}async expandAll(){const t=[];for(const e of this._aryTopGroups)t.push(e.expand());await Promise.all(t)}async collapseAll(t){const e=[];for(const s of this._aryTopGroups)e.push(s.collapse(t));await Promise.all(e)}get isExpanding(){return this.isStatusIn("expanding")}get isCollapsing(){return this.isStatusIn("collapsing")}get isSwitching(){return this.isExpanding||this.isCollapsing}statusAddRef(t){return e.statusAddRef(t)}statusRelease(t){return e.statusRelease(t)}statusScope(t,s){return e.statusScope(t,s)}isStatusIn(t){return e.isStatusIn(t)}backup(t){const{_backup:e}=this;return null==e[t]&&(e[t]={map:this._mapGroups,tops:this._aryTopGroups}),!0}restore(t,e){const s=this.getBackupData(t);if(null==s)return!1;0<this._aryTopGroups.length&&this.release(),Object.assign(this._mapGroups,s.map),this._aryTopGroups=s.tops.slice();for(const t of this._aryTopGroups)t.restore();return e&&this._owner.rebuild(),!0}hasBackup(t){return null!=this._backup[t]}clearBackup(t){if(null==t){for(const t of Object.keys(this._backup))delete this._backup[t];return!0}return null!=this._backup[t]&&(delete this._backup[t],!0)}getBackupData(t){return this._backup[t]}setBackupData(t,e){return!(!e.map||!Array.isArray(e.tops))&&(this._backup[t]=e,!0)}}const T=Symbol("properties");t.ExpandableListItemView=class v extends d{[S];constructor(t){super(t);const{group:e}=t;this[S]={group:e}}get isExpanded(){return this[S].group.isExpanded}get isExpanding(){return this.owner.isExpanding}get isCollapsing(){return this.owner.isCollapsing}get isSwitching(){return this.owner.isSwitching}get hasChildren(){return this[S].group.hasChildren}},t.ExpandableListView=class L extends A{[T];constructor(t){super(t),this[T]={context:new R(this)}}get expandContext(){return this[T].context}newGroup(t){return this[T].context.newGroup(t)}getGroup(t){return this[T].context.getGroup(t)}registerTopGroup(t){this[T].context.registerTopGroup(t)}getTopGroups(){return this[T].context.getTopGroups()}expandAll(){return this[T].context.expandAll()}collapseAll(t){return this[T].context.collapseAll(t)}get isExpanding(){return this[T].context.isExpanding}get isCollapsing(){return this[T].context.isCollapsing}get isSwitching(){return this[T].context.isSwitching}statusAddRef(t){return this[T].context.statusAddRef(t)}statusRelease(t){return this[T].context.statusRelease(t)}statusScope(t,e){return this[T].context.statusScope(t,e)}isStatusIn(t){return this[T].context.isStatusIn(t)}release(){return super.release(),this[T].context.release(),this}backup(t){return this[T].context.backup(t)}restore(t,e=!0){return this[T].context.restore(t,e)}hasBackup(t){return this[T].context.hasBackup(t)}clearBackup(t){return this[T].context.clearBackup(t)}getBackupData(t){return this[T].context.getBackupData(t)}setBackupData(t,e){return this[T].context.setBackupData(t,e)}},t.GroupProfile=p,t.ItemProfile=_,t.ListItemView=d,t.ListView=A,t.ListViewGlobalConfig=l,t.PageProfile=c,t.UI_FORMS_STATUS="UNDER CONSTRUCTION",t.clearTransition=n,t.cssPrefixes=["-webkit-","-moz-","-ms-","-o-",""],t.getTransformMatrixValues=i,t.setTransformTransition=r,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
//# sourceMappingURL=ui-components.min.map