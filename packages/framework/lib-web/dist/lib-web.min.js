/*!
 * @cdp/lib-web 0.9.20
 *   web api library collection
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@cdp/lib-core"),require("@cdp/lib-worker")):"function"==typeof define&&define.amd?define(["exports","@cdp/lib-core","@cdp/lib-worker"],e):(t="undefined"!=typeof globalThis?globalThis:t||self,e(t.CDP=t.CDP||{},t.CDP,t.CDP))}(this,function(t,e,s){"use strict";const n=e.safe(globalThis.location),i=e.safe(globalThis.document),r=e.safe(globalThis.requestAnimationFrame),o=e.safe(globalThis.requestIdleCallback),a=t=>{const e=/^(([^?#]+)\/)([\S]*)?$/.exec(t);return e?.[1]??""},l=a(i.querySelector("base")?.getAttribute("href")??n.href),c=t=>t?.includes("://")?t:null!=t?.[0]?"/"===t[0]?l+t.slice(1):l+t:l;async function h(t=1,e=r){for(;t-- >0;)await new Promise(e)}let u={},d={};async function p(t,e){const{url:n,noCache:r}=Object.assign({noCache:!1},e),o=await async function a(t,e){if(!t)return null;if(u[t])return u[t];{const n=await s.request.text(t),r=i.createElement("template");r.innerHTML=n;const o=r.content,a={fragment:o,html:n.replace(/\s/gm,"")};return!e&&o&&(u[t]=a),a}}(n,r);return function l(t,e,s){const{fragment:n,html:r}=e??{},o=`${t}${r?`::${r}`:""}`;if(d[o])return d[o];const a=n??i,l=a.querySelector(t),c=l instanceof HTMLTemplateElement?l:l?.innerHTML;return!s&&c&&(d[o]=c),c}(t,o,r)}function f(t){return"string"==typeof t?(t=>{const e=i.createElement("template");return e.innerHTML=t,e})(t):t?.cloneNode(!0)}const g=e.safe(globalThis.window),m=e.safe(globalThis.document),_=e.safe(globalThis.CustomEvent),y=e.safe(globalThis.requestAnimationFrame);function v(t){return t?.parent instanceof Window}function b(t,s){if(!t)return[];s=s??m;const n=[];try{if("string"==typeof t){const i=t.trim();if(i.startsWith("<")&&i.endsWith(">")){const t=m.createElement("template");t.innerHTML=i,n.push(...t.content.children)}else{const t=i;if(e.isFunction(s.getElementById)&&"#"===t[0]&&!/[ .<>:~]/.exec(t)){const e=s.getElementById(t.substring(1));e&&n.push(e)}else"body"===t?n.push(m.body):n.push(...s.querySelectorAll(t))}}else t.nodeType||v(t)?n.push(t):0<t.length&&(t[0].nodeType||v(t[0]))&&n.push(...t)}catch(t){void 0}return n}function E(t){return e.isNumber(t)&&0<=t?t:void 0}const w=["type","src","nonce","noModule"];const R=new Map,x=t=>{for(const[e,s]of R)if(s.targets.has(t))return e},O=(t,e,s,n)=>{x(t)&&!s.has(t)&&(n.delete(t),s.add(t),t.dispatchEvent(e));for(const i of t.childNodes)O(i,e,s,n)},C=(t,e,s,n)=>{for(const i of t)Node.ELEMENT_NODE===i.nodeType&&O(i,new _(e,{bubbles:!0,cancelable:!0}),s,n)};let S;const k=(t,e)=>S(t,e);k.utils={isWindowContext:v,elementify:b,rootify:function $(t,e){const s=(t,e)=>{const n=t instanceof HTMLTemplateElement?t.content:t;e.push(n);const i=n.querySelectorAll("template");for(const t of i)s(t,e)},n=[];for(const i of b(t,e))s(i,n);return n},evaluate:function T(t,s,n){const i=n??m,r=i.createElement("script");if(r.text=`CDP_DOM_EVAL_RETURN_VALUE_BRIDGE = (() => { return ${t}; })();`,s)for(const t of w){const e=s[t]||s?.getAttribute?.(t);e&&r.setAttribute(t,e)}try{e.getGlobalNamespace("CDP_DOM_EVAL_RETURN_VALUE_BRIDGE"),i.head.appendChild(r).parentNode.removeChild(r);const t=globalThis.CDP_DOM_EVAL_RETURN_VALUE_BRIDGE;return t}finally{delete globalThis.CDP_DOM_EVAL_RETURN_VALUE_BRIDGE}},detectify:(t,e)=>{const s=e??(t.ownerDocument?.body&&t.ownerDocument)??m,n=R.get(s)??(t=>{const e=new WeakSet,s=new WeakSet,n={targets:new Set,observer:new MutationObserver(t=>{for(const n of t)C(n.removedNodes,"disconnected",s,e),C(n.addedNodes,"connected",e,s)})};return R.set(t,n),n.observer.observe(t,{childList:!0,subtree:!0}),n})(s);return n.targets.add(t),t},undetectify:t=>{if(null==t)(()=>{for(const[,t]of R)t.targets.clear(),t.observer.disconnect();R.clear()})();else{const e=x(t);if(e){const s=R.get(e);s.targets.delete(t),s.targets.size||(s.observer.disconnect(),R.delete(e))}}}};const L=Symbol("create-iterable-iterator");class P{constructor(t){const e=this;for(const[s,n]of t.entries())e[s]=n;this.length=t.length}get isConnected(){for(const t of this)if(A(t)&&t.isConnected)return!0;return!1}[Symbol.iterator](){const t={base:this,pointer:0,next(){return this.pointer<this.base.length?{done:!1,value:this.base[this.pointer++]}:{done:!0,value:void 0}}};return t}entries(){return this[L]((t,e)=>[t,e])}keys(){return this[L](t=>t)}values(){return this[L]((t,e)=>e)}[L](t){const e={base:this,pointer:0},s={next(){const s=e.pointer;return s<e.base.length?(e.pointer++,{done:!1,value:t(s,e.base[s])}):{done:!0,value:void 0}},[Symbol.iterator](){return this}};return s}}function A(t){return!(!t||!t.nodeType)}function N(t){return A(t)&&Node.ELEMENT_NODE===t.nodeType}function D(t){return N(t)&&null!=t.dataset}function I(t){return!(!t||!t.querySelector)}function V(t){return N(t[0])}function M(t){return D(t[0])}function j(t){return t[0]instanceof Document}function U(t){return v(t[0])}function F(t){return!t}function H(t){return"string"==typeof t}function B(t){return null!=t.nodeType}function z(t){return t instanceof Document}function K(t){return v(t)}function W(t){return null!=t.length}function q(t,e){return!(!t||t.nodeName.toLowerCase()!==e.toLowerCase())}function G(t){if(t.offsetParent)return t.offsetParent;if(q(t,"svg")){const e=k(t),s=e.css(["display","position"]);if("none"===s.display||"fixed"===s.position)return null;{let t=e[0].parentElement;for(;t;){const{display:e,position:s}=k(t).css(["display","position"]);if("none"===e)return null;if(s&&"static"!==s)break;t=t.parentElement}return t}}return null}function Y(t){return N(t)&&"select"===t.nodeName.toLowerCase()&&t.multiple}function J(t){return N(t)&&null!=t.value}class Q{addClass(t){if(!V(this))return this;const s=e.isArray(t)?t:[t];for(const t of this)N(t)&&t.classList.add(...s);return this}removeClass(t){if(!V(this))return this;const s=e.isArray(t)?t:[t];for(const t of this)N(t)&&t.classList.remove(...s);return this}hasClass(t){if(!V(this))return!1;for(const e of this)if(N(e)&&e.classList.contains(t))return!0;return!1}toggleClass(t,s){if(!V(this))return this;const n=e.isArray(t)?t:[t],i=null==s?t=>{for(const e of n)t.classList.toggle(e)}:s?t=>t.classList.add(...n):t=>t.classList.remove(...n);for(const t of this)N(t)&&i(t);return this}prop(t,s){if(null==s&&e.isString(t)){const e=this[0];return e&&e[t]}for(const n of this)if(null!=s)e.assignValue(n,t,s);else for(const s of Object.keys(t))s in n&&e.assignValue(n,s,t[s]);return this}attr(t,s){if(V(this)){if(void 0===s&&e.isString(t)){const e=this[0].getAttribute(t);return e??void 0}if(null===s)return this.removeAttr(t);for(const e of this)if(N(e))if(null!=s)e.setAttribute(t,String(s));else for(const s of Object.keys(t)){const n=t[s];null===n?e.removeAttribute(s):e.setAttribute(s,String(n))}return this}return void 0===s?void 0:this}removeAttr(t){if(!V(this))return this;const s=e.isArray(t)?t:[t];for(const t of this)if(N(t))for(const e of s)t.removeAttribute(e);return this}val(t){if(!V(this))return null==t?void 0:this;if(null==t){const t=this[0];if(Y(t)){const e=[];for(const s of t.selectedOptions)e.push(s.value);return e}return"value"in t?t.value:void 0}for(const s of this)if(e.isArray(t)&&Y(s))for(const e of s.options)e.selected=t.includes(e.value);else J(s)&&(s.value=t);return this}data(t,s){if(!M(this))return null==s?void 0:this;if(void 0===s){const s=this[0].dataset;if(null==t){const t={};for(const n of Object.keys(s))e.assignValue(t,n,e.toTypedData(s[n]));return t}return e.toTypedData(s[e.camelize(t)])}{const n=e.camelize(t??"");if(n)for(const t of this)D(t)&&e.assignValue(t.dataset,n,e.fromTypedData(s));return this}}removeData(t){if(!M(this))return this;const s=e.isArray(t)?t.map(t=>e.camelize(t)):[e.camelize(t)];for(const t of this)if(D(t)){const{dataset:e}=t;for(const t of s)delete e[t]}return this}}function X(t,s,n,i){let r;i=i??e.noop;for(const[o,a]of s.entries())if(e.isFunction(t)){if(t.call(a,o,a)&&(r=n(a),void 0!==r))return r}else if(H(t)){if(a.matches?.(t)&&(r=n(a),void 0!==r))return r}else if(K(t)){if(v(a)){if(r=n(a),void 0!==r)return r}else if(r=i(),void 0!==r)return r}else if(z(t)){if(m===a){if(r=n(a),void 0!==r)return r}else if(r=i(),void 0!==r)return r}else if(B(t)){if(t===a&&(r=n(a),void 0!==r))return r}else if(W(t)){for(const e of t)if(e===a&&(r=n(a),void 0!==r))return r}else if(r=i(),void 0!==r)return r;if(r=i(),void 0!==r)return r}function Z(t){return null!=t&&Node.DOCUMENT_NODE!==t.nodeType&&Node.DOCUMENT_FRAGMENT_NODE!==t.nodeType}function tt(t,e){if(t){if(!e)return!0;if(k(t).is(e))return!0}return!1}function et(t,e,s,n){if(!V(e))return k();const i=new Set;for(const r of e){let e=r[t];for(;e&&(null==s||!k(e).is(s));)n?k(e).is(n)&&i.add(e):i.add(e),e=e[t]}return k([...i])}e.setMixClassAttribute(Q,"protoExtendsOnly");class st{get(t){return null!=t?(t=Math.trunc(t),t<0?this[t+this.length]:this[t]):this.toArray()}toArray(){return[...this]}index(t){if(V(this)){if(null==t){let t=0,e=this[0];for(;null!==(e=e.previousSibling);)Node.ELEMENT_NODE===e.nodeType&&(t+=1);return t}{let s;s=e.isString(t)?k(t)[0]:t instanceof P?t[0]:t;const n=[...this].indexOf(s);return 0<=n?n:void 0}}}first(){return k(this[0])}last(){return k(this[this.length-1])}add(t,e){const s=k(t,e),n=new Set([...this,...s]);return k([...n])}is(t){return!(this.length<=0||F(t))&&X(t,this,()=>!0,()=>!1)}filter(t){if(this.length<=0||F(t))return k();const e=[];return X(t,this,t=>{e.push(t)}),k(e)}not(t){if(this.length<=0||F(t))return k();const e=new Set([...this]);return X(t,this,t=>{e.delete(t)}),k([...e])}find(t){if(e.isString(t)){if(U(this))return k();{const e=[];for(const s of this)if(I(s)){const n=s.querySelectorAll(t);e.push(...n)}return k(e)}}{const e=k(t);return e.filter((t,e)=>{for(const t of this)if(A(t)&&t!==e&&t.contains(e))return!0;return!1})}}has(t){if(U(this))return k();const e=[];for(const s of this)if(I(s)){const n=k(t,s);e.push(...n)}return this.filter((t,s)=>{if(A(s))for(const t of new Set(e))if(s!==t&&s.contains(t))return!0;return!1})}map(t){const e=[];for(const[s,n]of this.entries())e.push(t.call(n,s,n));return k(e)}each(t){for(const[e,s]of this.entries())if(!1===t.call(s,e,s))return this;return this}slice(t,e){return k([...this].slice(t,e))}eq(t){return null==t?k():k(this.get(t))}closest(t){if(null!=t&&V(this)){if(e.isString(t)){const e=new Set;for(const s of this)if(N(s)){const n=s.closest(t);n&&e.add(n)}return k([...e])}return this.is(t)?k(this):this.parents(t).eq(0)}return k()}children(t){if(U(this))return k();const e=new Set;for(const s of this)if(I(s))for(const n of s.children)tt(n,t)&&e.add(n);return k([...e])}parent(t){const e=new Set;for(const s of this)if(A(s)){const n=s.parentNode;Z(n)&&tt(n,t)&&e.add(n)}return k([...e])}parents(t){return this.parentsUntil(void 0,t)}parentsUntil(t,e){let s=[];for(const n of this){let i=n.parentNode;for(;Z(i)&&(null==t||!k(i).is(t));)e?k(i).is(e)&&s.push(i):s.push(i),i=i.parentNode}return 1<this.length&&(s=[...new Set(s.reverse())].reverse()),k(s)}next(t){if(!V(this))return k();const e=new Set;for(const s of this)if(N(s)){const n=s.nextElementSibling;tt(n,t)&&e.add(n)}return k([...e])}nextAll(t){return this.nextUntil(void 0,t)}nextUntil(t,e){return et("nextElementSibling",this,t,e)}prev(t){if(!V(this))return k();const e=new Set;for(const s of this)if(N(s)){const n=s.previousElementSibling;tt(n,t)&&e.add(n)}return k([...e])}prevAll(t){return this.prevUntil(void 0,t)}prevUntil(t,e){return et("previousElementSibling",this,t,e)}siblings(t){if(!V(this))return k();const e=new Set;for(const s of this)if(N(s)){const n=s.parentNode;if(Z(n))for(const i of k(n).children(t))i!==s&&e.add(i)}return k([...e])}contents(){if(U(this))return k();const t=new Set;for(const e of this)if(A(e))if(q(e,"iframe"))t.add(e.contentDocument);else if(q(e,"template"))t.add(e.content);else for(const s of e.childNodes)t.add(s);return k([...t])}offsetParent(){const t=m.documentElement;if(this.length<=0)return k();if(V(this)){const e=new Set;for(const s of this){const n=G(s)??t;e.add(n)}return k([...e])}return k(t)}}function nt(t){const e=t.trim();return"<"===e.slice(0,1)&&">"===e.slice(-1)}function it(...t){const s=new Set;for(const n of t)if(e.isString(n)&&!nt(n)||A(n))s.add(n);else{const t=k(n);for(const n of t)(e.isString(n)||A(n)&&Node.DOCUMENT_NODE!==n.nodeType)&&s.add(n)}return s}function rt(t){return e.isString(t)?m.createTextNode(t):t}function ot(t,e,s){const n=null!=t?e.filter(t):e;s||n.off();for(const t of n)N(t)&&t.remove()}e.setMixClassAttribute(st,"protoExtendsOnly");class at{html(t){if(void 0===t){const t=this[0];return N(t)?t.innerHTML:""}if(e.isString(t)){for(const e of this)N(e)&&(e.innerHTML=t);return this}return void 0,this}text(t){if(void 0===t){const t=this[0];if(A(t)){const e=t.textContent;return null!=e?e.trim():""}return""}{const s=e.isString(t)?t:String(t);for(const t of this)A(t)&&(t.textContent=s);return this}}append(...t){const e=it(...t);for(const t of this)N(t)&&t.append(...e);return this}appendTo(t){return k(t).append(this)}prepend(...t){const e=it(...t);for(const t of this)N(t)&&t.prepend(...e);return this}prependTo(t){return k(t).prepend(this)}before(...t){const e=it(...t);for(const t of this)if(A(t)&&t.parentNode)for(const s of e)t.parentNode.insertBefore(rt(s),t);return this}insertBefore(t){return k(t).before(this)}after(...t){const e=it(...[...t].reverse());for(const t of this)if(A(t)&&t.parentNode)for(const s of e)t.parentNode.insertBefore(rt(s),t.nextSibling);return this}insertAfter(t){return k(t).after(this)}wrapAll(t){if(j(this)||U(this))return this;const e=this[0],s=k(t,e.ownerDocument).eq(0).clone(!0);return e.parentNode&&s.insertBefore(e),s.map((t,e)=>{for(;e.firstElementChild;)e=e.firstElementChild;return e}).append(this),this}wrapInner(t){if(!V(this))return this;for(const e of this){const s=k(e),n=s.contents();0<n.length?n.wrapAll(t):s.append(t)}return this}wrap(t){if(!V(this))return this;for(const e of this){const s=k(e);s.wrapAll(t)}return this}unwrap(t){return this.parent(t).not("body").each((t,e)=>{k(e).replaceWith(e.childNodes)}),this}empty(){for(const t of this)if(N(t))for(;t.firstChild;)t.removeChild(t.firstChild);return this}detach(t){return ot(t,this,!0),this}remove(t){return ot(t,this,!1),this}replaceWith(t){const e=(()=>{const e=k(t);if(1===e.length&&N(e[0]))return e[0];{const t=m.createDocumentFragment();for(const s of e)N(s)&&t.appendChild(s);return t}})();for(const t of this)N(t)&&t.replaceWith(e);return this}replaceAll(t){return k(t).replaceWith(this)}}function lt(t){return t.ownerDocument?.defaultView??g}function ct(t){const e=lt(t);return e.getComputedStyle(t)}function ht(t){return parseFloat(t)||0}e.setMixClassAttribute(at,"protoExtendsOnly");const ut={width:["left","right"],height:["top","bottom"]};function dt(t,e){return ht(t.getPropertyValue(`padding-${ut[e][0]}`))+ht(t.getPropertyValue(`padding-${ut[e][1]}`))}function pt(t,e){return ht(t.getPropertyValue(`border-${ut[e][0]}-width`))+ht(t.getPropertyValue(`border-${ut[e][1]}-width`))}function ft(t,e){return ht(t.getPropertyValue(`margin-${ut[e][0]}`))+ht(t.getPropertyValue(`margin-${ut[e][1]}`))}function gt(t,s,n){if(null==n){if(U(t))return t[0].document.documentElement[`client${e.classify(s)}`];if(j(t))return t[0].documentElement[`scroll${e.classify(s)}`];{const e=t[0];if(D(e)){const t=ct(e),n=ht(t.getPropertyValue(s));return"border-box"===t.getPropertyValue("box-sizing")?n-(pt(t,s)+dt(t,s)):n}return 0}}return t.css(s,e.isString(n)?n:`${n}px`)}function mt(t,s,n){if(null==n){if(U(t)||j(t))return gt(t,s);{const n=t[0];return D(n)?n[`client${e.classify(s)}`]:0}}if(U(t)||j(t))return t;{const i=e.isString(n);for(const e of t)if(D(e)){const{style:t,newVal:r}=(()=>{i&&e.style.setProperty(s,n);const t=ct(e),r=i?ht(t.getPropertyValue(s)):n;return{style:t,newVal:r}})();"border-box"===t.getPropertyValue("box-sizing")?e.style.setProperty(s,`${r+pt(t,s)}px`):e.style.setProperty(s,r-dt(t,s)+"px")}return t}}function _t(...t){let[s,n]=t;return e.isNumber(s)||e.isString(s)||(n=!!s,s=void 0),{includeMargin:n,value:s}}function yt(t,s,n,i){if(null==i){if(U(t))return t[0][`inner${e.classify(s)}`];if(j(t))return gt(t,s);{const e=t[0];if(D(e)){const t=bt(e,s);if(n){const n=ct(e);return t+ft(n,s)}return t}return 0}}if(U(t)||j(t))return t;{const r=e.isString(i);for(const e of t)if(D(e)){const{style:t,newVal:o}=(()=>{r&&e.style.setProperty(s,i);const t=ct(e),o=n?ft(t,s):0,a=(r?ht(t.getPropertyValue(s)):i)-o;return{style:t,newVal:a}})();"content-box"===t.getPropertyValue("box-sizing")?e.style.setProperty(s,o-pt(t,s)-dt(t,s)+"px"):e.style.setProperty(s,`${o}px`)}return t}}function vt(t){if(t.getClientRects().length<=0)return{top:0,left:0};const e=t.getBoundingClientRect(),s=lt(t);return{top:e.top+s.scrollY,left:e.left+s.scrollX}}function bt(t,s){if(null!=t.offsetWidth)return t[`offset${e.classify(s)}`];{const e=ct(t),n=ht(e.getPropertyValue(s));return"content-box"===e.getPropertyValue("box-sizing")?n+pt(e,s)+dt(e,s):n}}class Et{css(t,s){if(!M(this))return e.isString(t)?null==s?"":this:e.isArray(t)?{}:this;if(e.isString(t)){if(void 0===s){const s=this[0];return ct(s).getPropertyValue(e.dasherize(t))}{const n=e.dasherize(t),i=null===s;for(const t of this)D(t)&&(i?t.style.removeProperty(n):t.style.setProperty(n,s));return this}}if(e.isArray(t)){const s=this[0],n=lt(s),i={};for(const r of t){const t=e.dasherize(r);i[r]=n.getComputedStyle(s).getPropertyValue(t)}return i}{const s=function n(t){const s={};for(const n in t)e.assignValue(s,e.dasherize(n),t[n]);return s}(t);for(const t of this)if(D(t)){const{style:e}=t;for(const t in s)null===s[t]?e.removeProperty(t):e.setProperty(t,s[t])}return this}}width(t){return gt(this,"width",t)}height(t){return gt(this,"height",t)}innerWidth(t){return mt(this,"width",t)}innerHeight(t){return mt(this,"height",t)}outerWidth(...t){const{includeMargin:e,value:s}=_t(...t);return yt(this,"width",e,s)}outerHeight(...t){const{includeMargin:e,value:s}=_t(...t);return yt(this,"height",e,s)}position(){if(!M(this))return{top:0,left:0};let t,e={top:0,left:0};const s=this[0],{position:n,marginTop:i,marginLeft:r}=k(s).css(["position","marginTop","marginLeft"]),o=ht(i),a=ht(r);if("fixed"===n)t=s.getBoundingClientRect();else{t=vt(s);const n=s.ownerDocument;let i=G(s)??n.documentElement,r=k(i);for(;i&&(i===n.body||i===n.documentElement)&&"static"===r.css("position");)i=i.parentNode,r=k(i);if(i&&i!==s&&Node.ELEMENT_NODE===i.nodeType){e=vt(i);const{borderTopWidth:t,borderLeftWidth:s}=r.css(["borderTopWidth","borderLeftWidth"]);e.top+=ht(t),e.left+=ht(s)}}return{top:t.top-e.top-o,left:t.left-e.left-a}}offset(t){if(M(this)){if(null==t)return vt(this[0]);for(const e of this){const s=k(e),n={},{position:i,top:r,left:o}=s.css(["position","top","left"]);"static"===i&&(e.style.position="relative");const a=s.offset(),l=(()=>{const t=("absolute"===i||"fixed"===i)&&(r+o).includes("auto");return t?s.position():{top:ht(r),left:ht(o)}})();null!=t.top&&(n.top=`${t.top-a.top+l.top}px`),null!=t.left&&(n.left=`${t.left-a.left+l.left}px`),s.css(n)}return this}return null==t?{top:0,left:0}:this}}e.setMixClassAttribute(Et,"protoExtendsOnly");const wt={eventData:new WeakMap,eventListeners:new WeakMap,liveEventListeners:new WeakMap};function Rt(t){const e=wt.eventData.get(t.target)??[];return e.unshift(t),e}function xt(t,e){wt.eventData.set(t,e)}function Ot(t){wt.eventData.delete(t)}function Ct(t){const e=t.split("."),s=e.shift();return e.length?(e.sort(),`${s}.${e.join(".")}`):s}function St(t){const s=[],n=t.split("."),i=n.shift();if(n.length){n.sort();const t=[];for(let s=n.length;s>=1;s--)t.push(...e.combination(n,s));const r=`.${n.join(".")}.`;s.push({type:i,namespace:r});for(const e of t)s.push({type:`${i}.${e.join(".")}`,namespace:r})}else s.push({type:i,namespace:""});return s}function kt(t,e){const s=[],n=e.split("."),i=n.shift(),r=Ct(e);if(n.length){const e=t=>{if(t){const e=Object.keys(t),n=e.filter(t=>r===t.split("|")[0]).map(t=>t.split("|")[1]),i=e.filter(t=>{for(const e of n)if(e===t.split("|")[1])return!0;return!1}).map(t=>{const e=t.split("|");return{type:e[0],namespace:e[1]}});s.push(...i)}},{eventListeners:n,liveEventListeners:i}=wt;e(n.get(t)),e(i.get(t))}else s.push({type:i,namespace:""});return s}function $t(t,e,s,n,i,r){const o=n?wt.liveEventListeners:wt.eventListeners;if(!o.has(t)){if(!r)return{registered:void 0,handlers:[]};o.set(t,{})}const a=o.get(t),l=function c(t,e,s,n){const i={...n};return delete i.once,`${t}|${e}|${JSON.stringify(i)}|${s}`}(e,s,n,i);return a[l]||(a[l]={registered:new Set,handlers:[]}),a[l]}function Tt(t,e=!0){const s=[],n=t=>{if(t){for(const e of Object.keys(t)){const n=e.split("|"),i=n[0],r=JSON.parse(n[2]);for(const n of t[e].handlers)s.push({event:i,handler:n.proxy,options:r})}return!0}return!1},{eventListeners:i,liveEventListeners:r}=wt;return n(i.get(t))&&e&&i.delete(t),n(r.get(t))&&e&&r.delete(t),s}function Lt(t,e){const s=[],n=e.split(".").filter(t=>!!t),i=t=>{for(const e of n)if(t.includes(`.${e}.`))return!0;return!1},r=t=>{if(t){const e=Object.keys(t).filter(i);for(const n of e){const e=n.split("|"),i=e[0],r=JSON.parse(e[2]),{registered:o,handlers:a}=t[n];for(const t of a)s.push({event:i,handler:t.proxy,options:r}),o.delete(t.listener)}}},{eventListeners:o,liveEventListeners:a}=wt;return r(o.get(t)),r(a.get(t)),s}function Pt(...t){let[s,n,i,r]=t;return e.isFunction(n)&&([s,i,r]=t,n=void 0),s=s?e.isArray(s)?s:[s]:[],n=n??"",r?!0===r&&(r={capture:!0}):r={},{type:s,selector:n,listener:i,options:r}}const At=["resize","scroll"];function Nt(t,s,n){if(null==s){for(const s of this)At.includes(t)||(e.isFunction(s[t])?s[t]():k(s).trigger(t));return this}return this.on(t,s,n)}function Dt(t,e){const s=Tt(t,!1);for(const t of s)e.addEventListener(t.event,t.handler,t.options)}function It(t,s,n,i){return e.isFunction(s)&&t.on(n,function e(r){r.target===this&&(s.call(this,r),i||t.off(n,e))}),t}class Vt{on(...t){const{type:e,selector:s,listener:n,options:i}=Pt(...t);const r=s?function o(t){if(t.defaultPrevented)return;const e=Rt(t),i=k(t.target);if(i.is(s))n.apply(i[0],e);else for(const t of i.parents())k(t).is(s)&&n.apply(t,e)}:function a(t){n.apply(this,Rt(t))};for(const t of this)for(const o of e){const e=St(o);for(const o of e){const{type:e,namespace:a}=o,{registered:l,handlers:c}=$t(t,e,a,s,i,!0);l&&!l.has(n)&&(l.add(n),c.push({listener:n,proxy:r}),t.addEventListener(e,r,i))}}return this}off(...t){const{type:e,selector:s,listener:n,options:i}=Pt(...t);if(e.length<=0)for(const t of this){const e=Tt(t);for(const s of e)t.removeEventListener(s.event,s.handler,s.options)}else for(const t of this)for(const r of e)if(r.startsWith(".")){const e=Lt(t,r);for(const s of e)t.removeEventListener(s.event,s.handler,s.options)}else{const e=kt(t,r);for(const r of e){const{type:e,namespace:o}=r,{registered:a,handlers:l}=$t(t,e,o,s,i,!1);if(0<l.length)for(let s=l.length-1;s>=0;s--){const r=l[s];(n&&r.listener===n||r?.listener?.origin===n||!n)&&(t.removeEventListener(e,r.proxy,i),l.splice(s,1),a.delete(r.listener))}}}return this}once(...t){const{type:e,selector:s,listener:n,options:i}=Pt(...t),r={...i,once:!0},o=this;function a(...t){n.apply(this,t),o.off(e,s,a,r),delete a.origin}return a.origin=n,this.on(e,s,a,r)}trigger(t,...s){const n=t=>e.isString(t)?new _(Ct(t),{detail:s,bubbles:!0,cancelable:!0}):t,i=e.isArray(t)?t:[t];for(const t of i){const e=n(t);for(const t of this)xt(t,s),t.dispatchEvent(e),Ot(t)}return this}transitionStart(t,e=!1){return It(this,t,"transitionstart",e)}transitionEnd(t,e=!1){return It(this,t,"transitionend",e)}animationStart(t,e=!1){return It(this,t,"animationstart",e)}animationEnd(t,e=!1){return It(this,t,"animationend",e)}hover(t,e){return e=e??t,this.mouseenter(t).mouseleave(e)}click(t,e){return Nt.bind(this)("click",t,e)}dblclick(t,e){return Nt.bind(this)("dblclick",t,e)}blur(t,e){return Nt.bind(this)("blur",t,e)}focus(t,e){return Nt.bind(this)("focus",t,e)}focusin(t,e){return Nt.bind(this)("focusin",t,e)}focusout(t,e){return Nt.bind(this)("focusout",t,e)}keyup(t,e){return Nt.bind(this)("keyup",t,e)}keydown(t,e){return Nt.bind(this)("keydown",t,e)}keypress(t,e){return Nt.bind(this)("keypress",t,e)}submit(t,e){return Nt.bind(this)("submit",t,e)}contextmenu(t,e){return Nt.bind(this)("contextmenu",t,e)}change(t,e){return Nt.bind(this)("change",t,e)}mousedown(t,e){return Nt.bind(this)("mousedown",t,e)}mousemove(t,e){return Nt.bind(this)("mousemove",t,e)}mouseup(t,e){return Nt.bind(this)("mouseup",t,e)}mouseenter(t,e){return Nt.bind(this)("mouseenter",t,e)}mouseleave(t,e){return Nt.bind(this)("mouseleave",t,e)}mouseout(t,e){return Nt.bind(this)("mouseout",t,e)}mouseover(t,e){return Nt.bind(this)("mouseover",t,e)}touchstart(t,e){return Nt.bind(this)("touchstart",t,e)}touchend(t,e){return Nt.bind(this)("touchend",t,e)}touchmove(t,e){return Nt.bind(this)("touchmove",t,e)}touchcancel(t,e){return Nt.bind(this)("touchcancel",t,e)}resize(t,e){return Nt.bind(this)("resize",t,e)}scroll(t,e){return Nt.bind(this)("scroll",t,e)}clone(t=!1,e=!1){const s=this;return V(s)?s.map((s,n)=>function i(t,e,s){const n=t.cloneNode(!0);if(e)if(s){const e=t.querySelectorAll("*"),s=n.querySelectorAll("*");for(const[t]of e.entries())Dt(e[t],s[t])}else Dt(t,n);return n}(n,t,e)):s}}function Mt(t){return N(t)?t:function e(t){return A(t)&&Node.DOCUMENT_NODE===t.nodeType}(t)?t.documentElement:v(t)?t.document.documentElement:null}function jt(t,s){const{top:n,left:i,duration:r,easing:o,callback:a}=s,l=t.scrollTop,c=t.scrollLeft;let h=e.isNumber(n),u=e.isNumber(i);if(!r){let s=!1;return h&&n!==l&&(t.scrollTop=n,s=!0),u&&i!==c&&(t.scrollLeft=i,s=!0),s&&e.isFunction(a)&&a(),void 0}const d=(s,n,i,r)=>{if(!s)return{max:0,new:0,initial:0};const o=t[`scroll${e.classify(r)}`]-bt(t,r),a=Math.max(Math.min(n,o),0);return{max:o,new:a,initial:i}},p=d(h,n,l,"height"),f=d(u,i,c,"width");if(h&&p.new===p.initial&&(h=!1),u&&f.new===f.initial&&(u=!1),!h&&!u)return;const g=t=>e.isFunction(o)?o(t):"linear"===o?t:function s(t){return.5-Math.cos(t*Math.PI)/2}(t),m={top:0,left:0},_=Date.now(),v=()=>{const s=Date.now()-_,n=Math.max(Math.min(s/r,1),0),i=g(n);if(h&&(m.top=p.initial+i*(p.new-p.initial)),u&&(m.left=f.initial+i*(f.new-f.initial)),h&&p.new>p.initial&&m.top>=p.new||h&&p.new<p.initial&&m.top<=p.new||u&&f.new>f.initial&&m.left>=f.new||u&&f.new<f.initial&&m.left<=f.new)return h&&(t.scrollTop=p.new),u&&(t.scrollLeft=f.new),e.isFunction(a)&&a(),t=null,void 0;h&&(t.scrollTop=m.top),u&&(t.scrollLeft=m.left),y(v)};y(v)}e.setMixClassAttribute(Vt,"protoExtendsOnly");class Ut{scrollTop(t,e,s,n){if(null==t){const t=Mt(this[0]);return t?t.scrollTop:0}return this.scrollTo({top:t,duration:e,easing:s,callback:n})}scrollLeft(t,e,s,n){if(null==t){const t=Mt(this[0]);return t?t.scrollLeft:0}return this.scrollTo({left:t,duration:e,easing:s,callback:n})}scrollTo(...t){const e=function s(...t){const e={easing:"swing"};if(1===t.length)Object.assign(e,t[0]);else{const[s,n,i,r,o]=t;Object.assign(e,{top:n,left:s,duration:i,easing:r,callback:o})}return e.top=E(e.top),e.left=E(e.left),e.duration=E(e.duration),e}(...t);for(const t of this){const s=Mt(t);D(s)&&jt(s,e)}return this}}e.setMixClassAttribute(Ut,"protoExtendsOnly");const Ft=new WeakMap;class Ht{animate(t,e){const s={dom:this,animations:new Map};if(!V(this))return s.finished=Promise.resolve(s),s;for(const n of this)if(N(n)){const i=n.animate(t,e),r=Ft.get(n)??new Set;r.add(i),Ft.set(n,r),s.animations.set(n,i)}return s.finished=Promise.all([...s.animations.values()].map(t=>t.finished)).then(()=>s),s}cancel(){if(V(this))for(const t of this){const e=Ft.get(t);if(e){for(const t of e)t.cancel();Ft.delete(t)}}return this}finish(){if(V(this))for(const t of this){const e=Ft.get(t);if(e)for(const t of e)t.finish()}return this}reflow(){if(this[0]instanceof HTMLElement)for(const t of this)e.noop(t.offsetHeight);return this}repaint(){if(this[0]instanceof HTMLElement)for(const t of this){const e=t.style.display;t.style.display="none",t.style.display=e}return this}}e.setMixClassAttribute(Ht,"protoExtendsOnly");class Bt extends(e.mixins(P,Q,st,at,Et,Vt,Ut,Ht)){constructor(t){super(t)}static create(t,e){return t&&!e&&zt(t)?t:new Bt(b(t,e))}}function zt(t){return t instanceof Bt}e.setMixClassAttribute(Bt,"instanceOf",null),function Kt(t,e){S=e,k.fn=t}(Bt.prototype,Bt.create);const Wt=e.safe(globalThis.navigator),qt=e.safe(globalThis.screen),Gt=e.safe(globalThis.devicePixelRatio),Yt={navigator:Wt,screen:qt,devicePixelRatio:Gt},{navigator:Jt,screen:Qt,devicePixelRatio:Xt}=Yt,Zt=(t,e)=>600<=Math.min(t,e),te=t=>{t=t??{navigator:Jt,screen:Qt,devicePixelRatio:Xt};const s={ios:!1,android:!1,androidChrome:!1,desktop:!1,mobile:!1,phone:!1,tablet:!1,iphone:!1,iphoneX:!1,ipod:!1,ipad:!1,edge:!1,ie:!1,firefox:!1,macos:!1,windows:!1,cordova:!!e.getGlobal().cordova,electron:!1},{userAgent:n,platform:i,standalone:r}=t.navigator??Jt,{width:o,height:a}=t.screen??Qt,l=t.devicePixelRatio,c=/(Android);?[\s/]+([\d.]+)?/.exec(n);let h=/(iPad).*OS\s([\d_]+)/.exec(n);const u=/(iPod)(.*OS\s([\d_]+))?/.exec(n);let d=!h&&/(iPhone\sOS|iOS)\s([\d_]+)/.exec(n);const p=0<=n.indexOf("MSIE ")||0<=n.indexOf("Trident/"),f=0<=n.indexOf("Edge/"),g=0<=n.indexOf("Gecko/")&&0<=n.indexOf("Firefox/"),m="Win32"===i;let _="MacIntel"===i;const y=n.toLowerCase().startsWith("electron");if(!d&&!h&&_&&(Jt.maxTouchPoints>0||"ontouchstart"in globalThis)&&void 0!==r){const t=/(Version)\/([\d.]+)/.exec(n);Zt(o,a)?h=t:d=t,_=!1}return s.ie=p,s.edge=f,s.firefox=g,c&&!m&&(s.os="android",s.osVersion=c[2],s.android=!0,s.androidChrome=0<=n.toLowerCase().indexOf("chrome"),0<=n.indexOf("Mobile")?s.phone=!0:s.tablet=!0),(h??d??u)&&(s.os="ios",s.ios=!0),d&&!u&&(s.osVersion=d[2].replace(/_/g,"."),s.phone=!0,s.iphone=!0,(375===o&&812===a||812===o&&375===a||414===o&&896===a||896===o&&414===a)&&(s.iphoneX=!0)),h&&(s.osVersion=h[2].replace(/_/g,"."),s.tablet=!0,s.ipad=!0),u&&(s.osVersion=u[3]?u[3].replace(/_/g,"."):null,s.phone=!0,s.ipod=!0),s.desktop=!(t=>"orientation"in globalThis||0<=t.indexOf("Windows Phone"))(n),s.desktop&&(s.electron=y,s.macos=_,s.windows=m,s.macos&&(s.os="macos"),s.windows&&(s.os="windows")),s.mobile=!s.desktop,!s.mobile||s.phone||s.tablet||(Zt(o,a)?s.tablet=!0:s.phone=!0),s.pixelRatio=l??1,s},ee=te(),se=t=>"string"==typeof t,ne=()=>{let t,e;const s=new Promise((s,n)=>{t=s,e=n});return s.resolve=t,s.reject=e,s},ie=t=>null==t?"":""+t,re=/###/g,oe=t=>t&&t.indexOf("###")>-1?t.replace(re,"."):t,ae=t=>!t||se(t),le=(t,e,s)=>{const n=se(e)?e.split("."):e;let i=0;for(;i<n.length-1;){if(ae(t))return{};const e=oe(n[i]);!t[e]&&s&&(t[e]=new s),t=Object.prototype.hasOwnProperty.call(t,e)?t[e]:{},++i}return ae(t)?{}:{obj:t,k:oe(n[i])}},ce=(t,e,s)=>{const{obj:n,k:i}=le(t,e,Object);if(void 0!==n||1===e.length)return n[i]=s,void 0;let r=e[e.length-1],o=e.slice(0,e.length-1),a=le(t,o,Object);for(;void 0===a.obj&&o.length;)r=`${o[o.length-1]}.${r}`,o=o.slice(0,o.length-1),a=le(t,o,Object),a?.obj&&void 0!==a.obj[`${a.k}.${r}`]&&(a.obj=void 0);a.obj[`${a.k}.${r}`]=s},he=(t,e)=>{const{obj:s,k:n}=le(t,e);if(s&&Object.prototype.hasOwnProperty.call(s,n))return s[n]},ue=(t,e,s)=>{for(const n in e)"__proto__"!==n&&"constructor"!==n&&(n in t?se(t[n])||t[n]instanceof String||se(e[n])||e[n]instanceof String?s&&(t[n]=e[n]):ue(t[n],e[n],s):t[n]=e[n]);return t},de=t=>t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var pe={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const fe=t=>se(t)?t.replace(/[&<>"'\/]/g,t=>pe[t]):t;const ge=[" ",",","?","!",";"],me=new class _e{constructor(t){this.capacity=t,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(t){const e=this.regExpMap.get(t);if(void 0!==e)return e;const s=new RegExp(t);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(t,s),this.regExpQueue.push(t),s}}(20),ye=(t,e,s=".")=>{if(!t)return;if(t[e]){if(!Object.prototype.hasOwnProperty.call(t,e))return;return t[e]}const n=e.split(s);let i=t;for(let t=0;t<n.length;){if(!i||"object"!=typeof i)return;let e,r="";for(let o=t;o<n.length;++o)if(o!==t&&(r+=s),r+=n[o],e=i[r],void 0!==e){if(["string","number","boolean"].indexOf(typeof e)>-1&&o<n.length-1)continue;t+=o-t+1;break}i=e}return i},ve=t=>t?.replace("_","-"),be={type:"logger",log(t){this.output("log",t)},warn(t){this.output("warn",t)},error(t){this.output("error",t)},output(t,e){undefined}};class Ee{constructor(t,e={}){this.init(t,e)}init(t,e={}){this.prefix=e.prefix||"i18next:",this.logger=t||be,this.options=e,this.debug=e.debug}log(...t){return this.forward(t,"log","",!0)}warn(...t){return this.forward(t,"warn","",!0)}error(...t){return this.forward(t,"error","")}deprecate(...t){return this.forward(t,"warn","WARNING DEPRECATED: ",!0)}forward(t,e,s,n){return n&&!this.debug?null:(se(t[0])&&(t[0]=`${s}${this.prefix} ${t[0]}`),this.logger[e](t))}create(t){return new Ee(this.logger,{prefix:`${this.prefix}:${t}:`,...this.options})}clone(t){return t=t||this.options,t.prefix=t.prefix||this.prefix,new Ee(this.logger,t)}}const we=new Ee;class Re{constructor(){this.observers={}}on(t,e){return t.split(" ").forEach(t=>{this.observers[t]||(this.observers[t]=new Map);const s=this.observers[t].get(e)||0;this.observers[t].set(e,s+1)}),this}off(t,e){if(this.observers[t])return e?(this.observers[t].delete(e),void 0):(delete this.observers[t],void 0)}emit(t,...e){if(this.observers[t]){const s=Array.from(this.observers[t].entries());s.forEach(([t,s])=>{for(let n=0;n<s;n++)t(...e)})}if(this.observers["*"]){const s=Array.from(this.observers["*"].entries());s.forEach(([s,n])=>{for(let i=0;i<n;i++)s.apply(s,[t,...e])})}}}class xe extends Re{constructor(t,e={ns:["translation"],defaultNS:"translation"}){super(),this.data=t||{},this.options=e,void 0===this.options.keySeparator&&(this.options.keySeparator="."),void 0===this.options.ignoreJSONStructure&&(this.options.ignoreJSONStructure=!0)}addNamespaces(t){this.options.ns.indexOf(t)<0&&this.options.ns.push(t)}removeNamespaces(t){const e=this.options.ns.indexOf(t);e>-1&&this.options.ns.splice(e,1)}getResource(t,e,s,n={}){const i=void 0!==n.keySeparator?n.keySeparator:this.options.keySeparator,r=void 0!==n.ignoreJSONStructure?n.ignoreJSONStructure:this.options.ignoreJSONStructure;let o;t.indexOf(".")>-1?o=t.split("."):(o=[t,e],s&&(Array.isArray(s)?o.push(...s):se(s)&&i?o.push(...s.split(i)):o.push(s)));const a=he(this.data,o);return!a&&!e&&!s&&t.indexOf(".")>-1&&(t=o[0],e=o[1],s=o.slice(2).join(".")),!a&&r&&se(s)?ye(this.data?.[t]?.[e],s,i):a}addResource(t,e,s,n,i={silent:!1}){const r=void 0!==i.keySeparator?i.keySeparator:this.options.keySeparator;let o=[t,e];s&&(o=o.concat(r?s.split(r):s)),t.indexOf(".")>-1&&(o=t.split("."),n=e,e=o[1]),this.addNamespaces(e),ce(this.data,o,n),i.silent||this.emit("added",t,e,s,n)}addResources(t,e,s,n={silent:!1}){for(const n in s)(se(s[n])||Array.isArray(s[n]))&&this.addResource(t,e,n,s[n],{silent:!0});n.silent||this.emit("added",t,e,s)}addResourceBundle(t,e,s,n,i,r={silent:!1,skipCopy:!1}){let o=[t,e];t.indexOf(".")>-1&&(o=t.split("."),n=s,s=e,e=o[1]),this.addNamespaces(e);let a=he(this.data,o)||{};r.skipCopy||(s=JSON.parse(JSON.stringify(s))),n?ue(a,s,i):a={...a,...s},ce(this.data,o,a),r.silent||this.emit("added",t,e,s)}removeResourceBundle(t,e){this.hasResourceBundle(t,e)&&delete this.data[t][e],this.removeNamespaces(e),this.emit("removed",t,e)}hasResourceBundle(t,e){return void 0!==this.getResource(t,e)}getResourceBundle(t,e){return e||(e=this.options.defaultNS),this.getResource(t,e)}getDataByLanguage(t){return this.data[t]}hasLanguageSomeTranslations(t){const e=this.getDataByLanguage(t),s=e&&Object.keys(e)||[];return!!s.find(t=>e[t]&&Object.keys(e[t]).length>0)}toJSON(){return this.data}}const Oe={processors:{},addPostProcessor(t){this.processors[t.name]=t},handle(t,e,s,n,i){return t.forEach(t=>{e=this.processors[t]?.process(e,s,n,i)??e}),e}},Ce=Symbol("i18next/PATH_KEY");function Se(t,e){const{[Ce]:s}=t(function n(){const t=[],e=Object.create(null);let s;return e.get=(n,i)=>(s?.revoke?.(),i===Ce?t:(t.push(i),s=Proxy.revocable(n,e),s.proxy)),Proxy.revocable(Object.create(null),e).proxy}());return s.join(e?.keySeparator??".")}const ke={},$e=t=>!se(t)&&"boolean"!=typeof t&&"number"!=typeof t;class Te extends Re{constructor(t,e={}){super(),((t,e,s)=>{t.forEach(t=>{e[t]&&(s[t]=e[t])})})(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],t,this),this.options=e,void 0===this.options.keySeparator&&(this.options.keySeparator="."),this.logger=we.create("translator")}changeLanguage(t){t&&(this.language=t)}exists(t,e={interpolation:{}}){const s={...e};if(null==t)return!1;const n=this.resolve(t,s);if(void 0===n?.res)return!1;const i=$e(n.res);return!1!==s.returnObjects||!i}extractFromKey(t,e){let s=void 0!==e.nsSeparator?e.nsSeparator:this.options.nsSeparator;void 0===s&&(s=":");const n=void 0!==e.keySeparator?e.keySeparator:this.options.keySeparator;let i=e.ns||this.options.defaultNS||[];const r=s&&t.indexOf(s)>-1,o=!(this.options.userDefinedKeySeparator||e.keySeparator||this.options.userDefinedNsSeparator||e.nsSeparator||((t,e,s)=>{e=e||"",s=s||"";const n=ge.filter(t=>e.indexOf(t)<0&&s.indexOf(t)<0);if(0===n.length)return!0;const i=me.getRegExp(`(${n.map(t=>"?"===t?"\\?":t).join("|")})`);let r=!i.test(t);if(!r){const e=t.indexOf(s);e>0&&!i.test(t.substring(0,e))&&(r=!0)}return r})(t,s,n));if(r&&!o){const e=t.match(this.interpolator.nestingRegexp);if(e&&e.length>0)return{key:t,namespaces:se(i)?[i]:i};const r=t.split(s);(s!==n||s===n&&this.options.ns.indexOf(r[0])>-1)&&(i=r.shift()),t=r.join(n)}return{key:t,namespaces:se(i)?[i]:i}}translate(t,e,s){let n="object"==typeof e?{...e}:e;if("object"!=typeof n&&this.options.overloadTranslationOptionHandler&&(n=this.options.overloadTranslationOptionHandler(arguments)),"object"==typeof n&&(n={...n}),n||(n={}),null==t)return"";"function"==typeof t&&(t=Se(t,{...this.options,...n})),Array.isArray(t)||(t=[String(t)]);const i=void 0!==n.returnDetails?n.returnDetails:this.options.returnDetails,r=void 0!==n.keySeparator?n.keySeparator:this.options.keySeparator,{key:o,namespaces:a}=this.extractFromKey(t[t.length-1],n),l=a[a.length-1];let c=void 0!==n.nsSeparator?n.nsSeparator:this.options.nsSeparator;void 0===c&&(c=":");const h=n.lng||this.language,u=n.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if("cimode"===h?.toLowerCase())return u?i?{res:`${l}${c}${o}`,usedKey:o,exactUsedKey:o,usedLng:h,usedNS:l,usedParams:this.getUsedParamsDetails(n)}:`${l}${c}${o}`:i?{res:o,usedKey:o,exactUsedKey:o,usedLng:h,usedNS:l,usedParams:this.getUsedParamsDetails(n)}:o;const d=this.resolve(t,n);let p=d?.res;const f=d?.usedKey||o,g=d?.exactUsedKey||o,m=void 0!==n.joinArrays?n.joinArrays:this.options.joinArrays,_=!this.i18nFormat||this.i18nFormat.handleAsObject,y=void 0!==n.count&&!se(n.count),v=Te.hasDefaultValue(n),b=y?this.pluralResolver.getSuffix(h,n.count,n):"",E=n.ordinal&&y?this.pluralResolver.getSuffix(h,n.count,{ordinal:!1}):"",w=y&&!n.ordinal&&0===n.count,R=w&&n[`defaultValue${this.options.pluralSeparator}zero`]||n[`defaultValue${b}`]||n[`defaultValue${E}`]||n.defaultValue;let x=p;_&&!p&&v&&(x=R);const O=$e(x),C=Object.prototype.toString.apply(x);if(!(_&&x&&O&&["[object Number]","[object Function]","[object RegExp]"].indexOf(C)<0)||se(m)&&Array.isArray(x))if(_&&se(m)&&Array.isArray(p))p=p.join(m),p&&(p=this.extendTranslation(p,t,n,s));else{let e=!1,i=!1;!this.isValidLookup(p)&&v&&(e=!0,p=R),this.isValidLookup(p)||(i=!0,p=o);const a=n.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey,u=a&&i?void 0:p,f=v&&R!==p&&this.options.updateMissing;if(i||e||f){if(this.logger.log(f?"updateKey":"missingKey",h,l,o,f?R:p),r){const t=this.resolve(o,{...n,keySeparator:!1});t&&t.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let t=[];const e=this.languageUtils.getFallbackCodes(this.options.fallbackLng,n.lng||this.language);if("fallback"===this.options.saveMissingTo&&e&&e[0])for(let s=0;s<e.length;s++)t.push(e[s]);else"all"===this.options.saveMissingTo?t=this.languageUtils.toResolveHierarchy(n.lng||this.language):t.push(n.lng||this.language);const s=(t,e,s)=>{const i=v&&s!==p?s:u;this.options.missingKeyHandler?this.options.missingKeyHandler(t,l,e,i,f,n):this.backendConnector?.saveMissing&&this.backendConnector.saveMissing(t,l,e,i,f,n),this.emit("missingKey",t,l,e,p)};this.options.saveMissing&&(this.options.saveMissingPlurals&&y?t.forEach(t=>{const e=this.pluralResolver.getSuffixes(t,n);w&&n[`defaultValue${this.options.pluralSeparator}zero`]&&e.indexOf(`${this.options.pluralSeparator}zero`)<0&&e.push(`${this.options.pluralSeparator}zero`),e.forEach(e=>{s([t],o+e,n[`defaultValue${e}`]||R)})}):s(t,o,R))}p=this.extendTranslation(p,t,n,d,s),i&&p===o&&this.options.appendNamespaceToMissingKey&&(p=`${l}${c}${o}`),(i||e)&&this.options.parseMissingKeyHandler&&(p=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${l}${c}${o}`:o,e?p:void 0,n))}else{if(!n.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const t=this.options.returnedObjectHandler?this.options.returnedObjectHandler(f,x,{...n,ns:a}):`key '${o} (${this.language})' returned an object instead of string.`;return i?(d.res=t,d.usedParams=this.getUsedParamsDetails(n),d):t}if(r){const t=Array.isArray(x),e=t?[]:{},s=t?g:f;for(const t in x)if(Object.prototype.hasOwnProperty.call(x,t)){const i=`${s}${r}${t}`;e[t]=v&&!p?this.translate(i,{...n,defaultValue:$e(R)?R[t]:void 0,joinArrays:!1,ns:a}):this.translate(i,{...n,joinArrays:!1,ns:a}),e[t]===i&&(e[t]=x[t])}p=e}}return i?(d.res=p,d.usedParams=this.getUsedParamsDetails(n),d):p}extendTranslation(t,e,s,n,i){if(this.i18nFormat?.parse)t=this.i18nFormat.parse(t,{...this.options.interpolation.defaultVariables,...s},s.lng||this.language||n.usedLng,n.usedNS,n.usedKey,{resolved:n});else if(!s.skipInterpolation){s.interpolation&&this.interpolator.init({...s,interpolation:{...this.options.interpolation,...s.interpolation}});const r=se(t)&&(void 0!==s?.interpolation?.skipOnVariables?s.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let o;if(r){const e=t.match(this.interpolator.nestingRegexp);o=e&&e.length}let a=s.replace&&!se(s.replace)?s.replace:s;if(this.options.interpolation.defaultVariables&&(a={...this.options.interpolation.defaultVariables,...a}),t=this.interpolator.interpolate(t,a,s.lng||this.language||n.usedLng,s),r){const e=t.match(this.interpolator.nestingRegexp),n=e&&e.length;o<n&&(s.nest=!1)}!s.lng&&n&&n.res&&(s.lng=this.language||n.usedLng),!1!==s.nest&&(t=this.interpolator.nest(t,(...t)=>i?.[0]!==t[0]||s.context?this.translate(...t,e):(this.logger.warn(`It seems you are nesting recursively key: ${t[0]} in key: ${e[0]}`),null),s)),s.interpolation&&this.interpolator.reset()}const r=s.postProcess||this.options.postProcess,o=se(r)?[r]:r;return null!=t&&o?.length&&!1!==s.applyPostProcessor&&(t=Oe.handle(o,t,e,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...n,usedParams:this.getUsedParamsDetails(s)},...s}:s,this)),t}resolve(t,e={}){let s,n,i,r,o;return se(t)&&(t=[t]),t.forEach(t=>{if(this.isValidLookup(s))return;const a=this.extractFromKey(t,e),l=a.key;n=l;let c=a.namespaces;this.options.fallbackNS&&(c=c.concat(this.options.fallbackNS));const h=void 0!==e.count&&!se(e.count),u=h&&!e.ordinal&&0===e.count,d=void 0!==e.context&&(se(e.context)||"number"==typeof e.context)&&""!==e.context,p=e.lngs?e.lngs:this.languageUtils.toResolveHierarchy(e.lng||this.language,e.fallbackLng);c.forEach(t=>{this.isValidLookup(s)||(o=t,ke[`${p[0]}-${t}`]||!this.utils?.hasLoadedNamespace||this.utils?.hasLoadedNamespace(o)||(ke[`${p[0]}-${t}`]=!0,this.logger.warn(`key "${n}" for languages "${p.join(", ")}" won't get resolved as namespace "${o}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),p.forEach(n=>{if(this.isValidLookup(s))return;r=n;const o=[l];if(this.i18nFormat?.addLookupKeys)this.i18nFormat.addLookupKeys(o,l,n,t,e);else{let t;h&&(t=this.pluralResolver.getSuffix(n,e.count,e));const s=`${this.options.pluralSeparator}zero`,i=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(h&&(e.ordinal&&0===t.indexOf(i)&&o.push(l+t.replace(i,this.options.pluralSeparator)),o.push(l+t),u&&o.push(l+s)),d){const n=`${l}${this.options.contextSeparator||"_"}${e.context}`;o.push(n),h&&(e.ordinal&&0===t.indexOf(i)&&o.push(n+t.replace(i,this.options.pluralSeparator)),o.push(n+t),u&&o.push(n+s))}}let a;for(;a=o.pop();)this.isValidLookup(s)||(i=a,s=this.getResource(n,t,a,e))}))})}),{res:s,usedKey:n,exactUsedKey:i,usedLng:r,usedNS:o}}isValidLookup(t){return!(void 0===t||!this.options.returnNull&&null===t||!this.options.returnEmptyString&&""===t)}getResource(t,e,s,n={}){return this.i18nFormat?.getResource?this.i18nFormat.getResource(t,e,s,n):this.resourceStore.getResource(t,e,s,n)}getUsedParamsDetails(t={}){const e=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],s=t.replace&&!se(t.replace);let n=s?t.replace:t;if(s&&void 0!==t.count&&(n.count=t.count),this.options.interpolation.defaultVariables&&(n={...this.options.interpolation.defaultVariables,...n}),!s){n={...n};for(const t of e)delete n[t]}return n}static hasDefaultValue(t){const e="defaultValue";for(const s in t)if(Object.prototype.hasOwnProperty.call(t,s)&&e===s.substring(0,12)&&void 0!==t[s])return!0;return!1}}class Le{constructor(t){this.options=t,this.supportedLngs=this.options.supportedLngs||!1,this.logger=we.create("languageUtils")}getScriptPartFromCode(t){if(t=ve(t),!t||t.indexOf("-")<0)return null;const e=t.split("-");return 2===e.length?null:(e.pop(),"x"===e[e.length-1].toLowerCase()?null:this.formatLanguageCode(e.join("-")))}getLanguagePartFromCode(t){if(t=ve(t),!t||t.indexOf("-")<0)return t;const e=t.split("-");return this.formatLanguageCode(e[0])}formatLanguageCode(t){if(se(t)&&t.indexOf("-")>-1){let e;try{e=Intl.getCanonicalLocales(t)[0]}catch(t){}return e&&this.options.lowerCaseLng&&(e=e.toLowerCase()),e||(this.options.lowerCaseLng?t.toLowerCase():t)}return this.options.cleanCode||this.options.lowerCaseLng?t.toLowerCase():t}isSupportedCode(t){return("languageOnly"===this.options.load||this.options.nonExplicitSupportedLngs)&&(t=this.getLanguagePartFromCode(t)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(t)>-1}getBestMatchFromCodes(t){if(!t)return null;let e;return t.forEach(t=>{if(e)return;const s=this.formatLanguageCode(t);this.options.supportedLngs&&!this.isSupportedCode(s)||(e=s)}),!e&&this.options.supportedLngs&&t.forEach(t=>{if(e)return;const s=this.getScriptPartFromCode(t);if(this.isSupportedCode(s))return e=s;const n=this.getLanguagePartFromCode(t);if(this.isSupportedCode(n))return e=n;e=this.options.supportedLngs.find(t=>t===n?t:t.indexOf("-")<0&&n.indexOf("-")<0?void 0:t.indexOf("-")>0&&n.indexOf("-")<0&&t.substring(0,t.indexOf("-"))===n||0===t.indexOf(n)&&n.length>1?t:void 0)}),e||(e=this.getFallbackCodes(this.options.fallbackLng)[0]),e}getFallbackCodes(t,e){if(!t)return[];if("function"==typeof t&&(t=t(e)),se(t)&&(t=[t]),Array.isArray(t))return t;if(!e)return t.default||[];let s=t[e];return s||(s=t[this.getScriptPartFromCode(e)]),s||(s=t[this.formatLanguageCode(e)]),s||(s=t[this.getLanguagePartFromCode(e)]),s||(s=t.default),s||[]}toResolveHierarchy(t,e){const s=this.getFallbackCodes((!1===e?[]:e)||this.options.fallbackLng||[],t),n=[],i=t=>{t&&(this.isSupportedCode(t)?n.push(t):this.logger.warn(`rejecting language code not found in supportedLngs: ${t}`))};return se(t)&&(t.indexOf("-")>-1||t.indexOf("_")>-1)?("languageOnly"!==this.options.load&&i(this.formatLanguageCode(t)),"languageOnly"!==this.options.load&&"currentOnly"!==this.options.load&&i(this.getScriptPartFromCode(t)),"currentOnly"!==this.options.load&&i(this.getLanguagePartFromCode(t))):se(t)&&i(this.formatLanguageCode(t)),s.forEach(t=>{n.indexOf(t)<0&&i(this.formatLanguageCode(t))}),n}}const Pe={zero:0,one:1,two:2,few:3,many:4,other:5},Ae={select:t=>1===t?"one":"other",resolvedOptions:()=>({pluralCategories:["one","other"]})};class Ne{constructor(t,e={}){this.languageUtils=t,this.options=e,this.logger=we.create("pluralResolver"),this.pluralRulesCache={}}addRule(t,e){this.rules[t]=e}clearCache(){this.pluralRulesCache={}}getRule(t,e={}){const s=ve("dev"===t?"en":t),n=e.ordinal?"ordinal":"cardinal",i=JSON.stringify({cleanedCode:s,type:n});if(i in this.pluralRulesCache)return this.pluralRulesCache[i];let r;try{r=new Intl.PluralRules(s,{type:n})}catch(s){if(!Intl)return this.logger.error("No Intl support, please use an Intl polyfill!"),Ae;if(!t.match(/-|_/))return Ae;const n=this.languageUtils.getLanguagePartFromCode(t);r=this.getRule(n,e)}return this.pluralRulesCache[i]=r,r}needsPlural(t,e={}){let s=this.getRule(t,e);return s||(s=this.getRule("dev",e)),s?.resolvedOptions().pluralCategories.length>1}getPluralFormsOfKey(t,e,s={}){return this.getSuffixes(t,s).map(t=>`${e}${t}`)}getSuffixes(t,e={}){let s=this.getRule(t,e);return s||(s=this.getRule("dev",e)),s?s.resolvedOptions().pluralCategories.sort((t,e)=>Pe[t]-Pe[e]).map(t=>`${this.options.prepend}${e.ordinal?`ordinal${this.options.prepend}`:""}${t}`):[]}getSuffix(t,e,s={}){const n=this.getRule(t,s);return n?`${this.options.prepend}${s.ordinal?`ordinal${this.options.prepend}`:""}${n.select(e)}`:(this.logger.warn(`no plural rule found for: ${t}`),this.getSuffix("dev",e,s))}}const De=(t,e,s,n=".",i=!0)=>{let r=((t,e,s)=>{const n=he(t,s);return void 0!==n?n:he(e,s)})(t,e,s);return!r&&i&&se(s)&&(r=ye(t,s,n),void 0===r&&(r=ye(e,s,n))),r},Ie=t=>t.replace(/\$/g,"$$$$");class Ve{constructor(t={}){this.logger=we.create("interpolator"),this.options=t,this.format=t?.interpolation?.format||(t=>t),this.init(t)}init(t={}){t.interpolation||(t.interpolation={escapeValue:!0});const{escape:e,escapeValue:s,useRawValueToEscape:n,prefix:i,prefixEscaped:r,suffix:o,suffixEscaped:a,formatSeparator:l,unescapeSuffix:c,unescapePrefix:h,nestingPrefix:u,nestingPrefixEscaped:d,nestingSuffix:p,nestingSuffixEscaped:f,nestingOptionsSeparator:g,maxReplaces:m,alwaysFormat:_}=t.interpolation;this.escape=void 0!==e?e:fe,this.escapeValue=void 0===s||s,this.useRawValueToEscape=void 0!==n&&n,this.prefix=i?de(i):r||"{{",this.suffix=o?de(o):a||"}}",this.formatSeparator=l||",",this.unescapePrefix=c?"":h||"-",this.unescapeSuffix=this.unescapePrefix?"":c||"",this.nestingPrefix=u?de(u):d||de("$t("),this.nestingSuffix=p?de(p):f||de(")"),this.nestingOptionsSeparator=g||",",this.maxReplaces=m||1e3,this.alwaysFormat=void 0!==_&&_,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const t=(t,e)=>t?.source===e?(t.lastIndex=0,t):new RegExp(e,"g");this.regexp=t(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=t(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=t(this.nestingRegexp,`${this.nestingPrefix}((?:[^()"']+|"[^"]*"|'[^']*'|\\((?:[^()]|"[^"]*"|'[^']*')*\\))*?)${this.nestingSuffix}`)}interpolate(t,e,s,n){let i,r,o;const a=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},l=t=>{if(t.indexOf(this.formatSeparator)<0){const i=De(e,a,t,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(i,void 0,s,{...n,...e,interpolationkey:t}):i}const i=t.split(this.formatSeparator),r=i.shift().trim(),o=i.join(this.formatSeparator).trim();return this.format(De(e,a,r,this.options.keySeparator,this.options.ignoreJSONStructure),o,s,{...n,...e,interpolationkey:r})};this.resetRegExp();const c=n?.missingInterpolationHandler||this.options.missingInterpolationHandler,h=void 0!==n?.interpolation?.skipOnVariables?n.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables,u=[{regex:this.regexpUnescape,safeValue:t=>Ie(t)},{regex:this.regexp,safeValue:t=>this.escapeValue?Ie(this.escape(t)):Ie(t)}];return u.forEach(e=>{for(o=0;i=e.regex.exec(t);){const s=i[1].trim();if(r=l(s),void 0===r)if("function"==typeof c){const e=c(t,i,n);r=se(e)?e:""}else if(n&&Object.prototype.hasOwnProperty.call(n,s))r="";else{if(h){r=i[0];continue}this.logger.warn(`missed to pass in variable ${s} for interpolating ${t}`),r=""}else se(r)||this.useRawValueToEscape||(r=ie(r));const a=e.safeValue(r);if(t=t.replace(i[0],a),h?(e.regex.lastIndex+=r.length,e.regex.lastIndex-=i[0].length):e.regex.lastIndex=0,o++,o>=this.maxReplaces)break}}),t}nest(t,e,s={}){let n,i,r;const o=(t,e)=>{const s=this.nestingOptionsSeparator;if(t.indexOf(s)<0)return t;const n=t.split(new RegExp(`${s}[ ]*{`));let i=`{${n[1]}`;t=n[0],i=this.interpolate(i,r);const o=i.match(/'/g),a=i.match(/"/g);((o?.length??0)%2==0&&!a||a.length%2!=0)&&(i=i.replace(/'/g,'"'));try{r=JSON.parse(i),e&&(r={...e,...r})}catch(e){return this.logger.warn(`failed parsing options string in nesting for key ${t}`,e),`${t}${s}${i}`}return r.defaultValue&&r.defaultValue.indexOf(this.prefix)>-1&&delete r.defaultValue,t};for(;n=this.nestingRegexp.exec(t);){let a=[];r={...s},r=r.replace&&!se(r.replace)?r.replace:r,r.applyPostProcessor=!1,delete r.defaultValue;const l=/{.*}/.test(n[1])?n[1].lastIndexOf("}")+1:n[1].indexOf(this.formatSeparator);if(-1!==l&&(a=n[1].slice(l).split(this.formatSeparator).map(t=>t.trim()).filter(Boolean),n[1]=n[1].slice(0,l)),i=e(o.call(this,n[1].trim(),r),r),i&&n[0]===t&&!se(i))return i;se(i)||(i=ie(i)),i||(this.logger.warn(`missed to resolve ${n[1]} for nesting ${t}`),i=""),a.length&&(i=a.reduce((t,e)=>this.format(t,e,s.lng,{...s,interpolationkey:n[1].trim()}),i.trim())),t=t.replace(n[0],i),this.regexp.lastIndex=0}return t}}const Me=t=>{const e={};return(s,n,i)=>{let r=i;i&&i.interpolationkey&&i.formatParams&&i.formatParams[i.interpolationkey]&&i[i.interpolationkey]&&(r={...r,[i.interpolationkey]:void 0});const o=n+JSON.stringify(r);let a=e[o];return a||(a=t(ve(n),i),e[o]=a),a(s)}},je=t=>(e,s,n)=>t(ve(s),n)(e);class Ue{constructor(t={}){this.logger=we.create("formatter"),this.options=t,this.init(t)}init(t,e={interpolation:{}}){this.formatSeparator=e.interpolation.formatSeparator||",";const s=e.cacheInBuiltFormats?Me:je;this.formats={number:s((t,e)=>{const s=new Intl.NumberFormat(t,{...e});return t=>s.format(t)}),currency:s((t,e)=>{const s=new Intl.NumberFormat(t,{...e,style:"currency"});return t=>s.format(t)}),datetime:s((t,e)=>{const s=new Intl.DateTimeFormat(t,{...e});return t=>s.format(t)}),relativetime:s((t,e)=>{const s=new Intl.RelativeTimeFormat(t,{...e});return t=>s.format(t,e.range||"day")}),list:s((t,e)=>{const s=new Intl.ListFormat(t,{...e});return t=>s.format(t)})}}add(t,e){this.formats[t.toLowerCase().trim()]=e}addCached(t,e){this.formats[t.toLowerCase().trim()]=Me(e)}format(t,e,s,n={}){const i=e.split(this.formatSeparator);if(i.length>1&&i[0].indexOf("(")>1&&i[0].indexOf(")")<0&&i.find(t=>t.indexOf(")")>-1)){const t=i.findIndex(t=>t.indexOf(")")>-1);i[0]=[i[0],...i.splice(1,t)].join(this.formatSeparator)}const r=i.reduce((t,e)=>{const{formatName:i,formatOptions:r}=(t=>{let e=t.toLowerCase().trim();const s={};if(t.indexOf("(")>-1){const n=t.split("(");e=n[0].toLowerCase().trim();const i=n[1].substring(0,n[1].length-1);if("currency"===e&&i.indexOf(":")<0)s.currency||(s.currency=i.trim());else if("relativetime"===e&&i.indexOf(":")<0)s.range||(s.range=i.trim());else{const t=i.split(";");t.forEach(t=>{if(t){const[e,...n]=t.split(":"),i=n.join(":").trim().replace(/^'+|'+$/g,""),r=e.trim();s[r]||(s[r]=i),"false"===i&&(s[r]=!1),"true"===i&&(s[r]=!0),isNaN(i)||(s[r]=parseInt(i,10))}})}}return{formatName:e,formatOptions:s}})(e);if(this.formats[i]){let e=t;try{const o=n?.formatParams?.[n.interpolationkey]||{},a=o.locale||o.lng||n.locale||n.lng||s;e=this.formats[i](t,a,{...r,...n,...o})}catch(t){this.logger.warn(t)}return e}return this.logger.warn(`there was no format function for ${i}`),t},t);return r}}class Fe extends Re{constructor(t,e,s,n={}){super(),this.backend=t,this.store=e,this.services=s,this.languageUtils=s.languageUtils,this.options=n,this.logger=we.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=n.maxParallelReads||10,this.readingCalls=0,this.maxRetries=n.maxRetries>=0?n.maxRetries:5,this.retryTimeout=n.retryTimeout>=1?n.retryTimeout:350,this.state={},this.queue=[],this.backend?.init?.(s,n.backend,n)}queueLoad(t,e,s,n){const i={},r={},o={},a={};return t.forEach(t=>{let n=!0;e.forEach(e=>{const o=`${t}|${e}`;!s.reload&&this.store.hasResourceBundle(t,e)?this.state[o]=2:this.state[o]<0||(1===this.state[o]?void 0===r[o]&&(r[o]=!0):(this.state[o]=1,n=!1,void 0===r[o]&&(r[o]=!0),void 0===i[o]&&(i[o]=!0),void 0===a[e]&&(a[e]=!0)))}),n||(o[t]=!0)}),(Object.keys(i).length||Object.keys(r).length)&&this.queue.push({pending:r,pendingCount:Object.keys(r).length,loaded:{},errors:[],callback:n}),{toLoad:Object.keys(i),pending:Object.keys(r),toLoadLanguages:Object.keys(o),toLoadNamespaces:Object.keys(a)}}loaded(t,e,s){const n=t.split("|"),i=n[0],r=n[1];e&&this.emit("failedLoading",i,r,e),!e&&s&&this.store.addResourceBundle(i,r,s,void 0,void 0,{skipCopy:!0}),this.state[t]=e?-1:2,e&&s&&(this.state[t]=0);const o={};this.queue.forEach(s=>{((t,e,s)=>{const{obj:n,k:i}=le(t,e,Object);n[i]=n[i]||[],n[i].push(s)})(s.loaded,[i],r),((t,e)=>{void 0!==t.pending[e]&&(delete t.pending[e],t.pendingCount--)})(s,t),e&&s.errors.push(e),0!==s.pendingCount||s.done||(Object.keys(s.loaded).forEach(t=>{o[t]||(o[t]={});const e=s.loaded[t];e.length&&e.forEach(e=>{void 0===o[t][e]&&(o[t][e]=!0)})}),s.done=!0,s.errors.length?s.callback(s.errors):s.callback())}),this.emit("loaded",o),this.queue=this.queue.filter(t=>!t.done)}read(t,e,s,n=0,i=this.retryTimeout,r){if(!t.length)return r(null,{});if(this.readingCalls>=this.maxParallelReads)return this.waitingReads.push({lng:t,ns:e,fcName:s,tried:n,wait:i,callback:r}),void 0;this.readingCalls++;const o=(o,a)=>{if(this.readingCalls--,this.waitingReads.length>0){const t=this.waitingReads.shift();this.read(t.lng,t.ns,t.fcName,t.tried,t.wait,t.callback)}if(o&&a&&n<this.maxRetries)return setTimeout(()=>{this.read.call(this,t,e,s,n+1,2*i,r)},i),void 0;r(o,a)},a=this.backend[s].bind(this.backend);if(2!==a.length)return a(t,e,o);try{const s=a(t,e);s&&"function"==typeof s.then?s.then(t=>o(null,t)).catch(o):o(null,s)}catch(t){o(t)}}prepareLoading(t,e,s={},n){if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),n&&n();se(t)&&(t=this.languageUtils.toResolveHierarchy(t)),se(e)&&(e=[e]);const i=this.queueLoad(t,e,s,n);if(!i.toLoad.length)return i.pending.length||n(),null;i.toLoad.forEach(t=>{this.loadOne(t)})}load(t,e,s){this.prepareLoading(t,e,{},s)}reload(t,e,s){this.prepareLoading(t,e,{reload:!0},s)}loadOne(t,e=""){const s=t.split("|"),n=s[0],i=s[1];this.read(n,i,"read",void 0,void 0,(s,r)=>{s&&this.logger.warn(`${e}loading namespace ${i} for language ${n} failed`,s),!s&&r&&this.logger.log(`${e}loaded namespace ${i} for language ${n}`,r),this.loaded(t,s,r)})}saveMissing(t,e,s,n,i,r={},o=()=>{}){if(this.services?.utils?.hasLoadedNamespace&&!this.services?.utils?.hasLoadedNamespace(e))return this.logger.warn(`did not save key "${s}" as the namespace "${e}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!"),void 0;if(null!=s&&""!==s){if(this.backend?.create){const a={...r,isUpdate:i},l=this.backend.create.bind(this.backend);if(l.length<6)try{let i;i=5===l.length?l(t,e,s,n,a):l(t,e,s,n),i&&"function"==typeof i.then?i.then(t=>o(null,t)).catch(o):o(null,i)}catch(t){o(t)}else l(t,e,s,n,o,a)}t&&t[0]&&this.store.addResource(t[0],e,s,n)}}}const He=()=>({debug:!1,initAsync:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:t=>{let e={};if("object"==typeof t[1]&&(e=t[1]),se(t[1])&&(e.defaultValue=t[1]),se(t[2])&&(e.tDescription=t[2]),"object"==typeof t[2]||"object"==typeof t[3]){const s=t[3]||t[2];Object.keys(s).forEach(t=>{e[t]=s[t]})}return e},interpolation:{escapeValue:!0,format:t=>t,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0},cacheInBuiltFormats:!0}),Be=t=>(se(t.ns)&&(t.ns=[t.ns]),se(t.fallbackLng)&&(t.fallbackLng=[t.fallbackLng]),se(t.fallbackNS)&&(t.fallbackNS=[t.fallbackNS]),t.supportedLngs?.indexOf?.("cimode")<0&&(t.supportedLngs=t.supportedLngs.concat(["cimode"])),"boolean"==typeof t.initImmediate&&(t.initAsync=t.initImmediate),t),ze=()=>{};class Ke extends Re{constructor(t={},e){if(super(),this.options=Be(t),this.services={},this.logger=we,this.modules={external:[]},(t=>{const e=Object.getOwnPropertyNames(Object.getPrototypeOf(t));e.forEach(e=>{"function"==typeof t[e]&&(t[e]=t[e].bind(t))})})(this),e&&!this.isInitialized&&!t.isClone){if(!this.options.initAsync)return this.init(t,e),this;setTimeout(()=>{this.init(t,e)},0)}}init(t={},e){this.isInitializing=!0,"function"==typeof t&&(e=t,t={}),null==t.defaultNS&&t.ns&&(se(t.ns)?t.defaultNS=t.ns:t.ns.indexOf("translation")<0&&(t.defaultNS=t.ns[0]));const s=He();this.options={...s,...this.options,...Be(t)},this.options.interpolation={...s.interpolation,...this.options.interpolation},void 0!==t.keySeparator&&(this.options.userDefinedKeySeparator=t.keySeparator),void 0!==t.nsSeparator&&(this.options.userDefinedNsSeparator=t.nsSeparator);const n=t=>t?"function"==typeof t?new t:t:null;if(!this.options.isClone){let t;this.modules.logger?we.init(n(this.modules.logger),this.options):we.init(null,this.options),t=this.modules.formatter?this.modules.formatter:Ue;const e=new Le(this.options);this.store=new xe(this.options.resources,this.options);const i=this.services;i.logger=we,i.resourceStore=this.store,i.languageUtils=e,i.pluralResolver=new Ne(e,{prepend:this.options.pluralSeparator,simplifyPluralSuffix:this.options.simplifyPluralSuffix});const r=this.options.interpolation.format&&this.options.interpolation.format!==s.interpolation.format;r&&this.logger.deprecate("init: you are still using the legacy format function, please use the new approach: https://www.i18next.com/translation-function/formatting"),!t||this.options.interpolation.format&&this.options.interpolation.format!==s.interpolation.format||(i.formatter=n(t),i.formatter.init&&i.formatter.init(i,this.options),this.options.interpolation.format=i.formatter.format.bind(i.formatter)),i.interpolator=new Ve(this.options),i.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},i.backendConnector=new Fe(n(this.modules.backend),i.resourceStore,i,this.options),i.backendConnector.on("*",(t,...e)=>{this.emit(t,...e)}),this.modules.languageDetector&&(i.languageDetector=n(this.modules.languageDetector),i.languageDetector.init&&i.languageDetector.init(i,this.options.detection,this.options)),this.modules.i18nFormat&&(i.i18nFormat=n(this.modules.i18nFormat),i.i18nFormat.init&&i.i18nFormat.init(this)),this.translator=new Te(this.services,this.options),this.translator.on("*",(t,...e)=>{this.emit(t,...e)}),this.modules.external.forEach(t=>{t.init&&t.init(this)})}if(this.format=this.options.interpolation.format,e||(e=ze),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const t=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);t.length>0&&"dev"!==t[0]&&(this.options.lng=t[0])}this.services.languageDetector||this.options.lng||this.logger.warn("init: no languageDetector is used and no lng is defined");["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(t=>{this[t]=(...e)=>this.store[t](...e)});["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(t=>{this[t]=(...e)=>(this.store[t](...e),this)});const i=ne(),r=()=>{const t=(t,s)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),i.resolve(s),e(t,s)};if(this.languages&&!this.isInitialized)return t(null,this.t.bind(this));this.changeLanguage(this.options.lng,t)};return this.options.resources||!this.options.initAsync?r():setTimeout(r,0),i}loadResources(t,e=ze){let s=e;const n=se(t)?t:this.language;if("function"==typeof t&&(s=t),!this.options.resources||this.options.partialBundledLanguages){if("cimode"===n?.toLowerCase()&&(!this.options.preload||0===this.options.preload.length))return s();const t=[],e=e=>{if(!e)return;if("cimode"===e)return;const s=this.services.languageUtils.toResolveHierarchy(e);s.forEach(e=>{"cimode"!==e&&t.indexOf(e)<0&&t.push(e)})};if(n)e(n);else{const t=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);t.forEach(t=>e(t))}this.options.preload?.forEach?.(t=>e(t)),this.services.backendConnector.load(t,this.options.ns,t=>{t||this.resolvedLanguage||!this.language||this.setResolvedLanguage(this.language),s(t)})}else s(null)}reloadResources(t,e,s){const n=ne();return"function"==typeof t&&(s=t,t=void 0),"function"==typeof e&&(s=e,e=void 0),t||(t=this.languages),e||(e=this.options.ns),s||(s=ze),this.services.backendConnector.reload(t,e,t=>{n.resolve(),s(t)}),n}use(t){if(!t)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!t.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return"backend"===t.type&&(this.modules.backend=t),("logger"===t.type||t.log&&t.warn&&t.error)&&(this.modules.logger=t),"languageDetector"===t.type&&(this.modules.languageDetector=t),"i18nFormat"===t.type&&(this.modules.i18nFormat=t),"postProcessor"===t.type&&Oe.addPostProcessor(t),"formatter"===t.type&&(this.modules.formatter=t),"3rdParty"===t.type&&this.modules.external.push(t),this}setResolvedLanguage(t){if(t&&this.languages&&!(["cimode","dev"].indexOf(t)>-1)){for(let t=0;t<this.languages.length;t++){const e=this.languages[t];if(!(["cimode","dev"].indexOf(e)>-1)&&this.store.hasLanguageSomeTranslations(e)){this.resolvedLanguage=e;break}}!this.resolvedLanguage&&this.languages.indexOf(t)<0&&this.store.hasLanguageSomeTranslations(t)&&(this.resolvedLanguage=t,this.languages.unshift(t))}}changeLanguage(t,e){this.isLanguageChangingTo=t;const s=ne();this.emit("languageChanging",t);const n=t=>{this.language=t,this.languages=this.services.languageUtils.toResolveHierarchy(t),this.resolvedLanguage=void 0,this.setResolvedLanguage(t)},i=(i,r)=>{r?this.isLanguageChangingTo===t&&(n(r),this.translator.changeLanguage(r),this.isLanguageChangingTo=void 0,this.emit("languageChanged",r),this.logger.log("languageChanged",r)):this.isLanguageChangingTo=void 0,s.resolve((...t)=>this.t(...t)),e&&e(i,(...t)=>this.t(...t))},r=e=>{t||e||!this.services.languageDetector||(e=[]);const s=se(e)?e:e&&e[0],r=this.store.hasLanguageSomeTranslations(s)?s:this.services.languageUtils.getBestMatchFromCodes(se(e)?[e]:e);r&&(this.language||n(r),this.translator.language||this.translator.changeLanguage(r),this.services.languageDetector?.cacheUserLanguage?.(r)),this.loadResources(r,t=>{i(t,r)})};return t||!this.services.languageDetector||this.services.languageDetector.async?!t&&this.services.languageDetector&&this.services.languageDetector.async?0===this.services.languageDetector.detect.length?this.services.languageDetector.detect().then(r):this.services.languageDetector.detect(r):r(t):r(this.services.languageDetector.detect()),s}getFixedT(t,e,s){const n=(t,e,...i)=>{let r;r="object"!=typeof e?this.options.overloadTranslationOptionHandler([t,e].concat(i)):{...e},r.lng=r.lng||n.lng,r.lngs=r.lngs||n.lngs,r.ns=r.ns||n.ns,""!==r.keyPrefix&&(r.keyPrefix=r.keyPrefix||s||n.keyPrefix);const o=this.options.keySeparator||".";let a;return r.keyPrefix&&Array.isArray(t)?a=t.map(t=>("function"==typeof t&&(t=Se(t,{...this.options,...e})),`${r.keyPrefix}${o}${t}`)):("function"==typeof t&&(t=Se(t,{...this.options,...e})),a=r.keyPrefix?`${r.keyPrefix}${o}${t}`:t),this.t(a,r)};return se(t)?n.lng=t:n.lngs=t,n.ns=e,n.keyPrefix=s,n}t(...t){return this.translator?.translate(...t)}exists(...t){return this.translator?.exists(...t)}setDefaultNamespace(t){this.options.defaultNS=t}hasLoadedNamespace(t,e={}){if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const s=e.lng||this.resolvedLanguage||this.languages[0],n=!!this.options&&this.options.fallbackLng,i=this.languages[this.languages.length-1];if("cimode"===s.toLowerCase())return!0;const r=(t,e)=>{const s=this.services.backendConnector.state[`${t}|${e}`];return-1===s||0===s||2===s};if(e.precheck){const t=e.precheck(this,r);if(void 0!==t)return t}return!!this.hasResourceBundle(s,t)||(!(this.services.backendConnector.backend&&(!this.options.resources||this.options.partialBundledLanguages))||!(!r(s,t)||n&&!r(i,t)))}loadNamespaces(t,e){const s=ne();return this.options.ns?(se(t)&&(t=[t]),t.forEach(t=>{this.options.ns.indexOf(t)<0&&this.options.ns.push(t)}),this.loadResources(t=>{s.resolve(),e&&e(t)}),s):(e&&e(),Promise.resolve())}loadLanguages(t,e){const s=ne();se(t)&&(t=[t]);const n=this.options.preload||[],i=t.filter(t=>n.indexOf(t)<0&&this.services.languageUtils.isSupportedCode(t));return i.length?(this.options.preload=n.concat(i),this.loadResources(t=>{s.resolve(),e&&e(t)}),s):(e&&e(),Promise.resolve())}dir(t){if(t||(t=this.resolvedLanguage||(this.languages?.length>0?this.languages[0]:this.language)),!t)return"rtl";try{const e=new Intl.Locale(t);if(e&&e.getTextInfo){const t=e.getTextInfo();if(t&&t.direction)return t.direction}}catch(t){}const e=this.services?.languageUtils||new Le(He());return t.toLowerCase().indexOf("-latn")>1?"ltr":["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"].indexOf(e.getLanguagePartFromCode(t))>-1||t.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(t={},e){return new Ke(t,e)}cloneInstance(t={},e=ze){const s=t.forkResourceStore;s&&delete t.forkResourceStore;const n={...this.options,...t,isClone:!0},i=new Ke(n);void 0===t.debug&&void 0===t.prefix||(i.logger=i.logger.clone(t));if(["store","services","language"].forEach(t=>{i[t]=this[t]}),i.services={...this.services},i.services.utils={hasLoadedNamespace:i.hasLoadedNamespace.bind(i)},s){const t=Object.keys(this.store.data).reduce((t,e)=>(t[e]={...this.store.data[e]},t[e]=Object.keys(t[e]).reduce((s,n)=>(s[n]={...t[e][n]},s),t[e]),t),{});i.store=new xe(t,n),i.services.resourceStore=i.store}return i.translator=new Te(i.services,n),i.translator.on("*",(t,...e)=>{i.emit(t,...e)}),i.init(n,e),i.translator.options=n,i.translator.backendConnector.services.utils={hasLoadedNamespace:i.hasLoadedNamespace.bind(i)},i}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const We=Ke.createInstance();We.createInstance=Ke.createInstance,We.createInstance,We.dir,We.init,We.loadResources,We.reloadResources,We.use,We.changeLanguage,We.getFixedT,We.t,We.exists,We.setDefaultNamespace,We.hasLoadedNamespace,We.loadNamespaces,We.loadLanguages;const qe=We;!function(){let t=CDP_DECLARE.RESULT_CODE;t[t.I18N_DECLARE=9007199254740991]="I18N_DECLARE",void(t[t.ERROR_I18N_CORE_LAYER=CDP_DECLARE.DECLARE_ERROR_CODE(100,41,"i18next error")]="ERROR_I18N_CORE_LAYER")}();const Ge=e.safe(globalThis.navigator);class Ye{type="backend";static type="backend";_services;_options={};_fallbackMap={};init(t,e,s){this._services=t,this._options=Object.assign({loadPath:"res/locales/{{ns}}.{{lng}}.json"},this._options,e),this._fallbackMap=Object.assign(this._fallbackMap,s.fallbackResources)}read(t,s,n){const i=this._fallbackMap[t]||t,r=e.isFunction(this._options.loadPath)?this._options.loadPath([i],[s]):this._options.loadPath,o=this.resolveUrl(r,{lng:i,ns:s});this.loadUrl(o,n)}resolveUrl(t,e){return c(this._services.interpolator.interpolate(t,e,void 0,void 0))}loadUrl(t,n){void(async()=>{try{const e=await s.request.json(t,this._options);n(null,e)}catch(s){const i=e.toResult(s),r=`failed loading: ${t}, ${i.message}`;if(e.RESULT_CODE.ERROR_AJAX_RESPONSE===i.code&&i.cause){const{status:t}=i.cause;if(500<=t&&t<600)return n(r,!0);if(400<=t&&t<500)return n(r,!1)}n(r,!1)}})()}}function Je(t,e){const{selectorAttr:s,targetAttr:n,optionsAttr:i,useOptionsAttr:r,parseDefaultValueFromContent:o,customTagName:a}=t,l=(t,e)=>o?{...t,defaultValue:e}:t,c=(t,s,n,i)=>{const r=e.t(n,l(i,s.html()));if(!1===a)s[t](r);else{const e=`<${a}>${r}</${a}>`,n=s.children(a);n.length?n.replaceWith(e):s[t](e)}},h=(t,s,n)=>{let i="text";if(s.startsWith("[")){const t=s.split("]");s=t[1].trim(),i=t[0].substring(1,t[0].length).trim()}if("html"===i)t.html(e.t(s,l(n,t.html())));else if("text"===i)t.text(e.t(s,l(n,t.text())));else if("prepend"===i)c("prepend",t,s,n);else if("append"===i)c("append",t,s,n);else if(i.startsWith("data-")){const r=i.substring(5),o=e.t(s,l(n,t.data(r)));t.data(r,o),t.attr(i,o)}else t.attr(i,e.t(s,l(n,t.attr(i))))},u=(t,e)=>{const o=t.attr(s);if(!o)return;let a=t;const l=t.data(n);l&&(a=t.find(l)),e||!0!==r||(e=t.data(i)),e=e||{};for(const t of o.split(";")){const s=t.trim();""!==s&&h(a,s,e)}if(!0===r){const s={...e};delete s.lng,t.data(i,s)}};k.fn.localize=function d(t){return this.each((e,n)=>{for(const e of k.utils.rootify(n)){const n=k(e);u(n,t);const i=n.find(`[${s}]`);i.each((e,s)=>{u(k(s),t)})}})}}const Qe=qe.t.bind(qe),Xe=t=>{const s=Object.assign({noThrow:!0},t),{namespace:n,resourcePath:i,dom:r,noThrow:o}=s;return s.lng||(s.lng=Ge.language),n&&(!s.ns&&(s.ns=n),!s.defaultNS&&(s.defaultNS=n)),i&&(s.backend=Object.assign({loadPath:i},s.backend)),s.backend&&qe.use(Ye),qe.use(function a(t){return{type:"3rdParty",init:Je.bind(null,Object.assign({selectorAttr:"data-i18n",targetAttr:"i18n-target",optionsAttr:"i18n-options",useOptionsAttr:!1,parseDefaultValueFromContent:!0,customTagName:"cdp-i18n"},t))}}(r)),new Promise((t,n)=>{void qe.init(s,(s,i)=>{if(s){const t=e.makeResult(e.RESULT_CODE.ERROR_I18N_CORE_LAYER,"i18n#init() failed.",s);if(!o)return n(t);void 0}t(i)})})},Ze=()=>qe.language||Ge.language,ts=(t,s)=>{const n=Object.assign({noThrow:!0},s);return new Promise((s,i)=>{void qe.changeLanguage(t,(t,r)=>{if(t){const s=e.makeResult(e.RESULT_CODE.ERROR_I18N_CORE_LAYER,"i18n#changeLanguate() failed.",t);if(!n.noThrow)return i(s);void 0}s(r)})})},es=(t,e)=>k(t).localize(e);class ss{_broker=new e.EventBroker;_storage;constructor(t){e.verify("instanceOf",Storage,t),this._storage=t}get kind(){const t=localStorage===this._storage?"local-storage":"session-storage";return`web:${t}`}async getItem(t,n){return e.dropUndefined(await s.deserialize(this._storage[t],n))}async setItem(t,n,i){i=i??{};const r=e.dropUndefined(n,!0),o=e.dropUndefined(await s.deserialize(this._storage[t],i));e.deepEqual(o,r)||(this._storage.setItem(t,await s.serialize(r,i)),!i.silent&&this._broker.trigger("@",t,r,o))}async removeItem(t,n){n=n??{},await e.checkCanceled(n.cancel);const i=this._storage[t];void 0!==i&&(this._storage.removeItem(t),!n.silent&&this._broker.trigger("@",t,null,await s.deserialize(i,n)))}async clear(t){t=t??{},await e.checkCanceled(t.cancel),0<this._storage.length&&(this._storage.clear(),!t.silent&&this._broker.trigger("@",null,null,null))}async keys(t){return await e.checkCanceled(t?.cancel),Object.keys(this._storage)}on(t){return this._broker.on("@",t)}off(t){this._broker.off("@",t)}}const ns=new ss(localStorage);!function(){let t=CDP_DECLARE.RESULT_CODE;t[t.MVC_SYNC_DECLARE=9007199254740991]="MVC_SYNC_DECLARE",t[t.ERROR_MVC_INVALID_SYNC_PARAMS=CDP_DECLARE.DECLARE_ERROR_CODE(100,61,"invalid sync params.")]="ERROR_MVC_INVALID_SYNC_PARAMS",t[t.ERROR_MVC_INVALID_SYNC_STORAGE_ENTRY=CDP_DECLARE.DECLARE_ERROR_CODE(100,62,"invalid sync storage entires.")]="ERROR_MVC_INVALID_SYNC_STORAGE_ENTRY",void(t[t.ERROR_MVC_INVALID_SYNC_STORAGE_DATA_NOT_FOUND=CDP_DECLARE.DECLARE_ERROR_CODE(100,63,"data not found.")]="ERROR_MVC_INVALID_SYNC_STORAGE_DATA_NOT_FOUND")}();const is=new class rs{get kind(){return"null"}async sync(t,s,n){const{cancel:i}=n??{};await e.checkCanceled(i);const r=Promise.resolve("read"===t?{}:void 0);return s.trigger("@request",s,r),r}};function os(t){return e.result(t,"url")}const as={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};const ls=new class cs{get kind(){return"rest"}sync(t,n,i){const r=Object.assign({dataType:"json"},i),o=r.url??os(n);if(!o)throw e.makeResult(e.RESULT_CODE.ERROR_MVC_INVALID_SYNC_PARAMS,'A "url" property or function must be specified.');r.method=as[t],null!=r.data||"create"!==t&&"update"!==t&&"patch"!==t||(r.data=n.toJSON());const a=s.ajax(o,r);return n.trigger("@request",n,a),a}};function hs(t,s){const n=function i(t){return!!t.constructor.idAttribute}(t),r=os(t),o=t.constructor.idAttribute,a=(()=>{const s={};if(n){const n=!!e.isFunction(t.has)&&t.has(o);s[o]=n?t.id:function i(t){return`${t}:${Date.now().toString(36)}`}(r)}return s})();return{model:n,url:r,key:`${r}${n?`${s}${a[o]}`:""}`,data:a}}class us{_storage;_separator;constructor(t,e){this._storage=t,this._separator=e?.separator??"::"}getStorage(){return this._storage}setStorage(t){return this._storage=t,this}setIdSeparator(t){const e=this._separator;return this._separator=t,e}get kind(){return"storage"}async sync(t,s,n){const{model:i,key:r,url:o,data:a}=hs(s,this._separator);if(!o)throw e.makeResult(e.RESULT_CODE.ERROR_MVC_INVALID_SYNC_PARAMS,'A "url" property or function must be specified.');let l;switch(t){case"create":{const t=e.deepMerge({data:a},n);l=await this.update(r,s,o,a[Object.keys(a)[0]],t);break}case"update":case"patch":l=await this.update(r,s,o,s.id,n);break;case"delete":l=await this.destroy(r,s,o,n);break;case"read":if(l=await this.find(i,r,o,n),null==l)throw e.makeResult(e.RESULT_CODE.ERROR_MVC_INVALID_SYNC_STORAGE_DATA_NOT_FOUND,`method: ${t}`);break;default:throw e.makeResult(e.RESULT_CODE.ERROR_MVC_INVALID_SYNC_PARAMS,`unknown method: ${t}`)}return s.trigger("@request",s,Promise.resolve(l)),l}async queryEntries(t,s){const n=await this._storage.getItem(t,s);if(null==n)return{ids:!0,items:[]};if(e.isArray(n))return{ids:!n.length||e.isString(n[0]),items:n};throw e.makeResult(e.RESULT_CODE.ERROR_MVC_INVALID_SYNC_STORAGE_ENTRY,"entry is not Array type.")}saveEntries(t,e,s){return this._storage.setItem(t,e,s)}async find(t,s,n,i){if(t)return this._storage.getItem(s,i);try{const{ids:t,items:e}=await this.queryEntries(n,i);if(t){const t=[];for(const s of e){const e=await this._storage.getItem(`${n}${this._separator}${s}`,i);e&&t.push(e)}return t}return e}catch(t){const n=e.toResult(t);if(e.RESULT_CODE.ERROR_MVC_INVALID_SYNC_STORAGE_ENTRY===n.code)return this._storage.getItem(s,i);throw t}}async update(t,e,s,n,i){const{data:r}=i??{},o=Object.assign(e.toJSON(),r);if(await this._storage.setItem(t,o,i),t!==s){const{ids:t,items:e}=await this.queryEntries(s,i);t&&n&&!e.includes(n)&&(e.push(n),await this.saveEntries(s,e,i))}return this.find(!0,t,s,i)}async destroy(t,e,s,n){const i=await this._storage.getItem(t,n);if(await this._storage.removeItem(t,n),t!==s){const{ids:t,items:i}=await this.queryEntries(s,n);if(t&&e.id){const t=i.filter(t=>t!==e.id);await this.saveEntries(s,t,n)}}return i}}const ds=(t,e)=>new us(t,e),ps=ds(ns);let fs=is;function gs(t){if(null==t)return fs;{const e=fs;return fs=t,e}}!function(){let t=CDP_DECLARE.RESULT_CODE;t[t.MVC_MODEL_DECLARE=9007199254740991]="MVC_MODEL_DECLARE",void(t[t.ERROR_MVC_INVALID_DATA=CDP_DECLARE.DECLARE_ERROR_CODE(100,66,"invalid data.")]="ERROR_MVC_INVALID_DATA")}();const ms=Symbol("define"),_s=Symbol("update"),ys=Symbol("validate"),vs=Symbol("onchange"),bs=Symbol("broker"),Es=Symbol("properties"),ws=Object.freeze(e.makeResult(e.RESULT_CODE.SUCCESS,"valid attribute."));class Rs extends e.EventReceiver{static idAttribute="id";[Es];constructor(t,s){super();const n=Object.assign({},s),i=n.parse?this.parse(t,n):t,r={attrs:e.ObservableObject.from(i),baseAttrs:{...i},prevAttrs:{...i},cid:e.luid("model:",8),options:n,changeFired:!1};Object.defineProperty(this,Es,{value:r});for(const t of Object.keys(i))this[ms](this,t);this[vs]=()=>{this.trigger("@change",this);const{_prevAttrs:t,_attrs:s}=this,n=Object.keys(e.diff(t,s));for(const e of n)this.trigger(`@change:${e}`,this,s[e],t[e],e);this[Es].changeFired=!0},this[ys]({},n)}[_s](t,s){if(!e.deepEqual(this._attrs[t],s)){const{attrs:n,changeFired:i}=this[Es];i&&(this[Es].changeFired=!1,this[Es].prevAttrs={...n}),delete this[Es].changedAttrs,e.assignValue(this._prevAttrs,t,n[t]),e.assignValue(n,t,s)}}[ms](t,e){const s=t.constructor.prototype;e in s||Object.defineProperty(s,e,{get(){return this._attrs[e]},set(t){this[_s](e,t)},enumerable:!0,configurable:!0})}get id(){const t=Os(this,"id"),{cid:e,attrs:s}=this[Es];return t in s&&s[t]||e}get _attrs(){return this[Es].attrs}get _baseAttrs(){return this[Es].baseAttrs}get _prevAttrs(){return this[Es].prevAttrs}get _changedAttrs(){return this[Es].changedAttrs??=e.diff(this._baseAttrs,this._attrs),this[Es].changedAttrs}get _cid(){return this[Es].cid}get _options(){return this[Es].options}get $(){return this}get[bs](){return this._attrs.getBroker()}hasListener(t,e){return this[bs].hasListener(t,e)}channels(){return this[bs].channels().filter(t=>"@"!==t)}trigger(t,...e){this[bs].trigger(t,...e)}off(t,e){this._attrs.off(t,e)}on(t,e){return this._attrs.on("@",this[vs]),this._attrs.on(t,e)}once(t,e){const s=this.on(t,e),n=this.on(t,()=>{s.unsubscribe(),n.unsubscribe()});return s}get isValid(){return e.SUCCEEDED(this.validate({silent:!0}).code)}validate(t){const e=Object.assign({validate:!0,noThrow:!0,extend:!1},t);return this[ys]({},e)}validateAttributes(t,e){return ws}[ys](t,s){const{validate:n,silent:i,noThrow:r}=s??{};if(n){const n={...this._attrs,...t},o=this.validateAttributes(n,s);if(e.FAILED(o.code)&&(i||this.trigger("@invalid",this,n,o),!r))throw o;return o}return ws}has(t){return null!=this._attrs[t]}escape(t){return e.escapeHTML(this._attrs[t])}setAttributes(t,s){const{silent:n,extend:i}=s??{};try{n&&this._attrs.suspend(!0);const r=this[ys](t,s);if(e.FAILED(r.code))return this;for(const e of Object.keys(t))e in this._attrs?this[_s](e,t[e]):i&&(this[ms](this,e),this[_s](e,t[e]))}finally{n&&this._attrs.resume()}return this}clear(t){const e={};for(const t of Object.keys(this._baseAttrs))e[t]=void 0;return this.setAttributes(e,t)}toJSON(){return e.deepCopy({...this._attrs})}clone(){const{constructor:t,_attrs:e,_options:s}=this;return new t(e,s)}hasChanged(t){return null==t?!e.isEmptyObject(this._changedAttrs):t in this._changedAttrs}changed(t){if(t){const s=e.diff(this._attrs,t);return e.isEmptyObject(s)?void 0:s}return this.hasChanged()?{...this._changedAttrs}:void 0}previous(t){return this._prevAttrs[t]}isNew(){const t=Os(this,"id");return!this.has(t)}parse(t,e){return t}sync(t,e,s){return gs().sync(t,e,s)}async fetch(t){const e=Object.assign({parse:!0},t,{syncMethod:"read"});try{const t=await this.sync("read",this,e);return this.setAttributes(e.parse?this.parse(t,e):t,e),this.trigger("@sync",this,t,e),t}catch(t){throw this.trigger("@error",this,t,e),t}}async save(...t){const{attrs:s,options:n}=function i(...t){let s,[n,i,r]=t;return null==n||e.isObject(n)?(s=n,r=i):e.assignValue(s={},n,i),r?.data&&(s=Object.assign(s??{},r.data)),{attrs:s,options:r}}(...t),r=Object.assign({validate:!0,parse:!0,wait:!0,extend:!0},n);try{const{wait:t}=r,n=r.syncMethod=this.isNew()?"create":r.patch?"patch":"update";s&&(t?this[ys](s,r):(this.setAttributes(s,r),this[Es].baseAttrs={...this._attrs}),r.data="patch"===n?s:Object.assign(this.toJSON(),s));const i=await this.sync(n,this,r);let o=r.parse?this.parse(i,r):i;return s&&t&&(o=Object.assign({},s,o)),e.isObject(o)&&!e.isEmptyObject(o)&&(this.setAttributes(o,r),this[Es].baseAttrs={...this._attrs}),this.trigger("@sync",this,i,r),i}catch(t){throw this.trigger("@error",this,t,r),t}}async destroy(t){const s=Object.assign({wait:!0},t,{syncMethod:"delete"});try{const{wait:t,cancel:n}=s,i=!this.isNew(),r=()=>{this.stopListening(),this.trigger("@destroy",this,s)};let o;return!t&&r(),i?o=await this.sync("delete",this,s):await e.checkCanceled(n),t&&r(),i&&this.trigger("@sync",this,o,s),o}catch(t){throw this.trigger("@error",this,t,s),t}}}function xs(t){return t instanceof Rs}function Os(t,s=""){return e.isObject(t)?t.constructor.idAttribute??s:s}e.setMixClassAttribute(Rs,"instanceOf",null),function(){let t=CDP_DECLARE.RESULT_CODE;t[t.MVC_COLLECTION_DECLARE=9007199254740991]="MVC_COLLECTION_DECLARE",t[t.ERROR_MVC_INVALID_ACCESS=CDP_DECLARE.DECLARE_ERROR_CODE(100,71,"invalid access.")]="ERROR_MVC_INVALID_ACCESS",t[t.ERROR_MVC_INVALID_COMPARATORS=CDP_DECLARE.DECLARE_ERROR_CODE(100,72,"invalid comparators.")]="ERROR_MVC_INVALID_COMPARATORS",void(t[t.ERROR_MVC_EDIT_PERMISSION_DENIED=CDP_DECLARE.DECLARE_ERROR_CODE(100,73,"editing permission denied.")]="ERROR_MVC_EDIT_PERMISSION_DENIED")}();let Cs=()=>new Intl.Collator(Ze(),{sensitivity:"base",numeric:!0});function Ss(t,e){return(s,n)=>{const i=null!=s[t]?s[t]:"",r=null!=n[t]?n[t]:"";return e*Cs().compare(i,r)}}function ks(t,e){return(s,n)=>{const i=s[t],r=n[t];if(i===r)return 0;if(null==i)return-1*e;if(null==r)return 1*e;{const t=Object(i).valueOf(),s=Object(r).valueOf();return t===s?0:t<s?-1*e:1*e}}}function $s(t,e){return(s,n)=>s[t]===n[t]?0:null==s[t]?-1*e:null==n[t]?1*e:s[t]<n[t]?-1*e:1*e}const Ts=$s,Ls=$s;function Ps(t){const{name:e,type:s,order:n}=t;switch(s){case"string":return Ss(e,n);case"boolean":return Ts(e,n);case"number":return Ls(e,n);case"date":return ks(e,n);default:return $s(e,n)}}function As(t){const e=[];for(const s of t)e.push(Ps(s));return e}const{trunc:Ns}=Math;function Ds(t,e){return new Promise(s=>{const n=i=>{t.off(n),e&&(e.length=0,e.push(...t)),s(i)};t.on(n)})}async function Is(t,s){if(t instanceof e.ObservableArray)return await e.checkCanceled(s),{editor:t,promise:Ds(t)};if(Array.isArray(t)){const n=e.ObservableArray.from(t);return await e.checkCanceled(s),{editor:n,promise:Ds(n,t)}}throw e.makeResult(e.RESULT_CODE.NOT_SUPPORTED,"target is not Array or ObservableArray.")}function Vs(t,s){if(null==s||s.length<=0)return!1;for(const n of s)if(n<0||t<=n||Ns(n)!==n)throw e.makeResult(e.RESULT_CODE.NOT_SUPPORTED,`orders[] index is invalid. index: ${n}`);return!0}async function Ms(t,e){if(t.length<=0)return[];const{editor:s,promise:n}=await Is(t,e);return s.splice(0,t.length),n}async function js(t,e,s){if(null==e||e.length<=0)return[];const{editor:n,promise:i}=await Is(t,s);return n.push(...e),i}async function Us(t,s,n,i){if(s<0||t.length<s||Ns(s)!==s)throw e.makeResult(e.RESULT_CODE.NOT_SUPPORTED,`insertArray(), index is invalid. index: ${s}`);if(null==n||n.length<=0)return[];const{editor:r,promise:o}=await Is(t,i);return r.splice(s,0,...n),o}async function Fs(t,s,n,i){if(s<0||t.length<s||Ns(s)!==s)throw e.makeResult(e.RESULT_CODE.NOT_SUPPORTED,`reorderArray(), index is invalid. index: ${s}`);if(!Vs(t.length,n))return[];const{editor:r,promise:o}=await Is(t,i);let a=Array.from(r);{const t=[];for(const s of e.unique(n))t.push(r[s]),a[s]=null;a.splice(s,0,...t),a=a.filter(t=>null!=t)}for(const t of a.keys())r[t]=a[t];return o}async function Hs(t,s,n){if(!Vs(t.length,s))return[];const{editor:i,promise:r}=await Is(t,n);s.sort((t,e)=>t<e?1:-1);for(const t of e.unique(s))i.splice(t,1);return r}function Bs(t,e){return s=>s[t]===e}function zs(t,e){return s=>s[t]!==e}function Ks(t,e){return s=>s[t]>e}function Ws(t,e){return s=>s[t]<e}function qs(t,e){return s=>s[t]>=e}function Gs(t,e){return s=>s[t]<=e}function Ys(t,e){return s=>String(s[t]).toLocaleLowerCase().includes(e.toLocaleLowerCase())}function Js(t,e){return s=>!String(s[t]).toLocaleLowerCase().includes(e.toLocaleLowerCase())}function Qs(t,s,n){return i=>{const r=e.computeDate(new Date,-1*s,n);return r<=i[t]}}function Xs(t,s,n){return i=>{const r=e.computeDate(new Date,-1*s,n);return!(r<=i[t])}}function Zs(t,e,s){return tn(0,qs(t,e),Gs(t,s))}function tn(t,e,s){return s?n=>{switch(t){case 0:return e(n)&&s(n);case 1:return e(n)||s(n);default:return void 0,e(n)&&s(n)}}:e}class en{_operators;_combination;_sumKeys;_limit;_random;_sortKeys;constructor(t={operators:[]}){const{operators:e,combination:s,sumKeys:n,limit:i,random:r,sortKeys:o}=t;this._operators=e,this._combination=s??0,this._sumKeys=n??[],this._limit=i,this._random=!!r,this._sortKeys=o??[]}get operators(){return this._operators}set operators(t){this._operators=t}get sumKeys(){return this._sumKeys}set sumKeys(t){this._sumKeys=t}get combination(){return this._combination}set combination(t){this._combination=t}get limit(){return this._limit}set limit(t){this._limit=t}get random(){return this._random}set random(t){this._random=t}get sortKeys(){return this._sortKeys}set sortKeys(t){this._sortKeys=t}get comparators(){return As(this._sortKeys)}get filter(){let t;for(const e of this._operators){const{operator:s,prop:n,value:i}=e;switch(s){case 0:t=tn(this._combination,Bs(n,i),t);break;case 1:t=tn(this._combination,zs(n,i),t);break;case 2:t=tn(this._combination,Ks(n,i),t);break;case 3:t=tn(this._combination,Ws(n,i),t);break;case 4:t=tn(this._combination,qs(n,i),t);break;case 5:t=tn(this._combination,Gs(n,i),t);break;case 6:t=tn(this._combination,Ys(n,i),t);break;case 7:t=tn(this._combination,Js(n,i),t);break;case 8:t=tn(this._combination,Qs(n,i,e.unit),t);break;case 9:t=tn(this._combination,Xs(n,i,e.unit),t);break;case 10:t=tn(this._combination,Zs(n,i,e.range),t)}}return t??(()=>!0)}}const{trunc:sn}=Math;function nn(t,s,...n){let i=e.isFunction(s)?t.filter(s):t.slice();for(const t of n)e.isFunction(t)&&(i=e.sort(i,t));return i}const rn={0:null,1:{coeff:1},2:{coeff:1e3},3:{coeff:6e4},4:{coeff:36e5},5:{coeff:864e5},6:{coeff:1024},7:{coeff:1048576},8:{coeff:1073741824},9:{coeff:1099511627776}};function on(t,s){const{random:n,limit:i,sumKeys:r}=s;if(n&&e.shuffle(t,!0),i){const{unit:e,value:s,prop:n}=i,r=[],o=rn[e],a=s,l=!!i.excess;let c=0;for(const e of t){if(o){if(null==e[n]){void 0;continue}c+=Number(e[n])/o.coeff}else c++;if(a<c){l&&r.push(e);break}r.push(e)}t=r}const o={total:t.length,items:t};if(0<r.length)for(const e of t)for(const t of r)t in o||(o[t]=0),o[t]+=Number(e[t]);return o}async function an(t,s){const{filter:n,comparators:i,index:r,limit:o,cancel:a,progress:l,auto:c,noSearch:h}=s;if(!t.length)return{total:0,items:[],options:s};const u=h?t.slice():nn(t,n,...i),d=[];let p=r??0;for(;;){if(await e.checkCanceled(a),p<0||u.length<=p||sn(p)!==p)throw e.makeResult(e.RESULT_CODE.ERROR_MVC_INVALID_ACCESS,`invalid index: ${p}`);if(null!=o&&(o<=0||sn(o)!==o))throw e.makeResult(e.RESULT_CODE.ERROR_MVC_INVALID_ACCESS,`invalid limit: ${o}`);const t=Object.assign(s,{index:p}),n=u.slice(p,null!=o?p+o:void 0);d.push(...n);const i={total:u.length,items:n,options:{...t}};if(e.isFunction(l)&&l({...i}),c&&null!=o){if(!(u.length<=p+o)){p+=n.length;continue}i.items=d}return i}}function ln(t,e,s){const{noCache:n,noSearch:i}=s,r=!n&&!i&&e.total&&e.total===e.items.length;r&&(t.cache={...e},delete t.cache.options)}async function cn(t,s,n){const i=function r(t){const e=Object.assign({sortKeys:[]},t),{noSearch:s,sortKeys:n}=e;return s||e.comparators&&!(e.comparators.length<=0)||(e.comparators=As(n)),e}(n),{sortKeys:o,comparators:a,filter:l}=i;return Object.assign(t,{sortKeys:o,comparators:a,filter:l}),t.cache?(await an(t.cache.items,i)).items:(await async function c(t,s,n){const{index:i,limit:r,cancel:o,progress:a,auto:l}=n,c=[],h=t=>{const e=!!t.options?.condition;return e||t.total===t.items.length};let u=i??0;for(;;){if(await e.checkCanceled(o),u<0||sn(u)!==u)throw e.makeResult(e.RESULT_CODE.ERROR_MVC_INVALID_ACCESS,`invalid index: ${u}`);if(null!=r&&(r<=0||sn(r)!==r))throw e.makeResult(e.RESULT_CODE.ERROR_MVC_INVALID_ACCESS,`invalid limit: ${r}`);const i=Object.assign(n,{index:u});let d=await s(i);const p=Object.assign({},i,d.options);if(h(d)){ln(t,d,p);const{noSearch:e,condition:s}=p;if(s){const e=new en(s);d=on(nn(d.items,e.filter,...e.comparators),e),t.cache&&(Object.assign(t.cache,d),delete t.cache.options)}return an(d.items,Object.assign(i,{noSearch:e}))}{c.push(...d.items);const s={total:d.total,items:d.items,options:p};if(e.isFunction(a)&&a({...s}),l&&null!=r){if(!(d.total<=u+r)){u+=d.items.length;continue}s.items=c}return ln(t,s,p),s}}}(t,s,i)).items}const hn=Symbol("properties"),un=Symbol("create-iterable-iterator"),dn=Symbol("prepare-model"),pn=Symbol("remove-models"),fn=Symbol("add-reference"),gn=Symbol("remove-reference"),mn=Symbol("model-event-handler"),_n=t=>{const{sortKeys:e,comparators:s}=t;return{sortKeys:e??[],comparators:s??As(e??[])}},yn=t=>t?.idAttribute??"id",vn=(t,e)=>t[yn(e)],bn=t=>t.constructor.model,En=(t,s)=>{const n=bn(s);return!!e.isFunction(n)&&t instanceof n},wn=(t,e,s)=>{s=Math.min(Math.max(s,0),t.length),t.splice(s,0,...e)};const Rn={add:!0,remove:!0,merge:!0},xn={add:!0,remove:!1};class On extends e.EventSource{static model;[hn];constructor(t,s){super();const n=Object.assign({modelOptions:{},queryOptions:{}},s),{modelOptions:i,queryOptions:r}=n;this[hn]={constructOptions:n,provider:n.provider??this.sync.bind(this),cid:e.luid("collection:",8),queryOptions:r,queryInfo:{},modelOptions:i,byId:new Map,store:[]},this.initQueryInfo(),this[mn]=(t,s,n,i)=>{if(e.isString(t)&&t.startsWith("@")&&s){if(("@add"===t||"@remove"===t)&&n!==this)return;if("@destroy"===t&&(i=n,n=this,this.remove(s,i)),t.startsWith("@change")&&(i={},n=this,"@change"===t)){const t=((t,s)=>{const n=t,i=yn(s),r=n[i];if(e.isString(r))return{id:n[i],prevId:e.isFunction(n.previous)?n.previous(i):void 0}})(s,bn(this));if(t){const{id:e,prevId:n}=t;if(n!==e){const{byId:t}=this[hn];t.set(e,s),null!=n&&t.delete(n)}}}this.trigger.call(this,t,s,n,i)}},t&&this.reset(t,Object.assign({silent:!0},n))}initQueryInfo(){const{sortKeys:t,comparators:e}=_n(this._defaultQueryOptions);this._queryInfo={sortKeys:t,comparators:e}}release(t){return this[hn].afterFilter=void 0,this[hn].store=[],this.initQueryInfo(),this.stopListening()}clearCache(){delete this._queryInfo.cache}get id(){return this[hn].cid}get models(){const{_queryFilter:t,_afterFilter:e}=this,{store:s}=this[hn];return e&&e!==t?s.filter(e):s}get length(){return this.models.length}get filtered(){return!!this[hn].afterFilter}get _queryInfo(){return this[hn].queryInfo}set _queryInfo(t){this[hn].queryInfo=t}get _options(){return this[hn].constructOptions}get _provider(){return this[hn].provider}get _defaultParse(){return this._options.parse}get _defaultQueryOptions(){return this[hn].queryOptions}get _lastQueryOptions(){const{sortKeys:t,comparators:e,filter:s}=this[hn].queryInfo,n={};return t.length&&(n.sortKeys=t),e.length&&(n.comparators=e),s&&(n.filter=s),n}get _comparators(){return this[hn].queryInfo.comparators}get _queryFilter(){return this[hn].queryInfo.filter}get _afterFilter(){return this[hn].afterFilter}get(t){if(null==t)return;const{byId:s}=this[hn];if(e.isString(t)&&s.has(t))return s.get(t);const n=vn(xs(t)?t.toJSON():t,bn(this)),i=t._cid;return s.get(n)??(i&&s.get(i))}has(t){return null!=this.get(t)}toJSON(){return this.models.map(t=>xs(t)?t.toJSON():t)}clone(){const{constructor:t,_options:e}=this;return new t(this[hn].store,e)}sort(t){const s=t??{},{noThrow:n,silent:i}=s,{sortKeys:r,comparators:o}=_n(s),a=0<o.length?o:this._comparators;if(a.length<=0){if(n)return this;throw e.makeResult(e.RESULT_CODE.ERROR_MVC_INVALID_COMPARATORS,"Cannot sort a set without a comparator.")}return this[hn].store=nn(this[hn].store,this._afterFilter,...a),this[hn].queryInfo.comparators=a,0<r.length&&(this[hn].queryInfo.sortKeys=r),i||this.trigger("@sort",this,s),this}filter(...t){const s=function n(...t){const[s,n]=t;return null==s?{}:e.isFunction(s)?Object.assign({},n,{filter:s}):s}(...t),{filter:i,silent:r}=s;return i!==this[hn].afterFilter&&(this[hn].afterFilter=i,r||this.trigger("@filter",this,s)),this}at(t){return e.at(this.models,t)}first(t){const e=this.models;return null==t?e[0]:e.slice(0,t)}last(t){const e=this.models;return null==t?e[e.length-1]:e.slice(-1*t)}parse(t,e){return t}async sync(t){const e=await gs().sync("read",this,t);return{total:e.length,items:e,options:t}}async fetch(t){const s=Object.assign({progress:e.noop,parse:this._defaultParse},this._defaultQueryOptions,t);try{const{progress:t,limit:e,reset:n,noCache:i}=s,{_queryInfo:r,_provider:o}=this,a=null==e;s.progress=e=>{t(e),!a&&this.add(e.items,s)},i&&this.clearCache(),!a&&n&&this.reset(void 0,{silent:!0});const l=await cn(r,o,s);return a&&(n?this.reset(l,s):this.add(l,s)),this.trigger("@sync",this,l,s),l}catch(t){throw this.trigger("@error",void 0,this,t,s),t}}requery(t){const e=Object.assign({},this._lastQueryOptions,t,{reset:!0});return this.fetch(e)}set(t,s){if(e.isNullish(t))return;const n=Object.assign({parse:this._defaultParse},Rn,s);n.parse&&!En(t,this)&&(t=this.parse(t,s)??[]);const i=!e.isArray(t),r=i?[t]:t.slice(),{store:o}=this[hn],a=(t=>{if(null!=t)return t>o.length?o.length:t<0?(t+=o.length,t<0?0:t):t})(n.at),l=[],c=[],h=[],u=[],d=new Set,{add:p,merge:f,remove:g,parse:m,silent:_}=n;let y=!1;const v=this._comparators.length&&null==a&&!1!==n.sort;for(const[t,s]of r.entries()){const i=this.get(s);if(i){if(f&&s!==i){let t=xs(s)?s.toJSON():s;m&&e.isFunction(i.parse)&&(t=i.parse(t,n)),e.isFunction(i.setAttributes)?i.setAttributes(t,n):Object.assign(i,t),h.push(i),v&&!y&&(y=!e.isFunction(i.hasChanged)||i.hasChanged())}d.has(i)||(d.add(i),l.push(i)),r[t]=i}else if(p){const e=r[t]=this[dn](s,n);e&&(c.push(e),this[fn](e),d.add(e),l.push(e))}}if(g){for(const t of o)d.has(t)||u.push(t);u.length&&this[pn](u,n)}let b=!1;const E=!v&&p&&g;if(l.length&&E?(b=o.length!==l.length||o.some((t,e)=>t!==l[e]),o.length=0,wn(o,l,0)):c.length&&(v&&(y=!0),wn(o,c,a??o.length)),y&&this.sort({silent:!0}),!_){for(const[t,s]of c.entries())null!=a&&(n.index=a+t),xs(s)||s instanceof e.EventBroker?s.trigger("@add",s,this,n):this.trigger("@add",s,this,n);(y||b)&&this.trigger("@sort",this,n),(c.length||u.length||h.length)&&(n.changes={added:c,removed:u,merged:h},this.trigger("@update",this,n))}const w=r.filter(t=>null!=t);return i?w[0]:w.length?w:void 0}reset(t,e){const s=Object.assign({},e),{store:n}=this[hn];for(const t of n)this[gn](t);s.previous=n.slice(),(t=>{t.byId.clear(),t.store.length=0})(this[hn]);const i=t?this.add(t,Object.assign({silent:!0},s)):[];return s.silent||this.trigger("@reset",this,s),i}add(t,e){return this.set(t,Object.assign({merge:!1},e,xn))}remove(t,s){const n=Object.assign({},s),i=!e.isArray(t),r=i?[t]:t.slice(),o=this[pn](r,n);return!n.silent&&o.length&&(n.changes={added:[],merged:[],removed:o},this.trigger("@update",this,n)),i?o[0]:o}push(t,e){const{store:s}=this[hn];return this.add(t,Object.assign({at:s.length},e))}pop(t){const{store:e}=this[hn];return this.remove(e[e.length-1],t)}unshift(t,e){return this.add(t,Object.assign({at:0},e))}shift(t){const{store:e}=this[hn];return this.remove(e[0],t)}create(t,e){const{wait:s}=e??{},n=this[dn](t,e);if(!n)return;const i=xs(n)?n:void 0;return s&&i||this.add(n,e),i&&(async()=>{try{await i.save(void 0,e),s&&this.add(n,e)}catch(t){this.trigger("@error",i,this,t,e)}})(),n}[dn](t,s){if(En(t,this))return t;const n=bn(this),{modelOptions:i}=this[hn];if(n){const r=Object.assign({},i,s),o=new n(t,r);if(e.isFunction(o.validate)){const s=o.validate();if(e.FAILED(s.code))return this.trigger("@invalid",t,this,s,r),void 0}return o}return t}[pn](t,s){const n=Object.assign({},s),i=[];for(const s of t){const t=this.get(s);if(!t)continue;const{store:r}=this[hn],o=r.indexOf(t);r.splice(o,1),this[gn](t,!0),n.silent||(n.index=o,xs(t)||t instanceof e.EventBroker?t.trigger("@remove",t,this,n):this.trigger("@remove",t,this,n)),i.push(t),this[gn](t,!1)}return i}[fn](t){const{byId:s}=this[hn],{_cid:n,id:i}=t;null!=n&&s.set(n,t),null!=i&&s.set(i,t),(xs(t)||t instanceof e.EventPublisher)&&this.listenTo(t,"*",this[mn])}[gn](t,s=!1){const{byId:n}=this[hn],{_cid:i,id:r}=t;null!=i&&n.delete(i),null!=r&&n.delete(r),!s&&(xs(t)||t instanceof e.EventPublisher)&&this.stopListening(t,"*",this[mn])}[Symbol.iterator](){const t={base:this.models,pointer:0,next(){return this.pointer<this.base.length?{done:!1,value:this.base[this.pointer++]}:{done:!0,value:void 0}}};return t}entries(){return this[un]((t,e)=>[t,e])}keys(){return this[un](t=>t)}values(){return this[un]((t,e)=>e)}[un](t){const e={base:this.models,pointer:0},s=t=>vn(e.base[t],bn(this))||String(t),n={next(){const n=e.pointer;return n<e.base.length?(e.pointer++,{done:!1,value:t(s(n),e.base[n])}):{done:!0,value:void 0}},[Symbol.iterator](){return this}};return n}}async function Cn(t,s,n){const i=function r(t){if(t.filtered)throw e.makeResult(e.RESULT_CODE.ERROR_MVC_EDIT_PERMISSION_DENIED,"collection is applied after-filter.");return t.models.slice()}(t),o=await n(i,s?.cancel);return t.set(i,s),o}function Sn(t){return t.reduce((t,e)=>Math.min(t,e))}function kn(t,e,s,n,i){const r=!!e.length;return{type:t,list:e,range:r?{from:s,to:n}:void 0,insertedTo:r?i:void 0}}e.setMixClassAttribute(On,"instanceOf",null);const $n=e.safe(globalThis.document),Tn=Symbol("init-internal"),Ln=Symbol("properties"),Pn=Symbol("ensure-element");class An{[Ln];constructor(t){!1!==t&&this[Tn](t)}release(){return this.undelegateEvents(),this}remove(){return this.release(),this.$el.remove(),this}get id(){const{cid:t,id:e}=this[Ln];return e??t}get el(){return this[Ln].$el[0]}get $el(){return this[Ln].$el}get _cid(){return this[Ln].cid}get _tagName(){return this[Ln].tagName}get _attrs(){const{attributes:t,id:s,className:n}=this[Ln];return Object.assign(e.drop({id:s,class:n}),t)}setElement(t){return this.undelegateEvents(),this[Ln].$el=k(t),this.delegateEvents(),this}delegateEvents(t){const s=t??this.events();if(e.isEmptyObject(s))return this;this.undelegateEvents();for(const t of Object.keys(s)){let n=s[t];if(e.isFunction(n)||(n=this[n]),!n)continue;const i=/^(\S+)\s*(.*)$/.exec(t);this.delegate(i[1],i[2],n.bind(this))}return this}undelegateEvents(){return this.$el?.off(`.${this._cid}`),this}delegate(t,...e){return this.$el.on(`${t}.${this._cid}`,...e),this}undelegate(t,...e){return this.$el.off(`${t}.${this._cid}`,...e),this}$(t){return this.$el.find(t)}events(){return Object.assign({},this[Ln].events)}[Tn](t){const{el:s,tagName:n,id:i,attributes:r,className:o,events:a}=t??{};this[Ln]={cid:e.luid("view:",8),events:a,id:i,className:o,attributes:r,tagName:n??"div"},this[Pn](s)}[Pn](t){if(t)this.setElement(t);else{const{_attrs:t,_tagName:e}=this;this.setElement($n.createElement(e)),this.$el.attr(t)}}}class Nn extends(e.mixins(e.EventSource,An)){constructor(t){super(),this.super(An,!1),this[Tn](t)}release(){return super.release(),this.stopListening(),this.off(),this}}const Dn=Nn,In=globalThis,Vn=t=>t,Mn=In.trustedTypes,jn=Mn?Mn.createPolicy("lit-html",{createHTML:t=>t}):void 0,Un="$lit$",Fn=`lit$${Math.random().toFixed(9).slice(2)}$`,Hn="?"+Fn,Bn=`<${Hn}>`,zn=document,Kn=()=>zn.createComment(""),Wn=t=>null===t||"object"!=typeof t&&"function"!=typeof t,qn=Array.isArray,Gn=t=>qn(t)||"function"==typeof t?.[Symbol.iterator],Yn="[ \t\n\f\r]",Jn=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,Qn=/-->/g,Xn=/>/g,Zn=new RegExp(`>|${Yn}(?:([^\\s"'>=/]+)(${Yn}*=${Yn}*(?:[^ \t\n\f\r"'\`<>=]|("|')|))|$)`,"g"),ti=/'/g,ei=/"/g,si=/^(?:script|style|textarea|title)$/i,ni=t=>(e,...s)=>({_$litType$:t,strings:e,values:s}),ii=ni(1),ri=ni(2),oi=Symbol.for("lit-noChange"),ai=Symbol.for("lit-nothing"),li=new WeakMap,ci=zn.createTreeWalker(zn,129);function hi(t,e){if(!qn(t)||!t.hasOwnProperty("raw")){let t="invalid template strings array";throw new Error(t)}return void 0!==jn?jn.createHTML(e):e}const ui=(t,e)=>{const s=t.length-1,n=[];let i,r=2===e?"<svg>":3===e?"<math>":"",o=Jn;for(let e=0;e<s;e++){const s=t[e];let a,l,c=-1,h=0;for(;h<s.length&&(o.lastIndex=h,l=o.exec(s),null!==l);)h=o.lastIndex,o===Jn?"!--"===l[1]?o=Qn:void 0!==l[1]?o=Xn:void 0!==l[2]?(si.test(l[2])&&(i=new RegExp(`</${l[2]}`,"g")),o=Zn):void 0!==l[3]&&(o=Zn):o===Zn?">"===l[0]?(o=i??Jn,c=-1):void 0===l[1]?c=-2:(c=o.lastIndex-l[2].length,a=l[1],o=void 0===l[3]?Zn:'"'===l[3]?ei:ti):o===ei||o===ti?o=Zn:o===Qn||o===Xn?o=Jn:(o=Zn,i=void 0);const u=o===Zn&&t[e+1].startsWith("/>")?" ":"";r+=o===Jn?s+Bn:c>=0?(n.push(a),s.slice(0,c)+Un+s.slice(c)+Fn+u):s+Fn+(-2===c?e:u)}const a=r+(t[s]||"<?>")+(2===e?"</svg>":3===e?"</math>":"");return[hi(t,a),n]};class di{constructor({strings:t,_$litType$:e},s){let n;this.parts=[];let i=0,r=0;const o=t.length-1,a=this.parts,[l,c]=ui(t,e);if(this.el=di.createElement(l,s),ci.currentNode=this.el.content,2===e||3===e){const t=this.el.content.firstChild;t.replaceWith(...t.childNodes)}for(;null!==(n=ci.nextNode())&&a.length<o;){if(1===n.nodeType){if(n.hasAttributes())for(const t of n.getAttributeNames())if(t.endsWith(Un)){const e=c[r++],s=n.getAttribute(t),o=s.split(Fn),l=/([.?@])?(.*)/.exec(e);a.push({type:1,index:i,name:l[2],strings:o,ctor:"."===l[1]?_i:"?"===l[1]?yi:"@"===l[1]?vi:mi}),n.removeAttribute(t)}else t.startsWith(Fn)&&(a.push({type:6,index:i}),n.removeAttribute(t));if(si.test(n.tagName)){const t=n.textContent.split(Fn),e=t.length-1;if(e>0){n.textContent=Mn?Mn.emptyScript:"";for(let s=0;s<e;s++)n.append(t[s],Kn()),ci.nextNode(),a.push({type:2,index:++i});n.append(t[e],Kn())}}}else if(8===n.nodeType){const t=n.data;if(t===Hn)a.push({type:2,index:i});else{let t=-1;for(;-1!==(t=n.data.indexOf(Fn,t+1));)a.push({type:7,index:i}),t+=Fn.length-1}}i++}}static createElement(t,e){const s=zn.createElement("template");return s.innerHTML=t,s}}function pi(t,e,s=t,n){if(e===oi)return e;let i=void 0!==n?s.__directives?.[n]:s.__directive;const r=Wn(e)?void 0:e._$litDirective$;return i?.constructor!==r&&(i?._$notifyDirectiveConnectionChanged?.(!1),void 0===r?i=void 0:(i=new r(t),i._$initialize(t,s,n)),void 0!==n?(s.__directives??=[])[n]=i:s.__directive=i),void 0!==i&&(e=pi(t,i._$resolve(t,e.values),i,n)),e}class fi{constructor(t,e){this._$parts=[],this._$disconnectableChildren=void 0,this._$template=t,this._$parent=e}get parentNode(){return this._$parent.parentNode}get _$isConnected(){return this._$parent._$isConnected}_clone(t){const{el:{content:e},parts:s}=this._$template,n=(t?.creationScope??zn).importNode(e,!0);ci.currentNode=n;let i=ci.nextNode(),r=0,o=0,a=s[0];for(;void 0!==a;){if(r===a.index){let e;2===a.type?e=new gi(i,i.nextSibling,this,t):1===a.type?e=new a.ctor(i,a.name,a.strings,this,t):6===a.type&&(e=new bi(i,this,t)),this._$parts.push(e),a=s[++o]}r!==a?.index&&(i=ci.nextNode(),r++)}return ci.currentNode=zn,n}_update(t){let e=0;for(const s of this._$parts)void 0!==s&&(void 0!==s.strings?(s._$setValue(t,s,e),e+=s.strings.length-2):s._$setValue(t[e])),e++}}let gi=class t{get _$isConnected(){return this._$parent?._$isConnected??this.__isConnected}constructor(t,e,s,n){this.type=2,this._$committedValue=ai,this._$disconnectableChildren=void 0,this._$startNode=t,this._$endNode=e,this._$parent=s,this.options=n,this.__isConnected=n?.isConnected??!0}get parentNode(){let t=this._$startNode.parentNode;const e=this._$parent;return void 0!==e&&11===t?.nodeType&&(t=e.parentNode),t}get startNode(){return this._$startNode}get endNode(){return this._$endNode}_$setValue(t,e=this){t=pi(this,t,e),Wn(t)?t===ai||null==t||""===t?(this._$committedValue!==ai&&this._$clear(),this._$committedValue=ai):t!==this._$committedValue&&t!==oi&&this._commitText(t):void 0!==t._$litType$?this._commitTemplateResult(t):void 0!==t.nodeType?this._commitNode(t):Gn(t)?this._commitIterable(t):this._commitText(t)}_insert(t){return this._$startNode.parentNode.insertBefore(t,this._$endNode)}_commitNode(t){this._$committedValue!==t&&(this._$clear(),this._$committedValue=this._insert(t))}_commitText(t){if(this._$committedValue!==ai&&Wn(this._$committedValue)){const e=this._$startNode.nextSibling;e.data=t}else this._commitNode(zn.createTextNode(t));this._$committedValue=t}_commitTemplateResult(t){const{values:e,_$litType$:s}=t,n="number"==typeof s?this._$getTemplate(t):(void 0===s.el&&(s.el=di.createElement(hi(s.h,s.h[0]),this.options)),s);if(this._$committedValue?._$template===n)this._$committedValue._update(e);else{const t=new fi(n,this),s=t._clone(this.options);t._update(e),this._commitNode(s),this._$committedValue=t}}_$getTemplate(t){let e=li.get(t.strings);return void 0===e&&li.set(t.strings,e=new di(t)),e}_commitIterable(e){qn(this._$committedValue)||(this._$committedValue=[],this._$clear());const s=this._$committedValue;let n,i=0;for(const r of e)i===s.length?s.push(n=new t(this._insert(Kn()),this._insert(Kn()),this,this.options)):n=s[i],n._$setValue(r),i++;i<s.length&&(this._$clear(n&&n._$endNode.nextSibling,i),s.length=i)}_$clear(t=this._$startNode.nextSibling,e){for(this._$notifyConnectionChanged?.(!1,!0,e);t!==this._$endNode;){const e=Vn(t).nextSibling;Vn(t).remove(),t=e}}setConnected(t){void 0===this._$parent&&(this.__isConnected=t,this._$notifyConnectionChanged?.(t))}},mi=class t{get tagName(){return this.element.tagName}get _$isConnected(){return this._$parent._$isConnected}constructor(t,e,s,n,i){this.type=1,this._$committedValue=ai,this._$disconnectableChildren=void 0,this.element=t,this.name=e,this._$parent=n,this.options=i,s.length>2||""!==s[0]||""!==s[1]?(this._$committedValue=new Array(s.length-1).fill(new String),this.strings=s):this._$committedValue=ai}_$setValue(t,e=this,s,n){const i=this.strings;let r=!1;if(void 0===i)t=pi(this,t,e,0),r=!Wn(t)||t!==this._$committedValue&&t!==oi,r&&(this._$committedValue=t);else{const n=t;let o,a;for(t=i[0],o=0;o<i.length-1;o++)a=pi(this,n[s+o],e,o),a===oi&&(a=this._$committedValue[o]),r||=!Wn(a)||a!==this._$committedValue[o],a===ai?t=ai:t!==ai&&(t+=(a??"")+i[o+1]),this._$committedValue[o]=a}r&&!n&&this._commitValue(t)}_commitValue(t){t===ai?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,t??"")}},_i=class t extends mi{constructor(){super(...arguments),this.type=3}_commitValue(t){this.element[this.name]=t===ai?void 0:t}},yi=class t extends mi{constructor(){super(...arguments),this.type=4}_commitValue(t){this.element.toggleAttribute(this.name,!!t&&t!==ai)}},vi=class t extends mi{constructor(t,e,s,n,i){super(t,e,s,n,i),this.type=5}_$setValue(t,e=this){if(t=pi(this,t,e,0)??ai,t===oi)return;const s=this._$committedValue,n=t===ai&&s!==ai||t.capture!==s.capture||t.once!==s.once||t.passive!==s.passive,i=t!==ai&&(s===ai||n);n&&this.element.removeEventListener(this.name,this,s),i&&this.element.addEventListener(this.name,this,t),this._$committedValue=t}handleEvent(t){"function"==typeof this._$committedValue?this._$committedValue.call(this.options?.host??this.element,t):this._$committedValue.handleEvent(t)}};class bi{constructor(t,e,s){this.element=t,this.type=6,this._$disconnectableChildren=void 0,this._$parent=e,this.options=s}get _$isConnected(){return this._$parent._$isConnected}_$setValue(t){pi(this,t)}}const Ei={_boundAttributeSuffix:Un,_marker:Fn,_markerMatch:Hn,_HTML_RESULT:1,_getTemplateHtml:ui,_TemplateInstance:fi,_isIterable:Gn,_resolveDirective:pi,_ChildPart:gi,_AttributePart:mi,_BooleanAttributePart:yi,_EventPart:vi,_PropertyPart:_i,_ElementPart:bi},wi=In.litHtmlPolyfillSupport;wi?.(di,gi),(In.litHtmlVersions??=[]).push("3.3.1");const Ri=(t,e,s)=>{const n=s?.renderBefore??e;let i=n._$litPart$;if(void 0===i){const t=s?.renderBefore??null;n._$litPart$=i=new gi(e.insertBefore(Kn(),t),t,void 0,s??{})}return i._$setValue(t),i};let xi=null;const Oi={boundAttributeSuffix:Ei._boundAttributeSuffix,marker:Ei._marker,markerMatch:Ei._markerMatch,HTML_RESULT:Ei._HTML_RESULT,getTemplateHtml:Ei._getTemplateHtml,overrideDirectiveResolve:(t,e)=>class extends t{_$resolve(t,s){return e(this,s)}},patchDirectiveResolve:(t,e)=>{if(t.prototype._$resolve.name!==e.name){xi??=t.prototype._$resolve.name;for(let s=t.prototype;s!==Object.prototype;s=Object.getPrototypeOf(s))if(s.hasOwnProperty(xi))return s[xi]=e,void 0;throw new Error("Internal error: It is possible that both dev mode and production mode Lit was mixed together during SSR. Please comment on the issue: https://github.com/lit/lit/issues/4527")}},setDirectiveClass(t,e){t._$litDirective$=e},getAttributePartCommittedValue:(t,e,s)=>{let n=oi;return t._commitValue=t=>n=t,t._$setValue(e,t,s),n},connectedDisconnectable:t=>({...t,_$isConnected:!0}),resolveDirective:Ei._resolveDirective,AttributePart:Ei._AttributePart,PropertyPart:Ei._PropertyPart,BooleanAttributePart:Ei._BooleanAttributePart,EventPart:Ei._EventPart,ElementPart:Ei._ElementPart,TemplateInstance:Ei._TemplateInstance,isIterable:Ei._isIterable,ChildPart:Ei._ChildPart},Ci={ATTRIBUTE:1,CHILD:2,PROPERTY:3,BOOLEAN_ATTRIBUTE:4,EVENT:5,ELEMENT:6},Si=t=>(...e)=>({_$litDirective$:t,values:e});class ki{constructor(t){}get _$isConnected(){return this._$parent._$isConnected}_$initialize(t,e,s){this.__part=t,this._$parent=e,this.__attributeIndex=s}_$resolve(t,e){return this.update(t,e)}update(t,e){return this.render(...e)}}const{_ChildPart:$i}=Ei,Ti=t=>t,Li=(t,e)=>void 0!==t?._$litType$,Pi=t=>void 0===t.strings,Ai=()=>document.createComment(""),Ni=(t,e,s)=>{const n=t._$startNode.parentNode,i=void 0===e?t._$endNode:e._$startNode;if(void 0===s){const e=n.insertBefore(Ai(),i),r=n.insertBefore(Ai(),i);s=new $i(e,r,t,t.options)}else{const e=s._$endNode.nextSibling,r=s._$parent,o=r!==t;if(o){let e;s._$reparentDisconnectables?.(t),s._$parent=t,void 0!==s._$notifyConnectionChanged&&(e=t._$isConnected)!==r._$isConnected&&s._$notifyConnectionChanged(e)}if(e!==i||o){let t=s._$startNode;for(;t!==e;){const e=Ti(t).nextSibling;Ti(n).insertBefore(t,i),t=e}}}return s},Di=(t,e,s=t)=>(t._$setValue(e,s),t),Ii={},Vi=(t,e=Ii)=>t._$committedValue=e,Mi=t=>t._$committedValue,ji=t=>{t._$clear(),t._$startNode.remove()},Ui=t=>{t._$clear()},Fi=(t,e)=>{const s=t._$disconnectableChildren;if(void 0===s)return!1;for(const t of s)t._$notifyDirectiveConnectionChanged?.(e,!1),Fi(t,e);return!0},Hi=t=>{let e,s;do{if(void 0===(e=t._$parent))break;s=e._$disconnectableChildren,s.delete(t),t=e}while(0===s?.size)},Bi=t=>{for(let e;e=t._$parent;t=e){let s=e._$disconnectableChildren;if(void 0===s)e._$disconnectableChildren=s=new Set;else if(s.has(t))break;s.add(t),Wi(e)}};function zi(t){void 0!==this._$disconnectableChildren?(Hi(this),this._$parent=t,Bi(this)):this._$parent=t}function Ki(t,e=!1,s=0){const n=this._$committedValue,i=this._$disconnectableChildren;if(void 0!==i&&0!==i.size)if(e)if(Array.isArray(n))for(let t=s;t<n.length;t++)Fi(n[t],!1),Hi(n[t]);else null!=n&&(Fi(n,!1),Hi(n));else Fi(this,t)}const Wi=t=>{t.type==Ci.CHILD&&(t._$notifyConnectionChanged??=Ki,t._$reparentDisconnectables??=zi)};class qi extends ki{constructor(){super(...arguments),this._$disconnectableChildren=void 0}_$initialize(t,e,s){super._$initialize(t,e,s),Bi(this),this.isConnected=t._$isConnected}_$notifyDirectiveConnectionChanged(t,e=!0){t!==this.isConnected&&(this.isConnected=t,t?this.reconnected?.():this.disconnected?.()),e&&(Fi(this,t),Hi(this))}setValue(t){if(Pi(this.__part))this.__part._$setValue(t,this);else{const e=[...this.__part._$committedValue];e[this.__attributeIndex]=t,this.__part._$setValue(e,this,0)}}disconnected(){}reconnected(){}}class Gi{}const Yi=new WeakMap;const Ji=Si(class Qi extends qi{render(t){return ai}update(t,[e]){const s=e!==this._ref;return s&&void 0!==this._ref&&this._updateRefValue(void 0),(s||this._lastElementForRef!==this._element)&&(this._ref=e,this._context=t.options?.host,this._updateRefValue(this._element=t.element)),ai}_updateRefValue(t){if(this.isConnected||(t=void 0),"function"==typeof this._ref){const e=this._context??globalThis;let s=Yi.get(e);void 0===s&&(s=new WeakMap,Yi.set(e,s)),void 0!==s.get(this._ref)&&this._ref.call(this._context,void 0),s.set(this._ref,t),void 0!==t&&this._ref.call(this._context,t)}else this._ref.value=t}get _lastElementForRef(){return"function"==typeof this._ref?Yi.get(this._context??globalThis)?.get(this._ref):this._ref?.value}disconnected(){this._lastElementForRef===this._element&&this._updateRefValue(void 0)}reconnected(){this._updateRefValue(this._element)}});class Xi{constructor(t){this._ref=t}disconnect(){this._ref=void 0}reconnect(t){this._ref=t}deref(){return this._ref}}class Zi{constructor(){this._promise=void 0,this._resolve=void 0}get(){return this._promise}pause(){this._promise??=new Promise(t=>this._resolve=t)}resume(){this._resolve?.(),this._promise=this._resolve=void 0}}class tr extends qi{constructor(){super(...arguments),this.__weakThis=new Xi(this),this.__pauser=new Zi}render(t,e){return oi}update(t,[e,s]){if(this.isConnected||this.disconnected(),e===this.__value)return oi;this.__value=e;let n=0;const{__weakThis:i,__pauser:r}=this;return(async(t,e)=>{for await(const s of t)if(!1===await e(s))return})(e,async t=>{for(;r.get();)await r.get();const o=i.deref();if(void 0!==o){if(o.__value!==e)return!1;void 0!==s&&(t=s(t,n)),o.commitValue(t,n),n++}return!0}),oi}commitValue(t,e){this.setValue(t)}disconnected(){this.__weakThis.disconnect(),this.__pauser.pause()}reconnected(){this.__weakThis.reconnect(this),this.__pauser.resume()}}const er=Si(tr);const sr=Si(class nr extends tr{constructor(t){if(super(t),t.type!==Ci.CHILD)throw new Error("asyncAppend can only be used in child expressions")}update(t,e){return this.__childPart=t,super.update(t,e)}commitValue(t,e){0===e&&Ui(this.__childPart);const s=Ni(this.__childPart);Di(s,t)}}),ir=t=>{return e=t,null!=e?._$litType$?.h?t._$litType$.h:t.strings;var e};const rr=Si(class or extends ki{constructor(t){super(t),this._templateCache=new WeakMap}render(t){return[t]}update(t,[e]){const s=Li(this._value)?ir(this._value):null,n=Li(e)?ir(e):null;if(null!==s&&(null===n||s!==n)){const e=Mi(t),n=e.pop();let i=this._templateCache.get(s);if(void 0===i){const t=document.createDocumentFragment();i=Ri(ai,t),i.setConnected(!1),this._templateCache.set(s,i)}Vi(i,[n]),Ni(i,void 0,n)}if(null!==n){if(null===s||s!==n){const e=this._templateCache.get(n);if(void 0!==e){const s=Mi(e),n=s.pop();Ui(t),Ni(t,void 0,n),Vi(t,[n])}}this._value=e}else this._value=void 0;return this.render(e)}});const ar=Si(class lr extends ki{constructor(t){if(super(t),t.type!==Ci.ATTRIBUTE||"class"!==t.name||t.strings?.length>2)throw new Error("`classMap()` can only be used in the `class` attribute and must be the only part in the attribute.")}render(t){return" "+Object.keys(t).filter(e=>t[e]).join(" ")+" "}update(t,[e]){if(void 0===this._previousClasses){this._previousClasses=new Set,void 0!==t.strings&&(this._staticClasses=new Set(t.strings.join(" ").split(/\s/).filter(t=>""!==t)));for(const t in e)e[t]&&!this._staticClasses?.has(t)&&this._previousClasses.add(t);return this.render(e)}const s=t.element.classList;for(const t of this._previousClasses)t in e||(s.remove(t),this._previousClasses.delete(t));for(const t in e){const n=!!e[t];n===this._previousClasses.has(t)||this._staticClasses?.has(t)||(n?(s.add(t),this._previousClasses.add(t)):(s.remove(t),this._previousClasses.delete(t)))}return oi}}),cr={};const hr=Si(class ur extends ki{constructor(){super(...arguments),this._previousValue=cr}render(t,e){return e()}update(t,[e,s]){if(Array.isArray(e)){if(Array.isArray(this._previousValue)&&this._previousValue.length===e.length&&e.every((t,e)=>t===this._previousValue[e]))return oi}else if(this._previousValue===e)return oi;this._previousValue=Array.isArray(e)?Array.from(e):e;const n=this.render(e,s);return n}});const dr=Si(class pr extends ki{constructor(){super(...arguments),this.key=ai}render(t,e){return this.key=t,e}update(t,[e,s]){return e!==this.key&&(Vi(t),this.key=e),s}});const fr=Si(class gr extends ki{constructor(t){if(super(t),t.type!==Ci.PROPERTY&&t.type!==Ci.ATTRIBUTE&&t.type!==Ci.BOOLEAN_ATTRIBUTE)throw new Error("The `live` directive is not allowed on child or event bindings");if(!Pi(t))throw new Error("`live` bindings can only contain a single expression")}render(t){return t}update(t,[e]){if(e===oi||e===ai)return e;const s=t.element,n=t.name;if(t.type===Ci.PROPERTY){if(e===s[n])return oi}else if(t.type===Ci.BOOLEAN_ATTRIBUTE){if(!!e===s.hasAttribute(n))return oi}else if(t.type===Ci.ATTRIBUTE&&s.getAttribute(n)===String(e))return oi;return Vi(t),e}});const mr=(t,e,s)=>{const n=new Map;for(let i=e;i<=s;i++)n.set(t[i],i);return n};const _r=Si(class yr extends ki{constructor(t){if(super(t),t.type!==Ci.CHILD)throw new Error("repeat() can only be used in text expressions")}_getValuesAndKeys(t,e,s){let n;void 0===s?s=e:void 0!==e&&(n=e);const i=[],r=[];let o=0;for(const e of t)i[o]=n?n(e,o):o,r[o]=s(e,o),o++;return{values:r,keys:i}}render(t,e,s){return this._getValuesAndKeys(t,e,s).values}update(t,[e,s,n]){const i=Mi(t),{values:r,keys:o}=this._getValuesAndKeys(e,s,n);if(!Array.isArray(i))return this._itemKeys=o,r;const a=this._itemKeys??=[],l=[];let c,h,u=0,d=i.length-1,p=0,f=r.length-1;for(;u<=d&&p<=f;)if(null===i[u])u++;else if(null===i[d])d--;else if(a[u]===o[p])l[p]=Di(i[u],r[p]),u++,p++;else if(a[d]===o[f])l[f]=Di(i[d],r[f]),d--,f--;else if(a[u]===o[f])l[f]=Di(i[u],r[f]),Ni(t,l[f+1],i[u]),u++,f--;else if(a[d]===o[p])l[p]=Di(i[d],r[p]),Ni(t,i[u],i[d]),d--,p++;else if(void 0===c&&(c=mr(o,p,f),h=mr(a,u,d)),c.has(a[u]))if(c.has(a[d])){const e=h.get(o[p]),s=void 0!==e?i[e]:null;if(null===s){const e=Ni(t,i[u]);Di(e,r[p]),l[p]=e}else l[p]=Di(s,r[p]),Ni(t,i[u],s),i[e]=null;p++}else ji(i[d]),d--;else ji(i[u]),u++;for(;p<=f;){const e=Ni(t,l[f+1]);Di(e,r[p]),l[p++]=e}for(;u<=d;){const t=i[u++];null!==t&&ji(t)}return this._itemKeys=o,Vi(t,l),oi}}),vr="important",br=" !"+vr;const Er=Si(class wr extends ki{constructor(t){if(super(t),t.type!==Ci.ATTRIBUTE||"style"!==t.name||t.strings?.length>2)throw new Error("The `styleMap` directive must be used in the `style` attribute and must be the only part in the attribute.")}render(t){return Object.keys(t).reduce((e,s)=>{const n=t[s];return null==n?e:(s=s.includes("-")?s:s.replace(/(?:^(webkit|moz|ms|o)|)(?=[A-Z])/g,"-$&").toLowerCase(),e+`${s}:${n};`)},"")}update(t,[e]){const{style:s}=t.element;if(void 0===this._previousStyleProperties)return this._previousStyleProperties=new Set(Object.keys(e)),this.render(e);for(const t of this._previousStyleProperties)null==e[t]&&(this._previousStyleProperties.delete(t),t.includes("-")?s.removeProperty(t):s[t]=null);for(const t in e){const n=e[t];if(null!=n){this._previousStyleProperties.add(t);const e="string"==typeof n&&n.endsWith(br);t.includes("-")||e?s.setProperty(t,e?n.slice(0,-11):n,e?vr:""):s[t]=n}}return oi}});const Rr=Si(class xr extends ki{constructor(t){if(super(t),t.type!==Ci.CHILD)throw new Error("templateContent can only be used in child bindings")}render(t){return this._previousTemplate===t?oi:(this._previousTemplate=t,document.importNode(t.content,!0))}});class Or extends ki{constructor(t){if(super(t),this._value=ai,t.type!==Ci.CHILD)throw new Error(`${this.constructor.directiveName}() can only be used in child bindings`)}render(t){if(t===ai||null==t)return this._templateResult=void 0,this._value=t;if(t===oi)return t;if("string"!=typeof t)throw new Error(`${this.constructor.directiveName}() called with a non-string value`);if(t===this._value)return this._templateResult;this._value=t;const e=[t];return e.raw=e,this._templateResult={_$litType$:this.constructor.resultType,strings:e,values:[]}}}Or.directiveName="unsafeHTML",Or.resultType=1;const Cr=Si(Or);class Sr extends Or{}Sr.directiveName="unsafeSVG",Sr.resultType=2;const kr=Si(Sr),$r=t=>{return!(e=t,null===e||"object"!=typeof e&&"function"!=typeof e||"function"!=typeof t.then);var e},Tr=1073741823;const Lr=Si(class Pr extends qi{constructor(){super(...arguments),this.__lastRenderedIndex=Tr,this.__values=[],this.__weakThis=new Xi(this),this.__pauser=new Zi}render(...t){return t.find(t=>!$r(t))??oi}update(t,e){const s=this.__values;let n=s.length;this.__values=e;const i=this.__weakThis,r=this.__pauser;this.isConnected||this.disconnected();for(let t=0;t<e.length&&!(t>this.__lastRenderedIndex);t++){const o=e[t];if(!$r(o))return this.__lastRenderedIndex=t,o;t<n&&o===s[t]||(this.__lastRenderedIndex=Tr,n=0,Promise.resolve(o).then(async t=>{for(;r.get();)await r.get();const e=i.deref();if(void 0!==e){const s=e.__values.indexOf(o);s>-1&&s<e.__lastRenderedIndex&&(e.__lastRenderedIndex=s,e.setValue(t))}}))}return oi}disconnected(){this.__weakThis.disconnect(),this.__pauser.pause()}reconnected(){this.__weakThis.reconnect(this),this.__pauser.resume()}});const Ar={asyncAppend:sr,asyncReplace:er,cache:rr,choose:(t,e,s)=>{for(const s of e){const e=s[0];if(e===t){const t=s[1];return t()}}return s?.()},classMap:ar,guard:hr,ifDefined:t=>t??ai,join:function*Nr(t,e){const s="function"==typeof e;if(void 0!==t){let n=-1;for(const i of t)n>-1&&(yield s?e(n):e),n++,yield i}},keyed:dr,live:fr,map:function*Dr(t,e){if(void 0!==t){let s=0;for(const n of t)yield e(n,s++)}},range:function*Ir(t,e,s=1){const n=void 0===e?0:t;e??=t;for(let t=n;s>0?t<e:e<t;t+=s)yield t},ref:Ji,repeat:_r,styleMap:Er,templateContent:Rr,unsafeHTML:Cr,unsafeSVG:kr,until:Lr,when:function Vr(t,e,s){return t?e(t):s?.(t)}},Mr=t=>{const e=Array.isArray(t)?t:[t];return Object.prototype.hasOwnProperty.call(e,"raw")||Object.defineProperty(e,"raw",{value:e}),e},jr=t=>e=>Ur(e,t);function Ur(t,e){const s=[],n=[];let i=t,r=i.indexOf(e.delimiter.start);for(;r>=0;){if(i.indexOf(e.delimiter.end,r)<0)throw new Error(`missing end delimiter at: '${i}'`);s.push(i.substring(0,r));const t=Fr(i.substring(r+e.delimiter.start.length),e);if(t.insertionPoint)i=t.remainingTmplStr,n.push(t.insertionPoint),r=i.indexOf(e.delimiter.start);else{const n=s.pop();i=n+t.remainingTmplStr,r=i.indexOf(e.delimiter.start,n.length)}}return s.push(i),t=>e.html(s,...n.map(e=>e(t)))}function Fr(t,e){const s=Object.values(e.transformers).find(s=>s.test(t,e)),n=s?s.transform:e.transformVariable;return n(t,e)}function Hr(t,e){if("."===e)return t;let s=t;for(let t of e.split(".")){if(!s.hasOwnProperty(t))return"";s=s[t]}return s}function Br(t,e){return function s(t){return null==t?"":""+t}(Hr(t,e))}const zr=(t,{delimiter:e})=>{const s=t.indexOf(e.end),n=t.substring(0,s);return{remainingTmplStr:t.substring(s+e.end.length),insertionPoint:t=>Br(t,n)}},Kr=t=>({test:t=>"{"===t[0],transform:(e,{delimiter:s})=>{const n=e.indexOf("}"+s.end);if(n<0)throw new Error(`missing end delimiter at: '${s.start}${e}'`);const i=e.substring(1,n);return{remainingTmplStr:e.substring(n+1+s.end.length),insertionPoint:e=>t(Br(e,i))}}});function Wr(t){return[null,void 0,!1,0,NaN,""].some(e=>e===t)||t.length&&0===t.length}function qr(t,e){const s=t.indexOf(e.end),n=t.substring(1,s),i=`${e.start}/${n}${e.end}`,r=t.indexOf(i);if(r<0)throw new Error(`missing end delimiter at: '${e.start}${t}'`);return{dataKey:n,innerTmpl:t.substring(s+e.start.length,r),remainingTmplStr:t.substring(r+i.length)}}const Gr=()=>({test:t=>"#"===t[0],transform:(t,e)=>{const s=qr(t,e.delimiter),n=Ur(s.innerTmpl,e);return{remainingTmplStr:s.remainingTmplStr,insertionPoint:t=>{const e=Hr(t,s.dataKey);return Wr(e)?"":e.map?e.map(t=>n(t)):n(t)}}}}),Yr=()=>({test:t=>"^"===t[0],transform:(t,e)=>{const s=qr(t,e.delimiter),n=Ur(s.innerTmpl,e);return{remainingTmplStr:s.remainingTmplStr,insertionPoint:t=>{const e=Hr(t,s.dataKey);return Wr(e)?e.map?e.map(t=>n(t)):n(t):""}}}}),Jr=()=>({test:t=>"!"===t[0],transform:(t,{delimiter:e})=>({remainingTmplStr:t.substring(t.indexOf(e.end)+e.end.length),insertionPoint:void 0})}),Qr=()=>({test:t=>"="===t[0],transform:(t,e)=>{const s=e.delimiter.end.length,n=t.indexOf("="+e.delimiter.end);if(n<0)throw new Error(`missing end delimiter at: '${t}'`);const[i,r]=t.substring(1,n).split(" ");return e.delimiter.start=i,e.delimiter.end=r,{remainingTmplStr:t.substring(n+1+s),insertionPoint:void 0}}}),Xr=t=>(e,...s)=>t(Mr(e),...s);function Zr(t,e){const s={start:"{{",end:"}}"};let n;if("function"==typeof t)n=((t,e)=>jr({html:t,delimiter:{start:"{{",end:"}}"},transformVariable:zr,transformers:{unsafeVariable:Kr(e),section:Gr(),invertedSection:Yr(),comment:{test:t=>"!"===t[0],transform:(t,{delimiter:e})=>({remainingTmplStr:t.substring(t.indexOf(e.end)+e.end.length),insertionPoint:void 0})},customDelimiterTransformer:Qr()}}))(Xr(t),e),n.delimiter=s;else{const{html:e}=t,i=Object.assign({delimiter:s,transformers:{}},t,{html:Xr(e)});n=jr(i),n.delimiter=i.delimiter}return i=n,t=>{const{start:e,end:s}=i.delimiter,n=new RegExp(`\x3c!--\\s*${e}`,"g"),r=new RegExp(`${s}\\s*--\x3e`,"g"),o=new RegExp(`(${e}[#^/]?)\\s*([\\w\\.]+)\\s*(${s})`,"g"),a=(t instanceof HTMLTemplateElement?t.innerHTML:t).replace(n,e).replace(r,s).replace(o,"$1$2$3");return i(a)};var i}const to={variable:zr,unsafeVariable:Kr,section:Gr,invertedSection:Yr,comment:Jr,customDelimiter:Qr},eo=["this"],so=["+","-","!"],no=["=","+","-","*","/","%","^","==","!=",">","<",">=","<=","||","&&","??","&","===","!==","|","|>"],io={"!":0,":":0,",":0,")":0,"]":0,"}":0,"|>":1,"?":2,"??":3,"||":4,"&&":5,"|":6,"^":7,"&":8,"!=":9,"==":9,"!==":9,"===":9,">=":10,">":10,"<=":10,"<":10,"+":11,"-":11,"%":12,"/":12,"*":12,"(":13,"[":13,".":13,"{":13},ro=["==","!=","<=",">=","||","&&","??","|>"],oo=["===","!=="];var ao;!function(t){t[t.STRING=1]="STRING",t[t.IDENTIFIER=2]="IDENTIFIER",t[t.DOT=3]="DOT",t[t.COMMA=4]="COMMA",t[t.COLON=5]="COLON",t[t.INTEGER=6]="INTEGER",t[t.DECIMAL=7]="DECIMAL",t[t.OPERATOR=8]="OPERATOR",t[t.GROUPER=9]="GROUPER",t[t.KEYWORD=10]="KEYWORD",t[t.ARROW=11]="ARROW"}(ao||(ao={}));const lo=(t,e,s=0)=>({kind:t,value:e,precedence:s}),co=t=>9===t||10===t||13===t||32===t,ho=t=>95===t||36===t||(t&=-33,65<=t&&t<=90),uo=t=>ho(t)||po(t),po=t=>48<=t&&t<=57;class fo{_input;_index=-1;_tokenStart=0;_next;constructor(t){this._input=t,this._advance()}nextToken(){for(;co(this._next);)this._advance(!0);if(t=this._next,34===t||39===t)return this._tokenizeString();var t;if(ho(this._next))return this._tokenizeIdentOrKeyword();if(po(this._next))return this._tokenizeNumber();if(46===this._next)return this._tokenizeDot();if(44===this._next)return this._tokenizeComma();if(58===this._next)return this._tokenizeColon();if((t=>43===t||45===t||42===t||47===t||33===t||38===t||37===t||60===t||61===t||62===t||63===t||94===t||124===t)(this._next))return this._tokenizeOperator();if((t=>40===t||41===t||91===t||93===t||123===t||125===t)(this._next))return this._tokenizeGrouper();if(this._advance(),void 0!==this._next)throw new Error(`Expected end of input, got ${this._next}`)}_advance(t){this._index++,this._index<this._input.length?(this._next=this._input.charCodeAt(this._index),!0===t&&(this._tokenStart=this._index)):this._next=void 0}_getValue(t=0){const e=this._input.substring(this._tokenStart,this._index+t);return 0===t&&this._clearValue(),e}_clearValue(){this._tokenStart=this._index}_tokenizeString(){const t="unterminated string",e=this._next;for(this._advance(!0);this._next!==e;){if(void 0===this._next)throw new Error(t);if(92===this._next&&(this._advance(),void 0===this._next))throw new Error(t);this._advance()}const s=lo(ao.STRING,(n=this._getValue(),n.replace(/\\(.)/g,(t,e)=>{switch(e){case"n":return"\n";case"r":return"\r";case"t":return"\t";case"b":return"\b";case"f":return"\f";default:return e}})));var n;return this._advance(),s}_tokenizeIdentOrKeyword(){do{this._advance()}while(uo(this._next));const t=this._getValue(),e=(s=t,-1!==eo.indexOf(s)?ao.KEYWORD:ao.IDENTIFIER);var s;return lo(e,t)}_tokenizeNumber(){do{this._advance()}while(po(this._next));return 46===this._next?this._tokenizeDot():lo(ao.INTEGER,this._getValue())}_tokenizeDot(){return this._advance(),po(this._next)?this._tokenizeFraction():(this._clearValue(),lo(ao.DOT,".",13))}_tokenizeComma(){return this._advance(!0),lo(ao.COMMA,",")}_tokenizeColon(){return this._advance(!0),lo(ao.COLON,":")}_tokenizeFraction(){do{this._advance()}while(po(this._next));return lo(ao.DECIMAL,this._getValue())}_tokenizeOperator(){this._advance();let t=this._getValue(2);if(-1!==oo.indexOf(t))this._advance(),this._advance();else{if(t=this._getValue(1),"=>"===t)return this._advance(),lo(ao.ARROW,t);-1!==ro.indexOf(t)&&this._advance()}return t=this._getValue(),lo(ao.OPERATOR,t,io[t])}_tokenizeGrouper(){const t=String.fromCharCode(this._next),e=lo(ao.GROUPER,t,io[t]);return this._advance(!0),e}}const go=(t,e)=>new mo(t,e).parse();class mo{_kind;_tokenizer;_ast;_token;_value;constructor(t,e){this._tokenizer=new fo(t),this._ast=e}parse(){return this._advance(),this._parseExpression()}_advance(t,e){if(!this._matches(t,e))throw new Error(`Expected kind ${t} (${e}), was ${this._token?.kind} (${this._token?.value})`);const s=this._tokenizer.nextToken();this._token=s,this._kind=s?.kind,this._value=s?.value}_matches(t,e){return!(t&&this._kind!==t||e&&this._value!==e)}_parseExpression(){if(!this._token)return this._ast.empty();const t=this._parseUnary();return void 0===t?void 0:this._parsePrecedence(t,0)}_parsePrecedence(t,e){if(void 0===t)throw new Error("Expected left to be defined.");for(;this._token;)if(this._matches(ao.GROUPER,"(")){const e=this._parseArguments();t=this._ast.invoke(t,void 0,e)}else if(this._matches(ao.GROUPER,"[")){const e=this._parseIndex();t=this._ast.index(t,e)}else if(this._matches(ao.DOT)){this._advance();const e=this._parseUnary();t=this._makeInvokeOrGetter(t,e)}else{if(this._matches(ao.KEYWORD))break;if(!(this._matches(ao.OPERATOR)&&this._token.precedence>=e))break;t="?"===this._value?this._parseTernary(t):this._parseBinary(t,this._token)}return t}_makeInvokeOrGetter(t,e){if(void 0===e)throw new Error("expected identifier");if("ID"===e.type)return this._ast.getter(t,e.value);if("Invoke"===e.type&&"ID"===e.receiver.type){const s=e.receiver;return this._ast.invoke(t,s.value,e.arguments)}throw new Error(`expected identifier: ${e}`)}_parseBinary(t,e){if(-1===no.indexOf(e.value))throw new Error(`unknown operator: ${e.value}`);this._advance();let s=this._parseUnary();for(;(this._kind===ao.OPERATOR||this._kind===ao.DOT||this._kind===ao.GROUPER)&&this._token.precedence>e.precedence;)s=this._parsePrecedence(s,this._token.precedence);return this._ast.binary(t,e.value,s)}_parseUnary(){if(this._matches(ao.OPERATOR)){const t=this._value;if(this._advance(),"+"===t||"-"===t){if(this._matches(ao.INTEGER))return this._parseInteger(t);if(this._matches(ao.DECIMAL))return this._parseDecimal(t)}if(-1===so.indexOf(t))throw new Error(`unexpected token: ${t}`);const e=this._parsePrecedence(this._parsePrimary(),13);return this._ast.unary(t,e)}return this._parsePrimary()}_parseTernary(t){this._advance(ao.OPERATOR,"?");const e=this._parseExpression();this._advance(ao.COLON);const s=this._parseExpression();return this._ast.ternary(t,e,s)}_parsePrimary(){switch(this._kind){case ao.KEYWORD:const t=this._value;if("this"===t)return this._advance(),this._ast.id(t);if(-1!==eo.indexOf(t))throw new Error(`unexpected keyword: ${t}`);throw new Error(`unrecognized keyword: ${t}`);case ao.IDENTIFIER:return this._parseInvokeOrIdentifier();case ao.STRING:return this._parseString();case ao.INTEGER:return this._parseInteger();case ao.DECIMAL:return this._parseDecimal();case ao.GROUPER:return"("===this._value?this._parseParenOrFunction():"{"===this._value?this._parseMap():"["===this._value?this._parseList():void 0;case ao.COLON:throw new Error('unexpected token ":"');default:return}}_parseList(){const t=[];do{if(this._advance(),this._matches(ao.GROUPER,"]"))break;t.push(this._parseExpression())}while(this._matches(ao.COMMA));return this._advance(ao.GROUPER,"]"),this._ast.list(t)}_parseMap(){const t={};do{if(this._advance(),this._matches(ao.GROUPER,"}"))break;const e=this._value;(this._matches(ao.STRING)||this._matches(ao.IDENTIFIER))&&this._advance(),this._advance(ao.COLON),t[e]=this._parseExpression()}while(this._matches(ao.COMMA));return this._advance(ao.GROUPER,"}"),this._ast.map(t)}_parseInvokeOrIdentifier(){const t=this._value;if("true"===t)return this._advance(),this._ast.literal(!0);if("false"===t)return this._advance(),this._ast.literal(!1);if("null"===t)return this._advance(),this._ast.literal(null);if("undefined"===t)return this._advance(),this._ast.literal(void 0);const e=this._parseIdentifier(),s=this._parseArguments();return s?this._ast.invoke(e,void 0,s):e}_parseIdentifier(){if(!this._matches(ao.IDENTIFIER))throw new Error(`expected identifier: ${this._value}`);const t=this._value;return this._advance(),this._ast.id(t)}_parseArguments(){if(!this._matches(ao.GROUPER,"("))return;const t=[];do{if(this._advance(),this._matches(ao.GROUPER,")"))break;const e=this._parseExpression();t.push(e)}while(this._matches(ao.COMMA));return this._advance(ao.GROUPER,")"),t}_parseIndex(){this._advance();const t=this._parseExpression();return this._advance(ao.GROUPER,"]"),t}_parseParenOrFunction(){const t=this._parseArguments();if(this._matches(ao.ARROW)){this._advance();const e=this._parseExpression(),s=t?.map(t=>t.value)??[];return this._ast.arrowFunction(s,e)}return this._ast.paren(t[0])}_parseString(){const t=this._ast.literal(this._value);return this._advance(),t}_parseInteger(t=""){const e=this._ast.literal(parseInt(`${t}${this._value}`,10));return this._advance(),e}_parseDecimal(t=""){const e=this._ast.literal(parseFloat(`${t}${this._value}`));return this._advance(),e}}const _o={"+":(t,e)=>t+e,"-":(t,e)=>t-e,"*":(t,e)=>t*e,"/":(t,e)=>t/e,"%":(t,e)=>t%e,"==":(t,e)=>t==e,"!=":(t,e)=>t!=e,"===":(t,e)=>t===e,"!==":(t,e)=>t!==e,">":(t,e)=>t>e,">=":(t,e)=>t>=e,"<":(t,e)=>t<e,"<=":(t,e)=>t<=e,"||":(t,e)=>t||e,"&&":(t,e)=>t&&e,"??":(t,e)=>t??e,"|":(t,e)=>e(t),"|>":(t,e)=>e(t)},yo={"+":t=>t,"-":t=>-t,"!":t=>!t};const{AttributePart:vo,PropertyPart:bo,BooleanAttributePart:Eo,EventPart:wo}=Oi,Ro=new class xo{empty(){return{type:"Empty",evaluate:t=>t,getIds:t=>t}}literal(t){return{type:"Literal",value:t,evaluate(t){return this.value},getIds:t=>t}}id(t){return{type:"ID",value:t,evaluate(t){return"this"===this.value?t:t?.[this.value]},getIds(t){return t.push(this.value),t}}}unary(t,e){const s=yo[t];return{type:"Unary",operator:t,child:e,evaluate(t){return s(this.child.evaluate(t))},getIds(t){return this.child.getIds(t)}}}binary(t,e,s){const n=_o[e];return{type:"Binary",operator:e,left:t,right:s,evaluate(t){if("="===this.operator){if("ID"!==this.left.type&&"Getter"!==this.left.type&&"Index"!==this.left.type)throw new Error(`Invalid assignment target: ${this.left}`);const e=this.right.evaluate(t);let s,n;return"Getter"===this.left.type?(s=this.left.receiver.evaluate(t),n=this.left.name):"Index"===this.left.type?(s=this.left.receiver.evaluate(t),n=this.left.argument.evaluate(t)):"ID"===this.left.type&&(s=t,n=this.left.value),void 0===s?void 0:s[n]=e}return n(this.left.evaluate(t),this.right.evaluate(t))},getIds(t){return this.left.getIds(t),this.right.getIds(t),t}}}getter(t,e){return{type:"Getter",receiver:t,name:e,evaluate(t){return this.receiver.evaluate(t)?.[this.name]},getIds(t){return this.receiver.getIds(t),t}}}invoke(t,e,s){if(null!=e&&"string"!=typeof e)throw new Error("method not a string");return{type:"Invoke",receiver:t,method:e,arguments:s,evaluate(t){const s=this.receiver.evaluate(t),n=this.method?s:t?.this??t,i=this.method?s?.[e]:s,r=this.arguments??[],o=r.map(e=>e?.evaluate(t));return i?.apply?.(n,o)},getIds(t){return this.receiver.getIds(t),this.arguments?.forEach(e=>e?.getIds(t)),t}}}paren(t){return t}index(t,e){return{type:"Index",receiver:t,argument:e,evaluate(t){return this.receiver.evaluate(t)?.[this.argument.evaluate(t)]},getIds(t){return this.receiver.getIds(t),t}}}ternary(t,e,s){return{type:"Ternary",condition:t,trueExpr:e,falseExpr:s,evaluate(t){const e=this.condition.evaluate(t);return e?this.trueExpr.evaluate(t):this.falseExpr.evaluate(t)},getIds(t){return this.condition.getIds(t),this.trueExpr.getIds(t),this.falseExpr.getIds(t),t}}}map(t){return{type:"Map",entries:t,evaluate(e){const s={};if(t&&this.entries)for(const n in t){const t=this.entries[n];t&&(s[n]=t.evaluate(e))}return s},getIds(e){if(t&&this.entries)for(const s in t){const t=this.entries[s];t&&t.getIds(e)}return e}}}list(t){return{type:"List",items:t,evaluate(t){return this.items?.map(e=>e?.evaluate(t))},getIds(t){return this.items?.forEach(e=>e?.getIds(t)),t}}}arrowFunction(t,e){return{type:"ArrowFunction",params:t,body:e,evaluate(t){const e=this.params,s=this.body;return function(...n){const i=Object.fromEntries(e.map((t,e)=>[t,n[e]])),r=new Proxy(t??{},{set:(t,e,s)=>(i.hasOwnProperty(e)&&(i[e]=s),t[e]=s),get:(t,e)=>i.hasOwnProperty(e)?i[e]:t[e]});return s.evaluate(r)}},getIds(t){return this.body.getIds(t).filter(t=>!this.params.includes(t))}}}},Oo=new Map,Co=t=>t.replace(/-(-|\w)/g,(t,e)=>e.toUpperCase()),So=(t,e)=>{let s=Oo.get(t);if(void 0===s){if(Oo.has(t))return;if(t=t.trim(),t.startsWith("{{")&&t.endsWith("}}")){const e=t.substring(2,t.length-2).trim();s=new mo(e,Ro).parse(),Oo.set(t,s)}}return s?.evaluate(e)},ko=/(?<!\\){{(.*?)(?:(?<!\\)}})/g,$o=t=>/(?:\\{{)|(?:\\}})/g.test(t),To=t=>t.replaceAll(/\\{{/g,"{{").replace(/\\}}/g,"}}"),Lo={if:(t,e,s,n)=>{const i=t.getAttribute("if");if(null!==i&&So(i,e))return Ao(t,e,s,n)},repeat:(t,e,s,n)=>{const i=t.getAttribute("repeat");if(null!==i){const r=So(i,e);if(!r[Symbol.iterator])return ai;const o=Do(t);let a=-1;const l=[];for(const t of r){a++;const i=Object.create(e);i.item=t,i.index=a,i.this=e.this??e;const r=[];for(const t of o.parts){const e=t.update(i,s,n);1===t.type?r.push(...e):r.push(e)}const c={_$litType$:o,values:r};l.push(c)}return l}}},Po=(t,e=Lo,s={},n)=>{const i=Do(t),r=i.renderers;if(n){const e=Do(n),i=e.renderers,o=r.super;void 0!==o?s={...r,...s,super:(t,e,s)=>(s={...i,...s,super:(t,e,s)=>Ao(n,t,e,s)},o(t,e,s))}:(s={...i,...r,...s},t=n)}else s={...r,...s};return n=>Ao(t,n,e,s)},Ao=(t,e,s=Lo,n={})=>{const i=Do(t),r=[];for(const t of i.parts){const i=t.update(e,s,n);1===t.type?r.push(...i):r.push(i)}const o={_$litType$:i,values:r};return o},No=new Map,Do=t=>{let e=No.get(t);return void 0===e&&No.set(t,e=Io(t)),e},Io=t=>{const e={h:void 0,el:t.cloneNode(!0),parts:[],renderers:{}},s=document.createTreeWalker(e.el.content,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT|NodeFilter.SHOW_COMMENT);let n=s.currentNode,i=-1;const r=[];for(;null!==(n=s.nextNode());)if(n.nodeType===Node.ELEMENT_NODE){i++;const t=n;if("TEMPLATE"===t.tagName){const s=t.getAttribute("type"),n=t.getAttribute("name"),o=t.getAttribute("call");if(null!==o||null!==s||null!==n){let a;if(t.parentNode.insertBefore(document.createComment(""),t),r.push(t),null!==o){const e=o.trim(),s=e.startsWith("{{")&&e.endsWith("}}");a=(n,i,r)=>{const a=t.getAttribute("data"),l=null===a?void 0:So(a,n),c=s?So(e,n):r[o];return c?.(l,i,r)}}else null!==s?a=(e,n,i)=>{const r=n[s];return r?.(t,e,n,i)}:("super"===n?e.renderers.super=(e,s,n)=>{const i=n.super,r=Do(t);return n={...n,...r.renderers},i(e,s,n)}:e.renderers[n]=(e,s,n)=>Ao(t,e,s,n),a=(t,e,s)=>{const i=s[n];return i?.(t,e,s)});e.parts.push({type:2,index:i,update:a});continue}}const s=t.getAttributeNames();for(const n of s){const s=t.getAttribute(n),r=s.split(ko);if(1===r.length){$o(s)&&t.setAttribute(n,To(s));continue}t.removeAttribute(n);let o=n,a=vo;const l=n[0];"."===l?(o=Co(n.substring(1)),a=bo):"?"===l?(o=n.substring(1),a=Eo):"@"===l&&(o=Co(n.substring(1)),a=wo);const c=[To(r[0])],h=[];for(let t=1;t<r.length;t+=2){const e=r[t];h.push(go(e,Ro)),c.push(To(r[t+1]))}e.parts.push({type:1,index:i,name:o,strings:c,ctor:a,update:(t,e,s)=>h.map(e=>e.evaluate(t))})}}else if(n.nodeType===Node.TEXT_NODE){let t=n;const r=t.textContent,o=r.split(ko);o.length>1?t.textContent=To(o[0]):$o(r)&&(t.textContent=To(r));for(let n=1;n<o.length;n+=2){const r=o[n],a=go(r,Ro);e.parts.push({type:2,index:++i,update:(t,e)=>a.evaluate(t)});const l=new Text(o[n+1].replace("\\{{","{{"));t.parentNode.insertBefore(l,t.nextSibling),t.parentNode.insertBefore(document.createComment(""),t.nextSibling),t=l,s.currentNode=l}}for(const t of r)t.remove();return e};function Vo(t){const{handlers:e,renderers:s,superTemplate:n}=t??{};return t=>Po(function i(t){if(t instanceof HTMLTemplateElement)return t;if("string"==typeof t){const e=document.createElement("template");return e.innerHTML=t,e}throw new TypeError(`Type of template is not a valid. [typeof: ${typeof t}]`)}(t),e,s,n)}const Mo={mustache:Zr(ii,Ar.unsafeHTML),stampino:Vo()};class jo{static _transformer=Mo.mustache;static compile(t,e){const{transformer:s}=Object.assign({transformer:jo._transformer},e),n=s(t),i=t=>n(t);return i.source=t instanceof HTMLTemplateElement?t.innerHTML:t,i}static setTransformer(t){const e=jo._transformer;return jo._transformer=t,e}static get builtins(){return Object.keys(Mo)}static getBuitinTransformer(t){return Mo[t]}}let Uo,Fo=0;const Ho=t=>{Uo=t},Bo=()=>{Uo=null,Fo=0},zo=Symbol("hook"),Ko=Symbol("effects"),Wo=Symbol("layoutEffects");class qo{update;host;virtual;[zo];[Ko];[Wo];constructor(t,e){this.update=t,this.host=e,this[zo]=new Map,this[Ko]=[],this[Wo]=[]}run(t){Ho(this);const e=t();return Bo(),e}_runEffects(t){const e=this[t];Ho(this);for(const t of e)t.call(this);Bo()}runEffects(){this._runEffects(Ko)}runLayoutEffects(){this._runEffects(Wo)}teardown(){const t=this[zo];for(const[,e]of t)"function"==typeof e.teardown&&e.teardown(),delete e.teardown}}const Go=e.scheduler();const Yo=Si(class Jo extends qi{_state;_renderer;_args;_elObserved;_disconnectedHandler;constructor(t){super(t),this._state=new qo(()=>this.redraw(),this),this._renderer=e.noop,this._args=[]}render(t,e,...s){return this._renderer=e,this._args=s,this.observe(t),this.redraw(),oi}disconnected(){this._elObserved&&k.utils.undetectify(this._elObserved),this._elObserved=void 0,this._state.teardown()}redraw(){this._state.run(()=>{const t=this._renderer(...this._args);this.setValue(t)}),this._state.runLayoutEffects(),Go(()=>this._state.runEffects())}observe(t){if(this._disconnectedHandler)return;const{_$parent:e}=this;this._elObserved=e?.parentNode,this._elObserved&&(k.utils.detectify(this._elObserved,t),this._elObserved.addEventListener("disconnected",this._disconnectedHandler=this.disconnected.bind(this)))}});class Qo{id;state;constructor(t,e){this.id=t,this.state=e}}const Xo=(t,...e)=>{const s=Fo++,n=Uo[zo];let i=n.get(s);return i||(i=new t(s,Uo,...e),n.set(s,i)),i.update(...e)},Zo=t=>Xo.bind(null,t),ta=Zo(class extends Qo{args;constructor(t,e,s){super(t,e),this.updater=this.updater.bind(this),"function"==typeof s&&(s=s()),this.makeArgs(s)}update(){return this.args}updater(t){const[s]=this.args;if("function"==typeof t){const e=t;t=e(s)}e.deepEqual(s,t)||(this.makeArgs(t),this.state.update())}makeArgs(t){this.args=Object.freeze([t,this.updater])}}),ea=t=>Zo(class extends Qo{callback;lastValues;values;_teardown;constructor(e,s,n,i){super(e,s),t(s,this)}update(t,e){this.callback=t,this.values=e}call(){this.values&&!this.hasChanged()||this.run(),this.lastValues=this.values}run(){this.teardown(),this._teardown=this.callback.call(this.state)}teardown(){"function"==typeof this._teardown&&this._teardown()}hasChanged(){return!this.lastValues||this.values.some((t,s)=>!e.deepEqual(this.lastValues[s],t))}}),sa=(t,e)=>{t[Ko].push(e)},na=ea(sa),ia=ea((t,e)=>{t[Wo].push(e)}),ra=Zo(class extends Qo{value;values;constructor(t,e,s,n){super(t,e),this.value=s(),this.values=n}update(t,e){return this.hasChanged(e)&&(this.values=e,this.value=t()),this.value}hasChanged(t=[]){return t.some((t,e)=>this.values[e]!==t)}}),oa=Zo(class extends Qo{reducer;currentState;constructor(t,e,s,n,i){super(t,e),this.dispatch=this.dispatch.bind(this),this.currentState=void 0!==i?i(n):n}update(t){return this.reducer=t,[this.currentState,this.dispatch]}dispatch(t){this.currentState=this.reducer(this.currentState,t),this.state.update()}});class aa{defaultValue;_value;constructor(t){this.provide=this.provide.bind(this),this.consume=this.consume.bind(this),this.defaultValue=t,this._value=t}provide(t,s){return this._value=t,e.isFunction(s)?s(t):oi}consume(t){return t(this._value)}}const la=Zo(class extends Qo{_ranEffect;constructor(t,e,s){super(t,e),this._ranEffect=!1,sa(e,this)}update(t){let e;return t.consume(t=>{e=t}),e}call(){this._ranEffect||(this._ranEffect=!0,this.state.update())}}),ca=Yo.bind(null,null);ca.with=Yo,ca.useState=ta,ca.useEffect=na,ca.useLayoutEffect=ia,ca.useMemo=ra,ca.useRef=t=>ra(()=>({current:t}),[]),ca.useCallback=(t,e)=>ra(()=>t,e),ca.useReducer=oa,ca.createContext=t=>new aa(t),ca.useContext=la;var ha,ua={};var da=function pa(){if(ha)return ua;ha=1,Object.defineProperty(ua,"__esModule",{value:!0}),ua.PathError=ua.TokenData=void 0,ua.parse=d,ua.compile=function t(e,s={}){const{encode:i=encodeURIComponent,delimiter:r=n}=s,o="object"==typeof e?e:d(e,s),a=p(o.tokens,r,i);return function t(e={}){const[t,...s]=a(e);if(s.length)throw new TypeError(`Missing parameters: ${s.join(", ")}`);return t}},ua.match=function e(t,s={}){const{decode:r=decodeURIComponent,delimiter:o=n}=s,{regexp:a,keys:l}=f(t,s),c=l.map(t=>!1===r?i:"param"===t.type?r:t=>t.split(o).map(r));return function t(e){const s=a.exec(e);if(!s)return!1;const n=s[0],i=Object.create(null);for(let t=1;t<s.length;t++){if(void 0===s[t])continue;const e=l[t-1],n=c[t-1];i[e.name]=n(s[t])}return{path:n,params:i}}},ua.pathToRegexp=f,ua.stringify=function s(t){return v(t.tokens)};const n="/",i=t=>t,r=/^[$_\p{ID_Start}]$/u,o=/^[$\u200c\u200d\p{ID_Continue}]$/u,a={"{":"{","}":"}","(":"(",")":")","[":"[","]":"]","+":"+","?":"?","!":"!"};function l(t){return t.replace(/[{}()\[\]+?!:*\\]/g,"\\$&")}function c(t){return t.replace(/[.+*?^${}()[\]|/\\]/g,"\\$&")}class h{constructor(t,e){this.tokens=t,this.originalPath=e}}ua.TokenData=h;class u extends TypeError{constructor(t,e){let s=t;e&&(s+=`: ${e}`),s+="; visit https://git.new/pathToRegexpError for info",super(s),this.originalPath=e}}function d(t,e={}){const{encodePath:s=i}=e,n=[...t],l=[];let c=0,d=0;function p(){let e="";if(r.test(n[c]))do{e+=n[c++]}while(o.test(n[c]));else if('"'===n[c]){let s=c;for(;c++<n.length;){if('"'===n[c]){c++,s=0;break}"\\"===n[c]&&c++,e+=n[c]}if(s)throw new u(`Unterminated quote at index ${s}`,t)}if(!e)throw new u(`Missing parameter name at index ${c}`,t);return e}for(;c<n.length;){const t=n[c],e=a[t];e?l.push({type:e,index:c++,value:t}):"\\"===t?l.push({type:"escape",index:c++,value:n[c++]}):":"===t?l.push({type:"param",index:c++,value:p()}):"*"===t?l.push({type:"wildcard",index:c++,value:p()}):l.push({type:"char",index:c++,value:t})}return l.push({type:"end",index:c,value:""}),new h(function e(n){const i=[];for(;;){const r=l[d++];if(r.type===n)break;if("char"===r.type||"escape"===r.type){let t=r.value,e=l[d];for(;"char"===e.type||"escape"===e.type;)t+=e.value,e=l[++d];i.push({type:"text",value:s(t)});continue}if("param"!==r.type&&"wildcard"!==r.type){if("{"!==r.type)throw new u(`Unexpected ${r.type} at index ${r.index}, expected ${n}`,t);i.push({type:"group",tokens:e("}")})}else i.push({type:r.type,name:r.value})}return i}("end"),t)}function p(t,e,s){const n=t.map(t=>function n(t,e,s){if("text"===t.type)return()=>[t.value];if("group"===t.type){const n=p(t.tokens,e,s);return t=>{const[e,...s]=n(t);return s.length?[""]:[e]}}const n=s||i;if("wildcard"===t.type&&!1!==s)return s=>{const i=s[t.name];if(null==i)return["",t.name];if(!Array.isArray(i)||0===i.length)throw new TypeError(`Expected "${t.name}" to be a non-empty array`);return[i.map((e,s)=>{if("string"!=typeof e)throw new TypeError(`Expected "${t.name}/${s}" to be a string`);return n(e)}).join(e)]};return e=>{const s=e[t.name];if(null==s)return["",t.name];if("string"!=typeof s)throw new TypeError(`Expected "${t.name}" to be a string`);return[n(s)]}}(t,e,s));return t=>{const e=[""];for(const s of n){const[n,...i]=s(t);e[0]+=n,e.push(...i)}return e}}function f(t,e={}){const{delimiter:s=n,end:i=!0,sensitive:r=!1,trailing:o=!0}=e,a=[],l=r?"":"i",h=[];for(const n of g(t,[])){const t="object"==typeof n?n:d(n,e);for(const e of m(t.tokens,0,[]))h.push(_(e,s,a,t.originalPath))}let u=`^(?:${h.join("|")})`;o&&(u+=`(?:${c(s)}$)?`),u+=i?"$":`(?=${c(s)}|$)`;const p=new RegExp(u,l);return{regexp:p,keys:a}}function g(t,e){if(Array.isArray(t))for(const s of t)g(s,e);else e.push(t);return e}function*m(t,e,s){if(e===t.length)return yield s;const n=t[e];if("group"===n.type)for(const i of m(n.tokens,0,s.slice()))yield*m(t,e+1,i);else s.push(n);yield*m(t,e+1,s)}function _(t,e,s,n){let i="",r="",o=!0;for(const a of t)if("text"!==a.type)if("param"!==a.type&&"wildcard"!==a.type);else{if(!o&&!r)throw new u(`Missing text before "${a.name}" ${a.type}`,n);"param"===a.type?i+=`(${y(e,o?"":r)}+)`:i+="([\\s\\S]+)",s.push(a),r="",o=!1}else i+=c(a.value),r+=a.value,o||(o=a.value.includes(e));return i}function y(t,e){return e.length<2?t.length<2?`[^${c(t+e)}]`:`(?:(?!${c(t)})[^${c(e)}])`:t.length<2?`(?:(?!${c(e)})[^${c(t)}])`:`(?:(?!${c(e)}|${c(t)})[\\s\\S])`}function v(t){let e="",s=0;function n(e){const n=function i(t){const[e,...s]=t;return r.test(e)&&s.every(t=>o.test(t))}(e)&&function a(t){return!t||"text"!==t.type||!o.test(t.value[0])}(t[s]);return n?e:JSON.stringify(e)}for(;s<t.length;){const i=t[s++];if("text"!==i.type)if("group"!==i.type)if("param"!==i.type){if("wildcard"!==i.type)throw new TypeError(`Unknown token type: ${i.type}`);e+=`*${n(i.name)}`}else e+=`:${n(i.name)}`;else e+=`{${v(i.tokens)}}`;else e+=l(i.value)}return e}return ua.PathError=u,ua}();const fa={TokenData:da.TokenData,PathError:da.PathError,parse:da.parse,compile:da.compile,match:da.match,stringify:da.stringify,pathToRegexp:da.pathToRegexp};!function(){let t=CDP_DECLARE.RESULT_CODE;t[t.MVC_ROUTER_DECLARE=9007199254740991]="MVC_ROUTER_DECLARE",t[t.ERROR_MVC_ROUTER_ELEMENT_NOT_FOUND=CDP_DECLARE.DECLARE_ERROR_CODE(100,76,"router element not found.")]="ERROR_MVC_ROUTER_ELEMENT_NOT_FOUND",t[t.ERROR_MVC_ROUTER_ROUTE_CANNOT_BE_RESOLVED=CDP_DECLARE.DECLARE_ERROR_CODE(100,77,"Route cannot be resolved.")]="ERROR_MVC_ROUTER_ROUTE_CANNOT_BE_RESOLVED",t[t.ERROR_MVC_ROUTER_NAVIGATE_FAILED=CDP_DECLARE.DECLARE_ERROR_CODE(100,78,"Route navigate failed.")]="ERROR_MVC_ROUTER_NAVIGATE_FAILED",t[t.ERROR_MVC_ROUTER_INVALID_SUBFLOW_BASE_URL=CDP_DECLARE.DECLARE_ERROR_CODE(100,79,"Invalid sub-flow base url.")]="ERROR_MVC_ROUTER_INVALID_SUBFLOW_BASE_URL",void(t[t.ERROR_MVC_ROUTER_BUSY=CDP_DECLARE.DECLARE_ERROR_CODE(100,80,"In changing page process now.")]="ERROR_MVC_ROUTER_BUSY")}();const ga=e.safe(globalThis.window),ma=e.safe(globalThis.URL),_a=t=>t.replace(/^(#\/)|^[#/]|\s+$/,"").replace(/^\s+$|(\/$)/,""),ya=(t,e)=>Object.assign({"@id":_a(t)},e),va=t=>{const s=new e.Deferred;return s.reject=()=>{void 0,s.resolve()},s},ba=(t,e)=>{const s=e.direct(t["@id"])?.state?.el;!t.el&&s&&(t.el=s)};class Ea{_stack=[];_index=0;get length(){return this._stack.length}get state(){return this.distance(0)}get id(){return this.state["@id"]}get index(){return this._index}set index(t){this._index=Math.trunc(t)}get array(){return this._stack.slice()}get isFirst(){return 0===this._index}get isLast(){return this._index===this._stack.length-1}at(t){return e.at(this._stack,t)}clearForward(){this._stack=this._stack.slice(0,this._index+1)}closest(t){t=_a(t);const{_index:s}=this,n=this._stack.map((t,e)=>({index:e,distance:Math.abs(s-e),...t})).filter(e=>e["@id"]===t);return e.sort(n,(t,e)=>t.distance>e.distance?1:-1,!0),n[0]?.index}direct(t,e){const s=this.closest(t),n=null==e?this._index:this.closest(e);if(null==n||null==s)return{direction:"missing"};{const t=s-n,e=0===t?"none":t<0?"back":"forward";return{direction:e,delta:t,index:s,state:this._stack[s]}}}distance(t){const e=this._index+t;if(e<0)throw new RangeError(`invalid array index. [length: ${this.length}, given: ${e}]`);return this.at(e)}noopStack=e.noop;pushStack(t){this._stack[++this._index]=t}replaceStack(t){this._stack[this._index]=t}seekStack(t){const e=this.closest(t["@id"]);null==e?this.pushStack(t):this._index=e}dispose(){this._stack.length=0,this._index=NaN}}const wa=t=>{if(ma.canParse(t)){const{hash:e}=new ma(t);return _a(e||t.substring(l.length))}return _a(t)},Ra=t=>`/${wa(t)}`,xa=Symbol("SessionHistory#signature");class Oa extends e.EventPublisher{_window;_mode;_popStateHandler;_stack=new Ea;_dfGo;constructor(t,e,s,n){super(),this[xa]=!0,this._window=t,this._mode=e,this._popStateHandler=this.onPopState.bind(this),this._window.addEventListener("popstate",this._popStateHandler),this.replace(s??wa(this._window.location.href),n,{silent:!0})}dispose(){this._window.removeEventListener("popstate",this._popStateHandler),this._stack.dispose(),this.off(),delete this[xa]}async reset(t){if(Number.isNaN(this.index)||this._stack.length<=1)return;const{silent:e}=t??{},{location:s}=this._window,n=this._stack.state,i=s.href;this.setIndex(0),await this.clearForward();const r=s.href;if(!e){const t={df:va(),newId:wa(r),oldId:wa(i),postproc:"noop",prevState:n};await this.dispatchChangeInfo(this.state,t)}}get length(){return this._stack.length}get state(){return this._stack.state}get id(){return this._stack.id}get index(){return this._stack.index}get stack(){return this._stack.array}get canBack(){return!this._stack.isFirst}get canForward(){return!this._stack.isLast}at(t){return this._stack.at(t)}back(){return this.go(-1)}forward(){return this.go(1)}async go(t){if(this._dfGo)return this.index;if(!t)return await this.triggerEventAndWait("refresh",this.state,void 0),this.index;const s=this.index;try{this._dfGo=new e.Deferred,this._stack.distance(t),this._window.history.go(t),await this._dfGo}catch(t){void 0,this.setIndex(s)}finally{this._dfGo=void 0}return this.index}traverseTo(t){const{direction:e,delta:s}=this.direct(t);return"missing"===e?(void 0,Promise.resolve(this.index)):this.go(s)}push(t,e,s){return this.updateState("push",t,e,s??{})}replace(t,e,s){return this.updateState("replace",t,e,s??{})}clearForward(){return this._stack.clearForward(),this.clearForwardHistory()}closest(t){return this._stack.closest(t)}direct(t,e){return this._stack.direct(t,e)}setIndex(t){this._stack.index=t}toUrl(t){return"hash"===this._mode?`#/${t}`:c(t)}async triggerEventAndWait(t,e,s){const n=[];this.publish(t,e,s,n),await Promise.all(n)}async updateState(t,s,n,i){const{silent:r,cancel:o}=i,{location:a,history:l}=this._window,c=ya(s,n);s=c["@id"],"replace"===t&&0===this.index&&(c["@origin"]=!0);const h=a.href;l[`${t}State`](c,"",this.toUrl(s));const u=a.href;if(ba(c,this._stack),r)this._stack[`${t}Stack`](c);else{const s={df:new e.Deferred(o),newId:wa(u),oldId:wa(h),postproc:t,nextState:c};await this.dispatchChangeInfo(c,s)}return this.index}async dispatchChangeInfo(t,s){const n=((t,s)=>(t[e.$cdp]=s,t))(t,s);this._window.dispatchEvent(new PopStateEvent("popstate",{state:n})),await s.df}async suppressEventListenerScope(t){try{this._window.removeEventListener("popstate",this._popStateHandler);const e=()=>new Promise(t=>{this._window.addEventListener("popstate",e=>{t(e.state)})});await t(e)}finally{this._window.addEventListener("popstate",this._popStateHandler)}}async rollbackHistory(t,e){const{history:s}=this._window;switch(t){case"replace":s.replaceState(this.state,"",this.toUrl(this.id));break;case"push":await this.suppressEventListenerScope(async t=>{const e=t();s.go(-1),await e});break;default:await this.suppressEventListenerScope(async t=>{const n=this.index-this.closest(e);if(0!==n){const e=t();n&&s.go(n),await e}})}}async clearForwardHistory(){await this.suppressEventListenerScope(async t=>{const e=t=>t?.["@origin"],{history:s}=this._window;let n=s.state;for(;!e(n);){const e=t();s.back(),n=await e}const i=t=>{const e={...t};return delete e.router,delete e["@params"],JSON.parse(JSON.stringify(e))};for(let t=1,e=this._stack.length;t<e;t++){const e=this._stack.at(t);s.pushState(i(e),"",this.toUrl(e["@id"]))}})}async onPopState(t){const{location:s}=this._window,[n,i]=(t=>{if(e.isObject(t)&&t[e.$cdp]){const s=t[e.$cdp];return delete t[e.$cdp],[t,s]}return[t]})(t.state),r=i?.newId??wa(s.href),o=i?.postproc??"seek",a=i?.df??this._dfGo??new e.Deferred,l=i?.prevState??this.state,c=i?.nextState??this.direct(r).state??ya(r,n),{cancel:h,token:u}=e.CancelToken.source();try{if(a.catch(e.noop),await this.triggerEventAndWait("changing",c,h),u.requested)throw u.reason;this._stack[`${o}Stack`](c),await this.triggerEventAndWait("refresh",c,l),a.resolve()}catch(t){await this.rollbackHistory(o,r),this.publish("error",t),a.reject(t)}}}function Ca(t,e,s){const{context:n,mode:i}=Object.assign({mode:"hash"},s);return new Oa(n??ga,i,t,e)}const Sa=Symbol("MemoryHistory#signature");class ka extends e.EventPublisher{_stack=new Ea;constructor(t,e){super(),this[Sa]=!0,this.replace(t,e,{silent:!0})}dispose(){this._stack.dispose(),this.off(),delete this[Sa]}async reset(t){if(Number.isNaN(this.index)||this._stack.length<=1)return;const{silent:s}=t??{},n=this.state;this.setIndex(0),await this.clearForward();const i=this.state;if(!s){const t=va();void e.post(()=>{void this.onChangeState("noop",t,i,n)}),await t}}get length(){return this._stack.length}get state(){return this._stack.state}get id(){return this._stack.id}get index(){return this._stack.index}get stack(){return this._stack.array}get canBack(){return!this._stack.isFirst}get canForward(){return!this._stack.isLast}at(t){return this._stack.at(t)}back(){return this.go(-1)}forward(){return this.go(1)}async go(t){const s=this.index;try{const s=t?this.state:void 0,n=this._stack.distance(t??0),i=new e.Deferred;void e.post(()=>{void this.onChangeState("seek",i,n,s)}),await i}catch(t){void 0,this.setIndex(s)}return this.index}traverseTo(t){const{direction:e,delta:s}=this.direct(t);return"missing"===e?(void 0,Promise.resolve(this.index)):this.go(s)}push(t,e,s){return this.updateState("push",t,e,s??{})}replace(t,e,s){return this.updateState("replace",t,e,s??{})}async clearForward(){this._stack.clearForward()}closest(t){return this._stack.closest(t)}direct(t,e){return this._stack.direct(t,e)}setIndex(t){this._stack.index=t}async triggerEventAndWait(t,e,s){const n=[];this.publish(t,e,s,n),await Promise.all(n)}async updateState(t,s,n,i){const{silent:r,cancel:o}=i,a=ya(s,n);if("replace"===t&&0===this.index&&(a["@origin"]=!0),ba(a,this._stack),r)this._stack[`${t}Stack`](a);else{const s=new e.Deferred(o);void e.post(()=>{void this.onChangeState(t,s,a,this.state)}),await s}return this.index}async onChangeState(t,s,n,i){const{cancel:r,token:o}=e.CancelToken.source();try{if(await this.triggerEventAndWait("changing",n,r),o.requested)throw o.reason;this._stack[`${t}Stack`](n),await this.triggerEventAndWait("refresh",n,i),s.resolve()}catch(t){this.publish("error",t),s.reject(t)}}}function $a(t,e){return new ka(t,e)}const Ta=(t,e,s,n)=>{const i=!!n,r=Object.assign({url:t,router:i?void 0:e},n,{query:{},params:{},path:s.path,"@params":i?void 0:s});return i?(o=r,JSON.parse(JSON.stringify(o))):r;var o},La=(t,n)=>{try{t=`/${_a(t)}`;const{query:e,params:i}=n;let r=fa.compile(t)((t=>{const e={};if(t)for(const s of Object.keys(t))e[s]=String(t[s]);return e})(i));return e&&(r+=`?${s.toQueryStrings(e)}`),r}catch(s){throw e.makeResult(e.RESULT_CODE.ERROR_MVC_ROUTER_NAVIGATE_FAILED,`Construct route destination failed. [path: ${t}, detail: ${s.toString()}]`,s)}},Pa=async t=>{const{"@params":s}=t;if(s.page)return!1;const{component:n,componentOptions:i}=s;if(e.isFunction(n))try{s.page=new n(t,i)}catch{s.page=await n(t,i)}else e.isObject(n)?s.page=Object.assign({"@route":t,"@options":i},n):s.page={"@route":t,"@options":i};return!0},Aa=async t=>{if(t.$template)return!1;const s=t=>t instanceof HTMLTemplateElement?k([...t.content.children]):k(t),{content:n}=t;if(null==n)t.$template=k();else if(e.isString(n.selector)){const{selector:e,url:i}=n,r=f(await p(e,{url:i&&c(i)}));if(!r)throw Error(`template load failed. [selector: ${e}, url: ${i}]`);t.$template=s(r)}else e.isFunction(n)?t.$template=s(k(await n())[0]):t.$template=s(k(n)[0]);return!0},Na=t=>{if(t.reverse)switch(t.direction){case"back":return"forward";case"forward":return"back"}return t.direction},Da=(t,e)=>{try{return parseFloat(getComputedStyle(t[0])[`${e}Duration`])}catch{return 0}},Ia=(t,s,n)=>Promise.race([new Promise(e=>t[`${s}End`](e)),e.sleep(1e3*n+100)]),Va=async(t,e,s,n)=>{t.removeClass(e),t.addClass(n);const i=[];for(const e of["animation","transition"]){const s=Da(t,e);s&&i.push(Ia(t,e,s))}await Promise.all(i),t.removeClass([s,n])};class Ma{_promises=[];register(t){this._promises.push(t)}get promises(){return this._promises}async complete(){await Promise.all(this._promises),this._promises.length=0}}class ja extends e.EventPublisher{_routes={};_history;_$el;_raf;_historyChangingHandler;_historyRefreshHandler;_errorHandler;_cssPrefix;_transitionSettings;_navigationSettings;_lastRoute;_prevRoute;_subflowTransitionParams;_inChangingPage=!1;constructor(t,s){super();const{routes:n,start:i,el:r,window:o,history:a,initialPath:l,additionalStacks:c,cssPrefix:h,transition:u,navigation:d}=s;if(this._raf=o?.requestAnimationFrame??ga.requestAnimationFrame,this._$el=k(t,r),!this._$el.length)throw e.makeResult(e.RESULT_CODE.ERROR_MVC_ROUTER_ELEMENT_NOT_FOUND,`Router element not found. [selector: ${t}]`);this._history=((t="hash",s,n)=>e.isString(t)?"memory"===t?$a(s??""):Ca(s,void 0,{mode:t,context:n}):t)(a,l,o),this._historyChangingHandler=this.onHistoryChanging.bind(this),this._historyRefreshHandler=this.onHistoryRefresh.bind(this),this._errorHandler=this.onHandleError.bind(this),this._history.on("changing",this._historyChangingHandler),this._history.on("refresh",this._historyRefreshHandler),this._history.on("error",this._errorHandler),this._$el.on("click","[href]",this.onAnchorClicked.bind(this)),this._cssPrefix=h??"cdp",this._transitionSettings=Object.assign({default:"none",reload:"none"},u),this._navigationSettings=Object.assign({method:"push"},d),((t,e)=>{const s=`\n    .${e}-transition-running {\n        pointer-events: none;\n    }\n    .${e}-hidden {\n        visibility: hidden;\n        pointer-events: none;\n    }\n    `,n=new t.CSSStyleSheet;n.replaceSync(s);const{document:i}=t,r=i.adoptedStyleSheets;i.adoptedStyleSheets=[...r,n]})(o??ga,this._cssPrefix),(async()=>{await this.register(n,!1),c?.length&&await this.pushPageStack(c,{noNavigate:!0}),i&&await this.refresh()})()}get el(){return this._$el[0]}get currentRoute(){return this._history.state}get isInSubFlow(){return!!this.findSubFlowParams(!1)}get canBack(){return this._history.canBack}get canForward(){return this._history.canForward}async register(t,s=!1){const n=[];for(const s of(t=>{const s=(t,e)=>{const n=[];for(const i of e)i.path=`${t.replace(/\/$/,"")}/${_a(i.path)}`,n.push(i),i.routes&&n.push(...s(i.path,i.routes));return n};return s("",e.isArray(t)?t:t?[t]:[]).map(t=>{try{const{regexp:s,keys:n}=fa.pathToRegexp(t.path);t.regexp=s,t.paramKeys=n.filter(t=>e.isString(t.name)).map(t=>t.name)}catch(t){void 0}return t})})(t)){this._routes[s.path]=s;const{content:t,prefetch:e}=s;t&&e&&n.push(s)}return n.length&&await this.setPrefetchContents(n),s&&await this.refresh(),this}async navigate(t,s){try{const n=this.findRouteContextParams(t);if(!n)throw e.makeResult(e.RESULT_CODE.ERROR_MVC_ROUTER_NAVIGATE_FAILED,`Route not found. [to: ${t}]`);const i=Object.assign({intent:void 0},s),r=La(t,i),o=Ta(r,this,n,i),a=i.method??this._navigationSettings.method;try{await this._history[a](r,o)}catch{}}catch(t){this.onHandleError(t)}return this}async pushPageStack(t,s){try{const{noNavigate:n,traverseTo:i}=s??{},r=e.isArray(t)?t:[t],o=r.filter(t=>!!t.route).map(t=>t.route);await this.register(o,!1),await this.suppressEventListenerScope(async()=>{for(const t of r){const{path:s,transition:n,reverse:i}=t,r=Ra(s),o=this.findRouteContextParams(r);if(null==o)throw e.makeResult(e.RESULT_CODE.ERROR_MVC_ROUTER_ROUTE_CANNOT_BE_RESOLVED,`Route cannot be resolved. [path: ${s}]`,t);const a=Ta(r,this,o,{intent:void 0});a.transition=n,a.reverse=i,this._history.push(r,a,{silent:!0})}await this.waitFrame(),i&&await this._history.traverseTo(Ra(i))}),n||await this.refresh()}catch(t){this.onHandleError(t)}return this}back(){return this.go(-1)}forward(){return this.go(1)}async go(t){return await this._history.go(t),this}async traverseTo(t){return await this._history.traverseTo(Ra(t)),this}async beginSubFlow(t,e,s){try{const{transition:n,reverse:i}=s??{},r=Object.assign({transition:this._transitionSettings.default,reverse:!1,origin:this.currentRoute.url},e,{transition:n,reverse:i});this.evaluateSubFlowParams(r),this.currentRoute.subflow=r,await this.navigate(t,s)}catch(t){this.onHandleError(t)}return this}async commitSubFlow(t){const e=this.findSubFlowParams(!0);if(!e)return this;const{transition:s,reverse:n}=e.params;this._subflowTransitionParams=Object.assign({transition:s,reverse:n},t);const{additionalDistance:i,additionalStacks:r}=e.params,o=e.distance+i;return r?.length?(await this.suppressEventListenerScope(()=>this.go(-1*o)),await this.pushPageStack(r)):await this.go(-1*o),await this._history.clearForward(),this}async cancelSubFlow(t){const e=this.findSubFlowParams(!0);if(!e)return this;const{transition:s,reverse:n}=e.params;return this._subflowTransitionParams=Object.assign({transition:s,reverse:n},t),await this.go(-1*e.distance),await this._history.clearForward(),this}transitionSettings(t){const e={...this._transitionSettings};return t&&Object.assign(this._transitionSettings,t),e}navigationSettings(t){const e={...this._navigationSettings};return t&&Object.assign(this._navigationSettings,t),e}async refresh(t=1){switch(t){case 1:return this.go();case 2:return this.releaseCacheContents(void 0),this._prevRoute&&(this._prevRoute.el=null),this.go();default:return void 0,this}}evaluateSubFlowParams(t){let s=0;if(t.base){const n=_a(t.base);let i=!1;const{index:r,stack:o}=this._history;for(let t=r;t>=0;t--,s++)if(o[t]["@id"]===n){i=!0;break}if(!i)throw e.makeResult(e.RESULT_CODE.ERROR_MVC_ROUTER_INVALID_SUBFLOW_BASE_URL,`Invalid sub-flow base url. [url: ${t.base}]`)}else t.base=this.currentRoute.url;Object.assign(t,{additionalDistance:s})}findSubFlowParams(t){const e=this._history.stack;for(let s=e.length-1,n=0;s>=0;s--,n++)if(e[s].subflow){const i=e[s].subflow;return t&&delete e[s].subflow,{distance:n,params:i}}}makeRouteChangeInfo(t,e){const s=t.intent;delete t.intent;const n=e??this._lastRoute,i=this._history.direct(t["@id"],n?.["@id"]).direction,r=new Ma,o=!n||t.url===n.url,{transition:a,reverse:l}=this._subflowTransitionParams??(o?{transition:this._transitionSettings.reload,reverse:!1}:"back"!==i?t:n);return{router:this,from:n,to:t,direction:i,asyncProcess:r,reload:o,transition:a,reverse:l,intent:s}}findRouteContextParams(t){const e=`/${_a(t.split("?")[0])}`;for(const t of Object.keys(this._routes)){const{regexp:s}=this._routes[t];if(s.test(e))return this._routes[t]}}triggerPageCallback(t,s,n){const i=e.camelize(`page-${t}`);if(e.isFunction(s?.[i])){const t=s[i](n);t instanceof e.NativePromise&&n.asyncProcess&&n.asyncProcess.register(t)}}waitFrame(){return h(1,this._raf)}async changePage(t,n){try{this._inChangingPage=!0,(t=>{const{url:n}=t;t.query=n.includes("?")?s.parseUrlQuery(_a(n)):{},t.params={};const{regexp:i,paramKeys:r}=t["@params"];if(r.length){const o=i.exec(n)?.map((t,e)=>({value:t,key:r[e-1]}));for(const n of o)null!=n.key&&null!=n.value&&e.assignValue(t.params,n.key,s.convertUrlParamType(n.value))}})(t);const i=this.makeRouteChangeInfo(t,n);this._subflowTransitionParams=void 0;const[r,o,a,l]=await this.prepareChangeContext(i),c=await this.transitionPage(r,o,a,l,i);this.updateChangeContext(o,l,i,c),t.url===this.findSubFlowParams(!1)?.params.origin&&(this.findSubFlowParams(!0),await this._history.clearForward()),await this.treatPrefetchContents(),this.publish("changed",i)}finally{this._inChangingPage=!1}}async prepareChangeContext(t){const e=t.to,s=t.from,{"@params":n}=e,{"@params":i}=s??{};await Pa(e),await Aa(n),t.samePageInstance=i?.page&&i.page===n.page;const{reload:r,samePageInstance:o,asyncProcess:a}=t;!r&&o?await this.cloneContent(e,n,s,t,a):e.el||await this.loadContent(e,n,t,a);const l=k(e.el),c=n.page;return l.isConnected||await this.mountContent(l,c,t,a),[c,l,r&&{}||(i?.page??{}),r&&k(null)||k(s?.el)]}async cloneContent(t,e,s,n,i){t.el=s.el,s.el=t.el?.cloneNode(!0),k(s.el).removeAttr("id").insertBefore(t.el),k(t.el).addClass(`${this._cssPrefix}-hidden`).removeClass([`${this._cssPrefix}-page-current`,`${this._cssPrefix}-page-previous`]),this.publish("cloned",n),this.triggerPageCallback("cloned",e.page,n),await i.complete()}async loadContent(t,e,s,n){let i=!0;if(!t.el){const s=this._routes[t.path]["@route"]?.el;i=!s,s?t.el=s:e.$template?.isConnected?(t.el=e.$template[0],e.$template=e.$template.clone()):t.el=e.$template.clone()[0]}t!==this._routes[t.path]["@route"]&&(this._routes[t.path]["@route"]=t),i&&(this.publish("loaded",s),await n.complete(),this.triggerPageCallback("init",e.page,s),await n.complete())}async mountContent(t,e,s,n){t.addClass(`${this._cssPrefix}-hidden`),this._$el.append(t),this.publish("mounted",s),this.triggerPageCallback("mounted",e,s),await n.complete()}unmountContent(t){const e=k(t.el),s=t["@params"].page;e.isConnected&&(e.detach(),this.publish("unmounted",t),this.triggerPageCallback("unmounted",s,t)),t.el&&(t.el=null,this.publish("unloaded",t),this.triggerPageCallback("removed",s,t))}async transitionPage(t,e,s,n,i){const r=i.transition??this._transitionSettings.default,{"enter-from-class":o,"enter-active-class":a,"enter-to-class":l,"leave-from-class":c,"leave-active-class":h,"leave-to-class":u}=this._transitionSettings,d=o??`${r}-enter-from`,p=a??`${r}-enter-active`,f=l??`${r}-enter-to`,g=c??`${r}-leave-from`,m=h??`${r}-leave-active`,_=u??`${r}-leave-to`;return await this.beginTransition(t,e,d,p,s,n,g,m,i),await this.waitFrame(),await Promise.all([Va(e,d,p,f),Va(n,g,m,_)]),await this.waitFrame(),await this.endTransition(t,e,s,n,i),r}async beginTransition(t,e,s,n,i,r,o,a,l){this._$el.addClass([`${this._cssPrefix}-transition-running`,`${this._cssPrefix}-transition-direction-${Na(l)}`]),e.addClass([s,`${this._cssPrefix}-transition-running`]).removeClass(`${this._cssPrefix}-hidden`).reflow().addClass(n),r.addClass([o,a,`${this._cssPrefix}-transition-running`]),this.publish("before-transition",l),this.triggerPageCallback("before-leave",i,l),this.triggerPageCallback("before-enter",t,l),await l.asyncProcess.complete()}async endTransition(t,e,s,n,i){e[0]!==n[0]&&n.addClass(`${this._cssPrefix}-hidden`),e.removeClass([`${this._cssPrefix}-transition-running`]),n.removeClass([`${this._cssPrefix}-transition-running`]),this._$el.removeClass([`${this._cssPrefix}-transition-running`,`${this._cssPrefix}-transition-direction-${Na(i)}`]),this.triggerPageCallback("after-leave",s,i),this.triggerPageCallback("after-enter",t,i),this.publish("after-transition",i),await i.asyncProcess.complete()}updateChangeContext(t,e,s,n){const{from:i,reload:r,samePageInstance:o,direction:a,to:l}=s,c=i,h=l,u=!r;t[0]!==e[0]&&(e.removeClass(`${this._cssPrefix}-page-current`).addClass(`${this._cssPrefix}-page-previous`),t.addClass(`${this._cssPrefix}-page-current`),u&&this._prevRoute&&(this._prevRoute.el?.classList.remove(`${this._cssPrefix}-page-previous`),this.treatDomCacheContents(h,this._prevRoute))),u&&(this._prevRoute=c,o&&(e.detach(),t.addClass(`${this._cssPrefix}-page-previous`),this._prevRoute&&(this._prevRoute.el=null))),this._lastRoute=this.currentRoute,"forward"===a&&n&&(this._lastRoute.transition=n)}releaseCacheContents(t){for(const e of Object.keys(this._routes)){const s=this._routes[e]["@route"];s&&(null==t?this.unmountContent(s):s.el===t&&(s.el=null))}for(const e of this._history.stack)(null==t&&e.el||e.el===t)&&(e.el=null)}treatDomCacheContents(t,e){if(e.el&&e.el!==this.currentRoute.el){const s=k(e.el),n=s.data("dom-cache");if("connect"!==n){const i=e["@params"].page;s.detach();const r=e["@params"].page!==t["@params"].page;r&&(this.publish("unmounted",e),this.triggerPageCallback("unmounted",i,e)),"memory"!==n&&(this.releaseCacheContents(e.el),e.el=null,r&&(this.publish("unloaded",e),this.triggerPageCallback("removed",i,e)))}}}async setPrefetchContents(t){const e=(t,e)=>{const s=Ta(t.prefetch,this,t);return s.el=e,s},s=t=>({router:this,to:t,direction:"none",asyncProcess:new Ma,reload:!1});for(const n of t){const t=n["@route"]?.el;if(!t||this.currentRoute.el!==t&&this._lastRoute?.el!==t&&this._prevRoute?.el!==t){await Aa(n);const t=n.$template[0];if(!t.isConnected){const i=e(n,t);await Pa(i);const r=s(i),{asyncProcess:o}=r;await this.loadContent(i,n,r,o),await this.mountContent(k(t),n.page,r,o)}}}}async treatPrefetchContents(){const t=[],e=this.currentRoute.el?.querySelectorAll("[data-prefetch]")??[];for(const s of e){const e=k(s);if(!1!==e.data("prefetch")){const s=e.attr("href"),n=this.findRouteContextParams(s);n&&(n.prefetch=s,t.push(n))}}await this.setPrefetchContents(t)}onHistoryChanging(t,s,n){if(this._inChangingPage)return s(e.makeResult(e.RESULT_CODE.ERROR_MVC_ROUTER_BUSY)),void 0;const i=this.makeRouteChangeInfo(t,void 0);this.publish("will-change",i,s),n.push(...i.asyncProcess.promises)}onHistoryRefresh(t,s,n){const i=t=>{const s=`/${t["@id"]}`,n=this.findRouteContextParams(s);if(null==n)throw e.makeResult(e.RESULT_CODE.ERROR_MVC_ROUTER_ROUTE_CANNOT_BE_RESOLVED,`Route cannot be resolved. [path: ${s}]`,t);return null==t["@params"]&&Object.assign(t,Ta(s,this,n)),t.el??=this._history.direct(t["@id"])?.state?.el,t};try{n.push(this.changePage(i(t),s))}catch(t){this.onHandleError(t)}}onHandleError(t){this.publish("error",e.isResult(t)?t:e.makeResult(e.RESULT_CODE.ERROR_MVC_ROUTER_NAVIGATE_FAILED,"Route navigate failed.",t))}onAnchorClicked(t){const e=k(t.target).closest("[href]");if(e.data("prevent-router"))return;t.preventDefault();const s=e.attr("href"),n=e.data("transition"),i=e.data("navigate-method"),r="push"===i||"replace"===i?{method:i}:{};"#"===s?void this.back():void this.navigate(s,{transition:n,...r})}async suppressEventListenerScope(t){try{return this._history.off("changing",this._historyChangingHandler),this._history.off("refresh",this._historyRefreshHandler),this._history.off("error",this._errorHandler),await t()}finally{this._history.on("changing",this._historyChangingHandler),this._history.on("refresh",this._historyRefreshHandler),this._history.on("error",this._errorHandler)}}}function Ua(t,e){return new ja(t,Object.assign({start:!0},e))}!function(){let t=CDP_DECLARE.RESULT_CODE;t[t.APP_DECLARE=9007199254740991]="APP_DECLARE",void(t[t.ERROR_APP_CONTEXT_NEED_TO_BE_INITIALIZED=CDP_DECLARE.DECLARE_ERROR_CODE(100,81,"AppContext need to be initialized with options at least once.")]="ERROR_APP_CONTEXT_NEED_TO_BE_INITIALIZED")}();const Fa=e.safe(globalThis.window),Ha=async(t,e)=>{null!=e&&await new Promise(s=>{t.addEventListener(e,s,{once:!0})})},Ba=[];class za extends e.EventPublisher{_window;_router;_ready=new e.Deferred;_extension;constructor(t){super();const{main:e,window:s,routes:n}=t,i=Object.assign({},t,{routes:n.concat(...Ba),start:!1});this._window=s??Fa,this._router=Ua(e,i),this.initialize(t)}get router(){return this._router}get ready(){return this._ready}get activePage(){return this._router.currentRoute["@params"]?.page||{}}get orientation(){const t=k(this._window);return t.width()<t.height()?"portrait":"landscape"}get extension(){return this._extension}set extension(t){this._extension=t}async changeLanguage(t,e){const s=await ts(t,e);return await this._router.refresh(2),this.publish("languagechange",Ze(),s),s}isCurrentPath(t){const e=Ra(t),s=Ra(this._router.currentRoute["@id"]);return e===s}async initialize(t){const{splash:s,i18n:n,waitForReady:i,documentEventReady:r,documentEventBackButton:o,start:a}=t,{_window:l}=this;l.addEventListener("error",this.onGlobalError.bind(this)),l.addEventListener("unhandledrejection",this.onGlobalUnhandledRejection.bind(this)),await(async t=>{"loading"===t.readyState&&await new Promise(e=>{t.addEventListener("DOMContentLoaded",e,{once:!0})})})(l.document),await Promise.all([Xe(n),e.isFunction(i)?i(this):i,Ha(l.document,r)]),l.document.addEventListener(o,this.onHandleBackKey.bind(this)),l.addEventListener("orientationchange",this.onHandleOrientationChanged.bind(this)),this._router.on("loaded",this.onPageLoaded.bind(this)),a&&await this._router.refresh(),k(s,l.document).remove(),this._ready.resolve(),this.publish("ready",this)}onPageLoaded(t){es(t.to.el)}onGlobalError(t){void 0}onGlobalUnhandledRejection(t){void 0}onHandleBackKey(t){this.publish("backbutton",t)}async onHandleOrientationChanged(){const{requestAnimationFrame:t,screen:e}=this._window;await h(1,t),this.publish("orientationchange",this.orientation,e.orientation.angle)}}let Ka;const Wa=Symbol("page-view:properties");t.AppContext=t=>{const s=(n=Object.assign({main:"#app",start:!0,routes:[],documentEventBackButton:"backbutton"},t),Object.assign({},e.getConfig(),e.getGlobalNamespace("Config"),n));var n;if(null==t&&null==Ka)throw e.makeResult(e.RESULT_CODE.ERROR_APP_CONTEXT_NEED_TO_BE_INITIALIZED,"AppContext should be initialized with options at least once.");return s.reset&&(Ka=void 0,(()=>{const t=qe;delete t.options,delete t.language,delete t.languages,delete t.isInitialized})()),Ka??=new za(s),Ka},t.ArrayCursor=class qa{_array;_bof;_eof;_index;constructor(t,e=0){this._array=t,this._index=e,this.valid()?this._bof=this._eof=!1:(this._index=-1,this._bof=!0,this._eof=!1)}reset(t=[],e=-1){return this._array=t,this._index=e,this.valid()?this._bof=this._eof=!1:(this._index=-1,this._bof=!0,this._eof=!1),this}get current(){return this._array[this._index]}get index(){return this._index}get length(){return this._array.length}get isBOF(){return this._bof}get isEOF(){return this._eof}get array(){return this._array}moveFirst(){return this._index=0,this._bof=this._eof=!1,this.valid()||(this._index=-1,this._bof=!0),this}moveLast(){return this._index=this._array.length-1,this._bof=this._eof=!1,this.valid()||(this._eof=!0),this}moveNext(){return this._bof?(this._bof=!1,this._index=0):this._index++,this.valid()||(this._index=-1,this._eof=!0),this}movePrevious(){return this._eof?(this._eof=!1,this._index=this.length-1):this._index--,this.valid()||(this._index=-1,this._bof=!0),this}seek(t){return this._index="number"==typeof t?t:this._array.findIndex(t),this.valid()||(this._index=-1,this._bof=!1,this._eof=!0),this}valid(){return 0<=this._index&&this._index<this._array.length}},t.AsyncDirective=qi,t.Collection=On,t.Directive=ki,t.DynamicCondition=en,t.Hook=Qo,t.Model=Rs,t.PageView=class Ga extends Dn{[Wa];constructor(t,e){super(e),this[Wa]={route:t}}get active(){return((t,e)=>{for(const s of t.classList)if(s.includes(e))return!0;return!1})(this.el,"page-current")}get"@route"(){return this[Wa].route}get _route(){return this["@route"]}get _router(){return this[Wa].route?.router}render(...t){}onPageInit(t){}onPageMounted(t){}onPageCloned(t,e){}onPageBeforeEnter(t,e,s,n){}onPageAfterEnter(t,e,s,n){}onPageBeforeLeave(t,e,s,n){}onPageAfterLeave(t,e,s,n){}onPageUnmounted(t){}onPageRemoved(t){}pageInit(t){const{to:e}=t;this[Wa].route=e;const{el:s}=e;return s!==this.el&&this.setElement(s),this.onPageInit(e)}pageMounted(t){const{to:e}=t;return this[Wa].route=e,this.onPageMounted(e)}pageCloned(t){const{to:e,from:s}=t;return this[Wa].route=e,this.onPageCloned(e,s)}pageBeforeEnter(t){const{to:e,from:s,direction:n,intent:i}=t;return this[Wa].route=e,this.onPageBeforeEnter(e,s,n,i)}pageAfterEnter(t){const{to:e,from:s,direction:n,intent:i}=t;return this[Wa].route=e,this.onPageAfterEnter(e,s,n,i)}pageBeforeLeave(t){const{to:e,from:s,direction:n,intent:i}=t;return this[Wa].route=s,this.onPageBeforeLeave(s,e,n,i)}pageAfterLeave(t){const{to:e,from:s,direction:n,intent:i}=t;return this[Wa].route=s,this.onPageAfterLeave(s,e,n,i)}pageUnmounted(t){this.onPageUnmounted(t)}pageRemoved(t){this.release(),this[Wa].route=void 0,this.onPageRemoved(t)}},t.PartType=Ci,t.RESULT_VALID_ATTRS=ws,t.TemplateBridge=jo,t.View=Dn,t.ViewCore=An,t.WebStorage=ss,t._$LH=Oi,t.appendArray=js,t.appendCollection=async function Ya(t,e,s){const n=t.length,i=await Cn(t,s,(t,s)=>js(t,e,s));return kn("add",i,n,t.length-1,n)},t.changeLanguage=ts,t.clearArray=Ms,t.clearCollection=async function Ja(t,e){const s=t.length-1,n=await Cn(t,e,(t,e)=>Ms(t,e));return kn("remove",n,0,s)},t.clearTemplateCache=function Qa(){u={},d={}},t.conditionalFix=on,t.convertSortKeys=As,t.createMemoryHistory=$a,t.createMustacheTransformer=Zr,t.createRef=()=>new Gi,t.createRouter=Ua,t.createSessionHistory=Ca,t.createStampinoTransformer=Vo,t.createStorageDataSync=ds,t.dataSyncNULL=is,t.dataSyncREST=ls,t.dataSyncSTORAGE=ps,t.defaultCollatorProvider=function Xa(t){if(null==t)return Cs;{const e=Cs;return Cs=t,e}},t.defaultSync=gs,t.directive=Si,t.directives=Ar,t.disposeMemoryHistory=function Za(t){t[Sa]&&t.dispose()},t.disposeSessionHistory=function tl(t){t[xa]&&t.dispose()},t.dom=k,t.evaluateTemplate=Ao,t.getBooleanComparator=Ts,t.getDateComparator=ks,t.getGenericComparator=$s,t.getLanguage=Ze,t.getLanguageList=()=>qe.languages||[Ge.language],t.getNumberComparator=Ls,t.getStringComparator=Ss,t.getTemplate=async function el(t,s){const{type:n,url:i,noCache:r,callback:o}=Object.assign({type:"engine",noCache:!1},s);let a=await p(t,{url:i,noCache:r});if(!a)throw new URIError(`cannot specified template resource. { selector: ${t},  url: ${i} }`);switch(e.isFunction(o)&&(a=await o(a)),n){case"engine":return e.TemplateEngine.compile(a instanceof HTMLTemplateElement?e.unescapeHTML(a.innerHTML):a,s);case"bridge":return jo.compile(a,s);default:throw new TypeError(`[type: ${n}] is unknown.`)}},t.getWebDirectory=a,t.hooks=ca,t.html=ii,t.i18n=qe,t.idAttribute=Os,t.initializeI18N=Xe,t.insertArray=Us,t.insertCollection=async function sl(t,e,s,n){const i=await Cn(t,n,(t,n)=>Us(t,e,s,n));return kn("add",i,e,t.length-1,e)},t.isDOMClass=zt,t.isModel=xs,t.loadTemplateSource=p,t.localize=es,t.makeHook=Zo,t.noChange=oi,t.nothing=ai,t.path2regexp=fa,t.platform=ee,t.prepareTemplate=Po,t.queryItems=cn,t.queryPlatform=te,t.registerPage=t=>{Ba.push(t)},t.removeArray=Hs,t.removeCollection=async function nl(t,e,s){const n=Sn(e),i=t.length-1,r=await Cn(t,s,(t,s)=>Hs(t,e,s));return kn("remove",r,n,i)},t.render=Ri,t.reorderArray=Fs,t.reorderCollection=async function il(t,e,s,n){const i=Sn([e,...s]),r=await Cn(t,n,(t,n)=>Fs(t,e,s,n));return kn("reorder",r,i,t.length-1,e)},t.resetMemoryHistory=async function rl(t,e){t[Sa]&&await t.reset(e)},t.resetSessionHistory=async function ol(t,e){t[xa]&&await t.reset(e)},t.searchItems=nn,t.svg=ri,t.t=Qe,t.toComparator=Ps,t.toRouterPath=Ra,t.toRouterStackId=wa,t.toTemplateElement=f,t.toTemplateString=function al(t){return t instanceof HTMLTemplateElement?t.innerHTML:t},t.toTemplateStringsArray=Mr,t.toUrl=c,t.transformer=to,t.waitFrame=h,t.waitIdle=function ll(t){return new Promise(e=>o(()=>e(),t))},t.webRoot=l,t.webStorage=ns,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=lib-web.min.map